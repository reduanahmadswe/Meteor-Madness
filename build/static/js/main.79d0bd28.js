/*! For license information please see main.79d0bd28.js.LICENSE.txt */
(()=>{var t={45:(t,e,n)=>{var i=n(738).default;t.exports=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},49:(t,e)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}function v(){}function _(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},y.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},v.prototype=y.prototype;var x=_.prototype=new v;x.constructor=_,m(x,y.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function T(t,e,i){var r,a={},o=null,s=null;if(null!=e)for(r in void 0!==e.ref&&(s=e.ref),void 0!==e.key&&(o=""+e.key),e)w.call(e,r)&&!M.hasOwnProperty(r)&&(a[r]=e[r]);var l=arguments.length-2;if(1===l)a.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:n,type:t,key:o,ref:s,props:a,_owner:S.current}}function E(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var A=/\/+/g;function C(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function P(t,e,r,a,o){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var l=!1;if(null===t)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=t),t=""===a?"."+C(l,0):a,b(o)?(r="",null!=t&&(r=t.replace(A,"$&/")+"/"),P(o,e,r,"",function(t){return t})):null!=o&&(E(o)&&(o=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(o,r+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+t)),e.push(o)),1;if(l=0,a=""===a?".":a+":",b(t))for(var c=0;c<t.length;c++){var u=a+C(s=t[c],c);l+=P(s,e,r,u,o)}else if(u=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=p&&t[p]||t["@@iterator"])?t:null}(t),"function"===typeof u)for(t=u.call(t),c=0;!(s=t.next()).done;)l+=P(s=s.value,e,r,u=a+C(s,c++),o);else if("object"===s)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function I(t,e,n){if(null==t)return t;var i=[],r=0;return P(t,i,"","",function(t){return e.call(n,t,r++)}),i}function R(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var k={current:null},L={transition:null},D={ReactCurrentDispatcher:k,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};function z(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:I,forEach:function(t,e,n){I(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return I(t,function(){e++}),e},toArray:function(t){return I(t,function(t){return t})||[]},only:function(t){if(!E(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=y,e.Fragment=r,e.Profiler=o,e.PureComponent=_,e.StrictMode=a,e.Suspense=u,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,e.act=z,e.cloneElement=function(t,e,i){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),a=t.key,o=t.ref,s=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,s=S.current),void 0!==e.key&&(a=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)w.call(e,c)&&!M.hasOwnProperty(c)&&(r[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:t.type,key:a,ref:o,props:r,_owner:s}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:t},t.Consumer=t},e.createElement=T,e.createFactory=function(t){var e=T.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=E,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:R}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=L.transition;L.transition={};try{t()}finally{L.transition=e}},e.unstable_act=z,e.useCallback=function(t,e){return k.current.useCallback(t,e)},e.useContext=function(t){return k.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return k.current.useDeferredValue(t)},e.useEffect=function(t,e){return k.current.useEffect(t,e)},e.useId=function(){return k.current.useId()},e.useImperativeHandle=function(t,e,n){return k.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return k.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return k.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return k.current.useMemo(t,e)},e.useReducer=function(t,e,n){return k.current.useReducer(t,e,n)},e.useRef=function(t){return k.current.useRef(t)},e.useState=function(t){return k.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return k.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return k.current.useTransition()},e.version="18.3.1"},119:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(345)},136:function(t,e,n){var i=n(897).default;t.exports=function(){"use strict";var t={},e={};function n(n,i,r){if(e[n]=r,"index"===n){var a="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",o={};return e.shared(o),e.index(t,o),"undefined"!==typeof window&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([a],{type:"text/javascript"}))),t}}return n("shared",["exports"],function(t){function e(t,e,n,i){return new(n||(n=Promise))(function(r,a){function o(t){try{l(i.next(t))}catch(t){a(t)}}function s(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,s)}l((i=i.apply(t,e||[])).next())})}function n(t,e){this.x=t,this.y=e}function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var a,o;"function"==typeof SuppressedError&&SuppressedError,n.prototype={clone(){return new n(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,e){return this.clone()._rotateAround(t,e)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){const e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult(t){const e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){const t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){const e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround(t,e){const n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:n},n.convert=function(t){if(t instanceof n)return t;if(Array.isArray(t))return new n(+t[0],+t[1]);if(void 0!==t.x&&void 0!==t.y)return new n(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};var s=function(){if(o)return a;function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}return o=1,a=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},a}(),l=r(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const n=4*i;e.fillStyle="rgb(".concat(n,",").concat(n+1,",").concat(n+2,")"),e.fillRect(i%t,Math.floor(i/t),1,1)}const n=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&n[e]!==e){u=!0;break}}}return u||!1}var p=1e-6,f="undefined"!=typeof Float32Array?Float32Array:Array;function m(){var t=new f(9);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y(){var t=new f(3);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function v(t){return Math.hypot(t[0],t[1],t[2])}function _(t,e,n){var i=new f(3);return i[0]=t,i[1]=e,i[2]=n,i}function x(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function b(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function w(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2];return t[0]=r*l-a*s,t[1]=a*o-i*l,t[2]=i*s-r*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var S,M=v;function T(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t}function E(){var t=new f(4);return f!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function A(t,e,n,i){var r=.5*Math.PI/180;e*=r,n*=r,i*=r;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return t[0]=a*l*u-o*s*c,t[1]=o*s*u+a*l*c,t[2]=o*l*c-a*s*u,t[3]=o*l*u+a*s*c,t}function C(){var t=new f(2);return f!=Float32Array&&(t[0]=0,t[1]=0),t}function P(t,e){var n=new f(2);return n[0]=t,n[1]=e,n}y(),S=new f(4),f!=Float32Array&&(S[0]=0,S[1]=0,S[2]=0,S[3]=0),y(),_(1,0,0),_(0,1,0),E(),E(),m(),C();const I=8192;function R(t,e,n){return e*(I/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function k(t,e){return(t%e+e)%e}function L(t,e,n){return t*(1-n)+e*n}function D(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function z(t,e,n,i){const r=new l(t,e,n,i);return t=>r.solve(t)}const N=z(.25,.1,.25,1);function O(t,e,n){return Math.min(n,Math.max(e,t))}function F(t,e,n){const i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function B(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}let U=1;function j(t,e,n){const i={};for(const r in t)i[r]=e.call(this,t[r],r,t);return i}function V(t,e,n){const i={};for(const r in t)e.call(this,t[r],r,t)&&(i[r]=t[r]);return i}function H(t){return Array.isArray(t)?t.map(H):"object"==typeof t&&t?j(t,H):t}const G={};function W(t){G[t]||("undefined"!=typeof console&&console.warn(t),G[t]=!0)}function q(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Z(t){return"undefined"!=typeof WorkerGlobalScope&&void 0!==t&&t instanceof WorkerGlobalScope}let X=null;function Y(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function J(t,n,i,r,a){return e(this,void 0,void 0,function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const o=null==e?void 0:e.format;if(!o||!o.startsWith("BGR")&&!o.startsWith("RGB"))throw new Error("Unrecognized format ".concat(o));const s=o.startsWith("BGR"),l=new Uint8ClampedArray(r*a*4);if(yield e.copyTo(l,function(t,e,n,i,r){const a=4*Math.max(-e,0),o=(Math.max(0,n)-n)*i*4+a,s=4*i,l=Math.max(0,e),c=Math.max(0,n);return{rect:{x:l,y:c,width:Math.min(t.width,e+i)-l,height:Math.min(t.height,n+r)-c},layout:[{offset:o,stride:s}]}}(t,n,i,r,a)),s)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}})}let $,Q;function tt(t,e,n,i){return t.addEventListener(e,n,i),{unsubscribe:()=>{t.removeEventListener(e,n,i)}}}function et(t){return t*Math.PI/180}function nt(t){return t/Math.PI*180}const it={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},rt={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},at="AbortError";function ot(){return new Error(at)}const st={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function lt(t){return st.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]}const ct="global-dispatcher";class ut extends Error{constructor(t,e,n,i){super("AJAXError: ".concat(e," (").concat(t,"): ").concat(n)),this.status=t,this.statusText=e,this.url=n,this.body=i}}const ht=()=>Z(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,dt=function(t,n){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){const e=lt(t.url);if(e)return e(t,n);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,targetMapId:ct},n)}if(!(/^file:/.test(i=t.url)||/^file:/.test(ht())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(t,n){return e(this,void 0,void 0,function*(){const e=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:ht(),signal:n.signal});let i,r;"json"!==t.type||e.headers.has("Accept")||e.headers.set("Accept","application/json");try{i=yield fetch(e)}catch(e){throw new ut(0,e.message,t.url,new Blob)}if(!i.ok){const e=yield i.blob();throw new ut(i.status,i.statusText,t.url,e)}r="arrayBuffer"===t.type||"image"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text();const a=yield r;if(n.signal.aborted)throw ot();return{data:a,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires")}})}(t,n);if(Z(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,mustQueue:!0,targetMapId:ct},n)}var i;return function(t,e){return new Promise((n,i)=>{var r;const a=new XMLHttpRequest;a.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(a.responseType="arraybuffer");for(const e in t.headers)a.setRequestHeader(e,t.headers[e]);"json"===t.type&&(a.responseType="text",(null===(r=t.headers)||void 0===r?void 0:r.Accept)||a.setRequestHeader("Accept","application/json")),a.withCredentials="include"===t.credentials,a.onerror=()=>{i(new Error(a.statusText))},a.onload=()=>{if(!e.signal.aborted)if((a.status>=200&&a.status<300||0===a.status)&&null!==a.response){let e=a.response;if("json"===t.type)try{e=JSON.parse(a.response)}catch(t){return void i(t)}n({data:e,cacheControl:a.getResponseHeader("Cache-Control"),expires:a.getResponseHeader("Expires")})}else{const e=new Blob([a.response],{type:a.getResponseHeader("Content-Type")});i(new ut(a.status,a.statusText,t.url,e))}},e.signal.addEventListener("abort",()=>{a.abort(),i(ot())}),a.send(t.body)})}(t,n)};function pt(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function ft(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function mt(t,e,n){if(n&&n[t]){const i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}class gt{constructor(t){B(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=t}}class yt extends gt{constructor(t){super("error",B({error:t},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class vt{on(t,e){return this._listeners=this._listeners||{},ft(t,e,this._listeners),{unsubscribe:()=>{this.off(t,e)}}}off(t,e){return mt(t,e,this._listeners),mt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},ft(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new gt(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const a of i)mt(n,a,this._oneTimeListeners),a.call(this,t);const r=this._eventedParent;r&&(B(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof yt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var _t={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const xt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function bt(t,e){const n={};for(const i in t)"ref"!==i&&(n[i]=t[i]);return xt.forEach(t=>{t in e&&(n[t]=e[t])}),n}function wt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!wt(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!wt(t[n],e[n]))return!1;return!0}return t===e}function St(t,e){t.push(e)}function Mt(t,e,n){St(n,{command:"addSource",args:[t,e[t]]})}function Tt(t,e,n){St(e,{command:"removeSource",args:[t]}),n[t]=!0}function Et(t,e,n,i){Tt(t,n,i),Mt(t,e,n)}function At(t,e,n){let i;for(i in t[n])if(Object.prototype.hasOwnProperty.call(t[n],i)&&"data"!==i&&!wt(t[n][i],e[n][i]))return!1;for(i in e[n])if(Object.prototype.hasOwnProperty.call(e[n],i)&&"data"!==i&&!wt(t[n][i],e[n][i]))return!1;return!0}function Ct(t,e,n,i,r,a){t=t||{},e=e||{};for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(wt(t[o],e[o])||n.push({command:a,args:[i,o,e[o],r]}));for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&!Object.prototype.hasOwnProperty.call(t,o)&&(wt(t[o],e[o])||n.push({command:a,args:[i,o,e[o],r]}))}function Pt(t){return t.id}function It(t,e){return t[e.id]=e,t}class Rt{constructor(t,e,n,i){this.message=(t?"".concat(t,": "):"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function kt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}class Lt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Dt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new Dt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error("".concat(t," not found in scope."))}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const zt={kind:"null"},Nt={kind:"number"},Ot={kind:"string"},Ft={kind:"boolean"},Bt={kind:"color"},Ut={kind:"projectionDefinition"},jt={kind:"object"},Vt={kind:"value"},Ht={kind:"collator"},Gt={kind:"formatted"},Wt={kind:"padding"},qt={kind:"colorArray"},Zt={kind:"numberArray"},Xt={kind:"resolvedImage"},Yt={kind:"variableAnchorOffsetCollection"};function Kt(t,e){return{kind:"array",itemType:t,N:e}}function Jt(t){if("array"===t.kind){const e=Jt(t.itemType);return"number"==typeof t.N?"array<".concat(e,", ").concat(t.N,">"):"value"===t.itemType.kind?"array":"array<".concat(e,">")}return t.kind}const $t=[zt,Nt,Ot,Ft,Bt,Ut,Gt,jt,Kt(Vt),Wt,Zt,qt,Xt,Yt];function Qt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Qt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of $t)if(!Qt(t,e))return null}return"Expected ".concat(Jt(t)," but found ").concat(Jt(e)," instead.")}function te(t,e){return e.some(e=>e.kind===t.kind)}function ee(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function ne(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const ie=.96422,re=.82521,ae=4/29,oe=6/29,se=3*oe*oe,le=oe*oe*oe,ce=Math.PI/180,ue=180/Math.PI;function he(t){return(t%=360)<0&&(t+=360),t}function de(t){let e,n,[i,r,a,o]=t;const s=fe((.2225045*(i=pe(i))+.7168786*(r=pe(r))+.0606169*(a=pe(a)))/1);i===r&&r===a?e=n=s:(e=fe((.4360747*i+.3850649*r+.1430804*a)/ie),n=fe((.0139322*i+.0971045*r+.7141733*a)/re));const l=116*s-16;return[l<0?0:l,500*(e-s),200*(s-n),o]}function pe(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fe(t){return t>le?Math.pow(t,1/3):t/se+ae}function me(t){let[e,n,i,r]=t,a=(e+16)/116,o=isNaN(n)?a:a+n/500,s=isNaN(i)?a:a-i/200;return a=1*ye(a),o=ie*ye(o),s=re*ye(s),[ge(3.1338561*o-1.6168667*a-.4906146*s),ge(-.9787684*o+1.9161415*a+.033454*s),ge(.0719453*o-.2289914*a+1.4052427*s),r]}function ge(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function ye(t){return t>oe?t*t*t:se*(t-ae)}const ve=Object.hasOwn||function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function _e(t,e){return ve(t,e)?t[e]:void 0}function xe(t){return parseInt(t.padEnd(2,t),16)/255}function be(t,e){return we(e?t/100:t,0,1)}function we(t,e,n){return Math.min(Math.max(e,t),n)}function Se(t){return!t.some(Number.isNaN)}const Me={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Te(t,e,n){return t+n*(e-t)}function Ee(t,e,n){return t.map((t,i)=>Te(t,e[i],n))}class Ae{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.r=t,this.g=e,this.b=n,this.a=i,r||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[t,e,n,i]))}static parse(t){if(t instanceof Ae)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=_e(Me,t);if(e){const[t,n,i]=e;return[t/255,n/255,i/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let n=1;return[xe(t.slice(n,n+=e)),xe(t.slice(n,n+=e)),xe(t.slice(n,n+=e)),xe(t.slice(n,n+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,n,i,r,a,o,s,l,c,u,h,d]=e,p=[r||" ",s||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[i,o,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[we(+n/e,0,1),we(+a/e,0,1),we(+l/e,0,1),h?be(+h,d):1];if(Se(t))return t}}return}}const n=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[t,e,i,r,a,o,s,l,c]=n,u=[i||" ",a||" ",s].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,we(+r,0,100),we(+o,0,100),l?be(+l,c):1];if(Se(t))return function(t){let[e,n,i,r]=t;function a(t){const r=(t+e/30)%12,a=n*Math.min(i,1-i);return i-a*Math.max(-1,Math.min(r-3,9-r,1))}return e=he(e),n/=100,i/=100,[a(0),a(8),a(4),r]}(t)}}}(t);return e?new Ae(...e,!1):void 0}get rgb(){const{r:t,g:e,b:n,a:i}=this,r=i||1/0;return this.overwriteGetter("rgb",[t/r,e/r,n/r,i])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,n,i,r]=de(t),a=Math.sqrt(n*n+i*i);return[Math.round(1e4*a)?he(Math.atan2(i,n)*ue):NaN,a,e,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",de(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,n,i]=this.rgb;return"rgba(".concat([t,e,n].map(t=>Math.round(255*t)).join(","),",").concat(i,")")}static interpolate(t,e,n){switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb"){case"rgb":{const[i,r,a,o]=Ee(t.rgb,e.rgb,n);return new Ae(i,r,a,o,!1)}case"hcl":{const[i,r,a,o]=t.hcl,[s,l,c,u]=e.hcl;let h,d;if(isNaN(i)||isNaN(s))isNaN(i)?isNaN(s)?h=NaN:(h=s,1!==a&&0!==a||(d=l)):(h=i,1!==c&&0!==c||(d=r));else{let t=s-i;s>i&&t>180?t-=360:s<i&&i-s>180&&(t+=360),h=i+n*t}const[p,f,m,g]=function(t){let[e,n,i,r]=t;return e=isNaN(e)?0:e*ce,me([i,Math.cos(e)*n,Math.sin(e)*n,r])}([h,null!=d?d:Te(r,l,n),Te(a,c,n),Te(o,u,n)]);return new Ae(p,f,m,g,!1)}case"lab":{const[i,r,a,o]=me(Ee(t.lab,e.lab,n));return new Ae(i,r,a,o,!1)}}}}Ae.black=new Ae(0,0,0,1),Ae.white=new Ae(1,1,1,1),Ae.transparent=new Ae(0,0,0,0),Ae.red=new Ae(1,0,0,1);class Ce{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Pe=["bottom","center","top"];class Ie{constructor(t,e,n,i,r,a){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r,this.verticalAlign=a}}class Re{constructor(t){this.sections=t}static fromString(t){return new Re([new Ie(t,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Re?t:Re.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}}class ke{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ke)return t;if("number"==typeof t)return new ke([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ke(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new ke(Ee(t.values,e.values,n))}}class Le{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Le)return t;if("number"==typeof t)return new Le([t]);if(Array.isArray(t)){for(const e of t)if("number"!=typeof e)return;return new Le(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new Le(Ee(t.values,e.values,n))}}class De{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof De)return t;if("string"==typeof t){const e=Ae.parse(t);if(!e)return;return new De([e])}if(!Array.isArray(t))return;const e=[];for(const n of t){if("string"!=typeof n)return;const t=Ae.parse(n);if(!t)return;e.push(t)}return new De(e)}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb";const r=[];if(t.values.length!=e.values.length)throw new Error("colorArray: Arrays have mismatched length (".concat(t.values.length," vs. ").concat(e.values.length,"), cannot interpolate."));for(let a=0;a<t.values.length;a++)r.push(Ae.interpolate(t.values[a],e.values[a],n,i));return new De(r)}}class ze extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Ne=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Oe{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Oe)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const n=t[e],i=t[e+1];if("string"!=typeof n||!Ne.has(n))return;if(!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new Oe(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){const i=t.values,r=e.values;if(i.length!==r.length)throw new ze("Cannot interpolate values of different length. from: ".concat(t.toString(),", to: ").concat(e.toString()));const a=[];for(let o=0;o<i.length;o+=2){if(i[o]!==r[o])throw new ze("Cannot interpolate values containing mismatched anchors. from[".concat(o,"]: ").concat(i[o],", to[").concat(o,"]: ").concat(r[o]));a.push(i[o]);const[t,e]=i[o+1],[s,l]=r[o+1];a.push([Te(t,s,n),Te(e,l,n)])}return new Oe(a)}}class Fe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Fe({name:t,available:!1}):null}}class Be{constructor(t,e,n){this.from=t,this.to=e,this.transition=n}static interpolate(t,e,n){return new Be(t,e,n)}static parse(t){return t instanceof Be?t:Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]?new Be(t[0],t[1],t[2]):"object"==typeof t&&"string"==typeof t.from&&"string"==typeof t.to&&"number"==typeof t.transition?new Be(t.from,t.to,t.transition):"string"==typeof t?new Be(t,t,1):void 0}}function Ue(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([t,e,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function je(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Be||t instanceof Ae||t instanceof Ce||t instanceof Re||t instanceof ke||t instanceof Le||t instanceof De||t instanceof Oe||t instanceof Fe)return!0;if(Array.isArray(t)){for(const e of t)if(!je(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!je(t[e]))return!1;return!0}return!1}function Ve(t){if(null===t)return zt;if("string"==typeof t)return Ot;if("boolean"==typeof t)return Ft;if("number"==typeof t)return Nt;if(t instanceof Ae)return Bt;if(t instanceof Be)return Ut;if(t instanceof Ce)return Ht;if(t instanceof Re)return Gt;if(t instanceof ke)return Wt;if(t instanceof Le)return Zt;if(t instanceof De)return qt;if(t instanceof Oe)return Yt;if(t instanceof Fe)return Xt;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=Ve(i);if(n){if(n===t)continue;n=Vt;break}n=t}return Kt(n||Vt,e)}return jt}function He(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Ae||t instanceof Be||t instanceof Re||t instanceof ke||t instanceof Le||t instanceof De||t instanceof Oe||t instanceof Fe?t.toString():JSON.stringify(t)}class Ge{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!je(t[1]))return e.error("invalid value");const n=t[1];let i=Ve(n);const r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new Ge(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const We={string:Ot,number:Nt,boolean:Ft,object:jt};class qe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,a;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in We)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=We[n],i++}else r=Vt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],i++}n=Kt(r,a)}else{if(!We[r])throw new Error("Types doesn't contain name = ".concat(r));n=We[r]}const a=[];for(;i<t.length;i++){const n=e.parse(t[i],i,Vt);if(!n)return null;a.push(n)}return new qe(n,a)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!Qt(this.type,Ve(n)))return n;if(e===this.args.length-1)throw new ze("Expected value to be of type ".concat(Jt(this.type),", but found ").concat(Jt(Ve(n))," instead."))}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ze={"to-boolean":Ft,"to-color":Bt,"to-number":Nt,"to-string":Ot};class Xe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(!Ze[n])throw new Error("Can't parse ".concat(n," as it is not part of the known types"));if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=Ze[n],r=[];for(let a=1;a<t.length;a++){const n=e.parse(t[a],a,Vt);if(!n)return null;r.push(n)}return new Xe(i,r)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof Ae)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?"Invalid rgba value ".concat(JSON.stringify(e),": expected an array containing either three or four numeric values."):Ue(e[0],e[1],e[2],e[3]),!n))return new Ae(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ze(n||"Could not parse color from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"padding":{let e;for(const n of this.args){e=n.evaluate(t);const i=ke.parse(e);if(i)return i}throw new ze("Could not parse padding from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"numberArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=Le.parse(e);if(i)return i}throw new ze("Could not parse numberArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"colorArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=De.parse(e);if(i)return i}throw new ze("Could not parse colorArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"variableAnchorOffsetCollection":{let e;for(const n of this.args){e=n.evaluate(t);const i=Oe.parse(e);if(i)return i}throw new ze("Could not parse variableAnchorOffsetCollection from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"number":{let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new ze("Could not convert ".concat(JSON.stringify(e)," to number."))}case"formatted":return Re.fromString(He(this.args[0].evaluate(t)));case"resolvedImage":return Fe.fromString(He(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return He(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ye=["Unknown","Point","LineString","Polygon"];class Ke{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ye[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache.get(t);return e||(e=Ae.parse(t),this._parseColorCache.set(t,e)),e}}class Je{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Dt,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this.registry=t,this.path=n,this.key=n.map(t=>"[".concat(t,"]")).join(""),this.scope=r,this.errors=a,this.expectedType=i,this._isConstant=e}parse(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new qe(e,[t]):"coerce"===n?new Xe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found ".concat(typeof i,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;const r=this.registry[i];if(r){let i=r.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,r=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind){if("projectionDefinition"===t.kind&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(t.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(t.kind)&&["value","number","array"].includes(r.kind)||"colorArray"===t.kind&&["value","string","array"].includes(r.kind)||"variableAnchorOffsetCollection"===t.kind&&["value","array"].includes(r.kind))i=n(i,t,e.typeAnnotation||"coerce");else if(this.checkSubtype(t,r))return null}else i=n(i,t,e.typeAnnotation||"assert")}if(!(i instanceof Ge)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){const e=new Ke;try{i=new Ge(i.type,i.evaluate(e))}catch(t){return this.error(t.message),null}}return i}return this.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof t," instead."))}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new Je(this.registry,this._isConstant,i,e||null,r,this.errors)}error(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(t=>"[".concat(t,"]")).join(""));this.errors.push(new Lt(r,t))}checkSubtype(t,e){const n=Qt(t,e);return n&&this.error(n),n}}class $e{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=e.parse(t[r+1],r+1);if(!a)return null;n.push([i,a])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new $e(n,i):null}outputDefined(){return this.result.outputDefined()}}class Qe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Qe(n,e.scope.get(n)):e.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class tn{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Nt),i=e.parse(t[2],2,Kt(e.expectedType||Vt));return n&&i?new tn(i.type.itemType,n,i):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new ze("Array index out of bounds: ".concat(e," < 0."));if(e>=n.length)throw new ze("Array index out of bounds: ".concat(e," > ").concat(n.length-1,"."));if(e!==Math.floor(e))throw new ze("Array index must be an integer, but found ".concat(e," instead."));return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class en{constructor(t,e){this.type=Ft,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Vt),i=e.parse(t[2],2,Vt);return n&&i?te(n.type,[Ft,Ot,Nt,zt,Vt])?new en(n,i):e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(n.type)," instead")):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!ee(e,["boolean","string","number","null"]))throw new ze("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(Ve(e))," instead."));if(!ee(n,["string","array"]))throw new ze("Expected second argument to be of type array or string, but found ".concat(Jt(Ve(n))," instead."));return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class nn{constructor(t,e,n){this.type=Nt,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Vt),i=e.parse(t[2],2,Vt);if(!n||!i)return null;if(!te(n.type,[Ft,Ot,Nt,zt,Vt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,Nt);return r?new nn(n,i,r):null}return new nn(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!ee(e,["boolean","string","number","null"]))throw new ze("Expected first argument to be of type boolean, string, number or null, but found ".concat(Jt(Ve(e))," instead."));let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(t)),ee(n,["string"])){const t=n.indexOf(e,i);return-1===t?-1:[...n.slice(0,t)].length}if(ee(n,["array"]))return n.indexOf(e,i);throw new ze("Expected second argument to be of type array or string, but found ".concat(Jt(Ve(n))," instead."))}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class rn{constructor(t,e,n,i,r,a){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a}static parse(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},a=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const s=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Ve(t)))return null}else n=Ve(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=a.length}const u=e.parse(s,l,i);if(!u)return null;i=i||u.type,a.push(u)}const o=e.parse(t[1],1,Vt);if(!o)return null;const s=e.parse(t[t.length-1],t.length-1,i);return s?"value"!==o.type.kind&&e.concat(1).checkSubtype(n,o.type)?null:new rn(n,i,o,r,a,s):null}evaluate(t){const e=this.input.evaluate(t);return(Ve(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class an{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let a=1;a<t.length-1;a+=2){const r=e.parse(t[a],a,Ft);if(!r)return null;const o=e.parse(t[a+1],a+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=e.parse(t[t.length-1],t.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new an(n,i,r)}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(t=>{let[e,n]=t;return n.outputDefined()})&&this.otherwise.outputDefined()}}class on{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Vt),i=e.parse(t[2],2,Nt);if(!n||!i)return null;if(!te(n.type,[Kt(Vt),Ot,Vt]))return e.error("Expected first argument to be of type array or string, but found ".concat(Jt(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,Nt);return r?new on(n.type,n,i,r):null}return new on(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);let i;if(this.endIndex&&(i=this.endIndex.evaluate(t)),ee(e,["string"]))return[...e].slice(n,i).join("");if(ee(e,["array"]))return e.slice(n,i);throw new ze("Expected first argument to be of type array or string, but found ".concat(Jt(Ve(e))," instead."))}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function sn(t,e){const n=t.length-1;let i,r,a=0,o=n,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),i=t[s],r=t[s+1],i<=e){if(s===n||e<r)return s;a=s+1}else{if(!(i>e))throw new ze("Input is not a number.");o=s-1}return 0}class ln{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,Nt);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let a=1;a<t.length;a+=2){const n=1===a?-1/0:t[a],o=t[a+1],s=a,l=a+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new ln(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[sn(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function cn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var un,hn,dn=function(){if(hn)return un;function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}return hn=1,un=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},un}(),pn=cn(dn);class fn{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of r)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(t,e,n,i){let r=0;if("exponential"===t.name)r=mn(e,t.base,n,i);else if("linear"===t.name)r=mn(e,1,n,i);else if("cubic-bezier"===t.name){const a=t.controlPoints;r=new pn(a[0],a[1],a[2],a[3]).solve(mn(e,1,n,i))}return r}static parse(t,e){let[n,i,r,...a]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const t=i.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Nt),!r)return null;const o=[];let s=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||e.expectedType==qt?e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType):s=Bt;for(let l=0;l<a.length;l+=2){const t=a[l],n=a[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,s);if(!c)return null;s=s||c.type,o.push([t,c])}return ne(s,Nt)||ne(s,Ut)||ne(s,Bt)||ne(s,Wt)||ne(s,Zt)||ne(s,qt)||ne(s,Yt)||ne(s,Kt(Nt))?new fn(s,n,i,r,o):e.error("Type ".concat(Jt(s)," is not interpolatable."))}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const a=sn(e,i),o=fn.interpolationFactor(this.interpolation,i,e[a],e[a+1]),s=n[a].evaluate(t),l=n[a+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Te(s,l,o);case"color":return Ae.interpolate(s,l,o);case"padding":return ke.interpolate(s,l,o);case"colorArray":return De.interpolate(s,l,o);case"numberArray":return Le.interpolate(s,l,o);case"variableAnchorOffsetCollection":return Oe.interpolate(s,l,o);case"array":return Ee(s,l,o);case"projectionDefinition":return Be.interpolate(s,l,o)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ae.interpolate(s,l,o,"hcl");case"colorArray":return De.interpolate(s,l,o,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ae.interpolate(s,l,o,"lab");case"colorArray":return De.interpolate(s,l,o,"lab")}}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function mn(t,e,n,i){const r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}const gn={color:Ae.interpolate,number:Te,padding:ke.interpolate,numberArray:Le.interpolate,colorArray:De.interpolate,variableAnchorOffsetCollection:Oe.interpolate,array:Ee};class yn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const o of t.slice(1)){const t=e.parse(o,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}if(!n)throw new Error("No output type");const a=i&&r.some(t=>Qt(i,t.type));return new yn(a?Vt:n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof Fe&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function vn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function _n(t,e,n,i){return 0===i.compare(e,n)}function xn(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=Ft,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let a=e.parse(t[1],1,Vt);if(!a)return null;if(!vn(n,a.type))return e.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Jt(a.type),"'."));let o=e.parse(t[2],2,Vt);if(!o)return null;if(!vn(n,o.type))return e.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(Jt(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '".concat(Jt(a.type),"' and '").concat(Jt(o.type),"'."));i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new qe(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new qe(a.type,[o])));let s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(s=e.parse(t[3],3,Ht),!s)return null}return new r(a,o,s)}evaluate(r){const a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=Ve(a),n=Ve(o);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new ze('Expected arguments for "'.concat(t,'" to be (string, string) or (number, number), but found (').concat(e.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const t=Ve(a),n=Ve(o);if("string"!==t.kind||"string"!==n.kind)return e(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):e(r,a,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const bn=xn("==",function(t,e,n){return e===n},_n),wn=xn("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!_n(0,e,n,i)}),Sn=xn("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),Mn=xn(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),Tn=xn("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),En=xn(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class An{constructor(t,e,n){this.type=Ht,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Ft);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Ft);if(!r)return null;let a=null;return n.locale&&(a=e.parse(n.locale,1,Ot),!a)?null:new An(i,r,a)}evaluate(t){return new Ce(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Cn{constructor(t,e,n,i,r){this.type=Ot,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Nt);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,Ot),!r))return null;let a=null;if(i.currency&&(a=e.parse(i.currency,1,Ot),!a))return null;let o=null;if(i["min-fraction-digits"]&&(o=e.parse(i["min-fraction-digits"],1,Nt),!o))return null;let s=null;return i["max-fraction-digits"]&&(s=e.parse(i["max-fraction-digits"],1,Nt),!s)?null:new Cn(n,r,a,o,s)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Pn{constructor(t){this.type=Gt,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let a=1;a<=t.length-1;++a){const n=t[a];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,Nt),!t))return null;let a=null;if(n["text-font"]&&(a=e.parse(n["text-font"],1,Kt(Ot)),!a))return null;let o=null;if(n["text-color"]&&(o=e.parse(n["text-color"],1,Bt),!o))return null;let s=null;if(n["vertical-align"]){if("string"==typeof n["vertical-align"]&&!Pe.includes(n["vertical-align"]))return e.error("'vertical-align' must be one of: 'bottom', 'center', 'top' but found '".concat(n["vertical-align"],"' instead."));if(s=e.parse(n["vertical-align"],1,Ot),!s)return null}const l=i[i.length-1];l.scale=t,l.font=a,l.textColor=o,l.verticalAlign=s}else{const n=e.parse(t[a],1,Vt);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Pn(i)}evaluate(t){return new Re(this.sections.map(e=>{const n=e.content.evaluate(t);return Ve(n)===Xt?new Ie("",n,null,null,null,e.verticalAlign?e.verticalAlign.evaluate(t):null):new Ie(He(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null,e.verticalAlign?e.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor),e.verticalAlign&&t(e.verticalAlign)}outputDefined(){return!1}}class In{constructor(t){this.type=Xt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ot);return n?new In(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=Fe.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class Rn{constructor(t){this.type=Nt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found ".concat(Jt(n.type)," instead.")):new Rn(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return[...e].length;if(Array.isArray(e))return e.length;throw new ze("Expected value to be of type string or array, but found ".concat(Jt(Ve(e))," instead."))}eachChild(t){t(this.input)}outputDefined(){return!1}}const kn=8192;function Ln(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*kn),Math.round(i*r*kn)]}function Dn(t,e){const n=Math.pow(2,e.z);return[(r=(t[0]/kn+e.x)/n,360*r-180),(i=(t[1]/kn+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function zn(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Nn(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function On(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],a=t[0]-n[0],o=t[1]-n[1];return i*o-a*r==0&&i*a<=0&&r*o<=0}function Fn(t,e,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(a=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*a[0]&&!(!Gn(t,e,n,i)||!Gn(n,i,t,e));var r,a}function Bn(t,e,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(Fn(t,e,i[n],i[n+1]))return!0;return!1}function Un(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(const s of e)for(let e=0;e<s.length-1;e++){if(On(t,s[e],s[e+1]))return n;(a=s[e])[1]>(r=t)[1]!=(o=s[e+1])[1]>r[1]&&r[0]<(o[0]-a[0])*(r[1]-a[1])/(o[1]-a[1])+a[0]&&(i=!i)}var r,a,o;return i}function jn(t,e){for(const n of e)if(Un(t,n))return!0;return!1}function Vn(t,e){for(const n of t)if(!Un(n,e))return!1;for(let n=0;n<t.length-1;++n)if(Bn(t[n],t[n+1],e))return!1;return!0}function Hn(t,e){for(const n of e)if(Vn(t,n))return!0;return!1}function Gn(t,e,n,i){const r=i[0]-n[0],a=i[1]-n[1],o=(t[0]-n[0])*a-r*(t[1]-n[1]),s=(e[0]-n[0])*a-r*(e[1]-n[1]);return o>0&&s<0||o<0&&s>0}function Wn(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=[];for(let i=0;i<t[r].length;i++){const o=Ln(t[r][i],n);zn(e,o),a.push(o)}i.push(a)}return i}function qn(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=Wn(t[r],e,n);i.push(a)}return i}function Zn(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}zn(e,t)}function Xn(t,e,n,i){const r=Math.pow(2,i.z)*kn,a=[i.x*kn,i.y*kn],o=[];for(const s of t)for(const t of s){const i=[t.x+a[0],t.y+a[1]];Zn(i,e,n,r),o.push(i)}return o}function Yn(t,e,n,i){const r=Math.pow(2,i.z)*kn,a=[i.x*kn,i.y*kn],o=[];for(const l of t){const t=[];for(const n of l){const i=[n.x+a[0],n.y+a[1]];zn(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){(s=e)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const t of o)for(const i of t)Zn(i,e,n,r)}var s;return o}class Kn{constructor(t,e){this.type=Ft,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(je(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const n of e.features){const{type:e,coordinates:i}=n.geometry;"Polygon"===e&&t.push(i),"MultiPolygon"===e&&t.push(...i)}if(t.length)return new Kn(e,{type:"MultiPolygon",coordinates:t})}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Kn(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Kn(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=Wn(e.coordinates,i,r),o=Xn(t.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const t of o)if(!Un(t,a))return!1}if("MultiPolygon"===e.type){const a=qn(e.coordinates,i,r),o=Xn(t.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const t of o)if(!jn(t,a))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=Wn(e.coordinates,i,r),o=Yn(t.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const t of o)if(!Vn(t,a))return!1}if("MultiPolygon"===e.type){const a=qn(e.coordinates,i,r),o=Yn(t.geometry(),n,i,r);if(!Nn(n,i))return!1;for(const t of o)if(!Hn(t,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Jn=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1);const a=i+1;if(a<this.length&&n(e[a],e[i])<0&&(i=a),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}};function $n(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ti;for(;i>n;){if(i-n>600){const a=i-n+1,o=e-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);$n(t,e,Math.max(n,Math.floor(e-o*l/a+c)),Math.min(i,Math.floor(e+(a-o)*l/a+c)),r)}const a=t[e];let o=n,s=i;for(Qn(t,n,e),r(t[i],a)>0&&Qn(t,n,i);o<s;){for(Qn(t,o,s),o++,s--;r(t[o],a)<0;)o++;for(;r(t[s],a)>0;)s--}0===r(t[n],a)?Qn(t,n,s):(s++,Qn(t,s,i)),s<=e&&(n=s+1),e<=s&&(i=s-1)}}function Qn(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function ti(t,e){return t<e?-1:t>e?1:0}function ei(t,e){if(t.length<=1)return[t];const n=[];let i,r;for(const a of t){const t=ii(a);0!==t&&(a.area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[a]):i.push(a))}if(i&&n.push(i),e>1)for(let a=0;a<n.length;a++)n[a].length<=e||($n(n[a],e,1,n[a].length-1,ni),n[a]=n[a].slice(0,e));return n}function ni(t,e){return e.area-t.area}function ii(t){let e=0;for(let n,i,r=0,a=t.length,o=a-1;r<a;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}const ri=1/298.257223563,ai=ri*(2-ri),oi=Math.PI/180;class si{constructor(t){const e=6378.137*oi*1e3,n=Math.cos(t*oi),i=1/(1-ai*(1-n*n)),r=Math.sqrt(i);this.kx=e*r*n,this.ky=e*r*i*(1-ai)}distance(t,e){const n=this.wrap(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(t,e){let n,i,r,a,o=1/0;for(let s=0;s<t.length-1;s++){let l=t[s][0],c=t[s][1],u=this.wrap(t[s+1][0]-l)*this.kx,h=(t[s+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=t[s+1][0],c=t[s+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<o&&(o=p,n=l,i=c,r=s,a=d)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,a))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function li(t,e){return e[0]-t[0]}function ci(t){return t[1]-t[0]+1}function ui(t,e){return t[1]>=t[0]&&t[1]<e}function hi(t,e){if(t[0]>t[1])return[null,null];const n=ci(t);if(e){if(2===n)return[t,null];const e=Math.floor(n/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}function di(t,e){if(!ui(e,t.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let i=e[0];i<=e[1];++i)zn(n,t[i]);return n}function pi(t){const e=[1/0,1/0,-1/0,-1/0];for(const n of t)for(const t of n)zn(e,t);return e}function fi(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function mi(t,e,n){if(!fi(t)||!fi(e))return NaN;let i=0,r=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),n.distance([0,0],[i,r])}function gi(t,e,n){const i=n.pointOnLine(e,t);return n.distance(t,i.point)}function yi(t,e,n,i,r){const a=Math.min(gi(t,[n,i],r),gi(e,[n,i],r)),o=Math.min(gi(n,[t,e],r),gi(i,[t,e],r));return Math.min(a,o)}function vi(t,e,n,i,r){if(!ui(e,t.length)||!ui(i,n.length))return 1/0;let a=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(let t=i[0];t<i[1];++t){const i=n[t],o=n[t+1];if(Fn(e,s,i,o))return 0;a=Math.min(a,yi(e,s,i,o,r))}}return a}function _i(t,e,n,i,r){if(!ui(e,t.length)||!ui(i,n.length))return NaN;let a=1/0;for(let o=e[0];o<=e[1];++o)for(let e=i[0];e<=i[1];++e)if(a=Math.min(a,r.distance(t[o],n[e])),0===a)return a;return a}function xi(t,e,n){if(Un(t,e,!0))return 0;let i=1/0;for(const r of e){const e=r[0],a=r[r.length-1];if(e!==a&&(i=Math.min(i,gi(t,[a,e],n)),0===i))return i;const o=n.pointOnLine(r,t);if(i=Math.min(i,n.distance(t,o.point)),0===i)return i}return i}function bi(t,e,n,i){if(!ui(e,t.length))return NaN;for(let a=e[0];a<=e[1];++a)if(Un(t[a],n,!0))return 0;let r=1/0;for(let a=e[0];a<e[1];++a){const e=t[a],o=t[a+1];for(const t of n)for(let n=0,a=t.length,s=a-1;n<a;s=n++){const a=t[s],l=t[n];if(Fn(e,o,a,l))return 0;r=Math.min(r,yi(e,o,a,l,i))}}return r}function wi(t,e){for(const n of t)for(const t of n)if(Un(t,e,!0))return!0;return!1}function Si(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=pi(t),a=pi(e);if(i!==1/0&&mi(r,a,n)>=i)return i;if(Nn(r,a)){if(wi(t,e))return 0}else if(wi(e,t))return 0;let o=1/0;for(const s of t)for(let t=0,i=s.length,r=i-1;t<i;r=t++){const i=s[r],a=s[t];for(const t of e)for(let e=0,r=t.length,s=r-1;e<r;s=e++){const r=t[s],l=t[e];if(Fn(i,a,r,l))return 0;o=Math.min(o,yi(i,a,r,l,n))}}return o}function Mi(t,e,n,i,r,a){if(!a)return;const o=mi(di(i,a),r,n);o<e&&t.push([o,a,[0,0]])}function Ti(t,e,n,i,r,a,o){if(!a||!o)return;const s=mi(di(i,a),di(r,o),n);s<e&&t.push([s,a,o])}function Ei(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=Math.min(i.distance(t[0],n[0][0]),r);if(0===a)return a;const o=new Jn([[0,[0,t.length-1],[0,0]]],li),s=pi(n);for(;o.length>0;){const r=o.pop();if(r[0]>=a)continue;const l=r[1],c=e?50:100;if(ci(l)<=c){if(!ui(l,t.length))return NaN;if(e){const e=bi(t,l,n,i);if(isNaN(e)||0===e)return e;a=Math.min(a,e)}else for(let e=l[0];e<=l[1];++e){const r=xi(t[e],n,i);if(a=Math.min(a,r),0===a)return 0}}else{const n=hi(l,e);Mi(o,a,i,t,s,n[0]),Mi(o,a,i,t,s,n[1])}}return a}function Ai(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(a,r.distance(t[0],n[0]));if(0===o)return o;const s=new Jn([[0,[0,t.length-1],[0,n.length-1]]],li);for(;s.length>0;){const a=s.pop();if(a[0]>=o)continue;const l=a[1],c=a[2],u=e?50:100,h=i?50:100;if(ci(l)<=u&&ci(c)<=h){if(!ui(l,t.length)&&ui(c,n.length))return NaN;let a;if(e&&i)a=vi(t,l,n,c,r),o=Math.min(o,a);else if(e&&!i){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(a=gi(n[t],e,r),o=Math.min(o,a),0===o)return o}else if(!e&&i){const e=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(a=gi(t[n],e,r),o=Math.min(o,a),0===o)return o}else a=_i(t,l,n,c,r),o=Math.min(o,a)}else{const a=hi(l,e),u=hi(c,i);Ti(s,o,r,t,n,a[0],u[0]),Ti(s,o,r,t,n,a[0],u[1]),Ti(s,o,r,t,n,a[1],u[0]),Ti(s,o,r,t,n,a[1],u[1])}}return o}function Ci(t){return"MultiPolygon"===t.type?t.coordinates.map(t=>({type:"Polygon",coordinates:t})):"MultiLineString"===t.type?t.coordinates.map(t=>({type:"LineString",coordinates:t})):"MultiPoint"===t.type?t.coordinates.map(t=>({type:"Point",coordinates:t})):[t]}class Pi{constructor(t,e){this.type=Nt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'distance' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(je(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new Pi(e,e.features.map(t=>Ci(t.geometry)).flat());if("Feature"===e.type)return new Pi(e,Ci(e.geometry));if("type"in e&&"coordinates"in e)return new Pi(e,Ci(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>Dn([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new si(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,Ai(i,!1,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,Ai(i,!1,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,Ei(i,!1,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>Dn([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new si(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,Ai(i,!0,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,Ai(i,!0,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,Ei(i,!0,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("Polygon"===t.geometryType())return function(t,e){const n=t.geometry();if(0===n.length||0===n[0].length)return NaN;const i=ei(n,0).map(e=>e.map(e=>e.map(e=>Dn([e.x,e.y],t.canonical)))),r=new si(i[0][0][0][1]);let a=1/0;for(const o of e)for(const t of i){switch(o.type){case"Point":a=Math.min(a,Ei([o.coordinates],!1,t,r,a));break;case"LineString":a=Math.min(a,Ei(o.coordinates,!0,t,r,a));break;case"Polygon":a=Math.min(a,Si(t,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ii{constructor(t){this.type=Vt,this.key=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=t[1];return null==n?e.error("Global state property must be defined."):"string"!=typeof n?e.error("Global state property must be string, but found ".concat(typeof t[1]," instead.")):new Ii(n)}evaluate(t){var e;const n=null===(e=t.globals)||void 0===e?void 0:e.globalState;return n&&0!==Object.keys(n).length?_e(n,this.key):null}eachChild(){}outputDefined(){return!1}}const Ri={"==":bn,"!=":wn,">":Mn,"<":Sn,">=":En,"<=":Tn,array:qe,at:tn,boolean:qe,case:an,coalesce:yn,collator:An,format:Pn,image:In,in:en,"index-of":nn,interpolate:fn,"interpolate-hcl":fn,"interpolate-lab":fn,length:Rn,let:$e,literal:Ge,match:rn,number:qe,"number-format":Cn,object:qe,slice:on,step:ln,string:qe,"to-boolean":Xe,"to-color":Xe,"to-number":Xe,"to-string":Xe,var:Qe,within:Kn,distance:Pi,"global-state":Ii};class ki{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const n=t[0],i=ki.definitions[n];if(!i)return e.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(e=>{let[n]=e;return!Array.isArray(n)||n.length===t.length-1});let s=null;for(const[l,c]of o){s=new Je(e.registry,Oi,e.path,null,e.scope);const i=[];let a=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=s.parse(n,1+i.length,r);if(!o){a=!0;break}i.push(o)}if(!a)if(Array.isArray(l)&&l.length!==i.length)s.error("Expected ".concat(l.length," arguments, but found ").concat(i.length," instead."));else{for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];s.concat(t+1).checkSubtype(e,n.type)}if(0===s.errors.length)return new ki(n,r,c,i)}}if(1===o.length)e.errors.push(...s.errors);else{const n=(o.length?o:a).map(t=>{let[e]=t;return n=e,Array.isArray(n)?"(".concat(n.map(Jt).join(", "),")"):"(".concat(Jt(n.type),"...)");var n}).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(Jt(n.type))}e.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(t,e){ki.definitions=e;for(const n in e)t[n]=ki}}function Li(t,e){let[n,i,r,a]=e;n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=a?a.evaluate(t):1,s=Ue(n,i,r,o);if(s)throw new ze(s);return new Ae(n/255,i/255,r/255,o,!1)}function Di(t,e){return t in e}function zi(t,e){const n=e[t];return void 0===n?null:n}function Ni(t){return{type:t}}function Oi(t){if(t instanceof Qe)return Oi(t.boundExpression);if(t instanceof ki&&"error"===t.name)return!1;if(t instanceof An)return!1;if(t instanceof Kn)return!1;if(t instanceof Pi)return!1;if(t instanceof Ii)return!1;const e=t instanceof Xe||t instanceof qe;let n=!0;return t.eachChild(t=>{n=e?n&&Oi(t):n&&t instanceof Ge}),!!n&&Fi(t)&&Ui(t,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Fi(t){if(t instanceof ki){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Kn)return!1;if(t instanceof Pi)return!1;let e=!0;return t.eachChild(t=>{e&&!Fi(t)&&(e=!1)}),e}function Bi(t){if(t instanceof ki&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Bi(t)&&(e=!1)}),e}function Ui(t,e){if(t instanceof ki&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!Ui(t,e)&&(n=!1)}),n}function ji(t){return{result:"success",value:t}}function Vi(t){return{result:"error",value:t}}function Hi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Gi(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Wi(t){return!!t.expression&&t.expression.interpolated}function qi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Zi(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)&&Ve(t)===jt}function Xi(t){return t}function Yi(t,e){const n=t.stops&&"object"==typeof t.stops[0][0],i=n||!(n||void 0!==t.property),r=t.type||(Wi(e)?"exponential":"interval"),a=function(t){switch(t.type){case"color":return Ae.parse;case"padding":return ke.parse;case"numberArray":return Le.parse;case"colorArray":return De.parse;default:return null}}(e);if(a&&((t=kt({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],a(t[1])])),t.default=a(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==(o=t.colorSpace)&&"hcl"!==o&&"lab"!==o)throw new Error('Unknown color space: "'.concat(t.colorSpace,'"'));var o;const s=function(t){switch(t){case"exponential":return Qi;case"interval":return $i;case"categorical":return Ji;case"identity":return tr;default:throw new Error('Unknown function type "'.concat(t,'"'))}}(r);let l,c;if("categorical"===r){l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}if(n){const n={},i=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],a=r[0].zoom;void 0===n[a]&&(n[a]={zoom:a,type:t.type,property:t.property,default:t.default,stops:[]},i.push(a)),n[a].stops.push([r[0].value,r[1]])}const r=[];for(const t of i)r.push([n[t].zoom,Yi(n[t],e)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:fn.interpolationFactor.bind(void 0,a),zoomStops:r.map(t=>t[0]),evaluate:(n,i)=>{let{zoom:a}=n;return Qi({stops:r,base:t.base},e,a).evaluate(a,i)}}}if(i){const n="exponential"===r?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:fn.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map(t=>t[0]),evaluate:n=>{let{zoom:i}=n;return s(t,e,i,l,c)}}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[t.property]:void 0;return void 0===r?Ki(t.default,e.default):s(t,e,r,l,c)}}}function Ki(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Ji(t,e,n,i,r){return Ki(typeof n===r?i[n]:void 0,t.default,e.default)}function $i(t,e,n){if("number"!==qi(n))return Ki(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=sn(t.stops.map(t=>t[0]),n);return t.stops[r][1]}function Qi(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==qi(n))return Ki(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const a=sn(t.stops.map(t=>t[0]),n),o=function(t,e,n,i){const r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],l=t.stops[a+1][1],c=gn[e.type]||Xi;return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=s.evaluate.apply(void 0,n),a=l.evaluate.apply(void 0,n);if(void 0!==r&&void 0!==a)return c(r,a,o,t.colorSpace)}}:c(s,l,o,t.colorSpace)}function tr(t,e,n){switch(e.type){case"color":n=Ae.parse(n);break;case"formatted":n=Re.fromString(n.toString());break;case"resolvedImage":n=Fe.fromString(n.toString());break;case"padding":n=ke.parse(n);break;case"colorArray":n=De.parse(n);break;case"numberArray":n=Le.parse(n);break;default:qi(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0)}return Ki(n,t.default,e.default)}ki.register(Ri,{error:[{kind:"error"},[Ot],(t,e)=>{let[n]=e;throw new ze(n.evaluate(t))}],typeof:[Ot,[Vt],(t,e)=>{let[n]=e;return Jt(Ve(n.evaluate(t)))}],"to-rgba":[Kt(Nt,4),[Bt],(t,e)=>{let[n]=e;const[i,r,a,o]=n.evaluate(t).rgb;return[255*i,255*r,255*a,o]}],rgb:[Bt,[Nt,Nt,Nt],Li],rgba:[Bt,[Nt,Nt,Nt,Nt],Li],has:{type:Ft,overloads:[[[Ot],(t,e)=>{let[n]=e;return Di(n.evaluate(t),t.properties())}],[[Ot,jt],(t,e)=>{let[n,i]=e;return Di(n.evaluate(t),i.evaluate(t))}]]},get:{type:Vt,overloads:[[[Ot],(t,e)=>{let[n]=e;return zi(n.evaluate(t),t.properties())}],[[Ot,jt],(t,e)=>{let[n,i]=e;return zi(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[Vt,[Ot],(t,e)=>{let[n]=e;return zi(n.evaluate(t),t.featureState||{})}],properties:[jt,[],t=>t.properties()],"geometry-type":[Ot,[],t=>t.geometryType()],id:[Vt,[],t=>t.id()],zoom:[Nt,[],t=>t.globals.zoom],"heatmap-density":[Nt,[],t=>t.globals.heatmapDensity||0],elevation:[Nt,[],t=>t.globals.elevation||0],"line-progress":[Nt,[],t=>t.globals.lineProgress||0],accumulated:[Vt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Nt,Ni(Nt),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[Nt,Ni(Nt),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:Nt,overloads:[[[Nt,Nt],(t,e)=>{let[n,i]=e;return n.evaluate(t)-i.evaluate(t)}],[[Nt],(t,e)=>{let[n]=e;return-n.evaluate(t)}]]},"/":[Nt,[Nt,Nt],(t,e)=>{let[n,i]=e;return n.evaluate(t)/i.evaluate(t)}],"%":[Nt,[Nt,Nt],(t,e)=>{let[n,i]=e;return n.evaluate(t)%i.evaluate(t)}],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(t,e)=>{let[n,i]=e;return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.sqrt(n.evaluate(t))}],log10:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN10}],ln:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))}],log2:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN2}],sin:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.sin(n.evaluate(t))}],cos:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.cos(n.evaluate(t))}],tan:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.tan(n.evaluate(t))}],asin:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.asin(n.evaluate(t))}],acos:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.acos(n.evaluate(t))}],atan:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.atan(n.evaluate(t))}],min:[Nt,Ni(Nt),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Nt,Ni(Nt),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.abs(n.evaluate(t))}],round:[Nt,[Nt],(t,e)=>{let[n]=e;const i=n.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.floor(n.evaluate(t))}],ceil:[Nt,[Nt],(t,e)=>{let[n]=e;return Math.ceil(n.evaluate(t))}],"filter-==":[Ft,[Ot,Vt],(t,e)=>{let[n,i]=e;return t.properties()[n.value]===i.value}],"filter-id-==":[Ft,[Vt],(t,e)=>{let[n]=e;return t.id()===n.value}],"filter-type-==":[Ft,[Ot],(t,e)=>{let[n]=e;return t.geometryType()===n.value}],"filter-<":[Ft,[Ot,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Ft,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Ft,[Ot,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Ft,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Ft,[Ot,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Ft,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Ft,[Ot,Vt],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Ft,[Vt],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Ft,[Vt],(t,e)=>{let[n]=e;return n.value in t.properties()}],"filter-has-id":[Ft,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ft,[Kt(Ot)],(t,e)=>{let[n]=e;return n.value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ft,[Kt(Vt)],(t,e)=>{let[n]=e;return n.value.indexOf(t.id())>=0}],"filter-in-small":[Ft,[Ot,Kt(Vt)],(t,e)=>{let[n,i]=e;return i.value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Ft,[Ot,Kt(Vt)],(t,e)=>{let[n,i]=e;return function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Ft,overloads:[[[Ft,Ft],(t,e)=>{let[n,i]=e;return n.evaluate(t)&&i.evaluate(t)}],[Ni(Ft),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(t,e)=>{let[n,i]=e;return n.evaluate(t)||i.evaluate(t)}],[Ni(Ft),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Ft,[Ft],(t,e)=>{let[n]=e;return!n.evaluate(t)}],"is-supported-script":[Ft,[Ot],(t,e)=>{let[n]=e;const i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[Ot,[Ot],(t,e)=>{let[n]=e;return n.evaluate(t).toUpperCase()}],downcase:[Ot,[Ot],(t,e)=>{let[n]=e;return n.evaluate(t).toLowerCase()}],concat:[Ot,Ni(Vt),(t,e)=>e.map(e=>He(e.evaluate(t))).join("")],"resolved-locale":[Ot,[Ht],(t,e)=>{let[n]=e;return n.evaluate(t).resolvedLocale()}]});class er{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Ke,this._defaultValue=e?function(t){if("color"===t.type&&Zi(t.default))return new Ae(0,0,0,0);switch(t.type){case"color":return Ae.parse(t.default)||null;case"padding":return ke.parse(t.default)||null;case"numberArray":return Le.parse(t.default)||null;case"colorArray":return De.parse(t.default)||null;case"variableAnchorOffsetCollection":return Oe.parse(t.default)||null;case"projectionDefinition":return Be.parse(t.default)||null;default:return void 0===t.default?null:t.default}}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ze("Expected value to be one of ".concat(Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", "),", but found ").concat(JSON.stringify(t)," instead."));return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function nr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ri}function ir(t,e){const n=new Je(Ri,Oi,[],e?function(t){const e={color:Bt,string:Ot,number:Nt,enum:Ot,boolean:Ft,formatted:Gt,padding:Wt,numberArray:Zt,colorArray:qt,projectionDefinition:Ut,resolvedImage:Xt,variableAnchorOffsetCollection:Yt};return"array"===t.type?Kt(e[t.value]||Vt,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?ji(new er(i,e)):Vi(n.errors)}class rr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Bi(e.expression),this.globalStateRefs=cr(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}}class ar{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Bi(e.expression),this.globalStateRefs=cr(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}interpolationFactor(t,e,n){return this.interpolationType?fn.interpolationFactor(this.interpolationType,t,e,n):0}}function or(t,e){const n=ir(t,e);if("error"===n.result)return n;const i=n.value.expression,r=Fi(i);if(!r&&!Hi(e))return Vi([new Lt("","data expressions not supported")]);const a=Ui(i,["zoom"]);if(!a&&!Gi(e))return Vi([new Lt("","zoom expressions not supported")]);const o=lr(i);return o||a?o instanceof Lt?Vi([o]):o instanceof fn&&!Wi(e)?Vi([new Lt("",'"interpolate" expressions cannot be used with this property')]):ji(o?new ar(r?"camera":"composite",n.value,o.labels,o instanceof fn?o.interpolation:void 0):new rr(r?"constant":"source",n.value)):Vi([new Lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sr{constructor(t,e){this._parameters=t,this._specification=e,kt(this,Yi(this._parameters,this._specification))}static deserialize(t){return new sr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function lr(t){let e=null;if(t instanceof $e)e=lr(t.result);else if(t instanceof yn){for(const n of t.args)if(e=lr(n),e)break}else(t instanceof ln||t instanceof fn)&&t.input instanceof ki&&"zoom"===t.input.name&&(e=t);return e instanceof Lt||t.eachChild(t=>{const n=lr(t);n instanceof Lt?e=n:!e&&n?e=new Lt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Lt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function cr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return t instanceof Ii&&e.add(t.key),t.eachChild(t=>{cr(t,e)}),e}function ur(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ur(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const hr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function dr(t){if(null==t)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ur(t)||(t=mr(t));const e=ir(t,hr);if("error"===e.result)throw new Error(e.value.map(t=>"".concat(t.key,": ").concat(t.message)).join(", "));return{filter:(t,n,i)=>e.value.evaluate(t,n,{},i),needGeometry:fr(t),getGlobalStateRefs:()=>cr(e.value.expression)}}function pr(t,e){return t<e?-1:t>e?1:0}function fr(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(fr(t[e]))return!0;return!1}function mr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?gr(t[1],t[2],"=="):"!="===e?_r(gr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?gr(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(mr))):"all"===e?["all"].concat(t.slice(1).map(mr)):"none"===e?["all"].concat(t.slice(1).map(mr).map(_r)):"in"===e?yr(t[1],t.slice(2)):"!in"===e?_r(yr(t[1],t.slice(2))):"has"===e?vr(t[1]):"!has"!==e||_r(vr(t[1]));var n}function gr(t,e,n){switch(t){case"$type":return["filter-type-".concat(n),e];case"$id":return["filter-id-".concat(n),e];default:return["filter-".concat(n),t,e]}}function yr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(pr)]]:["filter-in-small",t,["literal",e]]}}function vr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function _r(t){return["!",t]}function xr(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const n of t)e+="".concat(xr(n),",");return"".concat(e,"]")}const n=Object.keys(t).sort();let i="{";for(let r=0;r<n.length;r++)i+="".concat(JSON.stringify(n[r]),":").concat(xr(t[n[r]]),",");return"".concat(i,"}")}function br(t){let e="";for(const n of xt)e+="/".concat(xr(t[n]));return e}function wr(t){const e=t.value;return e?[new Rt(t.key,e,"constants have been deprecated as of v8")]:[]}function Sr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Mr(t){if(Array.isArray(t))return t.map(Mr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Mr(t[n]);return e}return Sr(t)}function Tr(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=t.validateSpec;let l=[];const c=qi(n);if("object"!==c)return[new Rt(e,n,"object expected, ".concat(c," found"))];for(const u in n){const t=u.split(".")[0],c=_e(i,t)||i["*"];let h;if(_e(r,t))h=r[t];else if(_e(i,t))h=s;else if(r["*"])h=r["*"];else{if(!i["*"]){l.push(new Rt(e,n[u],'unknown property "'.concat(u,'"')));continue}h=s}l=l.concat(h({key:(e?"".concat(e,"."):e)+u,value:n[u],valueSpec:c,style:a,styleSpec:o,object:n,objectKey:u,validateSpec:s},n))}for(const u in i)r[u]||i[u].required&&void 0===i[u].default&&void 0===n[u]&&l.push(new Rt(e,n,'missing required property "'.concat(u,'"')));return l}function Er(t){const e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,a=t.key,o=t.arrayElementValidator||t.validateSpec;if("array"!==qi(e))return[new Rt(a,e,"array expected, ".concat(qi(e)," found"))];if(n.length&&e.length!==n.length)return[new Rt(a,e,"array length ".concat(n.length," expected, length ").concat(e.length," found"))];if(n["min-length"]&&e.length<n["min-length"])return[new Rt(a,e,"array length at least ".concat(n["min-length"]," expected, length ").concat(e.length," found"))];let s={type:n.value,values:n.values};r.$version<7&&(s.function=n.function),"object"===qi(n.value)&&(s=n.value);let l=[];for(let c=0;c<e.length;c++)l=l.concat(o({array:e,arrayIndex:c,value:e[c],valueSpec:s,validateSpec:t.validateSpec,style:i,styleSpec:r,key:"".concat(a,"[").concat(c,"]")}));return l}function Ar(t){const e=t.key,n=t.value,i=t.valueSpec;let r=qi(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new Rt(e,n,"number expected, ".concat(r," found"))]:"minimum"in i&&n<i.minimum?[new Rt(e,n,"".concat(n," is less than the minimum value ").concat(i.minimum))]:"maximum"in i&&n>i.maximum?[new Rt(e,n,"".concat(n," is greater than the maximum value ").concat(i.maximum))]:[]}function Cr(t){const e=t.valueSpec,n=Sr(t.value.type);let i,r,a,o={};const s="categorical"!==n&&void 0===t.value.property,l=!s,c="array"===qi(t.value.stops)&&"array"===qi(t.value.stops[0])&&"object"===qi(t.value.stops[0][0]),u=Tr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new Rt(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(Er({key:t.key,value:i,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===qi(i)&&0===i.length&&e.push(new Rt(t.key,i,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&s&&u.push(new Rt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new Rt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Wi(t.valueSpec)&&u.push(new Rt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!Hi(t.valueSpec)?u.push(new Rt(t.key,t.value,"property functions not supported")):s&&!Gi(t.valueSpec)&&u.push(new Rt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==t.value.property||u.push(new Rt(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,s=t.key;if("array"!==qi(i))return[new Rt(s,i,"array expected, ".concat(qi(i)," found"))];if(2!==i.length)return[new Rt(s,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==qi(i[0]))return[new Rt(s,i,"object expected, ".concat(qi(i[0])," found"))];if(void 0===i[0].zoom)return[new Rt(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Rt(s,i,"object stop key must have value")];if(a&&a>Sr(i[0].zoom))return[new Rt(s,i[0].zoom,"stop zoom values must appear in ascending order")];Sr(i[0].zoom)!==a&&(a=Sr(i[0].zoom),r=void 0,o={}),n=n.concat(Tr({key:"".concat(s,"[0]"),value:i[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Ar,value:d}}))}else n=n.concat(d({key:"".concat(s,"[0]"),value:i[0],validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},i));return nr(Mr(i[1]))?n.concat([new Rt("".concat(s,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(t.validateSpec({key:"".concat(s,"[1]"),value:i[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,a){const s=qi(t.value),l=Sr(t.value),c=null!==t.value?t.value:a;if(i){if(s!==i)return[new Rt(t.key,c,"".concat(s," stop domain type must match previous stop domain type ").concat(i))]}else i=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Rt(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let i="number expected, ".concat(s," found");return Hi(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Rt(t.key,c,i)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==r&&l<r?[new Rt(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new Rt(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Rt(t.key,c,"integer expected, found ".concat(l))]}}function Pr(t){const e=("property"===t.expressionContext?or:ir)(Mr(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new Rt("".concat(t.key).concat(e.key),t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Rt(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Bi(n))return[new Rt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Bi(n))return[new Rt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ui(n,["zoom","feature-state"]))return[new Rt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Fi(n))return[new Rt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ir(t){const e=t.key,n=t.value,i=qi(n);return"string"!==i?[new Rt(e,n,"color expected, ".concat(i," found"))]:Ae.parse(String(n))?[]:[new Rt(e,n,'color expected, "'.concat(n,'" found'))]}function Rr(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Sr(n))&&r.push(new Rt(e,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(Sr(n))&&r.push(new Rt(e,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function kr(t){return ur(Mr(t.value))?Pr(kt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lr(t)}function Lr(t){const e=t.value,n=t.key;if("array"!==qi(e))return[new Rt(n,e,"array expected, ".concat(qi(e)," found"))];const i=t.styleSpec;let r,a=[];if(e.length<1)return[new Rt(n,e,"filter array must have at least 1 element")];switch(a=a.concat(Rr({key:"".concat(n,"[0]"),value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),Sr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Sr(e[1])&&a.push(new Rt(n,e,'"$type" cannot be use with operator "'.concat(e[0],'"')));case"==":case"!=":3!==e.length&&a.push(new Rt(n,e,'filter array for operator "'.concat(e[0],'" must have 3 elements')));case"in":case"!in":e.length>=2&&(r=qi(e[1]),"string"!==r&&a.push(new Rt("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found"))));for(let o=2;o<e.length;o++)r=qi(e[o]),"$type"===Sr(e[1])?a=a.concat(Rr({key:"".concat(n,"[").concat(o,"]"),value:e[o],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new Rt("".concat(n,"[").concat(o,"]"),e[o],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)a=a.concat(Lr({key:"".concat(n,"[").concat(i,"]"),value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=qi(e[1]),2!==e.length?a.push(new Rt(n,e,'filter array for "'.concat(e[0],'" operator must have 2 elements'))):"string"!==r&&a.push(new Rt("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found")))}return a}function Dr(t,e){const n=t.key,i=t.validateSpec,r=t.style,a=t.styleSpec,o=t.value,s=t.objectKey,l=a["".concat(e,"_").concat(t.layerType)];if(!l)return[];const c=s.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return i({key:n,value:o,valueSpec:a.transition,style:r,styleSpec:a});const u=t.valueSpec||l[s];if(!u)return[new Rt(n,o,'unknown property "'.concat(s,'"'))];let h;if("string"===qi(o)&&Hi(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(o)))return[new Rt(n,o,'"'.concat(s,'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": ').concat(JSON.stringify(h[1])," }`."))];const d=[];return"symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&d.push(new Rt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Zi(Mr(o))&&"identity"===Sr(o.type)&&d.push(new Rt(n,o,'"text-font" does not support identity functions'))),d.concat(i({key:t.key,value:o,valueSpec:u,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:s}))}function zr(t){return Dr(t,"paint")}function Nr(t){return Dr(t,"layout")}function Or(t){let e=[];const n=t.value,i=t.key,r=t.style,a=t.styleSpec;if("object"!==qi(n))return[new Rt(i,n,"object expected, ".concat(qi(n)," found"))];n.type||n.ref||e.push(new Rt(i,n,'either "type" or "ref" is required'));let o=Sr(n.type);const s=Sr(n.ref);if(n.id){const a=Sr(n.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];Sr(t.id)===a&&e.push(new Rt(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new Rt(i,n[t],'"'.concat(t,'" is prohibited for ref layers')))}),r.layers.forEach(e=>{Sr(e.id)===s&&(t=e)}),t?t.ref?e.push(new Rt(i,n.ref,"ref cannot reference another ref layer")):o=Sr(t.type):e.push(new Rt(i,n.ref,'ref layer "'.concat(s,'" not found')))}else if("background"!==o)if(n.source){const t=r.sources&&r.sources[n.source],a=t&&Sr(t.type);t?"vector"===a&&"raster"===o?e.push(new Rt(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster-dem"!==a&&"hillshade"===o||"raster-dem"!==a&&"color-relief"===o?e.push(new Rt(i,n.source,'layer "'.concat(n.id,'" requires a raster-dem source'))):"raster"===a&&"raster"!==o?e.push(new Rt(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==o&&"color-relief"!==o?e.push(new Rt(i,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==o||!n.paint||!n.paint["line-gradient"]||"geojson"===a&&t.lineMetrics||e.push(new Rt(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):e.push(new Rt(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):e.push(new Rt(i,n.source,'source "'.concat(n.source,'" not found')))}else e.push(new Rt(i,n,'missing required property "source"'));return e=e.concat(Tr({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:"".concat(i,".type"),value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:n,objectKey:"type"}),filter:kr,layout:t=>Tr({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Nr(kt({layerType:o},t))}}),paint:t=>Tr({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>zr(kt({layerType:o},t))}})}})),e}function Fr(t){const e=t.value,n=t.key,i=qi(e);return"string"!==i?[new Rt(n,e,"string expected, ".concat(i," found"))]:[]}const Br={promoteId:function(t){let{key:e,value:n}=t;if("string"===qi(n))return Fr({key:e,value:n});{const t=[];for(const i in n)t.push(...Fr({key:"".concat(e,".").concat(i),value:n[i]}));return t}}};function Ur(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style,a=t.validateSpec;if(!e.type)return[new Rt(n,e,'"type" is required')];const o=Sr(e.type);let s;switch(o){case"vector":case"raster":return s=Tr({key:n,value:e,valueSpec:i["source_".concat(o.replace("-","_"))],style:t.style,styleSpec:i,objectElementValidators:Br,validateSpec:a}),s;case"raster-dem":return s=function(t){var e;const n=null!==(e=t.sourceName)&&void 0!==e?e:"",i=t.value,r=t.styleSpec,a=r.source_raster_dem,o=t.style;let s=[];const l=qi(i);if(void 0===i)return s;if("object"!==l)return s.push(new Rt("source_raster_dem",i,"object expected, ".concat(l," found"))),s;const c="custom"===Sr(i.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?'"'.concat(t.value.encoding,'"'):"Default";for(const d in i)!c&&u.includes(d)?s.push(new Rt(d,i[d],'In "'.concat(n,'": "').concat(d,'" is only valid when "encoding" is set to "custom". ').concat(h," encoding found"))):a[d]?s=s.concat(t.validateSpec({key:d,value:i[d],valueSpec:a[d],validateSpec:t.validateSpec,style:o,styleSpec:r})):s.push(new Rt(d,i[d],'unknown property "'.concat(d,'"')));return s}({sourceName:n,value:e,style:t.style,styleSpec:i,validateSpec:a}),s;case"geojson":if(s=Tr({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,validateSpec:a,objectElementValidators:Br}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],a="string"==typeof i?[i,["accumulated"],["get",t]]:i;s.push(...Pr({key:"".concat(n,".").concat(t,".map"),value:r,expressionContext:"cluster-map"})),s.push(...Pr({key:"".concat(n,".").concat(t,".reduce"),value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return Tr({key:n,value:e,valueSpec:i.source_video,style:r,validateSpec:a,styleSpec:i});case"image":return Tr({key:n,value:e,valueSpec:i.source_image,style:r,validateSpec:a,styleSpec:i});case"canvas":return[new Rt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rr({key:"".concat(n,".type"),value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function jr(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let a=[];const o=qi(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new Rt("light",e,"object expected, ".concat(o," found"))]),a;for(const s in e){const o=s.match(/^(.*)-transition$/);a=a.concat(o&&i[o[1]]&&i[o[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:n.transition,validateSpec:t.validateSpec,style:r,styleSpec:n}):i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n}):[new Rt(s,e[s],'unknown property "'.concat(s,'"'))])}return a}function Vr(t){const e=t.value,n=t.styleSpec,i=n.sky,r=t.style,a=qi(e);if(void 0===e)return[];if("object"!==a)return[new Rt("sky",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=o.concat(i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n}):[new Rt(s,e[s],'unknown property "'.concat(s,'"'))]);return o}function Hr(t){const e=t.value,n=t.styleSpec,i=n.terrain,r=t.style;let a=[];const o=qi(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new Rt("terrain",e,"object expected, ".concat(o," found"))]),a;for(const s in e)a=a.concat(i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n}):[new Rt(s,e[s],'unknown property "'.concat(s,'"'))]);return a}function Gr(t){let e=[];const n=t.value,i=t.key;if(Array.isArray(n)){const r=[],a=[];for(const o in n)n[o].id&&r.includes(n[o].id)&&e.push(new Rt(i,n,"all the sprites' ids must be unique, but ".concat(n[o].id," is duplicated"))),r.push(n[o].id),n[o].url&&a.includes(n[o].url)&&e.push(new Rt(i,n,"all the sprites' URLs must be unique, but ".concat(n[o].url," is duplicated"))),a.push(n[o].url),e=e.concat(Tr({key:"".concat(i,"[").concat(o,"]"),value:n[o],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return Fr({key:i,value:n})}function Wr(t){return e=t.value,Boolean(e)&&e.constructor===Object?[]:[new Rt(t.key,t.value,"object expected, ".concat(qi(t.value)," found"))];var e}const qr={"*":()=>[],array:Er,boolean:function(t){const e=t.value,n=t.key,i=qi(e);return"boolean"!==i?[new Rt(n,e,"boolean expected, ".concat(i," found"))]:[]},number:Ar,color:Ir,constants:wr,enum:Rr,filter:kr,function:Cr,layer:Or,object:Tr,source:Ur,light:jr,sky:Vr,terrain:Hr,projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,r=t.style,a=qi(e);if(void 0===e)return[];if("object"!==a)return[new Rt("projection",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=o.concat(i[s]?t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n}):[new Rt(s,e[s],'unknown property "'.concat(s,'"'))]);return o},projectionDefinition:function(t){const e=t.key;let n=t.value;n=n instanceof String?n.valueOf():n;const i=qi(n);return"array"!==i||function(t){return Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]}(n)||function(t){return!!["interpolate","step","literal"].includes(t[0])}(n)?["array","string"].includes(i)?[]:[new Rt(e,n,'projection expected, invalid type "'.concat(i,'" found'))]:[new Rt(e,n,"projection expected, invalid array ".concat(JSON.stringify(n)," found"))]},string:Fr,formatted:function(t){return 0===Fr(t).length?[]:Pr(t)},resolvedImage:function(t){return 0===Fr(t).length?[]:Pr(t)},padding:function(t){const e=t.key,n=t.value;if("array"===qi(n)){if(n.length<1||n.length>4)return[new Rt(e,n,"padding requires 1 to 4 values; ".concat(n.length," values found"))];const i={type:"number"};let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return Ar({key:e,value:n,valueSpec:{}})},numberArray:function(t){const e=t.key,n=t.value;if("array"===qi(n)){const i={type:"number"};if(n.length<1)return[new Rt(e,n,"array length at least 1 expected, length 0 found")];let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return Ar({key:e,value:n,valueSpec:{}})},colorArray:function(t){const e=t.key,n=t.value;if("array"===qi(n)){if(n.length<1)return[new Rt(e,n,"array length at least 1 expected, length 0 found")];let t=[];for(let i=0;i<n.length;i++)t=t.concat(Ir({key:"".concat(e,"[").concat(i,"]"),value:n[i]}));return t}return Ir({key:e,value:n})},variableAnchorOffsetCollection:function(t){const e=t.key,n=t.value,i=qi(n),r=t.styleSpec;if("array"!==i||n.length<1||n.length%2!=0)return[new Rt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let o=0;o<n.length;o+=2)a=a.concat(Rr({key:"".concat(e,"[").concat(o,"]"),value:n[o],valueSpec:r.layout_symbol["text-anchor"]})),a=a.concat(Er({key:"".concat(e,"[").concat(o+1,"]"),value:n[o+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:r}));return a},sprite:Gr,state:Wr};function Zr(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return t.validateSpec=Zr,n.expression&&Zi(Sr(e))?Cr(t):n.expression&&nr(Mr(e))?Pr(t):n.type&&qr[n.type]?qr[n.type](t):Tr(kt({},t,{valueSpec:n.type?i[n.type]:n}))}function Xr(t){const e=t.value,n=t.key,i=Fr(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new Rt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Rt(n,e,'"glyphs" url must include a "{range}" token'))),i}function Yr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_t,n=[];return n=n.concat(Zr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:Zr,objectElementValidators:{glyphs:Xr,"*":()=>[]}})),t.constants&&(n=n.concat(wr({key:"constants",value:t.constants}))),Jr(n)}function Kr(t){return function(e){return t(i(i({},e),{},{validateSpec:Zr}))}}function Jr(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function $r(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Jr(t.apply(this,n))}}Yr.source=$r(Kr(Ur)),Yr.sprite=$r(Kr(Gr)),Yr.glyphs=$r(Kr(Xr)),Yr.light=$r(Kr(jr)),Yr.sky=$r(Kr(Vr)),Yr.terrain=$r(Kr(Hr)),Yr.state=$r(Kr(Wr)),Yr.layer=$r(Kr(Or)),Yr.filter=$r(Kr(kr)),Yr.paintProperty=$r(Kr(zr)),Yr.layoutProperty=$r(Kr(Nr));const Qr=Yr,ta=Qr.light,ea=Qr.sky,na=Qr.paintProperty,ia=Qr.layoutProperty;function ra(t,e){let n=!1;if(e&&e.length)for(const i of e)t.fire(new yt(new Error(i.message))),n=!0;return n}class aa{constructor(t,e,n){const i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(let t=0;t<this.d*this.d;t++){const e=r[3+t],n=r[3+t+1];i.push(e===n?null:r.subarray(e,n))}const a=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],a),this.bboxes=r.subarray(a),this.insert=this._insertReadonly}else{this.d=e+2*n;for(let t=0;t<this.d*this.d;t++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;const r=n/e*t;this.min=-r,this.max=t+r}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,n,i,r,a){this.cells[r].push(a)}query(t,e,n,i,r){const a=this.min,o=this.max;if(t<=a&&e<=a&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);{const a=[];return this._forEachCell(t,e,n,i,this._queryCell,a,{},r),a}}_queryCell(t,e,n,i,r,a,o,s){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===o[h]){const l=4*h;(s?s(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&n>=c[l+0]&&i>=c[l+1])?(o[h]=!0,a.push(r[h])):o[h]=!1}}}}_forEachCell(t,e,n,i,r,a,o,s){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,t,e,n,i,c,a,o,s))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let n=0;for(let a=0;a<this.cells.length;a++)n+=this.cells[a].length;const i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let r=e;for(let a=0;a<t.length;a++){const e=t[a];i[3+a]=r,i.set(e,r),r+=e.length}return i[3+t.length]=r,i.set(this.keys,r),r+=this.keys.length,i[3+t.length+1]=r,i.set(this.bboxes,r),r+=this.bboxes.length,i.buffer}static serialize(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}}static deserialize(t){return new aa(t.buffer)}}const oa={};function sa(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(oa[t])throw new Error("".concat(t," is already registered."));Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),oa[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}sa("Object",Object),sa("Set",Set),sa("TransferableGridIndex",aa),sa("Color",Ae),sa("Error",Error),sa("AJAXError",ut),sa("ResolvedImage",Fe),sa("StylePropertyFunction",sr),sa("StyleExpression",er,{omit:["_evaluator"]}),sa("ZoomDependentExpression",ar),sa("ZoomConstantExpression",rr),sa("CompoundExpression",ki,{omit:["_evaluate"]});for(const i in Ri)Ri[i]._classRegistryKey||sa("Expression_".concat(i),Ri[i]);function la(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ca(t){return t.$name||t.constructor._classRegistryKey}function ua(t){return!function(t){if(null===t||"object"!=typeof t)return!1;const e=ca(t);return!(!e||"Object"===e)}(t)&&(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||t instanceof Error||la(t)||Y(t)||ArrayBuffer.isView(t)||t instanceof ImageData)}function ha(t,e){if(ua(t))return(la(t)||Y(t))&&e&&e.push(t),ArrayBuffer.isView(t)&&e&&e.push(t.buffer),t instanceof ImageData&&e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const i of t)n.push(ha(i,e));return n}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);const n=ca(t);if(!n)throw new Error("can't serialize object of unregistered class ".concat(t.constructor.name));if(!oa[n])throw new Error("".concat(n," is not registered."));const{klass:i}=oa[n],r=i.serialize?i.serialize(t,e):{};if(i.serialize){if(e&&r===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const i in t){if(!t.hasOwnProperty(i))continue;if(oa[n].omit.indexOf(i)>=0)continue;const a=t[i];r[i]=oa[n].shallow.indexOf(i)>=0?a:ha(a,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}function da(t){if(ua(t))return t;if(Array.isArray(t))return t.map(da);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);const e=ca(t)||"Object";if(!oa[e])throw new Error("can't deserialize unregistered class ".concat(e));const{klass:n}=oa[e];if(!n)throw new Error("can't deserialize unregistered class ".concat(e));if(n.deserialize)return n.deserialize(t);const i=Object.create(n.prototype);for(const r of Object.keys(t)){if("$name"===r)continue;const n=t[r];i[r]=oa[e].shallow.indexOf(r)>=0?n:da(n)}return i}class pa{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const fa={"Latin-1 Supplement":t=>t>=128&&t<=255,"Hangul Jamo":t=>t>=4352&&t<=4607,Khmer:t=>t>=6016&&t<=6143,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Kanbun:t=>t>=12688&&t<=12703,"CJK Strokes":t=>t>=12736&&t<=12783,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Hangul Syllables":t=>t>=44032&&t<=55215,"Private Use Area":t=>t>=57344&&t<=63743,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ma(t){for(const e of t)if(ba(e.charCodeAt(0)))return!0;return!1}function ga(t){for(const e of t)if(!_a(e.charCodeAt(0)))return!1;return!0}function ya(t){const e=t.map(t=>{try{return new RegExp("\\p{sc=".concat(t,"}"),"u").source}catch(t){return null}}).filter(t=>t);return new RegExp(e.join("|"),"u")}const va=ya(["Arab","Dupl","Mong","Ougr","Syrc"]);function _a(t){return!va.test(String.fromCodePoint(t))}const xa=ya(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ba(t){return!(746!==t&&747!==t&&(t<4352||!(fa["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||fa["CJK Compatibility"](t)||fa["CJK Strokes"](t)||!(!fa["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||fa["Enclosed CJK Letters and Months"](t)||fa["Ideographic Description Characters"](t)||fa.Kanbun(t)||fa.Katakana(t)&&12540!==t||!(!fa["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!fa["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||fa["Vertical Forms"](t)||fa["Yijing Hexagram Symbols"](t)||/(?:[\u1400-\u167F\u18B0-\u18F5]|\uD806[\uDEB0-\uDEBF])/.test(String.fromCodePoint(t))||/[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/.test(String.fromCodePoint(t))||xa.test(String.fromCodePoint(t)))))}function wa(t){return!(ba(t)||function(t){return!!(fa["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||fa["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||fa["Letterlike Symbols"](t)||fa["Number Forms"](t)||fa["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||fa["Control Pictures"](t)&&9251!==t||fa["Optical Character Recognition"](t)||fa["Enclosed Alphanumerics"](t)||fa["Geometric Shapes"](t)||fa["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||fa["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||fa["CJK Symbols and Punctuation"](t)||fa.Katakana(t)||fa["Private Use Area"](t)||fa["CJK Compatibility Forms"](t)||fa["Small Form Variants"](t)||fa["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}const Sa=ya(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ma(t){return Sa.test(String.fromCodePoint(t))}function Ta(t,e){return!(!e&&Ma(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||fa.Khmer(t))}function Ea(t){for(const e of t)if(Ma(e.charCodeAt(0)))return!0;return!1}const Aa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(t){this.pluginStatus=t.pluginStatus,this.pluginURL=t.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(t){if(Aa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=t.applyArabicShaping,this.processBidirectionalText=t.processBidirectionalText,this.processStyledBidirectionalText=t.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(t,n){return e(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==t.pluginStatus)return this.setState(t),t;const e=t.pluginURL,i=new Promise(t=>{this.loadScriptResolve=t});n(e);const r=new Promise(t=>setTimeout(()=>t(),this.TIMEOUT));if(yield Promise.race([i,r]),this.isParsed()){const t={pluginStatus:"loaded",pluginURL:e};return this.setState(t),t}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error("RTL Text Plugin failed to import scripts from ".concat(e))})}};class Ca{constructor(t,e){this.zoom=t,e?(this.now=e.now||0,this.fadeDuration=e.fadeDuration||0,this.zoomHistory=e.zoomHistory||new pa,this.transition=e.transition||{},this.globalState=e.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pa,this.transition={},this.globalState={})}isSupportedScript(t){return function(t,e){for(const n of t)if(!Ta(n.charCodeAt(0),e))return!1;return!0}(t,"loaded"===Aa.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class Pa{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Zi(t))return new sr(t,e);if(nr(t)){const n=or(t,e);if("error"===n.result)throw new Error(n.value.map(t=>"".concat(t.key,": ").concat(t.message)).join(", "));return n.value}{let n=t;return"color"===e.type&&"string"==typeof t?n=Ae.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"numberArray"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"colorArray"!==e.type||"string"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)?n=Oe.parse(t):"projectionDefinition"===e.type&&"string"==typeof t&&(n=Be.parse(t)):n=De.parse(t):n=Le.parse(t):n=ke.parse(t),{globalStateRefs:new Set,kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class Ia{constructor(t){this.property=t,this.value=new Pa(t,void 0)}transitioned(t,e){return new ka(this.property,this.value,e,B({},t.transition,this.transition),t.now)}untransitioned(){return new ka(this.property,this.value,null,{},0)}}class Ra{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return H(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ia(this._values[t].property)),this._values[t].value=new Pa(this._values[t].property,null===e?void 0:H(e))}getTransition(t){return H(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ia(this._values[t].property)),this._values[t].transition=H(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const i=this.getTransition(e);void 0!==i&&(t["".concat(e,"-transition")]=i)}return t}transitioned(t,e){const n=new La(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(t,e._values[i]);return n}untransitioned(){const t=new La(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class ka{constructor(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const i=t.now||0,r=this.value.possiblyEvaluate(t,e,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return a.possiblyEvaluate(t,e,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t,e,n),r,D(o))}}return r}}class La{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const i=new Na(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Da{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return H(this._values[t].value)}setValue(t,e){this._values[t]=new Pa(this._values[t].property,null===e?void 0:H(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const i=new Na(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(t,e,n);return i}}class za{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,i){return this.property.evaluate(this.value,this.parameters,t,e,n,i)}}class Na{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Oa{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,n){const i=gn[this.specification.type];return i?i(t,e,n):t}}class Fa{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,i){return new za(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,i)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new za(this,{kind:"constant",value:void 0},t.parameters);const i=gn[this.specification.type];if(i){const r=i(t.value.value,e.value.value,n);return new za(this,{kind:"constant",value:r},t.parameters)}return t}evaluate(t,e,n,i,r,a){return"constant"===t.kind?t.value:t.evaluate(e,n,i,r,a)}}class Ba extends Fa{possiblyEvaluate(t,e,n,i){if(void 0===t.value)return new za(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i),a="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,o=this._calculate(a,a,a,e);return new za(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new za(this,{kind:"constant",value:n},e)}return new za(this,t.expression,e)}evaluate(t,e,n,i,r,a){if("source"===t.kind){const o=t.evaluate(e,n,i,r,a);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class Ua{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},n,i);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Ca(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Ca(Math.floor(e.zoom),e)),t.expression.evaluate(new Ca(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class ja{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,i){return!!t.expression.evaluate(e,null,{},n,i)}interpolate(){return!1}}class Va{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const i=this.defaultPropertyValues[e]=new Pa(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new Ia(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}}}sa("DataDrivenProperty",Fa),sa("DataConstantProperty",Oa),sa("CrossFadedDataDrivenProperty",Ba),sa("CrossFadedProperty",Ua),sa("ColorRampProperty",ja);const Ha="-transition";class Ga extends vt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=dr(t.filter)),e.layout&&(this._unevaluatedLayout=new Da(e.layout)),e.paint)){this._transitionablePaint=new Ra(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Na(e.paint)}}setFilter(t){this.filter=t,this._featureFilter=dr(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const e in this._unevaluatedLayout._values){const n=this._unevaluatedLayout._values[e];for(const e of n.getGlobalStateRefs())t.add(e)}for(const e of this._featureFilter.getGlobalStateRefs())t.add(e);return t}setLayoutProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=e&&this._validate(ia,"layers.".concat(this.id,".layout.").concat(t),t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(Ha)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e&&this._validate(na,"layers.".concat(this.id,".paint.").concat(t),t,e,n))return!1;if(t.endsWith(Ha))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const o=this._transitionablePaint._values[t].value;return o.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(t,a,o)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),V(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!r||!1!==r.validate)&&ra(this,t.call(Qr,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof za&&Hi(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Wa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qa{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Za{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xa(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,i=0;return{members:t.map(t=>{const r=Wa[t.type].BYTES_PER_ELEMENT,a=n=Ya(n,Math.max(e,r)),o=t.components||1;return i=Math.max(i,r),n+=r*o,{name:t.name,type:t.type,components:o,offset:a}}),size:Ya(n,Math.max(i,e)),alignment:e}}function Ya(t,e){return Math.ceil(t/e)*e}class Ka extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t}}Ka.prototype.bytesPerElement=4,sa("StructArrayLayout2i4",Ka);class Ja extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t}}Ja.prototype.bytesPerElement=6,sa("StructArrayLayout3i6",Ja);class $a extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const a=4*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,t}}$a.prototype.bytesPerElement=8,sa("StructArrayLayout4i8",$a);class Qa extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t}}Qa.prototype.bytesPerElement=12,sa("StructArrayLayout2i4i12",Qa);class to extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=4*t,l=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[l+4]=i,this.uint8[l+5]=r,this.uint8[l+6]=a,this.uint8[l+7]=o,t}}to.prototype.bytesPerElement=8,sa("StructArrayLayout2i4ub8",to);class eo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t}}eo.prototype.bytesPerElement=8,sa("StructArrayLayout2f8",eo);class no extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,a,o,s,l,c)}emplace(t,e,n,i,r,a,o,s,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}no.prototype.bytesPerElement=20,sa("StructArrayLayout10ui20",no);class io extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,n,i,r,a,o,s,l,c,u,h)}emplace(t,e,n,i,r,a,o,s,l,c,u,h,d){const p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,t}}io.prototype.bytesPerElement=24,sa("StructArrayLayout4i4ui4i24",io);class ro extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}ro.prototype.bytesPerElement=12,sa("StructArrayLayout3f12",ro);class ao extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}ao.prototype.bytesPerElement=4,sa("StructArrayLayout1ul4",ao);class oo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,i,r,a,o,s,l)}emplace(t,e,n,i,r,a,o,s,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+3]=r,this.int16[u+4]=a,this.int16[u+5]=o,this.uint32[h+3]=s,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}oo.prototype.bytesPerElement=20,sa("StructArrayLayout6i1ul2ui20",oo);class so extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t}}so.prototype.bytesPerElement=12,sa("StructArrayLayout2i2i2i12",so);class lo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,i,r)}emplace(t,e,n,i,r,a){const o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[s+6]=r,this.int16[s+7]=a,t}}lo.prototype.bytesPerElement=16,sa("StructArrayLayout2f1f2i16",lo);class co extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)}emplace(t,e,n,i,r,a,o){const s=16*t,l=4*t,c=8*t;return this.uint8[s+0]=e,this.uint8[s+1]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.int16[c+6]=a,this.int16[c+7]=o,t}}co.prototype.bytesPerElement=16,sa("StructArrayLayout2ub2f2i16",co);class uo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t}}uo.prototype.bytesPerElement=6,sa("StructArrayLayout3ui6",uo);class ho extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g)}emplace(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y){const v=24*t,_=12*t,x=48*t;return this.int16[v+0]=e,this.int16[v+1]=n,this.uint16[v+2]=i,this.uint16[v+3]=r,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[v+10]=l,this.uint16[v+11]=c,this.uint16[v+12]=u,this.float32[_+7]=h,this.float32[_+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[_+10]=g,this.int16[v+22]=y,t}}ho.prototype.bytesPerElement=48,sa("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ho);class po extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,T,E,A){const C=this.length;return this.resize(C+1),this.emplace(C,t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,T,E,A)}emplace(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,T,E,A,C){const P=32*t,I=16*t;return this.int16[P+0]=e,this.int16[P+1]=n,this.int16[P+2]=i,this.int16[P+3]=r,this.int16[P+4]=a,this.int16[P+5]=o,this.int16[P+6]=s,this.int16[P+7]=l,this.uint16[P+8]=c,this.uint16[P+9]=u,this.uint16[P+10]=h,this.uint16[P+11]=d,this.uint16[P+12]=p,this.uint16[P+13]=f,this.uint16[P+14]=m,this.uint16[P+15]=g,this.uint16[P+16]=y,this.uint16[P+17]=v,this.uint16[P+18]=_,this.uint16[P+19]=x,this.uint16[P+20]=b,this.uint16[P+21]=w,this.uint16[P+22]=S,this.uint32[I+12]=M,this.float32[I+13]=T,this.float32[I+14]=E,this.uint16[P+30]=A,this.uint16[P+31]=C,t}}po.prototype.bytesPerElement=64,sa("StructArrayLayout8i15ui1ul2f2ui64",po);class fo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}fo.prototype.bytesPerElement=4,sa("StructArrayLayout1f4",fo);class mo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=3*t;return this.uint16[6*t+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t}}mo.prototype.bytesPerElement=12,sa("StructArrayLayout1ui2f12",mo);class go extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)}emplace(t,e,n,i){const r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=n,this.uint16[r+3]=i,t}}go.prototype.bytesPerElement=8,sa("StructArrayLayout1ul2ui8",go);class yo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t}}yo.prototype.bytesPerElement=4,sa("StructArrayLayout2ui4",yo);class vo extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}vo.prototype.bytesPerElement=2,sa("StructArrayLayout1ui2",vo);class _o extends Za{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)}emplace(t,e,n,i,r){const a=4*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,t}}_o.prototype.bytesPerElement=16,sa("StructArrayLayout4f16",_o);class xo extends qa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new n(this.anchorPointX,this.anchorPointY)}}xo.prototype.size=20;class bo extends oo{get(t){return new xo(this,t)}}sa("CollisionBoxArray",bo);class wo extends qa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}wo.prototype.size=48;class So extends ho{get(t){return new wo(this,t)}}sa("PlacedSymbolArray",So);class Mo extends qa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Mo.prototype.size=64;class To extends po{get(t){return new Mo(this,t)}}sa("SymbolInstanceArray",To);class Eo extends fo{getoffsetX(t){return this.float32[1*t+0]}}sa("GlyphOffsetArray",Eo);class Ao extends Ja{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}sa("SymbolLineVertexArray",Ao);class Co extends qa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Co.prototype.size=12;class Po extends mo{get(t){return new Co(this,t)}}sa("TextAnchorOffsetArray",Po);class Io extends qa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Io.prototype.size=8;class Ro extends go{get(t){return new Io(this,t)}}sa("FeatureIndexArray",Ro);class ko extends Ka{}class Lo extends Ka{}class Do extends Ka{}class zo extends Qa{}class No extends to{}class Oo extends eo{}class Fo extends no{}class Bo extends io{}class Uo extends ro{}class jo extends ao{}class Vo extends so{}class Ho extends co{}class Go extends uo{}class Wo extends yo{}const qo=Xa([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zo}=qo;class Xo{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,e,n,i){const r=this.segments[this.segments.length-1];return t>Xo.MAX_VERTEX_ARRAY_LENGTH&&W("Max vertices per segment is ".concat(Xo.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t,". Consider using the `fillLargeMeshArrays` function if you require meshes with more than ").concat(Xo.MAX_VERTEX_ARRAY_LENGTH," vertices.")),this._forceNewSegmentOnNextPrepare||!r||r.vertexLength+t>Xo.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i?this.createNewSegment(e,n,i):r}createNewSegment(t,e,n){const i={vertexOffset:t.length,primitiveOffset:e.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==n&&(i.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(i),i}getOrCreateLatestSegment(t,e,n){return this.prepareSegment(0,t,e,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,i){return new Xo([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function Yo(t,e){return 256*(t=O(Math.floor(t),0,255))+O(Math.floor(e),0,255)}Xo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,sa("SegmentVector",Xo);const Ko=Xa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jo,$o,Qo,ts={exports:{}},es={exports:{}},ns={exports:{}},is=function(){if(Qo)return ts.exports;Qo=1;var t=(Jo||(Jo=1,es.exports=function(t,e){var n,i,r,a,o,s,l,c;for(i=t.length-(n=3&t.length),r=e,o=3432918353,s=461845907,c=0;c<i;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(a=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}),es.exports),e=($o||($o=1,ns.exports=function(t,e){for(var n,i=t.length,r=e^i,a=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:r^=(255&t.charCodeAt(a+2))<<16;case 2:r^=(255&t.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}),ns.exports);return ts.exports=t,ts.exports.murmur3=t,ts.exports.murmur2=e,ts.exports}(),rs=r(is);class as{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,i){this.ids.push(os(t)),this.positions.push(e,n,i)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=os(t);let n=0,i=this.ids.length-1;for(;n<i;){const t=n+i>>1;this.ids[t]>=e?i=t:n=t+1}const r=[];for(;this.ids[n]===e;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(t,e){const n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return ss(n,i,0,n.length-1),e&&e.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(t){const e=new as;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function os(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:rs(String(t))}function ss(t,e,n,i){for(;n<i;){const r=t[n+i>>1];let a=n-1,o=i+1;for(;;){do{a++}while(t[a]<r);do{o--}while(t[o]>r);if(a>=o)break;ls(t,a,o),ls(e,3*a,3*o),ls(e,3*a+1,3*o+1),ls(e,3*a+2,3*o+2)}o-n<i-o?(ss(t,e,n,o),n=o+1):(ss(t,e,o+1,i),i=o)}}function ls(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}sa("FeaturePositionMap",as);class cs{constructor(t,e){this.gl=t.gl,this.location=e}}class us extends cs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class hs extends cs{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ds extends cs{constructor(t,e){super(t,e),this.current=Ae.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ps=new Float32Array(16);function fs(t){return[Yo(255*t.r,255*t.g),Yo(255*t.b,255*t.a)]}class ms{constructor(t,e,n){this.value=t,this.uniformNames=e.map(t=>"u_".concat(t)),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new ds(t,e):new us(t,e)}}class gs{constructor(t,e){this.uniformNames=e.map(t=>"u_".concat(t)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,n,i){const r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,n){return"u_pattern"===n.substr(0,9)?new hs(t,e):new us(t,e)}}class ys{constructor(t,e,n,i){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_".concat(t),type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(t,e,n,i,r){const a=this.paintVertexArray.length,o=this.expression.evaluate(new Ca(0),e,{},i,[],r);this.paintVertexArray.resize(t),this._setPaintValue(a,t,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(t,e,r)}_setPaintValue(t,e,n){if("color"===this.type){const i=fs(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vs{constructor(t,e,n,i,r,a){this.expression=t,this.uniformNames=e.map(t=>"u_".concat(t,"_t")),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:"a_".concat(t),type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,e,n,i,r){const a=this.expression.evaluate(new Ca(this.zoom),e,{},i,[],r),o=this.expression.evaluate(new Ca(this.zoom+1),e,{},i,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,a,o)}updatePaintArray(t,e,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),a=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(t,e,r,a)}_setPaintValue(t,e,n,i){if("color"===this.type){const r=fs(n),a=fs(i);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1],a[0],a[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,i=O(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(i)}getBinding(t,e,n){return new us(t,e)}}class _s{constructor(t,e,n,i,r,a){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=i,this.layerId=a,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,e,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,i,r){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(t,e,n,i){if(!i||!n)return;const{min:r,mid:a,max:o}=n,s=i[r],l=i[a],c=i[o];if(s&&l&&c)for(let u=t;u<e;u++)this.zoomInPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(u,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ko.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ko.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xs{constructor(t,e,n){this.binders={},this._buffers=[];const i=[];for(const r in t.paint._values){if(!n(r))continue;const a=t.paint.get(r);if(!(a instanceof za&&Hi(a.property.specification)))continue;const o=ws(r,t.type),s=a.value,l=a.property.specification.type,c=a.property.useIntegerZoom,u=a.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[r]=h?new gs(s.value,o):new ms(s.value,o,l),i.push("/u_".concat(r));else if("source"===s.kind||h){const n=Ss(r,l,"source");this.binders[r]=h?new _s(s,l,c,e,n,t.id):new ys(s,o,l,n),i.push("/a_".concat(r))}else{const t=Ss(r,l,"composite");this.binders[r]=new vs(s,o,l,c,e,t),i.push("/z_".concat(r))}}this.cacheKey=i.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof ys||e instanceof vs?e.maxValue:0}populatePaintArrays(t,e,n,i,r){for(const a in this.binders){const o=this.binders[a];(o instanceof ys||o instanceof vs||o instanceof _s)&&o.populatePaintArray(t,e,n,i,r)}}setConstantPatternPositions(t,e){for(const n in this.binders){const i=this.binders[n];i instanceof gs&&i.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,i,r){let a=!1;for(const o in t){const s=e.getPositions(o);for(const e of s){const s=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof ys||l instanceof vs||l instanceof _s)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(e.start,e.end,s,t[o],r),a=!0}}}}return a}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof ms||n instanceof gs)&&t.push(...n.uniformNames.map(t=>"#define HAS_UNIFORM_".concat(t)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof ys||n instanceof vs)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name);else if(n instanceof _s)for(let e=0;e<Ko.members.length;e++)t.push(Ko.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof ms||n instanceof gs||n instanceof vs)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof ms||r instanceof gs||r instanceof vs)for(const a of r.uniformNames)if(e[a]){const o=r.getBinding(t,e[a],a);n.push({name:a,property:i,binding:o})}}return n}setUniforms(t,e,n,i){for(const{name:r,property:a,binding:o}of e)this.binders[a].setUniform(o,i,n.get(a),r)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof _s){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof ys||n instanceof vs)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof ys||n instanceof vs||n instanceof _s)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof ys||e instanceof vs||e instanceof _s)&&e.destroy()}}}class bs{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new xs(i,e,n);this.needsUpload=!1,this._featureMap=new as,this._bufferOffset=0}populatePaintArrays(t,e,n,i,r,a){for(const o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,i,r,a);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ws(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace("".concat(e,"-"),"").replace(/-/g,"_")]}function Ss(t,e,n){const i={color:{source:eo,composite:_o},number:{source:fo,composite:eo}},r=function(t){return{"line-pattern":{source:Fo,composite:Fo},"fill-pattern":{source:Fo,composite:Fo},"fill-extrusion-pattern":{source:Fo,composite:Fo}}[t]}(t);return r&&r[n]||i[e][n]}sa("ConstantBinder",ms),sa("CrossFadedConstantBinder",gs),sa("SourceExpressionBinder",ys),sa("CrossFadedCompositeBinder",_s),sa("CompositeExpressionBinder",vs),sa("ProgramConfiguration",xs,{omit:["_buffers"]}),sa("ProgramConfigurationSet",bs);const Ms=Math.pow(2,14)-1,Ts=-Ms-1;function Es(t){const e=I/t.extent,n=t.loadGeometry();for(let i=0;i<n.length;i++){const t=n[i];for(let n=0;n<t.length;n++){const i=t[n],r=Math.round(i.x*e),a=Math.round(i.y*e);i.x=O(r,Ts,Ms),i.y=O(a,Ts,Ms),(r<i.x||r>i.x+1||a<i.y||a>i.y+1)&&W("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function As(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Es(t):[]}}const Cs=-32768;function Ps(t,e,n,i,r){t.emplaceBack(Cs+8*e+i,Cs+8*n+r)}class Is{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Lo,this.indexArray=new Go,this.segments=new Xo,this.programConfigurations=new bs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){const i=this.layers[0],r=[];let a=null,o=!1,s="heatmap"===i.type;if("circle"===i.type){const t=i;a=t.layout.get("circle-sort-key"),o=!a.isConstant(),s=s||"map"===t.paint.get("circle-pitch-alignment")}const l=s?e.subdivisionGranularity.circle:1;for(const{feature:c,id:u,index:h,sourceLayerIndex:d}of t){const t=this.layers[0]._featureFilter.needGeometry,e=As(c,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),e,n))continue;const i=o?a.evaluate(e,{},n):void 0,s={id:u,properties:c.properties,type:c.type,sourceLayerIndex:d,index:h,geometry:t?e.geometry:Es(c),patterns:{},sortKey:i};r.push(s)}o&&r.sort((t,e)=>t.sortKey-e.sortKey);for(const c of r){const{geometry:i,index:r,sourceLayerIndex:a}=c,o=t[r].feature;this.addFeature(c,i,r,n,l),e.featureIndex.insert(o,i,r,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,i){let r,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;switch(a){case 1:r=[0,7];break;case 3:r=[0,2,5,7];break;case 5:r=[0,1,3,4,6,7];break;case 7:r=[0,1,2,3,4,5,6,7];break;default:throw new Error("Invalid circle bucket granularity: ".concat(a,"; valid values are 1, 3, 5, 7."))}const o=r.length;for(const s of e)for(const e of s){const n=e.x,i=e.y;if(n<0||n>=I||i<0||i>=I)continue;const a=this.segments.prepareSegment(o*o,this.layoutVertexArray,this.indexArray,t.sortKey),s=a.vertexLength;for(let t=0;t<o;t++)for(let e=0;e<o;e++)Ps(this.layoutVertexArray,n,i,r[e],r[t]);for(let t=0;t<o-1;t++)for(let e=0;e<o-1;e++){const n=s+t*o+e,i=s+(t+1)*o+e;this.indexArray.emplaceBack(n,i+1,n+1),this.indexArray.emplaceBack(n,i,i+1)}a.vertexLength+=o*o,a.primitiveLength+=(o-1)*(o-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},i)}}function Rs(t,e){for(let n=0;n<t.length;n++)if(Us(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Us(t,e[n]))return!0;return!!zs(t,e)}function ks(t,e,n){return!!Us(t,e)||!!Os(e,t,n)}function Ls(t,e){if(1===t.length)return Bs(e,t[0]);for(let n=0;n<e.length;n++){const i=e[n];for(let e=0;e<i.length;e++)if(Us(t,i[e]))return!0}for(let n=0;n<t.length;n++)if(Bs(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(zs(t,e[n]))return!0;return!1}function Ds(t,e,n){if(t.length>1){if(zs(t,e))return!0;for(let i=0;i<e.length;i++)if(Os(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Os(t[i],e,n))return!0;return!1}function zs(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)if(Ns(i,r,e[t],e[t+1]))return!0}return!1}function Ns(t,e,n,i){return q(t,n,i)!==q(e,n,i)&&q(t,e,n)!==q(t,e,i)}function Os(t,e,n){const i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(Fs(t,e[r-1],e[r])<i)return!0;return!1}function Fs(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function Bs(t,e){let n,i,r,a=!1;for(let o=0;o<t.length;o++){n=t[o];for(let t=0,o=n.length-1;t<n.length;o=t++)i=n[t],r=n[o],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(a=!a)}return a}function Us(t,e){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const a=t[i],o=t[r];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function js(t,e,n){const i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;const a=q(t,e,n[0]);return a!==q(t,e,n[1])||a!==q(t,e,n[2])||a!==q(t,e,n[3])}function Vs(t,e,n){const i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Hs(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Gs(t,e,i,r,a){if(!e[0]&&!e[1])return t;const o=n.convert(e)._mult(a);"viewport"===i&&o._rotate(-r);const s=[];for(let n=0;n<t.length;n++)s.push(t[n].sub(o));return s}let Ws,qs;sa("CircleBucket",Is,{omit:["layers"]});var Zs={get paint(){return qs=qs||new Va({"circle-radius":new Fa(_t.paint_circle["circle-radius"]),"circle-color":new Fa(_t.paint_circle["circle-color"]),"circle-blur":new Fa(_t.paint_circle["circle-blur"]),"circle-opacity":new Fa(_t.paint_circle["circle-opacity"]),"circle-translate":new Oa(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new Oa(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oa(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oa(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fa(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fa(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fa(_t.paint_circle["circle-stroke-opacity"])})},get layout(){return Ws=Ws||new Va({"circle-sort-key":new Fa(_t.layout_circle["circle-sort-key"])})}};class Xs extends Ga{constructor(t){super(t,Zs)}createBucket(t){return new Is(t)}queryRadius(t){const e=t;return Vs("circle-radius",this,e)+Vs("circle-stroke-width",this,e)+Hs(this.paint.get("circle-translate"))}queryIntersectsFeature(t){let{queryGeometry:e,feature:n,featureState:i,geometry:r,transform:a,pixelsToTileUnits:o,unwrappedTileID:s,getElevation:l}=t;const c=Gs(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-a.bearingInRadians,o),u=this.paint.get("circle-radius").evaluate(n,i)+this.paint.get("circle-stroke-width").evaluate(n,i),h="map"===this.paint.get("circle-pitch-alignment"),d=h?c:function(t,e,n,i){return t.map(t=>Ys(t,e,n,i))}(c,a,s,l),p=h?u*o:u;for(const f of r)for(const t of f){const e=h?t:Ys(t,a,s,l);let n=p;const i=a.projectTileCoordinates(t.x,t.y,s,l).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?n*=i/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(n*=a.cameraToCenterDistance/i),ks(d,e,n))return!0}return!1}}function Ys(t,e,i,r){const a=e.projectTileCoordinates(t.x,t.y,i,r).point;return new n((.5*a.x+.5)*e.width,(.5*-a.y+.5)*e.height)}class Ks extends Is{}let Js;sa("HeatmapBucket",Ks,{omit:["layers"]});var $s={get paint(){return Js=Js||new Va({"heatmap-radius":new Fa(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fa(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oa(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ja(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oa(_t.paint_heatmap["heatmap-opacity"])})}};function Qs(t,e,n,i){let{width:r,height:a}=e;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*a*n)throw new RangeError("mismatched image size. expected: ".concat(i.length," but got: ").concat(r*a*n))}else i=new Uint8Array(r*a*n);return t.width=r,t.height=a,t.data=i,t}function tl(t,e,n){let{width:i,height:r}=e;if(i===t.width&&r===t.height)return;const a=Qs({},{width:i,height:r},n);el(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=a.data}function el(t,e,n,i,r,a){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,s=e.data;if(o===s)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<r.height;l++){const c=((n.y+l)*t.width+n.x)*a,u=((i.y+l)*e.width+i.x)*a;for(let t=0;t<r.width*a;t++)s[u+t]=o[c+t]}return e}class nl{constructor(t,e){Qs(this,t,1,e)}resize(t){tl(this,t,1)}clone(){return new nl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){el(t,e,n,i,r,1)}}class il{constructor(t,e){Qs(this,t,4,e)}resize(t){tl(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){el(t,e,n,i,r,4)}setPixel(t,e,n){const i=4*(t*this.width+e);this.data[i+0]=Math.round(255*n.r/n.a),this.data[i+1]=Math.round(255*n.g/n.a),this.data[i+2]=Math.round(255*n.b/n.a),this.data[i+3]=Math.round(255*n.a)}}function rl(t){const e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new il({width:n,height:i});if(Math.log(n)/Math.LN2%1!=0)throw new Error("width is not a power of 2 - ".concat(n));const a=(i,a,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);r.setPixel(i/4/n,a/4,s)};if(t.clips)for(let o=0,s=0;o<i;++o,s+=4*n)for(let e=0,i=0;e<n;e++,i+=4){const r=e/(n-1),{start:l,end:c}=t.clips[o];a(s,i,l*(1-r)+c*r)}else for(let o=0,s=0;o<n;o++,s+=4)a(0,s,o/(n-1));return r}sa("AlphaImage",nl),sa("RGBAImage",il);const al="big-fb";class ol extends Ga{createBucket(t){return new Ks(t)}constructor(t){super(t,$s),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(al)&&this.heatmapFbos.delete(al)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let sl;var ll={get paint(){return sl=sl||new Va({"hillshade-illumination-direction":new Oa(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Oa(_t.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Oa(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oa(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oa(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oa(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oa(_t.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Oa(_t.paint_hillshade["hillshade-method"])})}};class cl extends Ga{constructor(t){super(t,ll),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,e=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,i=this.paint.get("hillshade-shadow-color").values;const r=Math.max(t.length,e.length,n.length,i.length);t=t.concat(Array(r-t.length).fill(t.at(-1))),e=e.concat(Array(r-e.length).fill(e.at(-1))),n=n.concat(Array(r-n.length).fill(n.at(-1))),i=i.concat(Array(r-i.length).fill(i.at(-1)));const a=e.map(et);return{directionRadians:t.map(et),altitudeRadians:a,shadowColor:i,highlightColor:n}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let ul;var hl={get paint(){return ul=ul||new Va({"color-relief-opacity":new Oa(_t["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ja(_t["paint_color-relief"]["color-relief-color"])})}};class dl{constructor(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)}update(t,e,n){const{width:i,height:r}=t,a=!(this.size&&this.size[0]===i&&this.size[1]===r||n),{context:o}=this,{gl:s}=o;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[i,r],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Y(t)?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,r,0,this.format,s.UNSIGNED_BYTE,t.data);else{const{x:e,y:a}=n||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Y(t)?s.texSubImage2D(s.TEXTURE_2D,0,e,a,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,e,a,i,r,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D),o.pixelStoreUnpackFlipY.setDefault(),o.pixelStoreUnpack.setDefault(),o.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,e,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class pl{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void W('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".'));this.stride=e.height;const s=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=r,this.blueFactor=a,this.baseShift=o;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let l=0;l<s;l++)this.data[this._idx(-1,l)]=this.data[this._idx(0,l)],this.data[this._idx(s,l)]=this.data[this._idx(s-1,l)],this.data[this._idx(l,-1)]=this.data[this._idx(l,0)],this.data[this._idx(l,s)]=this.data[this._idx(l,s-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(s,-1)]=this.data[this._idx(s-1,0)],this.data[this._idx(-1,s)]=this.data[this._idx(0,s-1)],this.data[this._idx(s,s)]=this.data[this._idx(s-1,s-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let l=0;l<s;l++)for(let t=0;t<s;t++){const e=this.get(l,t);e>this.max&&(this.max=e),e<this.min&&(this.min=e)}}get(t,e){const n=new Uint8Array(this.data.buffer),i=4*this._idx(t,e);return this.unpack(n[i],n[i+1],n[i+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,n){return t*this.redFactor+e*this.greenFactor+n*this.blueFactor-this.baseShift}pack(t){return fl(t,this.getUnpackVector())}getPixels(){return new il({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=e*this.dim,r=e*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}const s=-e*this.dim,l=-n*this.dim;for(let c=a;c<o;c++)for(let e=i;e<r;e++)this.data[this._idx(e,c)]=t.data[this._idx(e+s,c+l)]}}function fl(t,e){const n=e[0],i=e[1],r=e[2],a=e[3],o=Math.min(n,i,r),s=Math.round((t+a)/o);return{r:Math.floor(s*o/n)%256,g:Math.floor(s*o/i)%256,b:Math.floor(s*o/r)%256}}sa("DEMData",pl);class ml extends Ga{constructor(t){super(t,hl)}_createColorRamp(t){const e={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof rr&&n._styleExpression.expression instanceof fn){this.colorRampExpression=n;const t=n._styleExpression.expression;e.elevationStops=t.labels,e.colorStops=[];for(const n of e.elevationStops)e.colorStops.push(t.evaluate({globals:{elevation:n}}))}if(e.elevationStops.length<1&&(e.elevationStops=[0],e.colorStops=[Ae.transparent]),e.elevationStops.length<2&&(e.elevationStops.push(e.elevationStops[0]+1),e.colorStops.push(e.colorStops[0])),e.elevationStops.length<=t)return e;const i={elevationStops:[],colorStops:[]},r=(e.elevationStops.length-1)/(t-1);for(let a=0;a<e.elevationStops.length-.5;a+=r)i.elevationStops.push(e.elevationStops[Math.round(a)]),i.colorStops.push(e.colorStops[Math.round(a)]);return W("Too many colors in specification of ".concat(this.id," color-relief layer, may not render properly.")),i}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,e,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const i=this._createColorRamp(e),r=new il({width:i.colorStops.length,height:1}),a=new il({width:i.colorStops.length,height:1});for(let o=0;o<i.elevationStops.length;o++){const t=fl(i.elevationStops[o],n);a.setPixel(0,o,new Ae(t.r/255,t.g/255,t.b/255,1)),r.setPixel(0,o,i.colorStops[o])}return this.colorRampTextures={elevationTexture:new dl(t,a,t.gl.RGBA),colorTexture:new dl(t,r,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}}const gl=Xa([{name:"a_pos",components:2,type:"Int16"}],4),{members:yl}=gl;function vl(t,e,n){const i=n.patternDependencies;let r=!1;for(const a of e){const e=a.paint.get("".concat(t,"-pattern"));e.isConstant()||(r=!0);const n=e.constantOr(null);n&&(r=!0,i[n.to]=!0,i[n.from]=!0)}return r}function _l(t,e,n,i,r){const a=r.patternDependencies;for(const o of e){const e=o.paint.get("".concat(t,"-pattern")).value;if("constant"!==e.kind){let t=e.evaluate({zoom:i-1},n,{},r.availableImages),s=e.evaluate({zoom:i},n,{},r.availableImages),l=e.evaluate({zoom:i+1},n,{},r.availableImages);t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,l=l&&l.name?l.name:l,a[t]=!0,a[s]=!0,a[l]=!0,n.patterns[o.id]={min:t,mid:s,max:l}}}return n}function xl(t,e,n,i,r){let a;if(r===function(t,e,n,i){let r=0;for(let a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(let o=e;o<n;o+=i)a=Vl(o/i|0,t[o],t[o+1],a);else for(let o=n-i;o>=e;o-=i)a=Vl(o/i|0,t[o],t[o+1],a);return a&&Nl(a,a.next)&&(Hl(a),a=a.next),a}function bl(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!Nl(i,i.next)&&0!==zl(i.prev,i,i.next))i=i.next;else{if(Hl(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function wl(t,e,n,i,r,a,o){if(!t)return;!o&&a&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=Il(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n=1;do{let i,r=t;t=null;let a=null;for(e=0;r;){e++;let o=r,s=0;for(let t=0;t<n&&(s++,o=o.nextZ,o);t++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||r.z<=o.z)?(i=r,r=r.nextZ,s--):(i=o,o=o.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=o}a.nextZ=null,n*=2}while(e>1)}(r)}(t,i,r,a);let s=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(a?Ml(t,i,r,a):Sl(t))e.push(l.i,t.i,c.i),Hl(t),t=c.next,s=c.next;else if((t=c)===s){o?1===o?wl(t=Tl(bl(t),e),e,n,i,r,a,2):2===o&&El(t,e,n,i,r,a):wl(bl(t),e,n,i,r,a,1);break}}}function Sl(t){const e=t.prev,n=t,i=t.next;if(zl(e,n,i)>=0)return!1;const r=e.x,a=n.x,o=i.x,s=e.y,l=n.y,c=i.y,u=Math.min(r,a,o),h=Math.min(s,l,c),d=Math.max(r,a,o),p=Math.max(s,l,c);let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Ll(r,s,a,l,o,c,f.x,f.y)&&zl(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ml(t,e,n,i){const r=t.prev,a=t,o=t.next;if(zl(r,a,o)>=0)return!1;const s=r.x,l=a.x,c=o.x,u=r.y,h=a.y,d=o.y,p=Math.min(s,l,c),f=Math.min(u,h,d),m=Math.max(s,l,c),g=Math.max(u,h,d),y=Il(p,f,e,n,i),v=Il(m,g,e,n,i);let _=t.prevZ,x=t.nextZ;for(;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&Ll(s,u,l,h,c,d,_.x,_.y)&&zl(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Ll(s,u,l,h,c,d,x.x,x.y)&&zl(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&Ll(s,u,l,h,c,d,_.x,_.y)&&zl(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&Ll(s,u,l,h,c,d,x.x,x.y)&&zl(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Tl(t,e){let n=t;do{const i=n.prev,r=n.next.next;!Nl(i,r)&&Ol(i,n,n.next,r)&&Ul(i,r)&&Ul(r,i)&&(e.push(i.i,n.i,r.i),Hl(n),Hl(n.next),n=t=r),n=n.next}while(n!==t);return bl(n)}function El(t,e,n,i,r,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Dl(o,t)){let s=jl(o,t);return o=bl(o,o.next),s=bl(s,s.next),wl(o,e,n,i,r,a,0),void wl(s,e,n,i,r,a,0)}t=t.next}o=o.next}while(o!==t)}function Al(t,e){let n=t.x-e.x;return 0===n&&(n=t.y-e.y,0===n)&&(n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function Cl(t,e){const n=function(t,e){let n=e;const i=t.x,r=t.y;let a,o=-1/0;if(Nl(t,n))return n;do{if(Nl(t,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o&&(o=t,a=n.x<n.next.x?n:n.next,t===i))return a}n=n.next}while(n!==e);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(i>=n.x&&n.x>=l&&i!==n.x&&kl(r<c?i:o,r,l,c,r<c?o:i,r,n.x,n.y)){const e=Math.abs(r-n.y)/(i-n.x);Ul(n,t)&&(e<u||e===u&&(n.x>a.x||n.x===a.x&&Pl(a,n)))&&(a=n,u=e)}n=n.next}while(n!==s);return a}(t,e);if(!n)return e;const i=jl(n,t);return bl(i,i.next),bl(n,n.next)}function Pl(t,e){return zl(t.prev,t,e.prev)<0&&zl(e.next,t,t.next)<0}function Il(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Rl(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function kl(t,e,n,i,r,a,o,s){return(r-o)*(e-s)>=(t-o)*(a-s)&&(t-o)*(i-s)>=(n-o)*(e-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function Ll(t,e,n,i,r,a,o,s){return!(t===o&&e===s)&&kl(t,e,n,i,r,a,o,s)}function Dl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ol(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ul(t,e)&&Ul(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(zl(t.prev,t,e.prev)||zl(t,e.prev,e))||Nl(t,e)&&zl(t.prev,t,t.next)>0&&zl(e.prev,e,e.next)>0)}function zl(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Nl(t,e){return t.x===e.x&&t.y===e.y}function Ol(t,e,n,i){const r=Bl(zl(t,e,n)),a=Bl(zl(t,e,i)),o=Bl(zl(n,i,t)),s=Bl(zl(n,i,e));return r!==a&&o!==s||!(0!==r||!Fl(t,n,e))||!(0!==a||!Fl(t,i,e))||!(0!==o||!Fl(n,t,i))||!(0!==s||!Fl(n,e,i))}function Fl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Bl(t){return t>0?1:t<0?-1:0}function Ul(t,e){return zl(t.prev,t,t.next)<0?zl(t,e,t.next)>=0&&zl(t,t.prev,e)>=0:zl(t,e,t.prev)<0||zl(t,t.next,e)<0}function jl(t,e){const n=Gl(t.i,t.x,t.y),i=Gl(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Vl(t,e,n,i){const r=Gl(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Hl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gl(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Wl{constructor(t,e){if(e>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=e}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class ql{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}ql.noSubdivision=new ql({fill:new Wl(0,0),line:new Wl(0,0),tile:new Wl(0,0),stencil:new Wl(0,0),circle:1}),sa("SubdivisionGranularityExpression",Wl),sa("SubdivisionGranularitySetting",ql);const Zl=-32768,Xl=32767;class Yl{constructor(t,e){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=I/t,this._canonical=e}_getKey(t,e){return(t+=32768)<<16|e+32768}_vertexToIndex(t,e){if(t<-32768||e<-32768||t>32767||e>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const n=0|Math.round(t),i=0|Math.round(e),r=this._getKey(n,i);if(this._vertexDictionary.has(r))return this._vertexDictionary.get(r);const a=this._vertexBuffer.length/2;return this._vertexDictionary.set(r,a),this._vertexBuffer.push(n,i),a}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(t,e){const n=[];for(let i=0;i<e.length;i+=3){const r=e[i],a=e[i+1],o=e[i+2],s=t[2*r],l=t[2*r+1];(t[2*a]-s)*(t[2*o+1]-l)-(t[2*a+1]-l)*(t[2*o]-s)>0?(n.push(r),n.push(o),n.push(a)):(n.push(r),n.push(a),n.push(o))}return n}(this._vertexBuffer,t);const e=[],n=t.length;for(let i=0;i<n;i+=3){const n=[t[i+0],t[i+1],t[i+2]],r=[this._vertexBuffer[2*t[i+0]+0],this._vertexBuffer[2*t[i+0]+1],this._vertexBuffer[2*t[i+1]+0],this._vertexBuffer[2*t[i+1]+1],this._vertexBuffer[2*t[i+2]+0],this._vertexBuffer[2*t[i+2]+1]];let a=1/0,o=1/0,s=-1/0,l=-1/0;for(let t=0;t<3;t++){const e=r[2*t],n=r[2*t+1];a=Math.min(a,e),s=Math.max(s,e),o=Math.min(o,n),l=Math.max(l,n)}if(a===s||o===l)continue;const c=Math.floor(a/this._granularityCellSize),u=Math.ceil(s/this._granularityCellSize),h=Math.floor(o/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let t=h;t<d;t++){const i=this._scanlineGenerateVertexRingForCellRow(t,r,n);$l(this._vertexBuffer,i,e)}else e.push(...n)}return e}_scanlineGenerateVertexRingForCellRow(t,e,n){const i=t*this._granularityCellSize,r=i+this._granularityCellSize,a=[];for(let o=0;o<3;o++){const t=e[2*o],s=e[2*o+1],l=e[2*(o+1)%6],c=e[(2*(o+1)+1)%6],u=e[2*(o+2)%6],h=e[(2*(o+2)+1)%6],d=l-t,p=c-s,f=0===d,m=0===p,g=(i-s)/p,y=(r-s)/p,v=Math.min(g,y),_=Math.max(g,y);if(!m&&(v>=1||_<=0)||m&&(s<i||s>r)){c>=i&&c<=r&&a.push(n[(o+1)%3]);continue}!m&&v>0&&a.push(this._vertexToIndex(t+d*v,s+p*v));const x=t+d*Math.max(v,0),b=t+d*Math.min(_,1);f||this._generateIntraEdgeVertices(a,t,s,l,c,x,b),!m&&_<1&&a.push(this._vertexToIndex(t+d*_,s+p*_)),(m||c>=i&&c<=r)&&a.push(n[(o+1)%3]),!m&&(c<=i||c>=r)&&this._generateInterEdgeVertices(a,t,s,l,c,u,h,b,i,r)}return a}_generateIntraEdgeVertices(t,e,n,i,r,a,o){const s=i-e,l=r-n,c=0===l,u=c?Math.min(e,i):Math.min(a,o),h=c?Math.max(e,i):Math.max(a,o),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?e<i:a<o)for(let f=d;f<=p;f++){const i=f*this._granularityCellSize;t.push(this._vertexToIndex(i,n+l*(i-e)/s))}else for(let f=p;f>=d;f--){const i=f*this._granularityCellSize;t.push(this._vertexToIndex(i,n+l*(i-e)/s))}}_generateInterEdgeVertices(t,e,n,i,r,a,o,s,l,c){const u=r-n,h=a-i,d=o-r,p=(l-r)/d,f=(c-r)/d,m=Math.min(p,f),g=Math.max(p,f),y=i+h*m;let v=Math.floor(Math.min(y,s)/this._granularityCellSize)+1,_=Math.ceil(Math.max(y,s)/this._granularityCellSize)-1,x=s<y;const b=0===d;if(b&&(o===l||o===c))return;if(b||m>=1||g<=0){const t=n-o,i=a+(e-a)*Math.min((l-o)/t,(c-o)/t);v=Math.floor(Math.min(i,s)/this._granularityCellSize)+1,_=Math.ceil(Math.max(i,s)/this._granularityCellSize)-1,x=s<i}const w=u>0?c:l;if(x)for(let S=v;S<=_;S++)t.push(this._vertexToIndex(S*this._granularityCellSize,w));else for(let S=_;S>=v;S--)t.push(this._vertexToIndex(S*this._granularityCellSize,w))}_generateOutline(t){const e=[];for(const n of t){const t=Jl(n,this._granularity,!0),i=this._pointArrayToIndices(t),r=[];for(let e=1;e<i.length;e++)r.push(i[e-1]),r.push(i[e]);e.push(r)}return e}_handlePoles(t){let e=!1,n=!1;this._canonical&&(0===this._canonical.y&&(e=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(e||n)&&this._fillPoles(t,e,n)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let e=0;e<t.length;e+=2){const n=t[e+1];n===Zl&&(t[e+1]=-32767),n===Xl&&(t[e+1]=32766)}}_generatePoleQuad(t,e,n,i,r,a){i>r!=(a===Zl)?(t.push(e),t.push(n),t.push(this._vertexToIndex(i,a)),t.push(n),t.push(this._vertexToIndex(r,a)),t.push(this._vertexToIndex(i,a))):(t.push(n),t.push(e),t.push(this._vertexToIndex(i,a)),t.push(this._vertexToIndex(r,a)),t.push(n),t.push(this._vertexToIndex(i,a)))}_fillPoles(t,e,n){const i=this._vertexBuffer,r=I,a=t.length;for(let o=2;o<a;o+=3){const a=t[o-2],s=t[o-1],l=t[o],c=i[2*a],u=i[2*a+1],h=i[2*s],d=i[2*s+1],p=i[2*l],f=i[2*l+1];e&&(0===u&&0===d&&this._generatePoleQuad(t,a,s,c,h,Zl),0===d&&0===f&&this._generatePoleQuad(t,s,l,h,p,Zl),0===f&&0===u&&this._generatePoleQuad(t,l,a,p,c,Zl)),n&&(u===r&&d===r&&this._generatePoleQuad(t,a,s,c,h,Xl),d===r&&f===r&&this._generatePoleQuad(t,s,l,h,p,Xl),f===r&&u===r&&this._generatePoleQuad(t,l,a,p,c,Xl))}}_initializeVertices(t){for(let e=0;e<t.length;e+=2)this._vertexToIndex(t[e],t[e+1])}subdividePolygonInternal(t,e){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:n,holeIndices:i}=function(t){const e=[],n=[];for(const i of t)if(0!==i.length){i!==t[0]&&e.push(n.length/2);for(let t=0;t<i.length;t++)n.push(i[t].x),n.push(i[t].y)}return{flattened:n,holeIndices:e}}(t);let r;this._initializeVertices(n);try{const t=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=e&&e.length,r=i?e[0]*n:t.length;let a=xl(t,0,r,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(i&&(a=function(t,e,n,i){const r=[];for(let a=0,o=e.length;a<o;a++){const n=xl(t,e[a]*i,a<o-1?e[a+1]*i:t.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Rl(n))}r.sort(Al);for(let a=0;a<r.length;a++)n=Cl(r[a],n);return n}(t,e,a,n)),t.length>80*n){s=t[0],l=t[1];let e=s,i=l;for(let a=n;a<r;a+=n){const n=t[a],r=t[a+1];n<s&&(s=n),r<l&&(l=r),n>e&&(e=n),r>i&&(i=r)}c=Math.max(e-s,i-l),c=0!==c?32767/c:0}return wl(a,o,n,s,l,c,0),o}(n,i),e=this._convertIndices(n,t);r=this._subdivideTrianglesScanline(e)}catch(t){console.error(t)}let a=[];return e&&(a=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(r),{verticesFlattened:this._vertexBuffer,indicesTriangles:r,indicesLineList:a}}_convertIndices(t,e){const n=[];for(let i=0;i<e.length;i++)n.push(this._vertexToIndex(t[2*e[i]],t[2*e[i]+1]));return n}_pointArrayToIndices(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n];e.push(this._vertexToIndex(i.x,i.y))}return e}}function Kl(t,e,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Yl(n,e).subdividePolygonInternal(t,i)}function Jl(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||t.length<1)return[];if(t.length<2)return[];const r=t[0],a=t[t.length-1],o=i&&(r.x!==a.x||r.y!==a.y);if(e<2)return o?[...t,t[0]]:[...t];const s=Math.floor(I/e),l=[];l.push(new n(t[0].x,t[0].y));const c=t.length,u=o?c:c-1;for(let h=0;h<u;h++){const e=t[h],i=h<c-1?t[h+1]:t[0],r=e.x,a=e.y,o=i.x,u=i.y,d=r!==o,p=a!==u;if(!d&&!p)continue;const f=o-r,m=u-a,g=Math.abs(f),y=Math.abs(m);let v=r,_=a;for(;;){const t=f>0?(Math.floor(v/s)+1)*s:(Math.ceil(v/s)-1)*s,e=m>0?(Math.floor(_/s)+1)*s:(Math.ceil(_/s)-1)*s,i=Math.abs(v-t),r=Math.abs(_-e),a=Math.abs(v-o),c=Math.abs(_-u),h=d?i/g:Number.POSITIVE_INFINITY,x=p?r/y:Number.POSITIVE_INFINITY;if((a<=i||!d)&&(c<=r||!p))break;if(h<x&&d||!p){v=t,_+=m*h;const e=new n(v,Math.round(_));l[l.length-1].x===e.x&&l[l.length-1].y===e.y||l.push(e)}else{v+=f*x,_=e;const t=new n(Math.round(v),_);l[l.length-1].x===t.x&&l[l.length-1].y===t.y||l.push(t)}}const x=new n(o,u);l[l.length-1].x===x.x&&l[l.length-1].y===x.y||l.push(x)}return l}function $l(t,e,n){if(0===e.length)throw new Error("Subdivision vertex ring is empty.");let i=0,r=t[2*e[0]];for(let l=1;l<e.length;l++){const n=t[2*e[l]];n<r&&(r=n,i=l)}const a=e.length;let o=i,s=(o+1)%a;for(;;){const i=o-1>=0?o-1:a-1,r=(s+1)%a,l=t[2*e[i]],c=t[2*e[r]],u=t[2*e[o]],h=t[2*e[o]+1],d=t[2*e[s]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const n=d-h,a=-(t[2*e[s]]-u),o=h<d?1:-1;((l-u)*n+(t[2*e[i]+1]-h)*a)*o>((c-u)*n+(t[2*e[r]+1]-h)*a)*o&&(p=!0)}if(p){const t=e[i],r=e[o],l=e[s];t!==r&&t!==l&&r!==l&&n.push(l,r,t),o--,o<0&&(o=a-1)}else{const t=e[r],i=e[o],l=e[s];t!==i&&t!==l&&i!==l&&n.push(l,i,t),s++,s>=a&&(s=0)}if(i===r)break}}function Ql(t,e,n,i,r,a,o,s,l){const c=r.length/2,u=o&&s&&l;if(c<Xo.MAX_VERTEX_ARRAY_LENGTH){const h=e.prepareSegment(c,n,i),d=h.vertexLength;for(let t=0;t<a.length;t+=3)i.emplaceBack(d+a[t],d+a[t+1],d+a[t+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=a.length/3,u&&(f=o.prepareSegment(c,n,s),p=f.vertexLength,f.vertexLength+=c);for(let e=0;e<r.length;e+=2)t(r[e],r[e+1]);if(u)for(let t=0;t<l.length;t++){const e=l[t];for(let t=1;t<e.length;t+=2)s.emplaceBack(p+e[t-1],p+e[t]);f.primitiveLength+=e.length/2}}else!function(t,e,n,i,r,a){const o=[];for(let h=0;h<i.length/2;h++)o.push(-1);const s={count:0};let l=0,c=t.getOrCreateLatestSegment(e,n),u=c.vertexLength;for(let h=2;h<r.length;h+=3){const d=r[h-2],p=r[h-1],f=r[h];let m=o[d]<l,g=o[p]<l,y=o[f]<l;c.vertexLength+((m?1:0)+(g?1:0)+(y?1:0))>Xo.MAX_VERTEX_ARRAY_LENGTH&&(c=t.createNewSegment(e,n),l=s.count,m=!0,g=!0,y=!0,u=0);const v=tc(o,i,a,s,d,m,c),_=tc(o,i,a,s,p,g,c),x=tc(o,i,a,s,f,y,c);n.emplaceBack(u+v-l,u+_-l,u+x-l),c.primitiveLength++}}(e,n,i,r,a,t),u&&function(t,e,n,i,r,a){const o=[];for(let h=0;h<i.length/2;h++)o.push(-1);const s={count:0};let l=0,c=t.getOrCreateLatestSegment(e,n),u=c.vertexLength;for(let h=0;h<r.length;h++){const d=r[h];for(let p=1;p<r[h].length;p+=2){const r=d[p-1],h=d[p];let f=o[r]<l,m=o[h]<l;c.vertexLength+((f?1:0)+(m?1:0))>Xo.MAX_VERTEX_ARRAY_LENGTH&&(c=t.createNewSegment(e,n),l=s.count,f=!0,m=!0,u=0);const g=tc(o,i,a,s,r,f,c),y=tc(o,i,a,s,h,m,c);n.emplaceBack(u+g-l,u+y-l),c.primitiveLength++}}}(o,n,s,r,l,t),e.forceNewSegmentOnNextPrepare(),null==o||o.forceNewSegmentOnNextPrepare()}function tc(t,e,n,i,r,a,o){if(a){const a=i.count;return n(e[2*r],e[2*r+1]),t[r]=i.count,i.count++,o.vertexLength++,a}return t[r]}class ec{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Do,this.indexArray=new Go,this.indexArray2=new Wo,this.programConfigurations=new bs(t.layers,t.zoom),this.segments=new Xo,this.segments2=new Xo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=vl("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=As(o,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),u,n))continue;const h=r?i.evaluate(u,{},n,e.availableImages):void 0,d={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Es(o),patterns:{},sortKey:h};a.push(d)}r&&a.sort((t,e)=>t.sortKey-e.sortKey);for(const o of a){const{geometry:i,index:r,sourceLayerIndex:a}=o;if(this.hasPattern){const t=_l("fill",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{},e.subdivisionGranularity);e.featureIndex.insert(t[r].feature,i,r,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n,t.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yl),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,i,r,a){for(const o of ei(e,500)){const t=Kl(o,i,a.fill.getGranularityForZoomLevel(i.z)),e=this.layoutVertexArray;Ql((t,n)=>{e.emplaceBack(t,n)},this.segments,this.layoutVertexArray,this.indexArray,t.verticesFlattened,t.indicesTriangles,this.segments2,this.indexArray2,t.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}}let nc,ic;sa("FillBucket",ec,{omit:["layers","patternFeatures"]});var rc={get paint(){return ic=ic||new Va({"fill-antialias":new Oa(_t.paint_fill["fill-antialias"]),"fill-opacity":new Fa(_t.paint_fill["fill-opacity"]),"fill-color":new Fa(_t.paint_fill["fill-color"]),"fill-outline-color":new Fa(_t.paint_fill["fill-outline-color"]),"fill-translate":new Oa(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new Oa(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ba(_t.paint_fill["fill-pattern"])})},get layout(){return nc=nc||new Va({"fill-sort-key":new Fa(_t.layout_fill["fill-sort-key"])})}};class ac extends Ga{constructor(t){super(t,rc)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ec(t)}queryRadius(){return Hs(this.paint.get("fill-translate"))}queryIntersectsFeature(t){let{queryGeometry:e,geometry:n,transform:i,pixelsToTileUnits:r}=t;return Ls(Gs(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-i.bearingInRadians,r),n)}isTileClipped(){return!0}}const oc=Xa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),sc=Xa([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lc}=oc;class cc{constructor(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(uc,this,e)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos,i=[];let r,a=1,o=0,s=0,l=0;for(;t.pos<e;){if(o<=0){const e=t.readVarint();a=7&e,o=e>>3}if(o--,1===a||2===a)s+=t.readSVarint(),l+=t.readSVarint(),1===a&&(r&&i.push(r),r=[]),r&&r.push(new n(s,l));else{if(7!==a)throw new Error("unknown command ".concat(a));r&&r.push(r[0].clone())}}return r&&i.push(r),i}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n=1,i=0,r=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;for(;t.pos<e;){if(i<=0){const e=t.readVarint();n=7&e,i=e>>3}if(i--,1===n||2===n)r+=t.readSVarint(),a+=t.readSVarint(),r<o&&(o=r),r>s&&(s=r),a<l&&(l=a),a>c&&(c=a);else if(7!==n)throw new Error("unknown command ".concat(n))}return[o,l,s,c]}toGeoJSON(t,e,n){const i=this.extent*Math.pow(2,n),r=this.extent*t,a=this.extent*e,o=this.loadGeometry();function s(t){return[360*(t.x+r)/i-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+a)/i)*Math.PI))-90]}function l(t){return t.map(s)}let c;if(1===this.type){const t=[];for(const n of o)t.push(n[0]);const e=l(t);c=1===t.length?{type:"Point",coordinates:e[0]}:{type:"MultiPoint",coordinates:e}}else if(2===this.type){const t=o.map(l);c=1===t.length?{type:"LineString",coordinates:t[0]}:{type:"MultiLineString",coordinates:t}}else{if(3!==this.type)throw new Error("unknown feature type");{const t=function(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let a=0;a<e;a++){const e=hc(t[a]);0!==e&&(void 0===r&&(r=e<0),r===e<0?(i&&n.push(i),i=[t[a]]):i&&i.push(t[a]))}return i&&n.push(i),n}(o),e=[];for(const n of t)e.push(n.map(l));c=1===e.length?{type:"Polygon",coordinates:e[0]}:{type:"MultiPolygon",coordinates:e}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function uc(t,e,n){1===t?e.id=n.readVarint():2===t?function(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(n,e):3===t?e.type=n.readVarint():4===t&&(e._geometry=n.pos)}function hc(t){let e=0;for(let n,i,r=0,a=t.length,o=a-1;r<a;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}cc.types=["Unknown","Point","LineString","Polygon"];class dc{constructor(t,e){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(pc,this,e),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new cc(this._pbf,e,this.extent,this._keys,this._values)}}function pc(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}if(null==e)throw new Error("unknown feature value");return e}(n))}class fc{constructor(t,e){this.layers=t.readFields(mc,{},e)}}function mc(t,e,n){if(3===t){const t=new dc(n,n.readVarint()+n.pos);t.length&&(e[t.name]=t)}}const gc=Math.pow(2,13);function yc(t,e,n,i,r,a,o,s){t.emplaceBack(e,n,2*Math.floor(i*gc)+o,r*gc*2,a*gc*2,Math.round(s))}class vc{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new zo,this.centroidVertexArray=new ko,this.indexArray=new Go,this.programConfigurations=new bs(t.layers,t.zoom),this.segments=new Xo,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.features=[],this.hasPattern=vl("fill-extrusion",this.layers,e);for(const{feature:i,id:r,index:a,sourceLayerIndex:o}of t){const t=this.layers[0]._featureFilter.needGeometry,s=As(i,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),s,n))continue;const l={id:r,sourceLayerIndex:o,index:a,geometry:t?s.geometry:Es(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(_l("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,a,n,{},e.subdivisionGranularity),e.featureIndex.insert(i,l.geometry,a,o,this.index,!0)}}addFeatures(t,e,n){for(const i of this.features){const{geometry:r}=i;this.addFeature(i,r,i.index,e,n,t.subdivisionGranularity)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lc),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,sc.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,n,i,r,a){for(const o of ei(e,500)){const e={x:0,y:0,sampleCount:0},n=this.layoutVertexArray.length;this.processPolygon(e,i,t,o,a);const r=this.layoutVertexArray.length-n,s=Math.floor(e.x/e.sampleCount),l=Math.floor(e.y/e.sampleCount);for(let t=0;t<r;t++)this.centroidVertexArray.emplaceBack(s,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}processPolygon(t,e,n,i,r){if(i.length<1)return;if(bc(i[0]))return;for(const u of i)0!==u.length&&_c(t,u);const a={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},o=r.fill.getGranularityForZoomLevel(e.z),s="Polygon"===cc.types[n.type];for(const u of i){if(0===u.length)continue;if(bc(u))continue;const t=Jl(u,o,s);this._generateSideFaces(t,a)}if(!s)return;const l=Kl(i,e,o,!1),c=this.layoutVertexArray;Ql((t,e)=>{yc(c,t,e,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(t,e){let n=0;for(let i=1;i<t.length;i++){const r=t[i],a=t[i-1];if(xc(r,a))continue;e.segment.vertexLength+4>Xo.MAX_VERTEX_ARRAY_LENGTH&&(e.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const o=r.sub(a)._perp()._unit(),s=a.dist(r);n+s>32768&&(n=0),yc(this.layoutVertexArray,r.x,r.y,o.x,o.y,0,0,n),yc(this.layoutVertexArray,r.x,r.y,o.x,o.y,0,1,n),n+=s,yc(this.layoutVertexArray,a.x,a.y,o.x,o.y,0,0,n),yc(this.layoutVertexArray,a.x,a.y,o.x,o.y,0,1,n);const l=e.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),e.segment.vertexLength+=4,e.segment.primitiveLength+=2}}}function _c(t,e){for(let n=0;n<e.length;n++){const i=e[n];n===e.length-1&&e[0].x===i.x&&e[0].y===i.y||(t.x+=i.x,t.y+=i.y,t.sampleCount++)}}function xc(t,e){return t.x===e.x&&(t.x<0||t.x>I)||t.y===e.y&&(t.y<0||t.y>I)}function bc(t){return t.every(t=>t.x<0)||t.every(t=>t.x>I)||t.every(t=>t.y<0)||t.every(t=>t.y>I)}let wc;sa("FillExtrusionBucket",vc,{omit:["layers","features"]});var Sc={get paint(){return wc=wc||new Va({"fill-extrusion-opacity":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ba(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fa(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Oa(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Mc extends Ga{constructor(t){super(t,Sc)}createBucket(t){return new vc(t)}queryRadius(){return Hs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t){let{queryGeometry:e,feature:i,featureState:r,geometry:a,transform:o,pixelsToTileUnits:s,pixelPosMatrix:l}=t;const c=Gs(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-o.bearingInRadians,s),u=this.paint.get("fill-extrusion-height").evaluate(i,r),h=this.paint.get("fill-extrusion-base").evaluate(i,r),d=function(t,e){const i=[];for(const r of t){const t=[r.x,r.y,0,1];T(t,t,e),i.push(new n(t[0]/t[3],t[1]/t[3]))}return i}(c,l),p=function(t,e,i,r){const a=[],o=[],s=r[8]*e,l=r[9]*e,c=r[10]*e,u=r[11]*e,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const m of t){const t=[],e=[];for(const i of m){const a=i.x,o=i.y,m=r[0]*a+r[4]*o+r[12],g=r[1]*a+r[5]*o+r[13],y=r[2]*a+r[6]*o+r[14],v=r[3]*a+r[7]*o+r[15],_=y+c,x=v+u,b=m+h,w=g+d,S=y+p,M=v+f,T=new n((m+s)/x,(g+l)/x);T.z=_/x,t.push(T);const E=new n(b/M,w/M);E.z=S/M,e.push(E)}a.push(t),o.push(e)}return[a,o]}(a,h,u,l);return function(t,e,n){let i=1/0;Ls(n,e)&&(i=Ec(n,e[0]));for(let r=0;r<e.length;r++){const a=e[r],o=t[r];for(let t=0;t<a.length-1;t++){const e=a[t],r=[e,a[t+1],o[t+1],o[t],e];Rs(n,r)&&(i=Math.min(i,Ec(n,r)))}}return i!==1/0&&i}(p[0],p[1],d)}}function Tc(t,e){return t.x*e.x+t.y*e.y}function Ec(t,e){if(1===t.length){let n=0;const i=e[n++];let r;for(;!r||i.equals(r);)if(r=e[n++],!r)return 1/0;for(;n<e.length;n++){const a=e[n],o=t[0],s=r.sub(i),l=a.sub(i),c=o.sub(i),u=Tc(s,s),h=Tc(s,l),d=Tc(l,l),p=Tc(c,s),f=Tc(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,v=i.z*(1-g-y)+r.z*g+a.z*y;if(isFinite(v))return v}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}const Ac=Xa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cc}=Ac,Pc=Xa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ic}=Pc,Rc=Math.cos(Math.PI/180*37.5),kc=Math.pow(2,14)/.5;class Lc{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new No,this.layoutVertexArray2=new Oo,this.indexArray=new Go,this.programConfigurations=new bs(t.layers,t.zoom),this.segments=new Xo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n){this.hasPattern=vl("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,e=As(o,t);if(!this.layers[0]._featureFilter.filter(new Ca(this.zoom,{globalState:this.globalState}),e,n))continue;const u=r?i.evaluate(e,{},n):void 0,h={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:t?e.geometry:Es(o),patterns:{},sortKey:u};a.push(h)}r&&a.sort((t,e)=>t.sortKey-e.sortKey);for(const o of a){const{geometry:i,index:r,sourceLayerIndex:a}=o;if(this.hasPattern){const t=_l("line",this.layers,o,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(o,i,r,n,{},e.subdivisionGranularity);e.featureIndex.insert(t[r].feature,i,r,a,this.index)}}update(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)}addFeatures(t,e,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,n,t.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ic)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,i,r,a){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),l=o.get("line-cap"),c=o.get("line-miter-limit"),u=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const h of e)this.addLine(h,t,s,l,c,u,i,a);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r,i)}addLine(t,e,n,i,r,a,o,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Jl(t,o?s.line.getGranularityForZoomLevel(o.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===cc.types[e.type];let c=t.length;for(;c>=2&&t[c-1].equals(t[c-2]);)c--;let u=0;for(;u<c-1&&t[u].equals(t[u+1]);)u++;if(c<(l?3:2))return;"bevel"===n&&(r=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,m,g,y;this.e1=this.e2=-1,l&&(p=t[c-2],y=t[u].sub(p)._unit()._perp());for(let v=u;v<c;v++){if(m=v===c-1?l?t[u+1]:void 0:t[v+1],m&&t[v].equals(m))continue;y&&(g=y),p&&(f=p),p=t[v],y=m?m.sub(p)._unit()._perp():g,g=g||y;let e=g.add(y);0===e.x&&0===e.y||e._unit();const o=g.x*y.x+g.y*y.y,s=e.x*y.x+e.y*y.y,_=0!==s?1/s:1/0,x=2*Math.sqrt(2-2*s),b=s<Rc&&f&&m,w=g.x*y.y-g.y*y.x>0;if(b&&v>u){const t=p.dist(f);if(t>2*h){const e=p.sub(p.sub(f)._mult(h/t)._round());this.updateDistance(f,e),this.addCurrentVertex(e,g,0,0,d),f=e}}const S=f&&m;let M=S?n:l?"butt":i;if(S&&"round"===M&&(_<a?M="miter":_<=2&&(M="fakeround")),"miter"===M&&_>r&&(M="bevel"),"bevel"===M&&(_>2&&(M="flipbevel"),_<r&&(M="miter")),f&&this.updateDistance(f,p),"miter"===M)e._mult(_),this.addCurrentVertex(p,e,0,0,d);else if("flipbevel"===M){if(_>100)e=y.mult(-1);else{const t=_*g.add(y).mag()/g.sub(y).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(p,e,0,0,d),this.addCurrentVertex(p,e.mult(-1),0,0,d)}else if("bevel"===M||"fakeround"===M){const t=-Math.sqrt(_*_-1),e=w?t:0,n=w?0:t;if(f&&this.addCurrentVertex(p,g,e,n,d),"fakeround"===M){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+o*(o*(3.55645-1.43519*o)-3.2452))*t*t+(.848013+o*(.215638*o-1.06021)))}const i=y.sub(g)._mult(n)._add(g)._unit()._mult(w?-1:1);this.addHalfVertex(p,i.x,i.y,!1,w,0,d)}}m&&this.addCurrentVertex(p,y,-e,-n,d)}else if("butt"===M)this.addCurrentVertex(p,e,0,0,d);else if("square"===M){const t=f?1:-1;this.addCurrentVertex(p,e,t,t,d)}else"round"===M&&(f&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,y,-1,-1,d,!0),this.addCurrentVertex(p,y,0,0,d)));if(b&&v<c-1){const t=p.dist(m);if(t>2*h){const e=p.add(m.sub(p)._mult(h/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,y,0,0,d),p=e}}}}addCurrentVertex(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=e.y*i-e.x,s=-e.y-e.x*i;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,a,!1,n,r),this.addHalfVertex(t,o,s,a,!0,-i,r),this.distance>kc/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,n,i,r,a))}addHalfVertex(t,e,n,i,r,a,o){let{x:s,y:l}=t;const c=.5*(this.lineClips?this.scaledDistance*(kc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(i?1:0),(l<<1)+(r?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1)|(63&c)<<2,c>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,u,this.e2),o.primitiveLength++),r?this.e2=u:this.e1=u}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let Dc,zc;sa("LineBucket",Lc,{omit:["layers","patternFeatures"]});var Nc={get paint(){return zc=zc||new Va({"line-opacity":new Fa(_t.paint_line["line-opacity"]),"line-color":new Fa(_t.paint_line["line-color"]),"line-translate":new Oa(_t.paint_line["line-translate"]),"line-translate-anchor":new Oa(_t.paint_line["line-translate-anchor"]),"line-width":new Fa(_t.paint_line["line-width"]),"line-gap-width":new Fa(_t.paint_line["line-gap-width"]),"line-offset":new Fa(_t.paint_line["line-offset"]),"line-blur":new Fa(_t.paint_line["line-blur"]),"line-dasharray":new Ua(_t.paint_line["line-dasharray"]),"line-pattern":new Ba(_t.paint_line["line-pattern"]),"line-gradient":new ja(_t.paint_line["line-gradient"])})},get layout(){return Dc=Dc||new Va({"line-cap":new Oa(_t.layout_line["line-cap"]),"line-join":new Fa(_t.layout_line["line-join"]),"line-miter-limit":new Oa(_t.layout_line["line-miter-limit"]),"line-round-limit":new Oa(_t.layout_line["line-round-limit"]),"line-sort-key":new Fa(_t.layout_line["line-sort-key"])})}};class Oc extends Fa{possiblyEvaluate(t,e){return e=new Ca(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=B({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}let Fc;class Bc extends Ga{constructor(t){super(t,Nc),this.gradientVersion=0,Fc||(Fc=new Oc(Nc.paint.properties["line-width"].specification),Fc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof ln,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Fc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Lc(t)}queryRadius(t){const e=t,n=Uc(Vs("line-width",this,e),Vs("line-gap-width",this,e)),i=Vs("line-offset",this,e);return n/2+Math.abs(i)+Hs(this.paint.get("line-translate"))}queryIntersectsFeature(t){let{queryGeometry:e,feature:i,featureState:r,geometry:a,transform:o,pixelsToTileUnits:s}=t;const l=Gs(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-o.bearingInRadians,s),c=s/2*Uc(this.paint.get("line-width").evaluate(i,r),this.paint.get("line-gap-width").evaluate(i,r)),u=this.paint.get("line-offset").evaluate(i,r);return u&&(a=function(t,e){const i=[];for(let r=0;r<t.length;r++){const a=t[r],o=[];for(let t=0;t<a.length;t++){const i=a[t-1],r=a[t],s=a[t+1],l=0===t?new n(0,0):r.sub(i)._unit()._perp(),c=t===a.length-1?new n(0,0):s.sub(r)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),o.push(u._mult(e)._add(r))}i.push(o)}return i}(a,u*s)),function(t,e,n){for(let i=0;i<e.length;i++){const r=e[i];if(t.length>=3)for(let e=0;e<r.length;e++)if(Us(t,r[e]))return!0;if(Ds(t,r,n))return!0}return!1}(l,a,c)}isTileClipped(){return!0}}function Uc(t,e){return e>0?e+2*t:t}const jc=Xa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vc=Xa([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Hc=Xa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Xa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gc=Xa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wc=Xa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qc(t,e,n){return t.sections.forEach(t=>{t.text=function(t,e,n){const i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Aa.applyArabicShaping&&(t=Aa.applyArabicShaping(t)),t}(t.text,e,n)}),t}Xa([{name:"triangle",components:3,type:"Uint16"}]),Xa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Xa([{type:"Float32",name:"offsetX"}]),Xa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Xa([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Zc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var Xc=24;const Yc=4294967296,Kc=1/Yc,Jc="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class $c{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<n;){const n=this.readVarint(),i=n>>3,r=this.pos;this.type=7&n,t(i,e,this),this.pos===r&&this.skip(n)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Yc;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Yc;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const e=this.buf;let n,i;return i=e[this.pos++],n=127&i,i<128?n:(i=e[this.pos++],n|=(127&i)<<7,i<128?n:(i=e[this.pos++],n|=(127&i)<<14,i<128?n:(i=e[this.pos++],n|=(127&i)<<21,i<128?n:(i=e[this.pos],n|=(15&i)<<28,function(t,e,n){const i=n.buf;let r,a;if(a=i[n.pos++],r=(112&a)>>4,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<3,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<10,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<17,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(127&a)<<24,a<128)return Qc(t,r,e);if(a=i[n.pos++],r|=(1&a)<<31,a<128)return Qc(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(n,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return Boolean(this.readVarint())}readString(){const t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Jc?Jc.decode(this.buf.subarray(e,t)):function(t,e,n){let i="",r=e;for(;r<n;){const e=t[r];let a,o,s,l=null,c=e>239?4:e>223?3:e>191?2:1;if(r+c>n)break;1===c?e<128&&(l=e):2===c?(a=t[r+1],128==(192&a)&&(l=(31&e)<<6|63&a,l<=127&&(l=null))):3===c?(a=t[r+1],o=t[r+2],128==(192&a)&&128==(192&o)&&(l=(15&e)<<12|(63&a)<<6|63&o,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(a=t[r+1],o=t[r+2],s=t[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(l=(15&e)<<18|(63&a)<<12|(63&o)<<6|63&s,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,e,t)}readBytes(){const t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(e));return t}readPackedSVarint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(t){const e=7&t;if(0===e)for(;this.buf[this.pos++]>127;);else if(2===e)this.pos=this.readVarint()+this.pos;else if(5===e)this.pos+=4;else{if(1!==e)throw new Error("Unimplemented type: ".concat(e));this.pos+=8}}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){const t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.dataView=new DataView(t.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Kc),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Kc),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?function(t,e){let n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),4294967295^n?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){const n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const e=this.pos;this.pos=function(t,e,n){for(let i,r,a=0;a<e.length;a++){if(i=e.charCodeAt(a),i>55295&&i<57344){if(!r){i>56319||a+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);const n=this.pos-e;n>=128&&tu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const e=t.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,e){this.pos++;const n=this.pos;t(e,this);const i=this.pos-n;i>=128&&tu(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(t,e,n){this.writeTag(t,2),this.writeRawMessage(e,n)}writePackedVarint(t,e){e.length&&this.writeMessage(t,eu,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,nu,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,au,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,iu,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,ru,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,ou,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,su,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,lu,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,cu,e)}writeBytesField(t,e){this.writeTag(t,2),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,5),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,5),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,1),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,1),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,0),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,0),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,2),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,5),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,1),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}}function Qc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function tu(t,e,n){const i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(let r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function eu(t,e){for(let n=0;n<t.length;n++)e.writeVarint(t[n])}function nu(t,e){for(let n=0;n<t.length;n++)e.writeSVarint(t[n])}function iu(t,e){for(let n=0;n<t.length;n++)e.writeFloat(t[n])}function ru(t,e){for(let n=0;n<t.length;n++)e.writeDouble(t[n])}function au(t,e){for(let n=0;n<t.length;n++)e.writeBoolean(t[n])}function ou(t,e){for(let n=0;n<t.length;n++)e.writeFixed32(t[n])}function su(t,e){for(let n=0;n<t.length;n++)e.writeSFixed32(t[n])}function lu(t,e){for(let n=0;n<t.length;n++)e.writeFixed64(t[n])}function cu(t,e){for(let n=0;n<t.length;n++)e.writeSFixed64(t[n])}function uu(t,e,n){1===t&&n.readMessage(hu,e)}function hu(t,e,n){if(3===t){const{id:t,bitmap:i,width:r,height:a,left:o,top:s,advance:l}=n.readMessage(du,{});e.push({id:t,bitmap:new nl({width:r+6,height:a+6},i),metrics:{width:r,height:a,left:o,top:s,advance:l}})}}function du(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function pu(t){let e=0,n=0;for(const o of t)e+=o.w*o.h,n=Math.max(n,o.w);t.sort((t,e)=>e.h-t.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let r=0,a=0;for(const o of t)for(let t=i.length-1;t>=0;t--){const e=i[t];if(!(o.w>e.w||o.h>e.h)){if(o.x=e.x,o.y=e.y,a=Math.max(a,o.y+o.h),r=Math.max(r,o.x+o.w),o.w===e.w&&o.h===e.h){const e=i.pop();e&&t<i.length&&(i[t]=e)}else o.h===e.h?(e.x+=o.w,e.w-=o.w):o.w===e.w?(e.y+=o.h,e.h-=o.h):(i.push({x:e.x+o.w,y:e.y,w:e.w-o.w,h:o.h}),e.y+=o.h,e.h-=o.h);break}}return{w:r,h:a,fill:e/(r*a)||0}}class fu{constructor(t,e){let{pixelRatio:n,version:i,stretchX:r,stretchY:a,content:o,textFitWidth:s,textFitHeight:l}=e;this.paddedRect=t,this.pixelRatio=n,this.stretchX=r,this.stretchY=a,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class mu{constructor(t,e){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,r),this.addImages(e,i,r);const{w:a,h:o}=pu(r),s=new il({width:a||1,height:o||1});for(const l in t){const e=t[l],i=n[l].paddedRect;il.copy(e.data,s,{x:0,y:0},{x:i.x+1,y:i.y+1},e.data)}for(const l in e){const t=e[l],n=i[l].paddedRect,r=n.x+1,a=n.y+1,o=t.data.width,c=t.data.height;il.copy(t.data,s,{x:0,y:0},{x:r,y:a},t.data),il.copy(t.data,s,{x:0,y:c-1},{x:r,y:a-1},{width:o,height:1}),il.copy(t.data,s,{x:0,y:0},{x:r,y:a+c},{width:o,height:1}),il.copy(t.data,s,{x:o-1,y:0},{x:r-1,y:a},{width:1,height:c}),il.copy(t.data,s,{x:0,y:0},{x:r+o,y:a},{width:1,height:c})}this.image=s,this.iconPositions=n,this.patternPositions=i}addImages(t,e,n){for(const i in t){const r=t[i],a={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(a),e[i]=new fu(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[i,r]=t.tl;n.update(e.data,void 0,{x:i,y:r})}}var gu;sa("ImagePosition",fu),sa("ImageAtlas",mu),t.ao=void 0,(gu=t.ao||(t.ao={}))[gu.none=0]="none",gu[gu.horizontal=1]="horizontal",gu[gu.vertical=2]="vertical",gu[gu.horizontalOnly=3]="horizontalOnly";class yu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,e,n){const i=new yu;return i.scale=t||1,i.fontStack=e,i.verticalAlign=n||"bottom",i}static forImage(t,e){const n=new yu;return n.imageName=t,n.verticalAlign=e||"bottom",n}}class vu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new vu;for(let i=0;i<t.sections.length;i++){const r=t.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;e+=i&&wa(i)&&!Zc[t[n+1]]||r&&wa(r)&&!Zc[t[n-1]]||!Zc[t[n]]?t[n]:Zc[t[n]]}return e}(this.text)}trim(){let t=0;for(let n=0;n<this.text.length&&xu[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&xu[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new vu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}getMaxImageSize(t){let e=0,n=0;for(let i=0;i<this.length();i++){const r=this.getSection(i);if(r.imageName){const i=t[r.imageName];if(!i)continue;const a=i.displaySize;e=Math.max(e,a[0]),n=Math.max(n,a[1])}}return{maxImageWidth:e,maxImageHeight:n}}addTextSection(t,e){this.text+=t.text,this.sections.push(yu.forText(t.scale,t.fontStack||e,t.verticalAlign));const n=this.sections.length-1;for(let i=0;i<t.text.length;++i)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void W("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(yu.forImage(e,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):W("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _u(e,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=vu.fromFeature(e,a);let y;d===t.ao.vertical&&g.verticalizePunctuation();const{processBidirectionalText:v,processStyledBidirectionalText:_}=Aa;if(v&&1===g.sections.length){y=[];const t=v(g.toString(),Cu(g,u,o,n,r,f));for(const e of t){const t=new vu;t.text=e,t.sections=g.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);y.push(t)}}else if(_){y=[];const t=_(g.text,g.sectionIndex,Cu(g,u,o,n,r,f));for(const e of t){const t=new vu;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const n=[],i=t.text;let r=0;for(const a of e)n.push(t.substring(r,a)),r=a;return r<i.length&&n.push(t.substring(r,i.length)),n}(g,Cu(g,u,o,n,r,f));const x=[],b={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(t,e,n,i,r,a,o,s,l,c,u,h){let d=0,p=0,f=0,m=0;const g="right"===s?1:"left"===s?0:.5,y=Xc/h;let v=0;for(const b of r){b.trim();const r=b.getMaxScale(),o={positionedGlyphs:[],lineOffset:0};t.positionedLines[v]=o;const s=o.positionedGlyphs;let h=0;if(!b.length()){p+=a,++v;continue}const _=Iu(i,b,y);for(let a=0;a<b.length();a++){const o=b.getSection(a),f=b.getSectionIndex(a),m=b.getCharCode(a),g=ku(l,u,m);let v;if(o.imageName){if(t.iconsInText=!0,o.scale=o.scale*y,v=Du(o,g,r,_,i),!v)continue;h=Math.max(h,v.imageOffset)}else if(v=Lu(o,m,g,_,e,n),!v)continue;const{rect:x,metrics:w,baselineOffset:S}=v;s.push({glyph:m,imageName:o.imageName,x:d,y:p+S+-17,vertical:g,scale:o.scale,fontStack:o.fontStack,sectionIndex:f,metrics:w,rect:x}),g?(t.verticalizable=!0,d+=(o.imageName?w.advance:Xc)*o.scale+c):d+=w.advance*o.scale+c}0!==s.length&&(f=Math.max(d-c,f),zu(s,0,s.length-1,g)),d=0,o.lineOffset=Math.max(h,(r-1)*Xc);const x=a*r+h;p+=x,m=Math.max(x,m),++v}const{horizontalAlign:_,verticalAlign:x}=Pu(o);(function(t,e,n,i,r,a,o,s,l){const c=(e-n)*r;let u=0;u=a!==o?-s*i- -17:-i*l*o+.5*o;for(const h of t)for(const t of h.positionedGlyphs)t.x+=c,t.y+=u})(t.positionedLines,g,_,x,f,m,a,p,r.length),t.top+=-x*p,t.bottom=t.top+p,t.left+=-_*f,t.right=t.left+f}(b,n,i,r,y,s,l,c,d,u,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const xu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},wu={40:!0};function Su(t,e,n,i,r,a){if(e.imageName){const t=i[e.imageName];return t?t.displaySize[0]*e.scale*Xc/a+r:0}{const i=n[e.fontStack],a=i&&i[t];return a?a.metrics.advance*e.scale+r:0}}function Mu(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function Tu(t,e,n){let i=0;return 10===t&&(i-=1e4),n&&(i+=150),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function Eu(t,e,n,i,r,a){let o=null,s=Mu(e,n,r,a);for(const l of i){const t=Mu(e-l.x,n,r,a)+l.badness;t<=s&&(o=l,s=t)}return{index:t,x:e,priorBreak:o,badness:s}}function Au(t){return t?Au(t.priorBreak).concat(t.index):[]}function Cu(t,e,n,i,r,a){if(!t)return[];const o=[],s=function(t,e,n,i,r,a){let o=0;for(let s=0;s<t.length();s++){const n=t.getSection(s);o+=Su(t.getCharCode(s),n,i,r,e,a)}return o/Math.max(1,Math.ceil(o/n))}(t,e,n,i,r,a),l=t.text.indexOf("\u200b")>=0;let c=0;for(let h=0;h<t.length();h++){const n=t.getSection(h),d=t.getCharCode(h);if(xu[d]||(c+=Su(d,n,i,r,e,a)),h<t.length()-1){const e=!((u=d)<11904)&&(!!fa["CJK Compatibility Forms"](u)||!!fa["CJK Compatibility"](u)||!!fa["CJK Strokes"](u)||!!fa["CJK Symbols and Punctuation"](u)||!!fa["Enclosed CJK Letters and Months"](u)||!!fa["Halfwidth and Fullwidth Forms"](u)||!!fa["Ideographic Description Characters"](u)||!!fa["Vertical Forms"](u)||xa.test(String.fromCodePoint(u)));(bu[d]||e||n.imageName||h!==t.length()-2&&wu[t.getCharCode(h+1)])&&o.push(Eu(h+1,c,s,o,Tu(d,t.getCharCode(h+1),e&&l),!1))}}var u;return Au(Eu(t.length(),c,s,o,0,!0))}function Pu(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Iu(t,e,n){const i=e.getMaxScale()*Xc,{maxImageWidth:r,maxImageHeight:a}=e.getMaxImageSize(t),o=Math.max(i,a*n);return{verticalLineContentWidth:Math.max(i,r*n),horizontalLineContentHeight:o}}function Ru(t){switch(t){case"top":return 0;case"center":return.5;default:return 1}}function ku(e,n,i){return!(e===t.ao.horizontal||!n&&!ba(i)||n&&(xu[i]||(r=i,/(?:[\u0600-\u0604\u0606-\u060B\u060D-\u061A\u061C-\u061E\u0620-\u063F\u0641-\u064A\u0656-\u066F\u0671-\u06DC\u06DE-\u06FF\u0750-\u077F\u0870-\u0891\u0897-\u08E1\u08E3-\u08FF\uFB50-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFF\uFE70-\uFE74\uFE76-\uFEFC]|\uD803[\uDE60-\uDE7E\uDEC2-\uDEC7\uDED0-\uDED8\uDEFA-\uDEFF]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB\uDEF0\uDEF1])/.test(String.fromCodePoint(r)))));var r}function Lu(t,e,n,i,r,a){const o=a[t.fontStack],s=function(t,e,n,i){if(t&&t.rect)return t;const r=e[n.fontStack],a=r&&r[i];return a?{rect:null,metrics:a.metrics}:null}(o&&o[e],r,t,e);if(null===s)return null;let l;if(n)l=i.verticalLineContentWidth-t.scale*Xc;else{const e=Ru(t.verticalAlign);l=(i.horizontalLineContentHeight-t.scale*Xc)*e}return{rect:s.rect,metrics:s.metrics,baselineOffset:l}}function Du(t,e,n,i,r){const a=r[t.imageName];if(!a)return null;const o=a.paddedRect,s=a.displaySize,l={width:s[0],height:s[1],left:1,top:-3,advance:e?s[1]:s[0]};let c;if(e)c=i.verticalLineContentWidth-s[1]*t.scale;else{const e=Ru(t.verticalAlign);c=(i.horizontalLineContentHeight-s[1]*t.scale)*e}return{rect:o,metrics:l,baselineOffset:c,imageOffset:(e?s[0]:s[1])*t.scale-Xc*n}}function zu(t,e,n,i){if(0===i)return;const r=t[n],a=(t[n].x+r.metrics.advance*r.scale)*i;for(let o=e;o<=n;o++)t[o].x-=a}function Nu(t,e,n){const{horizontalAlign:i,verticalAlign:r}=Pu(n),a=e[0]-t.displaySize[0]*i,o=e[1]-t.displaySize[1]*r;return{image:t,top:o,bottom:o+t.displaySize[1],left:a,right:a+t.displaySize[0]}}function Ou(t){var e,n;let i=t.left,r=t.top,a=t.right-i,o=t.bottom-r;const s=null!==(e=t.image.textFitWidth)&&void 0!==e?e:"stretchOrShrink",l=null!==(n=t.image.textFitHeight)&&void 0!==n?n:"stretchOrShrink",c=(t.image.content[2]-t.image.content[0])/(t.image.content[3]-t.image.content[1]);if("proportional"===l){if("stretchOnly"===s&&a/o<c||"proportional"===s){const t=Math.ceil(o*c);i*=t/a,a=t}}else if("proportional"===s&&"stretchOnly"===l&&0!==c&&a/o>c){const t=Math.ceil(a/c);r*=t/o,o=t}return{x1:i,y1:r,x2:i+a,y2:r+o}}function Fu(t,e,n,i,r,a){const o=t.image;let s;if(o.content){const t=o.content,e=o.pixelRatio||1;s=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e]}const l=e.left*a,c=e.right*a;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-o.displaySize[0])/2,h=p+o.displaySize[0]);const f=e.top*a,m=e.bottom*a;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-o.displaySize[1])/2,d=u+o.displaySize[1]),{image:o,top:u,right:h,bottom:d,left:p,collisionPadding:s}}const Bu=128,Uu=32640;function ju(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ca(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:i}=n;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let a=r;for(;a<e.length&&e[a]<t+1;)a++;a=Math.min(e.length-1,a);const o=e[r],s=e[a];return"composite"===n.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:s,minSize:n.evaluate(new Ca(o)),maxSize:n.evaluate(new Ca(s)),interpolationType:i}}}function Vu(t,e,n){let i="never";const r=t.get(e);return r?i=r:t.get(n)&&(i="always"),i}const Hu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gu(t,e,n,i,r,a,o,s,l,c,u,h,d){const p=s?Math.min(Uu,Math.round(s[0])):0,f=s?Math.min(Uu,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),a,o,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Wu(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function qu(t){for(const e of t.sections)if(Ea(e.text))return!0;return!1}class Zu{constructor(t){this.layoutVertexArray=new Bo,this.indexArray=new Go,this.programConfigurations=t,this.segments=new Xo,this.dynamicLayoutVertexArray=new Uo,this.opacityVertexArray=new jo,this.hasVisibleVertices=!1,this.placedSymbolArray=new So}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Hu,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}sa("SymbolBuffers",Zu);class Xu{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new Xo,this.collisionVertexArray=new Ho}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Hc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}sa("CollisionBuffers",Xu);class Yu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ju(this.zoom,n["text-size"]),this.iconSizeData=ju(this.zoom,n["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),a=i.get("symbol-z-order");this.canOverlap="never"!==Vu(i,"text-overlap","text-allow-overlap")||"never"!==Vu(i,"icon-overlap","icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map(e=>t.ao[e])),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=e.sourceID}createArrays(){this.text=new Zu(new bs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Zu(new bs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Eo,this.lineVertexArray=new Ao,this.symbolInstances=new To,this.textAnchorOffsets=new Po}calculateGlyphDependencies(t,e,n,i,r){for(let a=0;a<t.length;a++)if(e[t.charCodeAt(a)]=!0,(n||i)&&r){const n=Zc[t.charAt(a)];n&&(e[n.charCodeAt(0)]=!0)}}populate(e,n,i){const r=this.layers[0],a=r.layout,o=a.get("text-font"),s=a.get("text-field"),l=a.get("icon-image"),c=("constant"!==s.value.kind||s.value.value instanceof Re&&!s.value.value.isEmpty()||s.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=a.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,m=new Ca(this.zoom,{globalState:this.globalState});for(const{feature:g,id:y,index:v,sourceLayerIndex:_}of e){const e=r._featureFilter.needGeometry,n=As(g,e);if(!r._featureFilter.filter(m,n,i))continue;let s,l;if(e||(n.geometry=Es(g)),c){const t=r.getValueAndResolveTokens("text-field",n,i,f),e=Re.factory(t),a=this.hasRTLText=this.hasRTLText||qu(e);(!a||"unavailable"===Aa.getRTLTextPluginStatus()||a&&Aa.isParsed())&&(s=qc(e,r,n))}if(u){const t=r.getValueAndResolveTokens("icon-image",n,i,f);l=t instanceof Fe?t:Fe.fromString(t)}if(!s&&!l)continue;const x=this.sortFeaturesByKey?h.evaluate(n,{},i):void 0;if(this.features.push({id:y,text:s,icon:l,index:v,sourceLayerIndex:_,geometry:n.geometry,properties:g.properties,type:cc.types[g.type],sortKey:x}),l&&(d[l.name]=!0),s){const e=o.evaluate(n,{},i).join(","),r="viewport"!==a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.ao.vertical)>=0;for(const t of s.sections)if(t.image)d[t.image.name]=!0;else{const n=ma(s.toString()),i=t.fontStack||e,a=p[i]=p[i]||{};this.calculateGlyphDependencies(t.text,a,r,this.allowVerticalPlacement,n)}}}"line"===a.get("symbol-placement")&&(this.features=function(t){const e={},n={},i=[];let r=0;function a(e){i.push(t[e]),r++}function o(t,e,r){const a=n[t];return delete n[t],n[e]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(r[0]),a}function s(t,n,r){const a=e[n];return delete e[n],e[t]=a,i[a].geometry[0].shift(),i[a].geometry[0]=r[0].concat(i[a].geometry[0]),a}function l(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return"".concat(t,":").concat(i.x,":").concat(i.y)}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){a(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in e&&n[p]!==e[f]){const t=s(p,f,h),r=o(p,f,i[t].geometry);delete e[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[t].geometry=null}else p in n?o(p,f,h):f in e?s(p,f,h):(a(c),e[p]=r-1,n[f]=r-1)}return i.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length;if(void 0!==t.segment){let n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]);const r={};for(let a=t.segment+1;a<e.length;a++)r[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(let a=t.segment||0;a>=0;a--)r[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:i},a>0&&(i+=e[a-1].dist(e[a]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,n,i,r,a,o,s,l,c,u,h,d){const p=e.indexArray,f=e.layoutVertexArray,m=e.segments.prepareSegment(4*n.length,f,p,this.canOverlap?o.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,v=this.allowVerticalPlacement&&s===t.ao.vertical?Math.PI/2:0,_=o.text&&o.text.sections;for(let t=0;t<n.length;t++){const{tl:r,tr:a,bl:s,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:S}=n[t],M=m.vertexLength,T=b[1];Gu(f,l.x,l.y,r.x,T+r.y,u.x,u.y,i,w,h.x,h.y,y,x),Gu(f,l.x,l.y,a.x,T+a.y,u.x+u.w,u.y,i,w,g.x,h.y,y,x),Gu(f,l.x,l.y,s.x,T+s.y,u.x,u.y+u.h,i,w,h.x,g.y,y,x),Gu(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,i,w,g.x,g.y,y,x),Wu(e.dynamicLayoutVertexArray,l,v),p.emplaceBack(M,M+2,M+1),p.emplaceBack(M+1,M+2,M+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),t!==n.length-1&&S===n[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,o,o.index,{},d,_&&_[S])}e.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h)}_addCollisionDebugVertex(t,e,n,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(a.x),Math.round(a.y))}addCollisionDebugVertices(t,e,i,r,a,o,s){const l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,u=a.layoutVertexArray,h=a.collisionVertexArray,d=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,h,o,d,p,new n(t,e)),this._addCollisionDebugVertex(u,h,o,d,p,new n(i,e)),this._addCollisionDebugVertex(u,h,o,d,p,new n(i,r)),this._addCollisionDebugVertex(u,h,o,d,p,new n(t,r)),l.vertexLength+=4;const f=a.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(t,e,n,i){for(let r=t;r<e;r++){const t=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,i?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xu(Vo,Gc.members,Wo),this.iconCollisionBox=new Xu(Vo,Gc.members,Wo);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,n,i,r,a,o,s,l){const c={};for(let u=e;u<n;u++){const e=t.get(u);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let u=i;u<r;u++){const e=t.get(u);c.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalTextFeatureIndex=e.featureIndex;break}for(let u=a;u<o;u++){const e=t.get(u);c.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.iconFeatureIndex=e.featureIndex;break}for(let u=s;u<l;u++){const e=t.get(u);c.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.verticalIconFeatureIndex=e.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),i=n.vertexStartIndex+4*n.numGlyphs;for(let r=n.vertexStartIndex;r<i;r+=4)t.indexArray.emplaceBack(r,r+2,r+1),t.indexArray.emplaceBack(r+1,r+2,r+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),i=[],r=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const t=this.symbolInstances.get(o);i.push(0|Math.round(e*t.anchorX+n*t.anchorY)),r.push(t.featureIndex)}return a.sort((t,e)=>i[t]-i[e]||r[e]-r[t]),a}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ku,Ju;sa("SymbolBucket",Yu,{omit:["layers","collisionBoxArray","features","compareText"]}),Yu.MAX_GLYPHS=65535,Yu.addDynamicAttributes=Wu;var $u={get paint(){return Ju=Ju||new Va({"icon-opacity":new Fa(_t.paint_symbol["icon-opacity"]),"icon-color":new Fa(_t.paint_symbol["icon-color"]),"icon-halo-color":new Fa(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fa(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fa(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new Oa(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oa(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fa(_t.paint_symbol["text-opacity"]),"text-color":new Fa(_t.paint_symbol["text-color"],{runtimeType:Bt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Fa(_t.paint_symbol["text-halo-color"]),"text-halo-width":new Fa(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new Fa(_t.paint_symbol["text-halo-blur"]),"text-translate":new Oa(_t.paint_symbol["text-translate"]),"text-translate-anchor":new Oa(_t.paint_symbol["text-translate-anchor"])})},get layout(){return Ku=Ku||new Va({"symbol-placement":new Oa(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new Oa(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oa(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fa(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oa(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Oa(_t.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Oa(_t.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Oa(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oa(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oa(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fa(_t.layout_symbol["icon-size"]),"icon-text-fit":new Oa(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Oa(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fa(_t.layout_symbol["icon-image"]),"icon-rotate":new Fa(_t.layout_symbol["icon-rotate"]),"icon-padding":new Fa(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new Oa(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new Fa(_t.layout_symbol["icon-offset"]),"icon-anchor":new Fa(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oa(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oa(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oa(_t.layout_symbol["text-rotation-alignment"]),"text-field":new Fa(_t.layout_symbol["text-field"]),"text-font":new Fa(_t.layout_symbol["text-font"]),"text-size":new Fa(_t.layout_symbol["text-size"]),"text-max-width":new Fa(_t.layout_symbol["text-max-width"]),"text-line-height":new Oa(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new Fa(_t.layout_symbol["text-letter-spacing"]),"text-justify":new Fa(_t.layout_symbol["text-justify"]),"text-radial-offset":new Fa(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oa(_t.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fa(_t.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fa(_t.layout_symbol["text-anchor"]),"text-max-angle":new Oa(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new Oa(_t.layout_symbol["text-writing-mode"]),"text-rotate":new Fa(_t.layout_symbol["text-rotate"]),"text-padding":new Oa(_t.layout_symbol["text-padding"]),"text-keep-upright":new Oa(_t.layout_symbol["text-keep-upright"]),"text-transform":new Fa(_t.layout_symbol["text-transform"]),"text-offset":new Fa(_t.layout_symbol["text-offset"]),"text-allow-overlap":new Oa(_t.layout_symbol["text-allow-overlap"]),"text-overlap":new Oa(_t.layout_symbol["text-overlap"]),"text-ignore-placement":new Oa(_t.layout_symbol["text-ignore-placement"]),"text-optional":new Oa(_t.layout_symbol["text-optional"])})}};class Qu{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:zt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}sa("FormatSectionOverride",Qu,{omit:["defaultValue"]});class th extends Ga{constructor(t){super(t,$u)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const n of t)e.indexOf(n)<0&&e.push(n);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,i){const r=this.layout.get(t).evaluate(e,{},n,i),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||nr(a.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,(e,n)=>t&&n in t?String(t[n]):"")}(e.properties,r)}createBucket(t){return new Yu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of $u.paint.overridableProperties){if(!th.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new Qu(e),i=new er(n,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new rr("source",i):new ar("composite",i,e.value.zoomStops),this.paint._values[t]=new za(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&th.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),i=$u.paint.properties[e];let r=!1;const a=t=>{for(const e of t)if(i.overrides&&i.overrides.hasOverride(e))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Re)a(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{r||(e instanceof Ge&&Ve(e.value)===Gt?a(e.value.sections):e instanceof Pn?a(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return r}}let eh;var nh={get paint(){return eh=eh||new Va({"background-color":new Oa(_t.paint_background["background-color"]),"background-pattern":new Ua(_t.paint_background["background-pattern"]),"background-opacity":new Oa(_t.paint_background["background-opacity"])})}};class ih extends Ga{constructor(t){super(t,nh)}}let rh;var ah={get paint(){return rh=rh||new Va({"raster-opacity":new Oa(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new Oa(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oa(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oa(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new Oa(_t.paint_raster["raster-saturation"]),"raster-contrast":new Oa(_t.paint_raster["raster-contrast"]),"raster-resampling":new Oa(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new Oa(_t.paint_raster["raster-fade-duration"])})}};class oh extends Ga{constructor(t){super(t,ah)}}class sh extends Ga{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lh{constructor(t){this._methodToThrottle=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ch={once:!0},uh=6371008.8;class hh{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(e,")"));if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hh(F(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(t){const e=Math.PI/180,n=this.lat*e,i=t.lat*e,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*e);return uh*Math.acos(Math.min(r,1))}static convert(t){if(t instanceof hh)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new hh(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new hh(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dh=2*Math.PI*uh;function ph(t){return dh*Math.cos(t*Math.PI/180)}function fh(t){return(180+t)/360}function mh(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function gh(t,e){return t/ph(e)}function yh(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function vh(t,e){return t*ph(yh(e))}class _h{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=hh.convert(t);return new _h(fh(n.lng),mh(n.lat),gh(e,n.lat))}toLngLat(){return new hh(360*this.x-180,yh(this.y))}toAltitude(){return vh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/dh*(t=yh(this.y),1/Math.cos(t*Math.PI/180));var t}}function xh(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}class bh{constructor(t,e,n){if(!function(t,e,n){return!(t<0||t>25||n<0||n>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))}(t,e,n))throw new Error("x=".concat(e,", y=").concat(n,", z=").concat(t," outside of bounds. 0<=x<").concat(Math.pow(2,t),", 0<=y<").concat(Math.pow(2,t)," 0<=z<=25 "));this.z=t,this.x=e,this.y=n,this.key=Mh(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,n){const i=(a=this.y,o=this.z,s=xh(256*(r=this.x),256*(a=Math.pow(2,o)-a-1),o),l=xh(256*(r+1),256*(a+1),o),s[0]+","+s[1]+","+l[0]+","+l[1]);var r,a,o,s,l;const c=function(t,e,n){let i,r="";for(let a=t;a>0;a--)i=1<<a-1,r+=(e&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new n((t.x*e-this.x)*I,(t.y*e-this.y)*I)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class wh{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Mh(t,e.z,e.z,e.x,e.y)}}class Sh{constructor(t,e,n,i,r){if(this.terrainRttPosMatrix32f=null,t<n)throw new Error("overscaledZ should be >= z; overscaledZ = ".concat(t,"; z = ").concat(n));this.overscaledZ=t,this.wrap=e,this.canonical=new bh(n,+i,+r),this.key=Mh(e,t,n,i,r)}clone(){return new Sh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error("targetZ > this.overscaledZ; targetZ = ".concat(t,"; overscaledZ = ").concat(this.overscaledZ));const e=this.canonical.z-t;return t>this.canonical.z?new Sh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error("targetZ > this.overscaledZ; targetZ = ".concat(t,"; overscaledZ = ").concat(this.overscaledZ));const n=this.canonical.z-t;return t>this.canonical.z?Mh(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Mh(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Sh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Sh(e,this.wrap,e,n,i),new Sh(e,this.wrap,e,n+1,i),new Sh(e,this.wrap,e,n,i+1),new Sh(e,this.wrap,e,n+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Sh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Sh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}getTilePoint(t){return this.canonical.getTilePoint(new _h(t.x-this.wrap,t.y))}}function Mh(t,e,n,i,r){(t*=2)<0&&(t=-1*t-1);const a=1<<n;return(a*a*t+a*r+i).toString(36)+n.toString(36)+e.toString(36)}function Th(t,e){return e?t.properties[e]:t.id}sa("CanonicalTileID",bh),sa("OverscaledTileID",Sh,{omit:["terrainRttPosMatrix32f"]});class Eh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const e=new Eh;return e.extend(t(new n(this.minX,this.minY))),e.extend(t(new n(this.maxX,this.minY))),e.extend(t(new n(this.minX,this.maxY))),e.extend(t(new n(this.maxX,this.maxY))),e}static fromPoints(t){const e=new Eh;for(const n of t)e.extend(n);return e}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Ah{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error("Out of bounds. Index requested n=".concat(t," can't be >= this._numberToString.length ").concat(this._numberToString.length));return this._numberToString[t]}}class Ch{constructor(t,e,n,i,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class Ph{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new aa(I,16,0),this.grid3D=new aa(I,16,0),this.featureIndexArray=new Ro,this.promoteId=e}insert(t,e,n,i,r,a){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);const s=a?this.grid3D:this.grid;for(let l=0;l<e.length;l++){const t=e[l],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const i=t[e];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}n[0]<I&&n[1]<I&&n[2]>=0&&n[3]>=0&&s.insert(o,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fc(new $c(this.rawTileData)).layers,this.sourceLayerCoder=new Ah(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,r){this.loadVTLayers();const a=t.params,o=I/t.tileSize/t.scale,s=dr(a.filter),l=t.queryGeometry,c=t.queryPadding*o,u=Eh.fromPoints(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Eh.fromPoints(t.cameraQueryGeometry).expandBy(c),p=this.grid3D.query(d.minX,d.minY,d.maxX,d.maxY,(e,i,r,a)=>function(t,e,i,r,a){for(const n of t)if(e<=n.x&&i<=n.y&&r>=n.x&&a>=n.y)return!0;const o=[new n(e,i),new n(e,a),new n(r,a),new n(r,i)];if(t.length>2)for(const n of o)if(Us(t,n))return!0;for(let n=0;n<t.length-1;n++)if(js(t[n],t[n+1],o))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,r+c,a+c));for(const n of p)h.push(n);h.sort(Rh);const f={};let m;for(let n=0;n<h.length;n++){const c=h[n];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,a.layers,a.availableImages,e,i,r,(e,n,i)=>(d||(d=Es(e)),n.queryIntersectsFeature({queryGeometry:l,feature:e,featureState:i,geometry:d,zoom:this.z,transform:t.transform,pixelsToTileUnits:o,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return f}loadMatchingFeature(t,e,n,i,r,a,o,s,l,c,u){const h=this.bucketLayerIDs[e];if(a&&!h.some(t=>a.has(t)))return;const d=this.sourceLayerCoder.decode(n),p=this.vtLayers[d].feature(i);if(r.needGeometry){const t=As(p,!0);if(!r.filter(new Ca(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new Ca(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let m=0;m<h.length;m++){const e=h[m];if(a&&!a.has(e))continue;const n=s[e];if(!n)continue;let r={};f&&c&&(r=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const d=B({},l[e]);d.paint=Ih(d.paint,n.paint,p,r,o),d.layout=Ih(d.layout,n.layout,p,r,o);const g=!u||u(p,n,r);if(!g)continue;const y=new Ch(p,this.z,this.x,this.y,f);y.layer=d;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:i,feature:y,intersectionZ:g})}}lookupSymbolFeatures(t,e,n,i,r,a,o,s){const l={};this.loadVTLayers();const c=dr(r);for(const u of t)this.loadMatchingFeature(l,n,i,u,c,a,o,s,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){var n;let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i)),void 0===i&&(null===(n=t.properties)||void 0===n?void 0:n.cluster)&&this.promoteId&&(i=Number(t.properties.cluster_id))),i}}function Ih(t,e,n,i,r){return j(t,(t,a)=>{const o=e instanceof Na?e.get(a):null;return o&&o.evaluate?o.evaluate(n,i,r):o})}function Rh(t,e){return e-t}function kh(t,e,i,r,a){const o=[];for(let s=0;s<t.length;s++){const l=t[s];let c;for(let t=0;t<l.length-1;t++){let s=l[t],u=l[t+1];s.x<e&&u.x<e||(s.x<e?s=new n(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<e&&(u=new n(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<i&&u.y<i||(s.y<i?s=new n(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y<i&&(u=new n(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),s.x>=r&&u.x>=r||(s.x>=r?s=new n(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=r&&(u=new n(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=a&&u.y>=a||(s.y>=a?s=new n(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round():u.y>=a&&(u=new n(s.x+(a-s.y)/(u.y-s.y)*(u.x-s.x),a)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(u)))))}}return o}sa("FeatureIndex",Ph,{omit:["rawTileData","sourceLayerCoder"]});class Lh extends n{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new Lh(this.x,this.y,this.angle,this.segment)}}function Dh(t,e,n,i,r){if(void 0===e.segment||0===n)return!0;let a=e,o=e.segment+1,s=0;for(;s>-n/2;){if(o--,o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;const l=[];let c=0;for(;s<n/2;){const e=t[o],n=t[o+1];if(!n)return!1;let a=t[o-1].angleTo(e)-e.angleTo(n);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),c+=a;s-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;o++,s+=e.dist(n)}return!0}function zh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Nh(t,e,n){return t?.6*e*n:0}function Oh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Fh(t,e,n,i,r,a){const o=Nh(n,r,a),s=Oh(n,i)*a;let l=0;const c=zh(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],i=t[u+1],r=n.dist(i);if(l+r>c){const a=(c-l)/r,h=gn.number(n.x,i.x,a),d=gn.number(n.y,i.y,a),p=new Lh(h,d,i.angleTo(n),u);return p._round(),!o||Dh(t,p,s,o,e)?p:void 0}l+=r}}function Bh(t,e,n,i,r,a,o,s,l){const c=Nh(i,a,o),u=Oh(i,r),h=u*o,d=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Uh(t,d?e/2*s%e:(u/2+2*a)*o*s%e,e,c,n,h,d,!1,l)}function Uh(t,e,n,i,r,a,o,s,l){const c=a/2,u=zh(t);let h=0,d=e-n,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],o=t[f+1],s=e.dist(o),m=o.angleTo(e);for(;d+n<h+s;){d+=n;const g=(d-h)/s,y=gn.number(e.x,o.x,g),v=gn.number(e.y,o.y,g);if(y>=0&&y<l&&v>=0&&v<l&&d-c>=0&&d+c<=u){const e=new Lh(y,v,m,f);e._round(),i&&!Dh(t,e,a,i,r)||p.push(e)}}h+=s}return s||p.length||o||(p=Uh(t,h/2,n,i,r,a,o,!0,l)),p}function jh(t,e,i,r){const a=[],o=t.image,s=o.pixelRatio,l=o.paddedRect.w-2,c=o.paddedRect.h-2;let u={x1:t.left,y1:t.top,x2:t.right,y2:t.bottom};const h=o.stretchX||[[0,l]],d=o.stretchY||[[0,c]],p=(t,e)=>t+e[1]-e[0],f=h.reduce(p,0),m=d.reduce(p,0),g=l-f,y=c-m;let v=0,_=f,x=0,b=m,w=0,S=g,M=0,T=y;if(o.content&&r){const e=o.content,n=e[2]-e[0],i=e[3]-e[1];(o.textFitWidth||o.textFitHeight)&&(u=Ou(t)),v=Vh(h,0,e[0]),x=Vh(d,0,e[1]),_=Vh(h,e[0],e[2]),b=Vh(d,e[1],e[3]),w=e[0]-v,M=e[1]-x,S=n-_,T=i-b}const E=u.x1,A=u.y1,C=u.x2-E,P=u.y2-A,I=(t,r,a,l)=>{const c=Gh(t.stretch-v,_,C,E),u=Wh(t.fixed-w,S,t.stretch,f),h=Gh(r.stretch-x,b,P,A),d=Wh(r.fixed-M,T,r.stretch,m),p=Gh(a.stretch-v,_,C,E),g=Wh(a.fixed-w,S,a.stretch,f),y=Gh(l.stretch-x,b,P,A),I=Wh(l.fixed-M,T,l.stretch,m),R=new n(c,h),k=new n(p,h),L=new n(p,y),D=new n(c,y),z=new n(u/s,d/s),N=new n(g/s,I/s),O=e*Math.PI/180;if(O){const t=Math.sin(O),e=Math.cos(O),n=[e,-t,t,e];R._matMult(n),k._matMult(n),D._matMult(n),L._matMult(n)}const F=t.stretch+t.fixed,B=r.stretch+r.fixed;return{tl:R,tr:k,bl:D,br:L,tex:{x:o.paddedRect.x+1+F,y:o.paddedRect.y+1+B,w:a.stretch+a.fixed-F,h:l.stretch+l.fixed-B},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:N,minFontScaleX:S/s/C,minFontScaleY:T/s/P,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const t=Hh(h,g,f),e=Hh(d,y,m);for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1];for(let t=0;t<e.length-1;t++)a.push(I(i,e[t],r,e[t+1]))}}else a.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return a}function Vh(t,e,n){let i=0;for(const r of t)i+=Math.max(e,Math.min(n,r[1]))-Math.max(e,Math.min(n,r[0]));return i}function Hh(t,e,n){const i=[{fixed:-1,stretch:0}];for(const[r,a]of t){const t=i[i.length-1];i.push({fixed:r-t.stretch,stretch:t.stretch}),i.push({fixed:r-t.stretch,stretch:t.stretch+(a-r)})}return i.push({fixed:e+1,stretch:n}),i}function Gh(t,e,n,i){return t/e*n+i}function Wh(t,e,n,i){return t-e*n/i}sa("Anchor",Lh);class qh{constructor(t,e,i,r,a,o,s,l,c,u){var h;if(this.boxStartIndex=t.length,c){let t=o.top,e=o.bottom;const n=o.collisionPadding;n&&(t-=n[1],e+=n[3]);let i=e-t;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{const c=(null===(h=o.image)||void 0===h?void 0:h.content)&&(o.image.textFitWidth||o.image.textFitHeight)?Ou(o):{x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};c.y1=c.y1*s-l[0],c.y2=c.y2*s+l[2],c.x1=c.x1*s-l[3],c.x2=c.x2*s+l[1];const d=o.collisionPadding;if(d&&(c.x1-=d[0]*s,c.y1-=d[1]*s,c.x2+=d[2]*s,c.y2+=d[3]*s),u){const t=new n(c.x1,c.y1),e=new n(c.x2,c.y1),i=new n(c.x1,c.y2),r=new n(c.x2,c.y2),a=u*Math.PI/180;t._rotate(a),e._rotate(a),i._rotate(a),r._rotate(a),c.x1=Math.min(t.x,e.x,i.x,r.x),c.x2=Math.max(t.x,e.x,i.x,r.x),c.y1=Math.min(t.y,e.y,i.y,r.y),c.y2=Math.max(t.y,e.y,i.y,r.y)}t.emplaceBack(e.x,e.y,c.x1,c.y1,c.x2,c.y2,i,r,a)}this.boxEndIndex=t.length}}class Zh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1);const a=i+1;if(a<this.length&&n(e[a],e[i])<0&&(i=a),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}}function Xh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Eh.fromPoints(t[0]),a=Math.min(r.width(),r.height());let o=a/2;const s=new Zh([],Yh),{minX:l,minY:c,maxX:u,maxY:h}=r;if(0===a)return new n(l,c);for(let n=l;n<u;n+=a)for(let e=c;e<h;e+=a)s.push(new Kh(n+o,e+o,o,t));let d=function(t){let e=0,n=0,i=0;const r=t[0];for(let a=0,o=r.length,s=o-1;a<o;s=a++){const t=r[a],o=r[s],l=t.x*o.y-o.x*t.y;n+=(t.x+o.x)*l,i+=(t.y+o.y)*l,e+=3*l}return new Kh(n/e,i/e,0,t)}(t),p=s.length;for(;s.length;){const n=s.pop();(n.d>d.d||!d.d)&&(d=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=e||(o=n.h/2,s.push(new Kh(n.p.x-o,n.p.y-o,o,t)),s.push(new Kh(n.p.x+o,n.p.y-o,o,t)),s.push(new Kh(n.p.x-o,n.p.y+o,o,t)),s.push(new Kh(n.p.x+o,n.p.y+o,o,t)),p+=4)}return i&&(console.log("num probes: ".concat(p)),console.log("best distance: ".concat(d.d))),d.p}function Yh(t,e){return e.max-t.max}function Kh(t,e,i,r){this.p=new n(t,e),this.h=i,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const a=e[r];for(let e=0,r=a.length,o=r-1;e<r;o=e++){const r=a[e],s=a[o];r.y>t.y!=s.y>t.y&&t.x<(s.x-r.x)*(t.y-r.y)/(s.y-r.y)+r.x&&(n=!n),i=Math.min(i,Fs(t,r,s))}}return(n?1:-1)*Math.sqrt(i)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Jh;t.aE=void 0,(Jh=t.aE||(t.aE={}))[Jh.center=1]="center",Jh[Jh.left=2]="left",Jh[Jh.right=3]="right",Jh[Jh.top=4]="top",Jh[Jh.bottom=5]="bottom",Jh[Jh["top-left"]=6]="top-left",Jh[Jh["top-right"]=7]="top-right",Jh[Jh["bottom-left"]=8]="bottom-left",Jh[Jh["bottom-right"]=9]="bottom-right";const $h=Number.POSITIVE_INFINITY;function Qh(t,e){return e[1]!==$h?function(t,e,n){let i=0,r=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}return[i,r]}(t,e[0],e[1]):function(t,e){let n=0,i=0;e<0&&(e=0);const r=e/Math.SQRT2;switch(t){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}(t,e[0])}function td(t,e,n){var i;const r=t.layout,a=null===(i=r.get("text-variable-anchor-offset"))||void 0===i?void 0:i.evaluate(e,{},n);if(a){const t=a.values,e=[];for(let n=0;n<t.length;n+=2){const i=e[n]=t[n],r=t[n+1].map(t=>t*Xc);i.startsWith("top")?r[1]-=7:i.startsWith("bottom")&&(r[1]+=7),e[n+1]=r}return new Oe(e)}const o=r.get("text-variable-anchor");if(o){let i;i=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[r.get("text-radial-offset").evaluate(e,{},n)*Xc,$h]:r.get("text-offset").evaluate(e,{},n).map(t=>t*Xc);const a=[];for(const t of o)a.push(t,Qh(t,i));return new Oe(a)}return null}function ed(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nd(e,n,i,r,a,o,s,l,c,u,h,d){let p=o.textMaxSize.evaluate(n,{});void 0===p&&(p=s);const f=e.layers[0].layout,m=f.get("icon-offset").evaluate(n,{},h),g=rd(i.horizontal),y=s/24,v=e.tilePixelRatio*y,_=e.tilePixelRatio*p/24,x=e.tilePixelRatio*l,b=e.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*e.tilePixelRatio,S=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const r=t.get("icon-padding").evaluate(e,{},n),a=r&&r.values;return[a[0]*i,a[1]*i,a[2]*i,a[3]*i]}(f,n,h,e.tilePixelRatio),M=f.get("text-max-angle")/180*Math.PI,T="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),E="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),A=f.get("symbol-placement"),C=b/2,P=f.get("icon-text-fit");let R;r&&"none"!==P&&(e.allowVerticalPlacement&&i.vertical&&(R=Fu(r,i.vertical,P,f.get("icon-text-fit-padding"),m,y)),g&&(r=Fu(r,g,P,f.get("icon-text-fit-padding"),m,y)));const k=h?d.line.getGranularityForZoomLevel(h.z):1,L=(l,d)=>{d.x<0||d.x>=I||d.y<0||d.y>=I||function(e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,T){const E=e.addToLineVertexArray(n,i);let A,C,P,I,R=0,k=0,L=0,D=0,z=-1,N=-1;const O={};let F=rs("");if(e.allowVerticalPlacement&&r.vertical){const t=l.layout.get("text-rotate").evaluate(b,{},M)+90;P=new qh(c,n,u,h,d,r.vertical,p,f,m,t),s&&(I=new qh(c,n,u,h,d,s,y,v,m,t))}if(a){const i=l.layout.get("icon-rotate").evaluate(b,{}),r="none"!==l.layout.get("icon-text-fit"),o=jh(a,i,S,r),p=s?jh(s,i,S,r):void 0;C=new qh(c,n,u,h,d,a,y,v,!1,i),R=4*o.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Bu*l.layout.get("icon-size").evaluate(b,{})],m[0]>Uu&&W("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))):"composite"===f.kind&&(m=[Bu*w.compositeIconSizes[0].evaluate(b,{},M),Bu*w.compositeIconSizes[1].evaluate(b,{},M)],(m[0]>Uu||m[1]>Uu)&&W("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))),e.addSymbols(e.icon,o,m,x,_,b,t.ao.none,n,E.lineStartIndex,E.lineLength,-1,M),z=e.icon.placedSymbolArray.length-1,p&&(k=4*p.length,e.addSymbols(e.icon,p,m,x,_,b,t.ao.vertical,n,E.lineStartIndex,E.lineLength,-1,M),N=e.icon.placedSymbolArray.length-1)}const B=Object.keys(r.horizontal);for(const W of B){const i=r.horizontal[W];if(!A){F=rs(i.text);const t=l.layout.get("text-rotate").evaluate(b,{},M);A=new qh(c,n,u,h,d,i,p,f,m,t)}const a=1===i.positionedLines.length;if(L+=id(e,n,i,o,l,m,b,g,E,r.vertical?t.ao.horizontal:t.ao.horizontalOnly,a?B:[W],O,z,w,M),a)break}r.vertical&&(D+=id(e,n,r.vertical,o,l,m,b,g,E,t.ao.vertical,["vertical"],O,N,w,M));const U=A?A.boxStartIndex:e.collisionBoxArray.length,j=A?A.boxEndIndex:e.collisionBoxArray.length,V=P?P.boxStartIndex:e.collisionBoxArray.length,H=P?P.boxEndIndex:e.collisionBoxArray.length,G=C?C.boxStartIndex:e.collisionBoxArray.length,q=C?C.boxEndIndex:e.collisionBoxArray.length,Z=I?I.boxStartIndex:e.collisionBoxArray.length,X=I?I.boxEndIndex:e.collisionBoxArray.length;let Y=-1;const K=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;Y=K(A,Y),Y=K(P,Y),Y=K(C,Y),Y=K(I,Y);const J=Y>-1?1:0;J&&(Y*=T/Xc),e.glyphOffsetArray.length>=Yu.MAX_GLYPHS&&W("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey);const $=td(l,b,M),[Q,tt]=function(e,n){const i=e.length,r=null==n?void 0:n.values;if((null==r?void 0:r.length)>0)for(let a=0;a<r.length;a+=2){const n=r[a+1];e.emplaceBack(t.aE[r[a]],n[0],n[1])}return[i,e.length]}(e.textAnchorOffsets,$);e.symbolInstances.emplaceBack(n.x,n.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,z,N,F,U,j,V,H,G,q,Z,X,u,L,D,R,k,J,0,p,Y,Q,tt)}(e,d,l,i,r,a,R,e.layers[0],e.collisionBoxArray,n.index,n.sourceLayerIndex,e.index,v,[w,w,w,w],T,c,x,S,E,m,n,o,u,h,s)};if("line"===A)for(const t of kh(n.geometry,0,0,I,I)){const n=Jl(t,k),a=Bh(n,b,M,i.vertical||g,r,24,_,e.overscaling,I);for(const t of a)g&&ad(e,g.text,C,t)||L(n,t)}else if("line-center"===A){for(const t of n.geometry)if(t.length>1){const e=Jl(t,k),n=Fh(e,M,i.vertical||g,r,24,_);n&&L(e,n)}}else if("Polygon"===n.type)for(const t of ei(n.geometry,0)){const e=Xh(t,16);L(Jl(t[0],k,!0),new Lh(e.x,e.y,0))}else if("LineString"===n.type)for(const t of n.geometry){const e=Jl(t,k);L(e,new Lh(e[0].x,e[0].y,0))}else if("Point"===n.type)for(const t of n.geometry)for(const e of t)L([e],new Lh(e.x,e.y,0))}function id(t,e,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=function(t,e,i,r,a,o,s,l){const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const h of e.positionedLines)for(const t of h.positionedGlyphs){if(!t.rect)continue;const r=t.rect||{};let o=4,d=!0,p=1,f=0;const m=(a||l)&&t.vertical,g=t.metrics.advance*t.scale/2;if(l&&e.verticalizable&&(f=h.lineOffset/2-(t.imageName?-(Xc-t.metrics.width*t.scale)/2:(t.scale-1)*Xc)),t.imageName){const e=s[t.imageName];d=e.sdf,p=e.pixelRatio,o=1/p}const y=a?[t.x+g,t.y]:[0,0];let v=a?[0,0]:[t.x+g+i[0],t.y+i[1]-f],_=[0,0];m&&(_=v,v=[0,0]);const x=t.metrics.isDoubleResolution?2:1,b=(t.metrics.left-o)*t.scale-g+v[0],w=(-t.metrics.top-o)*t.scale+v[1],S=b+r.w/x*t.scale/p,M=w+r.h/x*t.scale/p,T=new n(b,w),E=new n(S,w),A=new n(b,M),C=new n(S,M);if(m){const e=new n(-g,g- -17),i=-Math.PI/2,r=12-g,a=new n(22-r,-(t.imageName?r:0)),o=new n(..._);T._rotateAround(i,e)._add(a)._add(o),E._rotateAround(i,e)._add(a)._add(o),A._rotateAround(i,e)._add(a)._add(o),C._rotateAround(i,e)._add(a)._add(o)}if(c){const t=Math.sin(c),e=Math.cos(c),n=[e,-t,t,e];T._matMult(n),E._matMult(n),A._matMult(n),C._matMult(n)}const P=new n(0,0),I=new n(0,0);u.push({tl:T,tr:E,bl:A,br:C,tex:r,writingMode:e.writingMode,glyphOffset:y,sectionIndex:t.sectionIndex,isSDF:d,pixelOffsetTL:P,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,a,o,s,r,t.allowVerticalPlacement),y=t.textSizeData;let v=null;"source"===y.kind?(v=[Bu*a.layout.get("text-size").evaluate(s,{})],v[0]>Uu&&W("".concat(t.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))):"composite"===y.kind&&(v=[Bu*f.compositeTextSizes[0].evaluate(s,{},m),Bu*f.compositeTextSizes[1].evaluate(s,{},m)],(v[0]>Uu||v[1]>Uu)&&W("".concat(t.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))),t.addSymbols(t.text,g,v,l,o,s,u,e,c.lineStartIndex,c.lineLength,p,m);for(const n of h)d[n]=t.text.placedSymbolArray.length-1;return 4*g.length}function rd(t){for(const e in t)return t[e];return null}function ad(t,e,n,i){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<n)return!0}else r[e]=[];return r[e].push(i),!1}const od=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,n]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error("Got v".concat(i," data when expected v1."));const r=od[15&n];if(!r)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new sd(o,a,r,t)}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,i=arguments.length>3?arguments[3]:void 0;if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const r=od.indexOf(this.ArrayType),a=2*t*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(r<0)throw new Error("Unexpected typed array class: ".concat(n,"."));i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+s,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+a+o+s),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+s,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=e,n}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return ld(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:a,nodeSize:o}=this,s=[0,r.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let o=h;o<=u;o++){const s=a[2*o],c=a[2*o+1];s>=t&&s<=n&&c>=e&&c<=i&&l.push(r[o])}continue}const d=h+u>>1,p=a[2*d],f=a[2*d+1];p>=t&&p<=n&&f>=e&&f<=i&&l.push(r[d]),(0===c?t<=p:e<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?n>=p:i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return l}within(t,e,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:a}=this,o=[0,i.length-1,0],s=[],l=n*n;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,h=o.pop()||0;if(u-h<=a){for(let n=h;n<=u;n++)dd(r[2*n],r[2*n+1],t,e)<=l&&s.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];dd(p,f,t,e)<=l&&s.push(i[d]),(0===c?t-n<=p:e-n<=f)&&(o.push(h),o.push(d-1),o.push(1-c)),(0===c?t+n>=p:e+n>=f)&&(o.push(d+1),o.push(u),o.push(1-c))}return s}}function ld(t,e,n,i,r,a){if(r-i<=n)return;const o=i+r>>1;cd(t,e,o,i,r,a),ld(t,e,n,i,o-1,1-a),ld(t,e,n,o+1,r,1-a)}function cd(t,e,n,i,r,a){for(;r>i;){if(r-i>600){const o=r-i+1,s=n-i+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);cd(t,e,n,Math.max(i,Math.floor(n-s*c/o+u)),Math.min(r,Math.floor(n+(o-s)*c/o+u)),a)}const o=e[2*n+a];let s=i,l=r;for(ud(t,e,i,n),e[2*r+a]>o&&ud(t,e,i,r);s<l;){for(ud(t,e,s,l),s++,l--;e[2*s+a]<o;)s++;for(;e[2*l+a]>o;)l--}e[2*i+a]===o?ud(t,e,i,l):(l++,ud(t,e,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function ud(t,e,n,i){hd(t,n,i),hd(e,2*n,2*i),hd(e,2*n+1,2*i+1)}function hd(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}function dd(t,e,n,i){const r=t-n,a=e-i;return r*r+a*a}var pd;t.cx=void 0,(pd=t.cx||(t.cx={})).create="create",pd.load="load",pd.fullLoad="fullLoad";let fd=null,md=[];const gd=1e3/60,yd="loadTime",vd="fullLoadTime",_d={mark(t){performance.mark(t)},frame(t){const e=t;null!=fd&&md.push(e-fd),fd=e},clearMetrics(){fd=null,md=[],performance.clearMeasures(yd),performance.clearMeasures(vd);for(const e in t.cx)performance.clearMarks(t.cx[e])},getPerformanceMetrics(){performance.measure(yd,t.cx.create,t.cx.load),performance.measure(vd,t.cx.create,t.cx.fullLoad);const e=performance.getEntriesByName(yd)[0].duration,n=performance.getEntriesByName(vd)[0].duration,i=md.length,r=1/(md.reduce((t,e)=>t+e,0)/i/1e3),a=md.filter(t=>t>gd).reduce((t,e)=>t+(e-gd)/gd,0);return{loadTime:e,fullLoadTime:n,fps:r,percentDroppedFrames:a/(i+a)*100,totalFrames:i}}};t.$=I,t.A=f,t.B=function(t){let[e,n,i]=t;return n+=90,n*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i)}},t.C=gn,t.D=Oa,t.E=vt,t.F=Ca,t.G=ea,t.H=function(t){if(null==X){const e=t.navigator?t.navigator.userAgent:null;X=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return X},t.I=fu,t.J=class{constructor(t,e){this.target=t,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lh(()=>this.process()),this.subscription=tt(this.target,"message",t=>this.receive(t),!1),this.globalScope=Z(self)?t:window}registerMessageHandler(t,e){this.messageHandlers[t]=e}sendAsync(t,e){return new Promise((n,i)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10),a=e?tt(e.signal,"abort",()=>{null==a||a.unsubscribe(),delete this.resolveRejects[r];const e={id:r,type:"<cancel>",origin:location.origin,targetMapId:t.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)},ch):null;this.resolveRejects[r]={resolve:t=>{null==a||a.unsubscribe(),n(t)},reject:t=>{null==a||a.unsubscribe(),i(t)}};const o=[],s=Object.assign(Object.assign({},t),{id:r,sourceMapId:this.mapId,origin:location.origin,data:ha(t.data,o)});this.target.postMessage(s,{transfer:o})})}receive(t){const e=t.data,n=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&"resource://android"!==e.origin&&"resource://android"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[n];const t=this.abortControllers[n];return delete this.abortControllers[n],void(t&&t.abort())}if(Z(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(0===this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,n){return e(this,void 0,void 0,function*(){if("<response>"===n.type){const e=this.resolveRejects[t];if(delete this.resolveRejects[t],!e)return;return void(n.error?e.reject(da(n.error)):e.resolve(da(n.data)))}if(!this.messageHandlers[n.type])return void this.completeTask(t,new Error("Could not find a registered handler for ".concat(n.type,", map ID: ").concat(this.mapId,", available handlers: ").concat(Object.keys(this.messageHandlers).join(", "))));const e=da(n.data),i=new AbortController;this.abortControllers[t]=i;try{const r=yield this.messageHandlers[n.type](n.sourceMapId,e,i);this.completeTask(t,null,r)}catch(e){this.completeTask(t,e)}})}completeTask(t,e,n){const i=[];delete this.abortControllers[t];const r={id:t,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?ha(e):null,data:ha(n,i)};this.target.postMessage(r,{transfer:i})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},t.K=ct,t.L=function(){var t=new f(16);return f!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.M=function(t,e,n){var i,r,a,o,s,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=i=e[0],t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=i*m+s*g+h*y+e[12],t[13]=r*m+l*g+d*y+e[13],t[14]=a*m+c*g+p*y+e[14],t[15]=o*m+u*g+f*y+e[15]),t},t.N=function(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.O=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*i+x*s+b*h+w*m,t[1]=_*r+x*l+b*d+w*g,t[2]=_*a+x*c+b*p+w*y,t[3]=_*o+x*u+b*f+w*v,t[4]=(_=n[4])*i+(x=n[5])*s+(b=n[6])*h+(w=n[7])*m,t[5]=_*r+x*l+b*d+w*g,t[6]=_*a+x*c+b*p+w*y,t[7]=_*o+x*u+b*f+w*v,t[8]=(_=n[8])*i+(x=n[9])*s+(b=n[10])*h+(w=n[11])*m,t[9]=_*r+x*l+b*d+w*g,t[10]=_*a+x*c+b*p+w*y,t[11]=_*o+x*u+b*f+w*v,t[12]=(_=n[12])*i+(x=n[13])*s+(b=n[14])*h+(w=n[15])*m,t[13]=_*r+x*l+b*d+w*g,t[14]=_*a+x*c+b*p+w*y,t[15]=_*o+x*u+b*f+w*v,t},t.P=n,t.Q=function(t,e){const n={};for(let i=0;i<e.length;i++){const r=e[i];r in t&&(n[r]=t[r])}return n},t.R=il,t.S=hh,t.T=dl,t.U=mh,t.V=fh,t.W=h,t.X=d,t.Y=J,t.Z=Sh,t._=e,t.a=st,t.a$=M,t.a0=function(t,e){var n,i,r,a;if(!t)return null!=e?e:{};if(!e)return t;const o=Object.assign({},t);if(e.removeAll&&(o.removeAll=!0),e.remove){const t=new Set(o.remove?o.remove.concat(e.remove):e.remove);o.remove=Array.from(t.values())}if(e.add){const t=o.add?o.add.concat(e.add):e.add,n=new Map(t.map(t=>[t.id,t]));o.add=Array.from(n.values())}if(e.update){const t=new Map(null===(n=o.update)||void 0===n?void 0:n.map(t=>[t.id,t]));for(const n of e.update){const e=null!==(i=t.get(n.id))&&void 0!==i?i:{id:n.id};n.newGeometry&&(e.newGeometry=n.newGeometry),n.addOrUpdateProperties&&(e.addOrUpdateProperties=(null!==(r=e.addOrUpdateProperties)&&void 0!==r?r:[]).concat(n.addOrUpdateProperties)),n.removeProperties&&(e.removeProperties=(null!==(a=e.removeProperties)&&void 0!==a?a:[]).concat(n.removeProperties)),n.removeAllProperties&&(e.removeAllProperties=!0),t.set(n.id,e)}o.update=Array.from(t.values())}return o},t.a1=_h,t.a2=Eh,t.a3=25,t.a4=bh,t.a5=t=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const i of t){const t=window.document.createElement("source");pt(i)||(e.crossOrigin="Anonymous"),t.src=i,e.appendChild(t)}})},t.a6=Rt,t.a7=function(){return U++},t.a8=bo,t.a9=Yu,t.aA=function(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(const a of t)e=Math.min(e,a.x),n=Math.min(n,a.y),i=Math.max(i,a.x),r=Math.max(r,a.y);return[e,n,i,r]},t.aB=Xc,t.aC=R,t.aD=function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!n[0]&&!n[1])return[0,0];const a=r?"map"===i?-t.bearingInRadians:0:"viewport"===i?t.bearingInRadians:0;if(a){const t=Math.sin(a),e=Math.cos(a);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}return[r?n[0]:R(e,n[0],t.zoom),r?n[1]:R(e,n[1],t.zoom)]},t.aF=Vu,t.aG=ed,t.aH=Pu,t.aI=sd,t.aJ=Xa,t.aK=ql,t.aL=ko,t.aM=Xo,t.aN=Go,t.aO=F,t.aP=nt,t.aQ=vh,t.aR=b,t.aS=x,t.aT=function(t){var e=new f(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.aU=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.aV=function(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t},t.aW=w,t.aX=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.aY=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},t.aZ=v,t.a_=function(t,e,n){const i=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return 0===i?null:(-(t[0]*n[0]+t[1]*n[1]+t[2]*n[2])-n[3])/i},t.aa=dr,t.ab=As,t.ac=Ch,t.ad=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,i,r)=>{const a=i||r;return e[n]=!a||a.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ae=et,t.af=function(t){return Math.pow(2,t)},t.ag=g,t.ah=O,t.ai=85.051129,t.aj=gh,t.ak=function(t){return Math.log(t)/Math.LN2},t.al=function(t){var e=t[0],n=t[1];return e*e+n*n},t.am=function(t,e){const n=[];for(const i in t)i in e||n.push(i);return n},t.an=function(t,e){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:a,maxZoom:o}=t,s=r?O(fn.interpolationFactor(r,e,a,o),0,1):0;"camera"===t.kind?i=gn.number(t.minSize,t.maxSize,s):n=s}return{uSizeT:n,uSize:i}},t.ap=function(t,e,n){let{uSize:i,uSizeT:r}=e,{lowerSize:a,upperSize:o}=n;return"source"===t.kind?a/Bu:"composite"===t.kind?gn.number(a/Bu,o/Bu,r):i},t.aq=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=n*s-i*o,_=n*l-r*o,x=n*c-a*o,b=i*l-r*s,w=i*c-a*s,S=r*c-a*l,M=u*m-h*f,T=u*g-d*f,E=u*y-p*f,A=h*g-d*m,C=h*y-p*m,P=d*y-p*g,I=v*P-_*C+x*A+b*E-w*T+S*M;return I?(t[0]=(s*P-l*C+c*A)*(I=1/I),t[1]=(r*C-i*P-a*A)*I,t[2]=(m*S-g*w+y*b)*I,t[3]=(d*w-h*S-p*b)*I,t[4]=(l*E-o*P-c*T)*I,t[5]=(n*P-r*E+a*T)*I,t[6]=(g*x-f*S-y*_)*I,t[7]=(u*S-d*x+p*_)*I,t[8]=(o*C-s*E+c*M)*I,t[9]=(i*E-n*C-a*M)*I,t[10]=(f*w-m*x+y*v)*I,t[11]=(h*x-u*w-p*v)*I,t[12]=(s*T-o*A-l*M)*I,t[13]=(n*A-i*T+r*M)*I,t[14]=(m*_-f*b-g*v)*I,t[15]=(u*b-h*_+d*v)*I,t):null},t.ar=C,t.as=function(t){return Math.hypot(t[0],t[1])},t.at=function(t){return t[0]=0,t[1]=0,t},t.au=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},t.av=Wu,t.aw=T,t.ax=function(t,e,i,r){const a=e.y-t.y,o=e.x-t.x,s=r.y-i.y,l=r.x-i.x,c=s*o-l*a;if(0===c)return null;const u=(l*(t.y-i.y)-s*(t.x-i.x))/c;return new n(t.x+u*o,t.y+u*a)},t.ay=kh,t.az=Rs,t.b=Y,t.b$=class extends lo{},t.b0=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.b1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},t.b2=wh,t.b3=Mh,t.b4=function(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+i)*(a=1/(i-r)),t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t},t.b5=function(t){var e=new f(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.b6=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+c*i,t[1]=o*r+u*i,t[2]=s*r+h*i,t[3]=l*r+d*i,t[4]=c*r-a*i,t[5]=u*r-o*i,t[6]=h*r-s*i,t[7]=d*r-l*i,t},t.b7=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+c*i,t[5]=o*r+u*i,t[6]=s*r+h*i,t[7]=l*r+d*i,t[8]=c*r-a*i,t[9]=u*r-o*i,t[10]=h*r-s*i,t[11]=d*r-l*i,t},t.b8=function(){const t=new Float32Array(16);return g(t),t},t.b9=function(){const t=new Float64Array(16);return g(t),t},t.bA=function(t,e){const n=k(t,360),i=k(e,360),r=i-n,a=i>n?r-360:r+360;return Math.abs(r)<Math.abs(a)?r:a},t.bB=function(t){return t[0]=0,t[1]=0,t[2]=0,t},t.bC=function(t,e,n,i){const r=Math.sqrt(t*t+e*e),a=Math.sqrt(n*n+i*i);t/=r,e/=r,n/=a,i/=a;const o=Math.acos(t*n+e*i);return-e*n+t*i>0?o:-o},t.bD=function(t,e){const n=k(t,2*Math.PI),i=k(e,2*Math.PI);return Math.min(Math.abs(n-i),Math.abs(n-i+2*Math.PI),Math.abs(n-i-2*Math.PI))},t.bE=function(){const t={},e=_t.$version;for(const n in _t.$root){const i=_t.$root[n];if(i.required){let r=null;r="version"===n?e:"array"===i.type?[]:{},null!=r&&(t[n]=r)}}return t},t.bF=pa,t.bG=ht,t.bH=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(!t(e[i],n[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.bI=function(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=bt(t[n],e[t[n].ref]));return t},t.bJ=function(t){if("custom"===t.type)return new sh(t);switch(t.type){case"background":return new ih(t);case"circle":return new Xs(t);case"color-relief":return new ml(t);case"fill":return new ac(t);case"fill-extrusion":return new Mc(t);case"heatmap":return new ol(t);case"hillshade":return new cl(t);case"line":return new Bc(t);case"raster":return new oh(t);case"symbol":return new th(t)}},t.bK=H,t.bL=function(t,e){if(!t)return[{command:"setStyle",args:[e]}];let n=[];try{if(!wt(t.version,e.version))return[{command:"setStyle",args:[e]}];wt(t.center,e.center)||n.push({command:"setCenter",args:[e.center]}),wt(t.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),wt(t.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),wt(t.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),wt(t.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),wt(t.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),wt(t.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),wt(t.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),wt(t.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),wt(t.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),wt(t.light,e.light)||n.push({command:"setLight",args:[e.light]}),wt(t.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),wt(t.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),wt(t.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const i={},r=[];!function(t,e,n,i){let r;for(r in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)||Tt(r,n,i));for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?wt(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&At(t,e,r)?St(n,{command:"setGeoJSONSourceData",args:[r,e[r].data]}):Et(r,e,n,i)):Mt(r,e,n))}(t.sources,e.sources,r,i);const a=[];t.layers&&t.layers.forEach(t=>{"source"in t&&i[t.source]?n.push({command:"removeLayer",args:[t.id]}):a.push(t)}),n=n.concat(r),function(t,e,n){e=e||[];const i=(t=t||[]).map(Pt),r=e.map(Pt),a=t.reduce(It,{}),o=e.reduce(It,{}),s=i.slice(),l=Object.create(null);let c,u,h,d,p;for(let f=0,m=0;f<i.length;f++)c=i[f],Object.prototype.hasOwnProperty.call(o,c)?m++:(St(n,{command:"removeLayer",args:[c]}),s.splice(s.indexOf(c,m),1));for(let f=0,m=0;f<r.length;f++)c=r[r.length-1-f],s[s.length-1-f]!==c&&(Object.prototype.hasOwnProperty.call(a,c)?(St(n,{command:"removeLayer",args:[c]}),s.splice(s.lastIndexOf(c,s.length-m),1)):m++,d=s[s.length-f],St(n,{command:"addLayer",args:[o[c],d]}),s.splice(s.length-f,0,c),l[c]=!0);for(let f=0;f<r.length;f++)if(c=r[f],u=a[c],h=o[c],!l[c]&&!wt(u,h))if(wt(u.source,h.source)&&wt(u["source-layer"],h["source-layer"])&&wt(u.type,h.type)){for(p in Ct(u.layout,h.layout,n,c,null,"setLayoutProperty"),Ct(u.paint,h.paint,n,c,null,"setPaintProperty"),wt(u.filter,h.filter)||St(n,{command:"setFilter",args:[c,h.filter]}),wt(u.minzoom,h.minzoom)&&wt(u.maxzoom,h.maxzoom)||St(n,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ct(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):wt(u[p],h[p])||St(n,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ct(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):wt(u[p],h[p])||St(n,{command:"setLayerProperty",args:[c,p,h[p]]}))}else St(n,{command:"removeLayer",args:[c]}),d=s[s.lastIndexOf(c)+1],St(n,{command:"addLayer",args:[h,d]})}(a,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:"setStyle",args:[e]}]}return n},t.bM=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===t.render&&e.push({message:"layers.".concat(n,': missing required method "render"')}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),e},t.bN=j,t.bO=V,t.bP=class extends cs{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.bQ=ds,t.bR=class extends cs{constructor(t,e){super(t,e),this.current=ps}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.bS=hs,t.bT=class extends cs{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.bU=class extends cs{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.bV=m,t.bW=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.bX=function(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t},t.bY=function(t,e,n,i,r,a,o){var s=1/(e-n),l=1/(i-r),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*l,t[14]=(o+a)*c,t[15]=1,t},t.bZ=class extends cs{constructor(t,e){super(t,e),this.current=new Array}set(t){if(t!=this.current){this.current=t;const e=new Float32Array(4*t.length);for(let n=0;n<t.length;n++)e[4*n]=t[n].r,e[4*n+1]=t[n].g,e[4*n+2]=t[n].b,e[4*n+3]=t[n].a;this.gl.uniform4fv(this.location,e)}}},t.b_=class extends cs{constructor(t,e){super(t,e),this.current=new Array}set(t){if(t!=this.current){this.current=t;const e=new Float32Array(t);this.gl.uniform1fv(this.location,e)}}},t.ba=function(){return new Float64Array(16)},t.bb=function(t,e,n){const i=new Float64Array(4);return A(i,t,e-90,n),i},t.bc=function(t,e,n,i){var r,a,o,s,l,c=e[0],u=e[1],h=e[2],d=e[3],f=n[0],m=n[1],g=n[2],y=n[3];return(a=c*f+u*m+h*g+d*y)<0&&(a=-a,f=-f,m=-m,g=-g,y=-y),1-a>p?(r=Math.acos(a),o=Math.sin(r),s=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(s=1-i,l=i),t[0]=s*c+l*f,t[1]=s*u+l*m,t[2]=s*h+l*g,t[3]=s*d+l*y,t},t.bd=function(t){const e=new Float64Array(9);var n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_;h=(r=(i=t)[0])*(l=r+r),d=(a=i[1])*l,f=(o=i[2])*l,m=o*(c=a+a),y=(s=i[3])*l,v=s*c,_=s*(u=o+o),(n=e)[0]=1-(p=a*c)-(g=o*u),n[3]=d-_,n[6]=f+v,n[1]=d+_,n[4]=1-h-g,n[7]=m-y,n[2]=f-v,n[5]=m+y,n[8]=1-h-p;const x=nt(-Math.asin(O(e[2],-1,1)));let b,w;return Math.hypot(e[5],e[8])<.001?(b=0,w=-nt(Math.atan2(e[3],e[4]))):(b=nt(0===e[5]&&0===e[8]?0:Math.atan2(e[5],e[8])),w=nt(0===e[1]&&0===e[0]?0:Math.atan2(e[1],e[0]))),{roll:b,pitch:x+90,bearing:w}},t.be=function(t,e){return t.roll==e.roll&&t.pitch==e.pitch&&t.bearing==e.bearing},t.bf=Ae,t.bg=us,t.bh=Zl,t.bi=Xl,t.bj=Wl,t.bk=L,t.bl=D,t.bm=Be,t.bn=function(t,e,n,i,r){return L(i,r,O((t-e)/(n-e),0,1))},t.bo=k,t.bp=function(){return new Float64Array(3)},t.bq=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},t.br=A,t.bs=function(t,e,n){var i=n[0],r=n[1],a=n[2],o=e[0],s=e[1],l=e[2],c=r*l-a*s,u=a*o-i*l,h=i*s-r*o,d=r*h-a*u,p=a*c-i*h,f=i*u-r*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,t[0]=o+(c*=m)+(d*=2),t[1]=s+u+p,t[2]=l+h+f,t},t.bt=function(t,e,n){const i=(r=[t[0],t[1],t[2],e[0],e[1],e[2],n[0],n[1],n[2]])[0]*((u=r[8])*(o=r[4])-(s=r[5])*(c=r[7]))+r[1]*(-u*(a=r[3])+s*(l=r[6]))+r[2]*(c*a-o*l);var r,a,o,s,l,c,u;if(0===i)return null;const h=w([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),d=w([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),p=w([],[t[0],t[1],t[2]],[e[0],e[1],e[2]]),f=b([],h,-t[3]);return x(f,f,b([],d,-e[3])),x(f,f,b([],p,-n[3])),b(f,f,1/i),f},t.bu=uh,t.bv=function(){return new Float64Array(4)},t.bw=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},t.bx=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},t.by=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},t.bz=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-c*i,t[1]=o*r-u*i,t[2]=s*r-h*i,t[3]=l*r-d*i,t[8]=a*i+c*r,t[9]=o*i+u*r,t[10]=s*i+h*r,t[11]=l*i+d*r,t},t.c=ot,t.c0=Wc,t.c1=class extends uo{},t.c2=al,t.c3=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.c4=rl,t.c5=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/(o=o||1),t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,t},t.c6=class extends $a{},t.c7=class extends vo{},t.c8=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},t.c9=function(t,e){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=e[0],x=e[1],b=e[2],w=e[3],S=e[4],M=e[5],T=e[6],E=e[7],A=e[8],C=e[9],P=e[10],I=e[11],R=e[12],k=e[13],L=e[14],D=e[15];return Math.abs(n-_)<=p*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-x)<=p*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(r-b)<=p*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(a-w)<=p*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-S)<=p*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-M)<=p*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(l-T)<=p*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-E)<=p*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-A)<=p*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-C)<=p*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-P)<=p*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-I)<=p*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(m-R)<=p*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-k)<=p*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(y-L)<=p*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(v-D)<=p*Math.max(1,Math.abs(v),Math.abs(D))},t.cA=function(t,e){st.REGISTERED_PROTOCOLS[t]=e},t.cB=function(t){delete st.REGISTERED_PROTOCOLS[t]},t.cC=function(t,e){const n={};for(let r=0;r<t.length;r++){const i=e&&e[t[r].id]||br(t[r]);e&&(e[t[r].id]=i);let a=n[i];a||(a=n[i]=[]),a.push(t[r])}const i=[];for(const r in n)i.push(n[r]);return i},t.cD=sa,t.cE=Ah,t.cF=Ph,t.cG=mu,t.cH=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=I/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const n=e.bucket.layers[0],i=n.layout,r=n._unevaluatedLayout._values,a={layoutIconSize:r["icon-size"].possiblyEvaluate(new Ca(e.bucket.zoom+1),e.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Ca(e.bucket.zoom+1),e.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Ca(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.bucket.textSizeData;a.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Ca(t),e.canonical),r["text-size"].possiblyEvaluate(new Ca(n),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.bucket.iconSizeData;a.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Ca(t),e.canonical),r["icon-size"].possiblyEvaluate(new Ca(n),e.canonical)]}const o=i.get("text-line-height")*Xc,s="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),l=i.get("text-keep-upright"),c=i.get("text-size");for(const u of e.bucket.features){const r=i.get("text-font").evaluate(u,{},e.canonical).join(","),h=c.evaluate(u,{},e.canonical),d=a.layoutTextSize.evaluate(u,{},e.canonical),p=a.layoutIconSize.evaluate(u,{},e.canonical),f={horizontal:{},vertical:void 0},m=u.text;let g,y=[0,0];if(m){const a=m.toString(),c=i.get("text-letter-spacing").evaluate(u,{},e.canonical)*Xc,p=ga(a)?c:0,g=i.get("text-anchor").evaluate(u,{},e.canonical),v=td(n,u,e.canonical);if(!v){const t=i.get("text-radial-offset").evaluate(u,{},e.canonical);y=t?Qh(g,[t*Xc,$h]):i.get("text-offset").evaluate(u,{},e.canonical).map(t=>t*Xc)}let _=s?"center":i.get("text-justify").evaluate(u,{},e.canonical);const x="point"===i.get("symbol-placement")?i.get("text-max-width").evaluate(u,{},e.canonical)*Xc:1/0,b=()=>{e.bucket.allowVerticalPlacement&&ma(a)&&(f.vertical=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,x,o,g,"left",p,y,t.ao.vertical,!0,d,h))};if(!s&&v){const n=new Set;if("auto"===_)for(let t=0;t<v.values.length;t+=2)n.add(ed(v.values[t]));else n.add(_);let i=!1;for(const a of n)if(!f.horizontal[a])if(i)f.horizontal[a]=f.horizontal[0];else{const n=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,x,o,"center",a,p,y,t.ao.horizontal,!1,d,h);n&&(f.horizontal[a]=n,i=1===n.positionedLines.length)}b()}else{"auto"===_&&(_=ed(g));const n=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,x,o,g,_,p,y,t.ao.horizontal,!1,d,h);n&&(f.horizontal[_]=n),b(),ma(a)&&s&&l&&(f.vertical=_u(m,e.glyphMap,e.glyphPositions,e.imagePositions,r,x,o,g,_,p,y,t.ao.vertical,!1,d,h))}}let v=!1;if(u.icon&&u.icon.name){const t=e.imageMap[u.icon.name];t&&(g=Nu(e.imagePositions[u.icon.name],i.get("icon-offset").evaluate(u,{},e.canonical),i.get("icon-anchor").evaluate(u,{},e.canonical)),v=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=v:e.bucket.sdfIcons!==v&&W("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const _=rd(f.horizontal)||f.vertical;e.bucket.iconsInText=!!_&&_.iconsInText,(_||g)&&nd(e.bucket,u,f,g,e.imageMap,a,d,p,y,v,e.canonical,e.subdivisionGranularity)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.cI=Lc,t.cJ=ec,t.cK=vc,t.cL=fc,t.cM=$c,t.cN=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.cO=function(t,n,i,r,a){return e(this,void 0,void 0,function*(){if(d())try{return yield J(t,n,i,r,a)}catch(t){}return function(t,e,n,i,r){const a=t.width,o=t.height;$&&Q||($=new OffscreenCanvas(a,o),Q=$.getContext("2d",{willReadFrequently:!0})),$.width=a,$.height=o,Q.drawImage(t,0,0,a,o);const s=Q.getImageData(e,n,i,r);return Q.clearRect(0,0,a,o),s.data}(t,n,i,r,a)})},t.cP=pl,t.cQ=r,t.cR=dc,t.cS=cc,t.cT=ir,t.cU=function(t,e){const n=new Map;if(null==t);else if("Feature"===t.type)n.set(Th(t,e),t);else for(const i of t.features)n.set(Th(i,e),i);return n},t.cV=function(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=Th(t,e);if("FeatureCollection"===t.type){const n=new Set;for(const i of t.features){const t=Th(i,e);if(null==t)return!1;if(n.has(t))return!1;n.add(t)}return!0}return!1},t.cW=function(t,e,n){var i,r,a,o;if(e.removeAll&&t.clear(),e.remove)for(const s of e.remove)t.delete(s);if(e.add)for(const s of e.add){const e=Th(s,n);null!=e&&t.set(e,s)}if(e.update)for(const s of e.update){let e=t.get(s.id);if(null==e)continue;const n=!s.removeAllProperties&&((null===(i=s.removeProperties)||void 0===i?void 0:i.length)>0||(null===(r=s.addOrUpdateProperties)||void 0===r?void 0:r.length)>0);if((s.newGeometry||s.removeAllProperties||n)&&(e=Object.assign({},e),t.set(s.id,e),n&&(e.properties=Object.assign({},e.properties))),s.newGeometry&&(e.geometry=s.newGeometry),s.removeAllProperties)e.properties={};else if((null===(a=s.removeProperties)||void 0===a?void 0:a.length)>0)for(const t of s.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(o=s.addOrUpdateProperties)||void 0===o?void 0:o.length)>0)for(const{key:t,value:i}of s.addOrUpdateProperties)e.properties[t]=i}},t.cX=Aa,t.ca=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.cb=t=>"symbol"===t.type,t.cc=t=>"circle"===t.type,t.cd=t=>"heatmap"===t.type,t.ce=t=>"line"===t.type,t.cf=t=>"fill"===t.type,t.cg=t=>"fill-extrusion"===t.type,t.ch=t=>"hillshade"===t.type,t.ci=t=>"color-relief"===t.type,t.cj=t=>"raster"===t.type,t.ck=t=>"background"===t.type,t.cl=t=>"custom"===t.type,t.cm=z,t.cn=function(t,e,n){const i=P(e.x-n.x,e.y-n.y),r=P(t.x-n.x,t.y-n.y);var a,o;return nt(Math.atan2(i[0]*r[1]-i[1]*r[0],(a=i)[0]*(o=r)[0]+a[1]*o[1]))},t.co=N,t.cp=function(t,e){return rt[e]&&(t instanceof MouseEvent||t instanceof WheelEvent)},t.cq=function(t,e){return it[e]&&"touches"in t},t.cr=function(t){return it[t]||rt[t]},t.cs=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t},t.ct=function(t,e){const{x:n,y:i}=_h.fromLngLat(e);return!(t<0||t>25||i<0||i>=1||n<0||n>=1)},t.cu=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.cv=class extends Ja{},t.cw=_d,t.cy=function(t){return t.message===at},t.cz=ut,t.d=pt,t.e=B,t.f=t=>e(void 0,void 0,void 0,function*(){if(0===t.byteLength)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(t)],{type:"image/png"});try{return createImageBitmap(e)}catch(t){throw new Error("Could not load image because of ".concat(t.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}}),t.g=lt,t.h=t=>new Promise((e,n)=>{const i=new Image;i.onload=()=>{e(i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame(()=>{i.src=K})},i.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(r):K}),t.i=Z,t.j=(t,e)=>dt(B(t,{type:"json"}),e),t.k=yt,t.l=gt,t.m=dt,t.n=(t,e)=>dt(B(t,{type:"arrayBuffer"}),e),t.o=function(t){return new $c(t).readFields(uu,[])},t.p=pu,t.q=nl,t.r=Va,t.s=tt,t.t=Ra,t.u=fa,t.v=_t,t.w=W,t.x=ta,t.y=ra,t.z=Qr}),n("worker",["./shared"],function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,n){for(const r of e){this._layerConfigs[r.id]=r;const e=this._layers[r.id]=t.bJ(r);e._featureFilter=t.aa(e.filter),this.keyCache[r.id]&&delete this.keyCache[r.id]}for(const t of n)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const i=t.cC(Object.values(this._layerConfigs),this.keyCache);for(const t of i){const e=t.map(t=>this._layers[t.id]),n=e[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const a=n.sourceLayer||"_geojsonTileLayer";let o=r[a];o||(o=r[a]=[]),o.push(e)}}}class n{constructor(e){const n={},i=[];for(const t in e){const r=e[t],a=n[t]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const n={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};i.push(n),a[t]={rect:n,metrics:e.metrics}}}const{w:r,h:a}=t.p(i),o=new t.q({width:r||1,height:a||1});for(const s in e){const i=e[s];for(const e in i){const r=i[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const a=n[s][e].rect;t.q.copy(r.bitmap,o,{x:0,y:0},{x:a.x+1,y:a.y+1},r.bitmap)}}this.image=o,this.positions=n}}t.cD("GlyphAtlas",n);class i{constructor(e){this.tileID=new t.Z(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[],this.globalState=e.globalState}parse(e,i,a,o,s){return t._(this,void 0,void 0,function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a8;const l=new t.cE(Object.keys(e.layers).sort()),c=new t.cF(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:a,subdivisionGranularity:s},d=i.familiesBySource[this.source];for(const n in d){const i=e.layers[n];if(!i)continue;1===i.version&&t.w('Vector tile source "'.concat(this.source,'" layer "').concat(n,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const o=l.encode(n),s=[];for(let t=0;t<i.length;t++){const e=i.feature(t),r=c.getId(e,n);s.push({feature:e,id:r,index:t,sourceLayerIndex:o})}for(const e of d[n]){const n=e[0];n.source!==this.source&&t.w("layer.source = ".concat(n.source," does not equal this.source = ").concat(this.source)),n.minzoom&&this.zoom<Math.floor(n.minzoom)||n.maxzoom&&this.zoom>=n.maxzoom||"none"!==n.visibility&&(r(e,this.zoom,a),(u[n.id]=n.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:o,sourceID:this.source,globalState:this.globalState})).populate(s,h,this.tileID.canonical),c.bucketLayerIDs.push(e.map(t=>t.id)))}}const p=t.bN(h.glyphDependencies,t=>Object.keys(t).map(Number));this.inFlightDependencies.forEach(t=>null==t?void 0:t.abort()),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const t=new AbortController;this.inFlightDependencies.push(t),f=o.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},t)}const m=Object.keys(h.iconDependencies);let g=Promise.resolve({});if(m.length){const t=new AbortController;this.inFlightDependencies.push(t),g=o.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"icons"}},t)}const y=Object.keys(h.patternDependencies);let v=Promise.resolve({});if(y.length){const t=new AbortController;this.inFlightDependencies.push(t),v=o.sendAsync({type:"GI",data:{icons:y,source:this.source,tileID:this.tileID,type:"patterns"}},t)}const[_,x,b]=yield Promise.all([f,g,v]),w=new n(_),S=new t.cG(x,b);for(const e in u){const n=u[e];n instanceof t.a9?(r(n.layers,this.zoom,a),t.cH({bucket:n,glyphMap:_,glyphPositions:w.positions,imageMap:x,imagePositions:S.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):n.hasPattern&&(n instanceof t.cI||n instanceof t.cJ||n instanceof t.cK)&&(r(n.layers,this.zoom,a),n.addFeatures(h,this.tileID.canonical,S.patternPositions))}return this.status="done",{buckets:Object.values(u).filter(t=>!t.isEmpty()),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:w.image,imageAtlas:S,glyphMap:this.returnDependencies?_:null,iconMap:this.returnDependencies?x:null,glyphPositions:this.returnDependencies?w.positions:null}})}}function r(e,n,i){const r=new t.F(n);for(const t of e)t.recalculate(r,i)}class a{constructor(t,e,n){this.actor=t,this.layerIndex=e,this.availableImages=n,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,n){return t._(this,void 0,void 0,function*(){const i=yield t.n(e.request,n);try{return{vectorTile:new t.cL(new t.cM(i.data)),rawData:i.data,cacheControl:i.cacheControl,expires:i.expires}}catch(t){const r=new Uint8Array(i.data);let a="Unable to parse the tile at ".concat(e.request.url,", ");throw a+=31===r[0]&&139===r[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":"got error: ".concat(t.message),new Error(a)}})}loadTile(e){return t._(this,void 0,void 0,function*(){const n=e.uid,r=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.cN(e.request),a=new i(e);this.loading[n]=a;const o=new AbortController;a.abort=o;try{const i=yield this.loadVectorTile(e,o);if(delete this.loading[n],!i)return null;const s=i.rawData,l={};i.expires&&(l.expires=i.expires),i.cacheControl&&(l.cacheControl=i.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}a.vectorTile=i.vectorTile;const u=a.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);this.loaded[n]=a,this.fetching[n]={rawTileData:s,cacheControl:l,resourceTiming:c};try{const e=yield u;return t.e({rawTileData:s.slice(0)},e,l,c)}finally{delete this.fetching[n]}}catch(t){throw delete this.loading[n],a.status="done",this.loaded[n]=a,t}})}reloadTile(e){return t._(this,void 0,void 0,function*(){const n=e.uid;if(!this.loaded||!this.loaded[n])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const i=this.loaded[n];if(i.showCollisionBoxes=e.showCollisionBoxes,i.globalState=e.globalState,"parsing"===i.status){const r=yield i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);let a;if(this.fetching[n]){const{rawTileData:e,cacheControl:i,resourceTiming:o}=this.fetching[n];delete this.fetching[n],a=t.e({rawTileData:e.slice(0)},r,i,o)}else a=r;return a}if("done"===i.status&&i.vectorTile)return i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity)})}abortTile(e){return t._(this,void 0,void 0,function*(){const t=this.loading,n=e.uid;t&&t[n]&&t[n].abort&&(t[n].abort.abort(),delete t[n])})}removeTile(e){return t._(this,void 0,void 0,function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]})}}class o{constructor(){this.loaded={}}loadTile(e){return t._(this,void 0,void 0,function*(){const{uid:n,encoding:i,rawImageData:r,redFactor:a,greenFactor:o,blueFactor:s,baseShift:l}=e,c=r.width+2,u=r.height+2,h=t.b(r)?new t.R({width:c,height:u},yield t.cO(r,-1,-1,c,u)):r,d=new t.cP(n,h,i,a,o,s,l);return this.loaded=this.loaded||{},this.loaded[n]=d,d})}removeTile(t){const e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]}}var s,l,c=function(){if(l)return s;function t(t,n){if(0!==t.length){e(t[0],n);for(var i=1;i<t.length;i++)e(t[i],!n)}}function e(t,e){for(var n=0,i=0,r=0,a=t.length,o=a-1;r<a;o=r++){var s=(t[r][0]-t[o][0])*(t[o][1]+t[r][1]),l=n+s;i+=Math.abs(n)>=Math.abs(s)?n-l+s:s-l+n,n=l}n+i>=0!=!!e&&t.reverse()}return l=1,s=function e(n,i){var r,a=n&&n.type;if("FeatureCollection"===a)for(r=0;r<n.features.length;r++)e(n.features[r],i);else if("GeometryCollection"===a)for(r=0;r<n.geometries.length;r++)e(n.geometries[r],i);else if("Feature"===a)e(n.geometry,i);else if("Polygon"===a)t(n.coordinates,i);else if("MultiPolygon"===a)for(r=0;r<n.coordinates.length;r++)t(n.coordinates[r],i);return n}}(),u=t.cQ(c);class h extends t.cS{constructor(e,n){super(new t.cM,0,n,[],[]),this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},"id"in e&&("string"==typeof e.id?this.id=parseInt(e.id,10):"number"!=typeof e.id||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const i of n){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}class d extends t.cR{constructor(e,n){super(new t.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=n?n.version:1,this.extent=n?n.extent:4096,this.length=e.length,this.features=e}feature(t){return new h(this.features[t],this.extent)}}function p(t,e){e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let a=0;a<t.length;a++)n.feature=t.feature(a),e.writeMessage(2,f,n);const i=n.keys;for(const a of i)e.writeStringField(3,a);const r=n.values;for(const a of r)e.writeMessage(4,_,a)}function f(t,e){if(!t.feature)return;const n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,m,t),e.writeVarintField(3,n.type),e.writeMessage(4,v,n)}function m(t,e){for(const i in null===(n=t.feature)||void 0===n?void 0:n.properties){var n;let r=t.feature.properties[i],a=t.keycache[i];if(null===r)continue;void 0===a&&(t.keys.push(i),a=t.keys.length-1,t.keycache[i]=a),e.writeVarint(a),"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r&&(r=JSON.stringify(r));const o=typeof r+":"+r;let s=t.valuecache[o];void 0===s&&(t.values.push(r),s=t.values.length-1,t.valuecache[o]=s),e.writeVarint(s)}}function g(t,e){return(e<<3)+(7&t)}function y(t){return t<<1^t>>31}function v(t,e){const n=t.loadGeometry(),i=t.type;let r=0,a=0;for(const o of n){let n=1;1===i&&(n=o.length),e.writeVarint(g(1,n));const s=3===i?o.length-1:o.length;for(let t=0;t<s;t++){1===t&&1!==i&&e.writeVarint(g(2,s-1));const n=o[t].x-r,l=o[t].y-a;e.writeVarint(y(n)),e.writeVarint(y(l)),r+=n,a+=l}3===t.type&&e.writeVarint(g(7,1))}}function _(t,e){const n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}const x={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},b=Math.fround||(w=new Float32Array(1),t=>(w[0]=+t,w[0]));var w;class S{constructor(t){this.options=Object.assign(Object.create(x),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:n,maxZoom:i}=this.options;e&&console.time("total time");const r="prepare ".concat(t.length," points");e&&console.time(r),this.points=t;const a=[];for(let s=0;s<t.length;s++){const e=t[s];if(!e.geometry)continue;const[n,i]=e.geometry.coordinates,r=b(E(n)),o=b(A(i));a.push(r,o,1/0,s,-1,1),this.options.reduce&&a.push(0)}let o=this.trees[i+1]=this._createTree(a);e&&console.timeEnd(r);for(let s=i;s>=n;s--){const t=+Date.now();o=this.trees[s]=this._createTree(this._cluster(o,s)),e&&console.log("z%d: %d clusters in %dms",s,o.numItems,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){const t=this.getClusters([n,i,180,a],e),o=this.getClusters([-180,i,r,a],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],s=o.range(E(n),A(a),E(r),A(i)),l=o.data,c=[];for(const u of s){const t=this.stride*u;c.push(l[t+5]>1?M(l,t,this.clusterProps):this.points[l[t+3]])}return c}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const a=r.data;if(e*this.stride>=a.length)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=r.within(a[e*this.stride],a[e*this.stride+1],o),l=[];for(const c of s){const e=c*this.stride;a[e+4]===t&&l.push(a[e+5]>1?M(a,e,this.clusterProps):this.points[a[e+3]])}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,n){const i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i}getTile(t,e,n){const i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:a,radius:o}=this.options,s=o/a,l=(n-s)/r,c=(n+1+s)/r,u={features:[]};return this._addTileFeatures(i.range((e-s)/r,l,(e+1+s)/r,c),i.data,e,n,r,u),0===e&&this._addTileFeatures(i.range(1-s/r,l,1,c),i.data,r,n,r,u),e===r-1&&this._addTileFeatures(i.range(0,l,s/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,i,r){const a=this.getChildren(e);for(const o of a){const e=o.properties;if(e&&e.cluster?r+e.point_count<=i?r+=e.point_count:r=this._appendLeaves(t,e.cluster_id,n,i,r):r<i?r++:t.push(o),t.length===n)break}return r}_createTree(e){const n=new t.aI(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)n.add(e[t],e[t+1]);return n.finish(),n.data=e,n}_addTileFeatures(t,e,n,i,r,a){for(const o of t){const t=o*this.stride,s=e[t+5]>1;let l,c,u;if(s)l=T(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const n=this.points[e[t+3]];l=n.properties;const[i,r]=n.geometry.coordinates;c=E(i),u=A(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=s||this.options.generateId?e[t+3]:this.points[e[t+3]].id,void 0!==d&&(h.id=d),a.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:n,extent:i,reduce:r,minPoints:a}=this.options,o=n/(i*Math.pow(2,e)),s=t.data,l=[],c=this.stride;for(let u=0;u<s.length;u+=c){if(s[u+2]<=e)continue;s[u+2]=e;const n=s[u],i=s[u+1],h=t.within(s[u],s[u+1],o),d=s[u+5];let p=d;for(const t of h){const n=t*c;s[n+2]>e&&(p+=s[n+5])}if(p>d&&p>=a){let t,a=n*d,o=i*d,f=-1;const m=(u/c<<5)+(e+1)+this.points.length;for(const n of h){const i=n*c;if(s[i+2]<=e)continue;s[i+2]=e;const l=s[i+5];a+=s[i]*l,o+=s[i+1]*l,s[i+4]=m,r&&(t||(t=this._map(s,u,!0),f=this.clusterProps.length,this.clusterProps.push(t)),r(t,this._map(s,i)))}s[u+4]=m,l.push(a/p,o/p,1/0,m,-1,p),r&&l.push(f)}else{for(let t=0;t<c;t++)l.push(s[u+t]);if(p>1)for(const t of h){const n=t*c;if(!(s[n+2]<=e)){s[n+2]=e;for(let t=0;t<c;t++)l.push(s[n+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,n){if(t[e+5]>1){const i=this.clusterProps[t[e+6]];return n?Object.assign({},i):i}const i=this.points[t[e+3]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function M(t,e,n){return{type:"Feature",id:t[e+3],properties:T(t,e,n),geometry:{type:"Point",coordinates:[(i=t[e],360*(i-.5)),C(t[e+1])]}};var i}function T(t,e,n){const i=t[e+5],r=i>=1e4?"".concat(Math.round(i/1e3),"k"):i>=1e3?Math.round(i/100)/10+"k":i,a=t[e+6],o=-1===a?{}:Object.assign({},n[a]);return Object.assign(o,{cluster:!0,cluster_id:t[e+3],point_count:i,point_count_abbreviated:r})}function E(t){return t/360+.5}function A(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function C(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function P(t,e,n,i){let r=i;const a=e+(n-e>>1);let o,s=n-e;const l=t[e],c=t[e+1],u=t[n],h=t[n+1];for(let d=e+3;d<n;d+=3){const e=I(t[d],t[d+1],l,c,u,h);if(e>r)o=d,r=e;else if(e===r){const t=Math.abs(d-a);t<s&&(o=d,s=t)}}r>i&&(o-e>3&&P(t,e,o,i),t[o+2]=r,n-o>3&&P(t,o,n,i))}function I(t,e,n,i,r,a){let o=r-n,s=a-i;if(0!==o||0!==s){const l=((t-n)*o+(e-i)*s)/(o*o+s*s);l>1?(n=r,i=a):l>0&&(n+=o*l,i+=s*l)}return o=t-n,s=e-i,o*o+s*s}function R(t,e,n,i){const r={id:null==t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)k(r,n);else if("Polygon"===e)k(r,n[0]);else if("MultiLineString"===e)for(const a of n)k(r,a);else if("MultiPolygon"===e)for(const a of n)k(r,a[0]);return r}function k(t,e){for(let n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function L(t,e,n,i){if(!e.geometry)return;const r=e.geometry.coordinates;if(r&&0===r.length)return;const a=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let s=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===a)D(r,s);else if("MultiPoint"===a)for(const c of r)D(c,s);else if("LineString"===a)z(r,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(const n of r)s=[],z(n,s,o,!1),t.push(R(l,"LineString",s,e.properties));return}N(r,s,o,!1)}else if("Polygon"===a)N(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(const r of e.geometry.geometries)L(t,{id:l,geometry:r,properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of r){const e=[];N(t,e,o,!0),s.push(e)}}t.push(R(l,a,s,e.properties))}function D(t,e){e.push(O(t[0]),F(t[1]),0)}function z(t,e,n,i){let r,a,o=0;for(let l=0;l<t.length;l++){const n=O(t[l][0]),s=F(t[l][1]);e.push(n,s,0),l>0&&(o+=i?(r*s-n*a)/2:Math.sqrt(Math.pow(n-r,2)+Math.pow(s-a,2))),r=n,a=s}const s=e.length-3;e[2]=1,P(e,0,s,n),e[s+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function N(t,e,n,i){for(let r=0;r<t.length;r++){const a=[];z(t[r],a,n,i),e.push(a)}}function O(t){return t/360+.5}function F(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function B(t,e,n,i,r,a,o,s){if(i/=e,a>=(n/=e)&&o<i)return t;if(o<n||a>=i)return null;const l=[];for(const c of t){const t=c.geometry;let e=c.type;const a=0===r?c.minX:c.minY,o=0===r?c.maxX:c.maxY;if(a>=n&&o<i){l.push(c);continue}if(o<n||a>=i)continue;let u=[];if("Point"===e||"MultiPoint"===e)U(t,u,n,i,r);else if("LineString"===e)j(t,u,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===e)H(t,u,n,i,r,!1);else if("Polygon"===e)H(t,u,n,i,r,!0);else if("MultiPolygon"===e)for(const s of t){const t=[];H(s,t,n,i,r,!0),t.length&&u.push(t)}if(u.length){if(s.lineMetrics&&"LineString"===e){for(const t of u)l.push(R(c.id,e,t,c.tags));continue}"LineString"!==e&&"MultiLineString"!==e||(1===u.length?(e="LineString",u=u[0]):e="MultiLineString"),"Point"!==e&&"MultiPoint"!==e||(e=3===u.length?"Point":"MultiPoint"),l.push(R(c.id,e,u,c.tags))}}return l.length?l:null}function U(t,e,n,i,r){for(let a=0;a<t.length;a+=3){const o=t[a+r];o>=n&&o<=i&&G(e,t[a],t[a+1],t[a+2])}}function j(t,e,n,i,r,a,o){let s=V(t);const l=0===r?W:q;let c,u,h=t.start;for(let g=0;g<t.length-3;g+=3){const d=t[g],p=t[g+1],f=t[g+2],m=t[g+3],y=t[g+4],v=0===r?d:p,_=0===r?m:y;let x=!1;o&&(c=Math.sqrt(Math.pow(d-m,2)+Math.pow(p-y,2))),v<n?_>n&&(u=l(s,d,p,m,y,n),o&&(s.start=h+c*u)):v>i?_<i&&(u=l(s,d,p,m,y,i),o&&(s.start=h+c*u)):G(s,d,p,f),_<n&&v>=n&&(u=l(s,d,p,m,y,n),x=!0),_>i&&v<=i&&(u=l(s,d,p,m,y,i),x=!0),!a&&x&&(o&&(s.end=h+c*u),e.push(s),s=V(t)),o&&(h+=c)}let d=t.length-3;const p=t[d],f=t[d+1],m=0===r?p:f;m>=n&&m<=i&&G(s,p,f,t[d+2]),d=s.length-3,a&&d>=3&&(s[d]!==s[0]||s[d+1]!==s[1])&&G(s,s[0],s[1],s[2]),s.length&&e.push(s)}function V(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function H(t,e,n,i,r,a){for(const o of t)j(o,e,n,i,r,a,!1)}function G(t,e,n,i){t.push(e,n,i)}function W(t,e,n,i,r,a){const o=(a-e)/(i-e);return G(t,a,n+(r-n)*o,1),o}function q(t,e,n,i,r,a){const o=(a-n)/(r-n);return G(t,e+(i-e)*o,a,1),o}function Z(t,e){const n=[];for(let i=0;i<t.length;i++){const r=t[i],a=r.type;let o;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=X(r.geometry,e);else if("MultiLineString"===a||"Polygon"===a){o=[];for(const t of r.geometry)o.push(X(t,e))}else if("MultiPolygon"===a){o=[];for(const t of r.geometry){const n=[];for(const i of t)n.push(X(i,e));o.push(n)}}n.push(R(r.id,a,o,r.tags))}return n}function X(t,e){const n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(let i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function Y(t,e){if(t.transformed)return t;const n=1<<t.z,i=t.x,r=t.y;for(const a of t.features){const t=a.geometry,o=a.type;if(a.geometry=[],1===o)for(let s=0;s<t.length;s+=2)a.geometry.push(K(t[s],t[s+1],e,n,i,r));else for(let s=0;s<t.length;s++){const o=[];for(let a=0;a<t[s].length;a+=2)o.push(K(t[s][a],t[s][a+1],e,n,i,r));a.geometry.push(o)}}return t.transformed=!0,t}function K(t,e,n,i,r,a){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-a))]}function J(t,e,n,i,r){const a=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const s of t)$(o,s,a,r);return o}function $(t,e,n,i){const r=e.geometry,a=e.type,o=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===a||"MultiPoint"===a)for(let s=0;s<r.length;s+=3)o.push(r[s],r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)Q(o,r,t,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(let s=0;s<r.length;s++)Q(o,r[s],t,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(let s=0;s<r.length;s++){const e=r[s];for(let i=0;i<e.length;i++)Q(o,e[i],t,n,!0,0===i)}if(o.length){let n=e.tags||null;if("LineString"===a&&i.lineMetrics){n={};for(const t in e.tags)n[t]=e.tags[t];n.mapbox_clip_start=r.start/r.size,n.mapbox_clip_end=r.end/r.size}const s={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:n};null!==e.id&&(s.id=e.id),t.features.push(s)}}function Q(t,e,n,i,r,a){const o=i*i;if(i>0&&e.size<(r?o:i))return void(n.numPoints+=e.length/3);const s=[];for(let l=0;l<e.length;l+=3)(0===i||e[l+2]>o)&&(n.numSimplified++,s.push(e[l],e[l+1])),n.numPoints++;r&&function(t,e){let n=0;for(let i=0,r=t.length,a=r-2;i<r;a=i,i+=2)n+=(t[i]-t[a])*(t[i+1]+t[a+1]);if(n>0===e)for(let i=0,r=t.length;i<r/2;i+=2){const e=t[i],n=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=e,t[r-1-i]=n}}(s,a),t.push(s)}const tt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class et{constructor(t,e){const n=(e=this.options=function(t,e){for(const n in e)t[n]=e[n];return t}(Object.create(tt),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(t,e){const n=[];if("FeatureCollection"===t.type)for(let i=0;i<t.features.length;i++)L(n,t.features[i],e,i);else L(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){const n=e.buffer/e.extent;let i=t;const r=B(t,1,-1-n,n,0,-1,2,e),a=B(t,1,1-n,2+n,0,-1,2,e);return(r||a)&&(i=B(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=Z(r,1).concat(i)),a&&(i=i.concat(Z(a,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,n,i,r,a,o){const s=[t,e,n,i],l=this.options,c=l.debug;for(;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();const u=1<<e,h=nt(e,n,i);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=J(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t="z".concat(e);this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==r){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===r)continue;if(null!=r){const t=r-e;if(n!==a>>t||i!==o>>t)continue}}if(d.source=null,0===t.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let y=null,v=null,_=null,x=null,b=B(t,u,n-p,n+m,0,d.minX,d.maxX,l),w=B(t,u,n+f,n+g,0,d.minX,d.maxX,l);t=null,b&&(y=B(b,u,i-p,i+m,1,d.minY,d.maxY,l),v=B(b,u,i+f,i+g,1,d.minY,d.maxY,l),b=null),w&&(_=B(w,u,i-p,i+m,1,d.minY,d.maxY,l),x=B(w,u,i+f,i+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*n,2*i),s.push(v||[],e+1,2*n,2*i+1),s.push(_||[],e+1,2*n+1,2*i),s.push(x||[],e+1,2*n+1,2*i+1)}}getTile(t,e,n){t=+t,e=+e,n=+n;const i=this.options,{extent:r,debug:a}=i;if(t<0||t>24)return null;const o=1<<t,s=nt(t,e=e+o&o-1,n);if(this.tiles[s])return Y(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",t,e,n);let l,c=t,u=e,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[nt(c,u,h)];return l&&l.source?(a>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,t,e,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?Y(this.tiles[s],r):null):null}}function nt(t,e,n){return 32*((1<<t)*n+e)+t}class it extends a{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,n){return t._(this,void 0,void 0,function*(){const n=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return null;const r=new d(i.features,{version:2,extent:t.$});let a=function(e){const n=new t.cM;return function(t,e){for(const n in t.layers)e.writeMessage(3,p,t.layers[n])}(e,n),n.finish()}(r);return 0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),{vectorTile:r,rawData:a.buffer}})}loadData(e){return t._(this,void 0,void 0,function*(){var n;null===(n=this._pendingRequest)||void 0===n||n.abort();const i=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.cN(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest);const n=yield this._pendingData;this._geoJSONIndex=e.cluster?new S(function(e){let{superclusterOptions:n,clusterProperties:i}=e;if(!i||!n)return n;const r={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(i);for(const c of l){const[e,n]=i[c],o=t.cT(n),s=t.cT("string"==typeof e?[e,["accumulated"],["get",c]]:e);r[c]=o.value,a[c]=s.value}return n.map=t=>{s.properties=t;const e={};for(const n of l)e[n]=r[n].evaluate(o,s);return e},n.reduce=(t,e)=>{s.properties=e;for(const n of l)o.accumulated=t[n],t[n]=a[n].evaluate(o,s)},n}(e)).load(n.features):function(t,e){return new et(t,e)}(n,e.geojsonVtOptions),this.loaded={};const r={data:n};if(i){const t=i.finish();t&&(r.resourceTiming={},r.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}return r}catch(e){if(delete this._pendingRequest,t.cy(e))return{abandoned:!0};throw e}})}getData(){return t._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(t){const e=this.loaded;return e&&e[t.uid]?super.reloadTile(t):this.loadTile(t)}loadAndProcessGeoJSON(e,n){return t._(this,void 0,void 0,function*(){let i=yield this.loadGeoJSON(e,n);if(delete this._pendingRequest,"object"!=typeof i)throw new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object."));if(u(i,!0),e.filter){const n=t.cT(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(t=>"".concat(t.key,": ").concat(t.message)).join(", "));const r=i.features.filter(t=>n.value.evaluate({zoom:0},t));i={type:"FeatureCollection",features:r}}return i})}loadGeoJSON(e,n){return t._(this,void 0,void 0,function*(){const{promoteId:i}=e;if(e.request){const r=yield t.j(e.request,n);return this._dataUpdateable=t.cV(r.data,i)?t.cU(r.data,i):void 0,r.data}if("string"==typeof e.data)try{const n=JSON.parse(e.data);return this._dataUpdateable=t.cV(n,i)?t.cU(n,i):void 0,n}catch(t){throw new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object."))}if(!e.dataDiff)throw new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object."));if(!this._dataUpdateable)throw new Error("Cannot update existing geojson data in ".concat(e.source));return t.cW(this._dataUpdateable,e.dataDiff,i),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(e){return t._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(t){return this._geoJSONIndex.getClusterExpansionZoom(t.clusterId)}getClusterChildren(t){return this._geoJSONIndex.getChildren(t.clusterId)}getClusterLeaves(t){return this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset)}}class rt{constructor(e){this.self=e,this.actor=new t.J(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(t,e)=>{if(this.externalWorkerSourceTypes[t])throw new Error('Worker source with name "'.concat(t,'" already registered.'));this.externalWorkerSourceTypes[t]=e},this.self.addProtocol=t.cA,this.self.removeProtocol=t.cB,this.self.registerRTLTextPlugin=e=>{t.cX.setMethods(e)},this.actor.registerMessageHandler("LDT",(t,e)=>this._getDEMWorkerSource(t,e.source).loadTile(e)),this.actor.registerMessageHandler("RDT",(e,n)=>t._(this,void 0,void 0,function*(){this._getDEMWorkerSource(e,n.source).removeTile(n)})),this.actor.registerMessageHandler("GCEZ",(e,n)=>t._(this,void 0,void 0,function*(){return this._getWorkerSource(e,n.type,n.source).getClusterExpansionZoom(n)})),this.actor.registerMessageHandler("GCC",(e,n)=>t._(this,void 0,void 0,function*(){return this._getWorkerSource(e,n.type,n.source).getClusterChildren(n)})),this.actor.registerMessageHandler("GCL",(e,n)=>t._(this,void 0,void 0,function*(){return this._getWorkerSource(e,n.type,n.source).getClusterLeaves(n)})),this.actor.registerMessageHandler("LD",(t,e)=>this._getWorkerSource(t,e.type,e.source).loadData(e)),this.actor.registerMessageHandler("GD",(t,e)=>this._getWorkerSource(t,e.type,e.source).getData()),this.actor.registerMessageHandler("LT",(t,e)=>this._getWorkerSource(t,e.type,e.source).loadTile(e)),this.actor.registerMessageHandler("RT",(t,e)=>this._getWorkerSource(t,e.type,e.source).reloadTile(e)),this.actor.registerMessageHandler("AT",(t,e)=>this._getWorkerSource(t,e.type,e.source).abortTile(e)),this.actor.registerMessageHandler("RMT",(t,e)=>this._getWorkerSource(t,e.type,e.source).removeTile(e)),this.actor.registerMessageHandler("RS",(e,n)=>t._(this,void 0,void 0,function*(){if(!this.workerSources[e]||!this.workerSources[e][n.type]||!this.workerSources[e][n.type][n.source])return;const t=this.workerSources[e][n.type][n.source];delete this.workerSources[e][n.type][n.source],void 0!==t.removeSource&&t.removeSource(n)})),this.actor.registerMessageHandler("RM",e=>t._(this,void 0,void 0,function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})),this.actor.registerMessageHandler("SR",(e,n)=>t._(this,void 0,void 0,function*(){this.referrer=n})),this.actor.registerMessageHandler("SRPS",(t,e)=>this._syncRTLPluginState(t,e)),this.actor.registerMessageHandler("IS",(e,n)=>t._(this,void 0,void 0,function*(){this.self.importScripts(n)})),this.actor.registerMessageHandler("SI",(t,e)=>this._setImages(t,e)),this.actor.registerMessageHandler("UL",(e,n)=>t._(this,void 0,void 0,function*(){this._getLayerIndex(e).update(n.layers,n.removedIds)})),this.actor.registerMessageHandler("SL",(e,n)=>t._(this,void 0,void 0,function*(){this._getLayerIndex(e).replace(n)}))}_setImages(e,n){return t._(this,void 0,void 0,function*(){this.availableImages[e]=n;for(const t in this.workerSources[e]){const i=this.workerSources[e][t];for(const t in i)i[t].availableImages=n}})}_syncRTLPluginState(e,n){return t._(this,void 0,void 0,function*(){return yield t.cX.syncState(n,this.self.importScripts)})}_getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}_getLayerIndex(t){let n=this.layerIndexes[t];return n||(n=this.layerIndexes[t]=new e),n}_getWorkerSource(t,e,n){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){const i={sendAsync:(e,n)=>(e.targetMapId=t,this.actor.sendAsync(e,n))};switch(e){case"vector":this.workerSources[t][e][n]=new a(i,this._getLayerIndex(t),this._getAvailableImages(t));break;case"geojson":this.workerSources[t][e][n]=new it(i,this._getLayerIndex(t),this._getAvailableImages(t));break;default:this.workerSources[t][e][n]=new this.externalWorkerSourceTypes[e](i,this._getLayerIndex(t),this._getAvailableImages(t))}}return this.workerSources[t][e][n]}_getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new o),this.demWorkerSources[t][e]}}return t.i(self)&&(self.worker=new rt(self)),rt}),n("index",["exports","./shared"],function(t,e){var n="5.6.2";function i(){var t=new e.A(4);return e.A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}let r,a;const o={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(t,n,i){const r=requestAnimationFrame(t=>{a(),n(t)}),{unsubscribe:a}=e.s(t.signal,"abort",()=>{a(),cancelAnimationFrame(r),i(e.c())},!1)},frameAsync(t){return new Promise((e,n)=>{this.frame(t,e,n)})},getImageData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height),n},resolveURL:t=>(r||(r=document.createElement("a")),r.href=t,r.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==a&&(a=matchMedia("(prefers-reduced-motion: reduce)")),a.matches)}};class s{static testProp(t){if(!s.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in s.docStyle)return t[e];return t[0]}static create(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){s.docStyle&&s.selectProp&&(s.userSelect=s.docStyle[s.selectProp],s.docStyle[s.selectProp]="none")}static enableDrag(){s.docStyle&&s.selectProp&&(s.docStyle[s.selectProp]=s.userSelect)}static setTransform(t,e){t.style[s.transformProp]=e}static addEventListener(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.addEventListener(e,n,"passive"in i?i:i.capture)}static removeEventListener(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t.removeEventListener(e,n,"passive"in i?i:i.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",s.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",s.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",s.suppressClickInternal,!0)},0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,n,i){const r=n.boundingClientRect;return new e.P((i.clientX-r.left)/n.x-t.clientLeft,(i.clientY-r.top)/n.y-t.clientTop)}static mousePos(t,e){const n=s.getScale(t);return s.getPoint(t,n,e)}static touchPos(t,e){const n=[],i=s.getScale(t);for(let r=0;r<e.length;r++)n.push(s.getPoint(t,i,e[r]));return n}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const e=(new DOMParser).parseFromString(t,"text/html").body||document.createElement("body"),n=e.querySelectorAll("script");for(const i of n)i.remove();return s.clean(e),e.innerHTML}static isPossiblyDangerous(t,e){const n=e.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!n.includes("javascript:")&&!n.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const e=t.children;for(const n of e)s.removeAttributes(n),s.clean(n)}static removeAttributes(t){for(const{name:e,value:n}of t.attributes)s.isPossiblyDangerous(e,n)&&t.removeAttribute(e)}}s.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,s.selectProp=s.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),s.transformProp=s.testProp(["transform","WebkitTransform"]);const l={supported:!1,testSupport:function(t){!h&&u&&(d?p(t):c=t)}};let c,u,h=!1,d=!1;function p(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,u),t.isContextLost())return;l.supported=!0}catch(t){}t.deleteTexture(e),h=!0}var f;"undefined"!=typeof document&&(u=document.createElement("img"),u.onload=()=>{c&&p(c),c=null,d=!0},u.onerror=()=>{h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(t){let n,i,r,a;t.resetRequestQueue=()=>{n=[],i=0,r=0,a={}},t.addThrottleControl=t=>{const e=r++;return a[e]=t,e},t.removeThrottleControl=t=>{delete a[t],s()},t.getImage=function(t,i){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((a,o)=>{l.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),e.e(t,{type:"image"}),n.push({abortController:i,requestParameters:t,supportImageRefresh:r,state:"queued",onError:t=>{o(t)},onSuccess:t=>{a(t)}}),s()})};const o=t=>e._(this,void 0,void 0,function*(){t.state="running";const{requestParameters:n,supportImageRefresh:r,onError:a,onSuccess:o,abortController:l}=t,u=!1===r&&!e.i(self)&&!e.g(n.url)&&(!n.headers||Object.keys(n.headers).reduce((t,e)=>t&&"accept"===e,!0));i++;const h=u?c(n,l):e.m(n,l);try{const n=yield h;delete t.abortController,t.state="completed",n.data instanceof HTMLImageElement||e.b(n.data)?o(n):n.data&&o({data:yield(d=n.data,"function"==typeof createImageBitmap?e.f(d):e.h(d)),cacheControl:n.cacheControl,expires:n.expires})}catch(e){delete t.abortController,a(e)}finally{i--,s()}var d}),s=()=>{const t=(()=>{for(const t of Object.keys(a))if(a[t]())return!0;return!1})()?e.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=i;e<t&&n.length>0;e++){const t=n.shift();t.abortController.signal.aborted?e--:o(t)}},c=(t,n)=>new Promise((i,r)=>{const a=new Image,o=t.url,s=t.credentials;s&&"include"===s?a.crossOrigin="use-credentials":(s&&"same-origin"===s||!e.d(o))&&(a.crossOrigin="anonymous"),n.signal.addEventListener("abort",()=>{a.src="",r(e.c())}),a.fetchPriority="high",a.onload=()=>{a.onerror=a.onload=null,i({data:a})},a.onerror=()=>{a.onerror=a.onload=null,n.signal.aborted||r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},a.src=o})}(f||(f={})),f.resetRequestQueue();class m{constructor(t){this._transformRequestFn=null!=t?t:null}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function g(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const n=[];for(const{id:i,url:r}of t){const t="".concat(i).concat(r);-1===n.indexOf(t)&&(n.push(t),e.push({id:i,url:r}))}}return e}function y(t,e,n){try{const i=new URL(t);return i.pathname+="".concat(e).concat(n),i.toString()}catch(e){throw new Error('Invalid sprite URL "'.concat(t,'", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically'))}}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class _ extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,promiseResolve:e}of this.requestors)e(this._getImagesForIds(t));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const t=n.spriteData;n.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),n.spriteData=null}return n}addImage(t,e){if(this.images[t])throw new Error("Image id ".concat(t," already exist, use updateImage instead"));this._validate(t,e)&&(this.images[t]=e)}_validate(t,n){let i=!0;const r=n.data||n.spriteData;return this._validateStretch(n.stretchX,r&&r.width)||(this.fire(new e.k(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),i=!1),this._validateStretch(n.stretchY,r&&r.height)||(this.fire(new e.k(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.k(new Error('Image "'.concat(t,'" has invalid "content" value')))),i=!1),i}_validateStretch(t,e){if(!t)return!0;let n=0;for(const i of t){if(i[0]<n||i[1]<i[0]||e<i[1])return!1;n=i[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const n=e.spriteData,i=n&&n.width||e.data.width,r=n&&n.height||e.data.height;return!(t[0]<0||i<t[0]||t[1]<0||r<t[1]||t[2]<0||i<t[2]||t[3]<0||r<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this.getImage(t);if(n&&(i.data.width!==e.data.width||i.data.height!==e.data.height))throw new Error("size mismatch between old image (".concat(i.data.width,"x").concat(i.data.height,") and new image (").concat(e.data.width,"x").concat(e.data.height,")."));e.version=i.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((e,n)=>{let i=!0;if(!this.isLoaded())for(const r of t)this.images[r]||(i=!1);this.isLoaded()||i?e(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:e})})}_getImagesForIds(t){const n={};for(const i of t){let t=this.getImage(i);t||(this.fire(new e.l("styleimagemissing",{id:i})),t=this.getImage(i)),t?n[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,textFitWidth:t.textFitWidth,textFitHeight:t.textFitHeight,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w('Image "'.concat(i,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}return n}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(t){const n=this.patterns[t],i=this.getImage(t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new e.I(n,i);this.patterns[t]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:n,h:i}=e.p(t),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const a in this.patterns){const{bin:t}=this.patterns[a],n=t.x+1,i=t.y+1,o=this.getImage(a).data,s=o.width,l=o.height;e.R.copy(o,r,{x:0,y:0},{x:n,y:i},{width:s,height:l}),e.R.copy(o,r,{x:0,y:l-1},{x:n,y:i-1},{width:s,height:1}),e.R.copy(o,r,{x:0,y:0},{x:n,y:i+l},{width:s,height:1}),e.R.copy(o,r,{x:s-1,y:0},{x:n-1,y:i},{width:1,height:l}),e.R.copy(o,r,{x:0,y:0},{x:n+s,y:i},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const t=this.getImage(n);t||e.w('Image with ID: "'.concat(n,'" was not found')),v(t)&&this.updateImage(n,t)}}}const x=1e20;function b(t,e,n,i,r,a,o,s,l){for(let c=e;c<e+i;c++)w(t,n*a+c,a,r,o,s,l);for(let c=n;c<n+r;c++)w(t,c*a+e,1,i,o,s,l)}function w(t,e,n,i,r,a,o){a[0]=0,o[0]=-x,o[1]=x,r[0]=t[e];for(let s=1,l=0,c=0;s<i;s++){r[s]=t[e+s*n];const i=s*s;do{const t=a[l];c=(r[s]-r[t]+i-t*t)/(s-t)/2}while(c<=o[l]&&--l>-1);l++,a[l]=s,o[l]=c,o[l+1]=x}for(let s=0,l=0;s<i;s++){for(;o[l+1]<s;)l++;const i=a[l],c=s-i;t[e+s*n]=r[i]+c*c}}class S{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return e._(this,void 0,void 0,function*(){const e=[];for(const r in t)for(const n of t[r])e.push(this._getAndCacheGlyphsPromise(r,n));const n=yield Promise.all(e),i={};for(const{stack:t,id:r,glyph:a}of n)i[t]||(i[t]={}),i[t][r]=a&&{id:a.id,bitmap:a.bitmap.clone(),metrics:a.metrics};return i})}_getAndCacheGlyphsPromise(t,n){return e._(this,void 0,void 0,function*(){let e=this.entries[t];e||(e=this.entries[t]={glyphs:{},requests:{},ranges:{}});let i=e.glyphs[n];if(void 0!==i)return{stack:t,id:n,glyph:i};if(i=this._tinySDF(e,t,n),i)return e.glyphs[n]=i,{stack:t,id:n,glyph:i};const r=Math.floor(n/256);if(256*r>65535)throw new Error("glyphs > 65535 not supported");if(e.ranges[r])return{stack:t,id:n,glyph:i};if(!this.url)throw new Error("glyphsUrl is not set");if(!e.requests[r]){const n=S.loadGlyphRange(t,r,this.url,this.requestManager);e.requests[r]=n}const a=yield e.requests[r];for(const t in a)this._doesCharSupportLocalGlyph(+t)||(e.glyphs[+t]=a[+t]);return e.ranges[r]=!0,{stack:t,id:n,glyph:a[n]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(/(?:[\u3006\u3007\u3021-\u3029\u3038-\u303A\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFA6D\uFA70-\uFAD9]|\uD81B[\uDFE4\uDFF2-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82C[\uDD70-\uDEFB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79])|[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|(?:[\u3041-\u3096\u309D-\u309F]|\uD82C[\uDC01-\uDD1F\uDD32\uDD50-\uDD52]|\uD83C\uDE00)|(?:[\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u32D0-\u32FE\u3300-\u3357\uFF66-\uFF6F\uFF71-\uFF9D]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00\uDD20-\uDD22\uDD55\uDD64-\uDD67])/.test(String.fromCodePoint(t))||e.u["CJK Unified Ideographs"](t)||e.u["Hangul Syllables"](t)||e.u.Hiragana(t)||e.u.Katakana(t)||e.u["CJK Symbols and Punctuation"](t)||e.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,n,i){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(i))return;let a=t.tinySDF;if(!a){let e="400";/bold/i.test(n)?e="900":/medium/i.test(n)?e="500":/light/i.test(n)&&(e="200"),a=t.tinySDF=new S.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:r,fontWeight:e})}const o=a.draw(String.fromCharCode(i));return{id:i,bitmap:new e.q({width:o.width||60,height:o.height||60},o.data),metrics:{width:o.glyphWidth/2||24,height:o.glyphHeight/2||24,left:o.glyphLeft/2+.5||0,top:o.glyphTop/2-27.5||-8,advance:o.glyphAdvance/2||24,isDoubleResolution:!0}}}}S.loadGlyphRange=function(t,n,i,r){return e._(this,void 0,void 0,function*(){const a=256*n,o=a+255,s=r.transformRequest(i.replace("{fontstack}",t).replace("{range}","".concat(a,"-").concat(o)),"Glyphs"),l=yield e.n(s,new AbortController);if(!l||!l.data)throw new Error("Could not load glyph range. range: ".concat(n,", ").concat(a,"-").concat(o));const c={};for(const t of e.o(l.data))c[t.id]=t;return c})},S.TinySDF=class{constructor(){let{fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:a="normal",fontStyle:o="normal",lang:s=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=e,this.cutoff=i,this.radius=n,this.lang=s;const l=this.size=t+4*e,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font="".concat(o," ").concat(a," ").concat(t,"px ").concat(r),u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:a}=this.ctx.measureText(t),o=Math.ceil(n),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(i)),c=s+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:e};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;this.lang&&(f.lang=this.lang),f.clearRect(m,m,s,l),f.fillText(t,m,m+o);const v=f.getImageData(m,m,s,l);y.fill(x,0,h),g.fill(0,0,h);for(let _=0;_<l;_++)for(let t=0;t<s;t++){const e=v.data[4*(_*s+t)+3]/255;if(0===e)continue;const n=(_+m)*c+t+m;if(1===e)y[n]=0,g[n]=x;else{const t=.5-e;y[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}b(y,0,0,c,u,c,this.f,this.v,this.z),b(g,m,m,s,l,c,this.f,this.v,this.z);for(let _=0;_<h;_++){const t=Math.sqrt(y[_])-Math.sqrt(g[_]);d[_]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class M{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,n){return e.B(t.expression.evaluate(n))}interpolate(t,n,i){return{x:e.C.number(t.x,n.x,i),y:e.C.number(t.y,n.y,i),z:e.C.number(t.z,n.z,i)}}}let T;class E extends e.E{constructor(t){super(),T=T||new e.r({anchor:new e.D(e.v.light.anchor),position:new M,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.t(T),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.x,t,n))for(const e in t){const n=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),n):this._transitionable.setValue(e,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.y(this,t.call(e.z,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.v}))}}const A=new e.r({"sky-color":new e.D(e.v.sky["sky-color"]),"horizon-color":new e.D(e.v.sky["horizon-color"]),"fog-color":new e.D(e.v.sky["fog-color"]),"fog-ground-blend":new e.D(e.v.sky["fog-ground-blend"]),"horizon-fog-blend":new e.D(e.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new e.D(e.v.sky["sky-horizon-blend"]),"atmosphere-blend":new e.D(e.v.sky["atmosphere-blend"])});class C extends e.E{constructor(t){super(),this._transitionable=new e.t(A),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.F(0))}setSky(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.G,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const e in t){const n=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),n):this._transitionable.setValue(e,n)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!1!==(null==i?void 0:i.validate)&&e.y(this,t.call(e.z,e.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class P{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]}getDashRanges(t,e,n){const i=[];let r=t.length%2==1?-t[t.length-1]*n:0,a=t[0]*n,o=!0;i.push({left:r,right:a,isDash:o,zeroLength:0===t[0]});let s=t[0];for(let l=1;l<t.length;l++){o=!o;const e=t[l];r=s*n,s+=e,a=s*n,i.push({left:r,right:a,isDash:o,zeroLength:0===e})}return i}addRoundDash(t,e,n){const i=e/2;for(let r=-n;r<=n;r++){const e=this.width*(this.nextRow+n+r);let a=0,o=t[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=t[++a]);const l=Math.abs(s-o.left),c=Math.abs(s-o.right),u=Math.min(l,c);let h;const d=r/n*(i+1);if(o.isDash){const t=i-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=i-Math.sqrt(u*u+d*d);this.data[e+s]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let o=t.length-1;o>=0;--o){const e=t[o],n=t[o+1];e.zeroLength?t.splice(o,1):n&&n.isDash===e.isDash&&(n.left=e.left,t.splice(o,1))}const e=t[0],n=t[t.length-1];e.isDash===n.isDash&&(e.left=n.left-this.width,n.right=e.right+this.width);const i=this.width*this.nextRow;let r=0,a=t[r];for(let o=0;o<this.width;o++){o/a.right>1&&(a=t[++r]);const e=Math.abs(o-a.left),n=Math.abs(o-a.right),s=Math.min(e,n);this.data[i+o]=Math.max(0,Math.min(255,(a.isDash?s:-s)+128))}}addDash(t,n){const i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return e.w("LineAtlas out of space"),null;let a=0;for(let e=0;e<t.length;e++)a+=t[e];if(0!==a){const e=this.width/a,r=this.getDashRanges(t,this.width,e);n?this.addRoundDash(r,e,i):this.addRegularDash(r)}const o={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:a};return this.nextRow+=r,this.dirty=!0,o}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}const I="maplibre_preloaded_worker_pool";class R{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<R.workerCount;)this.workers.push(new Worker(e.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[I]}numActive(){return Object.keys(this.active).length}}const k=Math.floor(o.hardwareConcurrency/2);let L,D;function z(){return L||(L=new R),L}R.workerCount=e.H(globalThis)?Math.max(Math.min(k,3),1):1;class N{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const i=this.workerPool.acquire(n);for(let r=0;r<i.length;r++){const t=new e.J(i[r],n);t.name="Worker ".concat(r),this.actors.push(t)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,e){const n=[];for(const i of this.actors)n.push(i.sendAsync({type:t,data:e}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.actors.forEach(t=>{t.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,e){for(const n of this.actors)n.registerMessageHandler(t,e)}}function O(){return D||(D=new N(z(),e.K),D.registerMessageHandler("GR",(t,n,i)=>e.m(n,i))),D}function F(t,n){const i=e.L();return e.M(i,i,[1,1,0]),e.N(i,i,[.5*t.width,.5*t.height,1]),t.calculatePosMatrix?e.O(i,i,t.calculatePosMatrix(n.toUnwrapped())):i}function B(t,e,n,i,r,a,o){var s;const l=function(t,e,n){if(t)for(const i of t){const t=e[i];if(t&&t.source===n&&"fill-extrusion"===t.type)return!0}else for(const i in e){const t=e[i];if(t.source===n&&"fill-extrusion"===t.type)return!0}return!1}(null!==(s=null==r?void 0:r.layers)&&void 0!==s?s:null,e,t.id),c=a.maxPitchScaleFactor(),u=t.tilesIn(i,c,l);u.sort(U);const h=[];for(const d of u)h.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(e,n,t._state,d.queryGeometry,d.cameraQueryGeometry,d.scale,r,a,c,F(t.transform,d.tileID),o?(t,e)=>o(d.tileID,t,e):void 0)});return function(t,e){for(const n in t)for(const i of t[n])j(i,e);return t}(function(t){const e={},n={};for(const i of t){const t=i.queryResults,r=i.wrappedTileID,a=n[r]=n[r]||{};for(const n in t){const i=t[n],r=a[n]=a[n]||{},o=e[n]=e[n]||[];for(const t of i)r[t.featureIndex]||(r[t.featureIndex]=!0,o.push(t))}}return e}(h),t)}function U(t,e){const n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function j(t,e){const n=t.feature,i=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}function V(t,n,i){return e._(this,void 0,void 0,function*(){let r=t;if(t.url?r=(yield e.j(n.transformRequest(t.url,"Source"),i)).data:yield o.frameAsync(i),!r)return null;const a=e.Q(e.e(r,t),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in r&&r.vector_layers&&(a.vectorLayerIds=r.vector_layers.map(t=>t.id)),a})}class H{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof e.S?new e.S(t.lng,t.lat):e.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.S?new e.S(t.lng,t.lat):e.S.convert(t),this}extend(t){const n=this._sw,i=this._ne;let r,a;if(t instanceof e.S)r=t,a=t;else{if(!(t instanceof H))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(H.convert(t)):this.extend(e.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(e.S.convert(t)):this;if(r=t._sw,a=t._ne,!r||!a)return this}return n||i?(n.lng=Math.min(r.lng,n.lng),n.lat=Math.min(r.lat,n.lat),i.lng=Math.max(a.lng,i.lng),i.lat=Math.max(a.lat,i.lat)):(this._sw=new e.S(r.lng,r.lat),this._ne=new e.S(a.lng,a.lat)),this}getCenter(){return new e.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.S(this.getWest(),this.getNorth())}getSouthEast(){return new e.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:i}=e.S.convert(t);let r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(t){return t instanceof H?t:t?new H(t):t}static fromLngLat(t){const n=360*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/40075017,i=n/Math.cos(Math.PI/180*t.lat);return new H(new e.S(t.lng-i,t.lat-n),new e.S(t.lng+i,t.lat+n))}adjustAntiMeridian(){const t=new e.S(this._sw.lng,this._sw.lat),n=new e.S(this._ne.lng,this._ne.lat);return new H(t,t.lng>n.lng?new e.S(n.lng+360,n.lat):n)}}class G{constructor(t,e,n){this.bounds=H.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),i=Math.floor(e.V(this.bounds.getWest())*n),r=Math.floor(e.U(this.bounds.getNorth())*n),a=Math.ceil(e.V(this.bounds.getEast())*n),o=Math.ceil(e.U(this.bounds.getSouth())*n);return t.x>=i&&t.x<a&&t.y>=r&&t.y<o}}class W extends e.E{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.Q(n,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return e._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(e.e(this,t),t.bounds&&(this.tileBounds=new G(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return e.e({},this._options)}loadTile(t){return e._(this,void 0,void 0,function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(e,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};n.request.collectResourceTiming=this._collectResourceTiming;let i="RT";if(t.actor&&"expired"!==t.state){if("loading"===t.state)return new Promise((e,n)=>{t.reloadPromise={resolve:e,reject:n}})}else t.actor=this.dispatcher.getActor(),i="LT";t.abortController=new AbortController;try{const e=yield t.actor.sendAsync({type:i,data:n},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,e)}catch(e){if(delete t.abortController,t.aborted)return;if(e&&404!==e.status)throw e;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,e){if(e&&e.resourceTiming&&(t.resourceTiming=e.resourceTiming),e&&this.map._refreshExpiredTiles&&t.setExpiryData(e),t.loadVectorData(e,this.map.painter),t.reloadPromise){const e=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(e.resolve).catch(e.reject)}}abortTile(t){return e._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return e._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class q extends e.E{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},n),e.e(this,e.Q(n,["url","scheme","tileSize"]))}load(){return e._(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function*(){t._loaded=!1,t.fire(new e.l("dataloading",{dataType:"source"})),t._tileJSONRequest=new AbortController;try{const i=yield V(t._options,t.map._requestManager,t._tileJSONRequest);t._tileJSONRequest=null,t._loaded=!0,i&&(e.e(t,i),i.bounds&&(t.tileBounds=new G(i.bounds,t.minzoom,t.maxzoom)),t.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:n})))}catch(n){t._tileJSONRequest=null,t.fire(new e.k(n))}}()})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return e.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return e._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const i=yield f.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const n=this.map.painter.context,r=n.gl,a=i.data;t.texture=this.map.painter.getTileTexture(a.width),t.texture?t.texture.update(a,{useMipmap:!0}):(t.texture=new e.T(n,a,r.RGBA,{useMipmap:!0}),t.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}})}abortTile(t){return e._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return e._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Z extends q{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return e._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const n=yield f.getImage(i,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(n&&n.data){const i=n.data;this.map._refreshExpiredTiles&&(n.cacheControl||n.expires)&&t.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const r=e.b(i)&&e.W()?i:yield this.readImageNow(i),a={type:this.type,uid:t.uid,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||"expired"===t.state){t.actor=this.dispatcher.getActor();const e=yield t.actor.sendAsync({type:"LDT",data:a});t.dem=e,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}})}readImageNow(t){return e._(this,void 0,void 0,function*(){if("undefined"!=typeof VideoFrame&&e.X()){const n=t.width+2,i=t.height+2;try{return new e.R({width:n,height:i},yield e.Y(t,-1,-1,n,i))}catch(t){}}return o.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,a=0===n.x?t.wrap-1:t.wrap,o=(n.x+1+i)%i,s=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.Z(t.overscaledZ,a,n.z,r,n.y).key]={backfilled:!1},l[new e.Z(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(l[new e.Z(t.overscaledZ,a,n.z,r,n.y-1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.Z(t.overscaledZ,a,n.z,r,n.y+1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.Z(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),l}unloadTile(t){return e._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class X extends e.E{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.e({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,void 0!==n.clusterMaxZoom&&this.maxzoom<=n.clusterMaxZoom&&e.w('The maxzoom value "'.concat(this.maxzoom,'" is expected to be greater than the clusterMaxZoom value "').concat(n.clusterMaxZoom,'".')),this.workerOptions=e.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==n.buffer?n.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==n.tolerance?n.tolerance:.375),extent:e.$,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.$,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(e.$/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||void 0===t||e.w("Integer expected for option 'clusterMaxZoom': provided value \"".concat(t,'" rounded to "').concat(n,'"')),n}load(){return e._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._pendingWorkerUpdate={data:t},this._updateWorkerData(),this}updateData(t){return this._pendingWorkerUpdate.diff=e.a0(this._pendingWorkerUpdate.diff,t),this._updateWorkerData(),this}getData(){return e._(this,void 0,void 0,function*(){const t=e.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return"GeometryCollection"===t.type?t.geometries.map(t=>t.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return e._(this,void 0,void 0,function*(){const t=new H,e=yield this.getData();let n;switch(e.type){case"FeatureCollection":n=e.features.map(t=>this.getCoordinatesFromGeometry(t.geometry)).flat(1/0);break;case"Feature":n=this.getCoordinatesFromGeometry(e.geometry);break;default:n=this.getCoordinatesFromGeometry(e)}if(0==n.length)return t;for(let i=0;i<n.length-1;i+=2)t.extend([n[i],n[i+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,e,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:e,offset:n}})}_updateWorkerData(){return e._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;const{data:t,diff:n}=this._pendingWorkerUpdate;if(!t&&!n)return void e.w("No data or diff provided to GeoJSONSource ".concat(this.id,"."));const i=e.e({type:this.type},this.workerOptions);t?("string"==typeof t?(i.request=this.map._requestManager.transformRequest(o.resolveURL(t),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(t),this._pendingWorkerUpdate.data=void 0):n&&(i.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new e.l("dataloading",{dataType:"source"}));try{const t=yield this.actor.sendAsync({type:"LD",data:i});if(this._isUpdatingWorker=!1,this._removed||t.abandoned)return void this.fire(new e.l("dataabort",{dataType:"source"}));this._data=t.data;let n=null;t.resourceTiming&&t.resourceTiming[this.id]&&(n=t.resourceTiming[this.id].slice(0));const r={dataType:"source"};this._collectResourceTiming&&n&&n.length>0&&e.e(r,{resourceTiming:n}),this.fire(new e.l("data",Object.assign(Object.assign({},r),{sourceDataType:"metadata"}))),this.fire(new e.l("data",Object.assign(Object.assign({},r),{sourceDataType:"content"})))}catch(t){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new e.l("dataabort",{dataType:"source"}));this.fire(new e.k(t))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&void 0===this._pendingWorkerUpdate.data&&void 0===this._pendingWorkerUpdate.diff}loadTile(t){return e._(this,void 0,void 0,function*(){const e=t.actor?"RT":"LT";t.actor=this.actor;const n={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const i=yield this.actor.sendAsync({type:e,data:n},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(i,this.map.painter,"RT"===e)})}abortTile(t){return e._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return e._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Y extends e.E{constructor(t,e,n,i){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=e}load(t){return e._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const e=yield f.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,e&&e.data&&(this.image=e.data,t&&(this.coordinates=t),this._finishLoading())}catch(t){this._request=null,this._loaded=!0,this.fire(new e.k(t))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(e.a1.fromLngLat);var i;return this.tileID=function(t){const n=e.a2.fromPoints(t),i=n.width(),r=n.height(),a=Math.max(i,r),o=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),s=Math.pow(2,o);return new e.a4(o,Math.floor((n.minX+n.maxX)/2*s),Math.floor((n.minY+n.maxY)/2*s))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(t=>this.tileID.getTilePoint(t)._round()),this.flippedWindingOrder=((i=this.tileCoords)[1].x-i[0].x)*(i[2].y-i[0].y)-(i[1].y-i[0].y)*(i[2].x-i[0].x)<0,this.fire(new e.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new e.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return e._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:i,maxX:r,maxY:a}=e.a2.fromPoints(t),o={};for(let s=0;s<=e.a3;s++){const t=Math.pow(2,s),e=Math.floor(n*t),l=Math.floor(i*t),c=Math.floor(r*t),u=Math.floor(a*t);o[s]={minTileX:e,minTileY:l,maxTileX:c,maxTileY:u}}return o}}class K extends Y{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){return e._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,"Source").url);try{const t=yield e.a5(this.urls);if(this._loaded=!0,!t)return;this.video=t,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(t){this.fire(new e.k(t))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.k(new e.a6("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class J extends Y{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new e.k(new e.a6("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.k(new e.a6("sources.".concat(t),null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.k(new e.a6("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new e.k(new e.a6("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.k(new e.a6("sources.".concat(t),null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){return e._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(n,this.canvas,i.RGBA,{premultiply:!0});let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const $={},Q=t=>{switch(t){case"geojson":return X;case"image":return Y;case"raster":return q;case"raster-dem":return Z;case"vector":return W;case"video":return K;case"canvas":return J}return $[t]},tt="RTLPluginLoaded";class et extends e.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=O()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(t=>{throw this.status="error",t})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return e._(this,arguments,void 0,function(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){if(e.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(e.url=o.resolveURL(t),!e.url)throw new Error("requested url ".concat(t," is invalid"));if("unavailable"===e.status){if(!n)return e._requestImport();e.status="deferred",e._syncState(e.status)}else if("requested"===e.status)return e._requestImport()}()})}_requestImport(){return e._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new e.l(tt))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let nt=null;function it(){return nt||(nt=new et),nt}class rt{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a7(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const n={};if(!e)return n;for(const i of t){const t=i.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){i.layers=t,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)n[e.id]=i}}return n}(t.buckets,null==n?void 0:n.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.a9){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const n=this.buckets[t];if(n instanceof e.a9&&n.hasRTLText){this.hasRTLText=!0,it().lazyLoad();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(t).queryRadius(e))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a8}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const n=this.buckets[e];n.uploadPending()&&n.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new e.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,n,i,r,a,o,s,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:a,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:o,queryPadding:this.queryPadding*l,getElevation:u},t,e,n):{}}querySourceFeatures(t,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),a=n&&n.sourceLayer?n.sourceLayer:"",o=r._geojsonTileLayer||r[a];if(!o)return;const s=e.aa(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let d=0;d<o.length;d++){const n=o.feature(d);if(s.needGeometry){const t=e.ab(n,!0);if(!s.filter(new e.F(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new e.F(this.tileID.overscaledZ),n))continue;const r=i.getId(n,a),p=new e.ac(n,l,c,u,r);p.tile=h,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const n=e.ad(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(n)if(this.expirationTime<n)e=!0;else{const i=this.expirationTime-n;i?this.expirationTime=t+Math.max(i,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!e.style.hasLayer(i))continue;const r=this.buckets[i],a=r.layers[0].sourceLayer||"_geojsonTileLayer",o=n[a],s=t[a];if(!o||!s||0===Object.keys(s).length)continue;r.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.now()+t}setDependencies(t,e){const n={};for(const i of e)n[i]=!0;this.dependencies[t]=n}hasDependency(t,e){for(const n of t){const t=this.dependencies[n];if(t)for(const n of e)if(t[n])return!0}return!1}}class at{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,n){const i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:e,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout(()=>{this.remove(t,r)},n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const n in this.data)for(const i of this.data[n])t(i.value)||e.push(i);for(const n of e)this.remove(n.value.tileID,n)}}class ot{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,i){const r=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.e(this.stateChanges[t][r],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])i[e]||(this.deletedStates[t][r][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(t,e,n){if(null===this.deletedStates[t])return;const i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}getState(t,n){const i=String(n),r=e.e({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][n];if(null===e)return{};for(const t in e)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,n){const i={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const t={};for(const n in this.stateChanges[r])this.state[r][n]||(this.state[r][n]={}),e.e(this.state[r][n],this.stateChanges[r][n]),t[n]=this.state[r][n];i[r]=t}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const t={};if(null===this.deletedStates[r])for(const e in this.state[r])t[e]={},this.state[r][e]={};else for(const e in this.deletedStates[r]){if(null===this.deletedStates[r][e])this.state[r][e]={};else for(const t of Object.keys(this.deletedStates[r][e]))delete this.state[r][e][t];t[e]=this.state[r][e]}i[r]=i[r]||{},e.e(i[r],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const e in t)t[e].setFeatureState(i,n)}}const st=89.25;function lt(t,n){const i=e.ah(n.lat,-e.ai,e.ai);return new e.P(e.V(n.lng)*t,e.U(i)*t)}function ct(t,n){return new e.a1(n.x/t,n.y/t).toLngLat()}function ut(t){return t.cameraToCenterDistance*Math.min(.85*Math.tan(e.ae(90-t.pitch)),Math.tan(e.ae(st-t.pitch)))}function ht(t,n){const i=t.canonical,r=n/e.af(i.z),a=i.x+Math.pow(2,i.z)*t.wrap,o=e.ag(new Float64Array(16));return e.M(o,o,[a*r,i.y*r,0]),e.N(o,o,[r/e.$,r/e.$,1]),o}function dt(t,n,i,r,a){const o=e.a1.fromLngLat(t,n),s=a*e.aj(1,t.lat),l=s*Math.cos(e.ae(i)),c=Math.sqrt(s*s-l*l),u=c*Math.sin(e.ae(-r)),h=c*Math.cos(e.ae(-r));return new e.a1(o.x+u,o.y+h,o.z+l)}function pt(t,e,n){const i=e.intersectsFrustum(t);if(!n||0===i)return i;const r=e.intersectsPlane(n);return 0===r?0:2===i&&2===r?2:1}function ft(t,e,n){let i=0;const r=(n-e)/10;for(let a=0;a<10;a++)i+=r*Math.pow(Math.cos(e+(a+.5)/10*(n-e)),t);return i}function mt(t,n){return function(i,r,a,o,s){const l=2*((t-1)/e.ak(Math.cos(e.ae(st-s))/Math.cos(e.ae(st)))-1),c=Math.acos(a/o),u=2*ft(l-1,0,e.ae(s/2)),h=Math.min(e.ae(st),c+e.ae(s/2)),d=ft(l-1,Math.min(h,c-e.ae(s/2)),h),p=Math.atan(r/a),f=Math.hypot(r,a);let m=i;return m+=e.ak(o/f/Math.max(.5,Math.cos(e.ae(s/2)))),m+=l*e.ak(Math.cos(p))/2,m-=e.ak(Math.max(1,d/u/n))/2,m}}const gt=mt(9.314,3);function yt(t,n){const i=(n.roundZoom?Math.round:Math.floor)(t.zoom+e.ak(t.tileSize/n.tileSize));return Math.max(0,i)}function vt(t,n){const i=t.getCameraFrustum(),r=t.getClippingPlane(),a=t.screenPointToMercatorCoordinate(t.getCameraPoint()),o=e.a1.fromLngLat(t.center,t.elevation);a.z=o.z+Math.cos(t.pitchInRadians)*t.cameraToCenterDistance/t.worldSize;const s=t.getCoveringTilesDetailsProvider(),l=s.allowVariableZoom(t,n),c=yt(t,n),u=n.minzoom||0,h=void 0!==n.maxzoom?n.maxzoom:t.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*a.x,p*a.y,0],m=[p*o.x,p*o.y,0],g=Math.hypot(o.x-a.x,o.y-a.y),y=Math.abs(o.z-a.z),v=Math.hypot(g,y),_=t=>({zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),x=[],b=[];if(t.renderWorldCopies&&s.allowWorldCopies())for(let e=1;e<=3;e++)x.push(_(-e)),x.push(_(e));for(x.push(_(0));x.length>0;){const p=x.pop(),g=p.x,_=p.y;let w=p.fullyVisible;const S={x:g,y:_,z:p.zoom},M=s.getTileBoundingVolume(S,p.wrap,t.elevation,n);if(!w){const t=pt(i,M,r);if(0===t)continue;w=2===t}const T=s.distanceToTile2d(a.x,a.y,S,M);let E=c;l&&(E=(n.calculateTileZoom||gt)(t.zoom+e.ak(t.tileSize/n.tileSize),T,y,v,t.fov)),E=(n.roundZoom?Math.round:Math.floor)(E),E=Math.max(0,E);const A=Math.min(E,h);if(p.wrap=s.getWrap(o,S,p.wrap),p.zoom>=A){if(p.zoom<u)continue;const t=d-p.zoom,i=f[0]-.5-(g<<t),r=f[1]-.5-(_<<t),a=n.reparseOverscaled?Math.max(p.zoom,E):p.zoom;b.push({tileID:new e.Z(p.zoom===h?a:p.zoom,p.wrap,p.zoom,g,_),distanceSq:e.al([m[0]-.5-g,m[1]-.5-_]),tileDistanceToCamera:Math.sqrt(i*i+r*r)})}else for(let t=0;t<4;t++)x.push({zoom:p.zoom+1,x:(g<<1)+t%2,y:(_<<1)+(t>>1),wrap:p.wrap,fullyVisible:w})}return b.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}const _t=e.a2.fromPoints([new e.P(0,0),new e.P(e.$,e.$)]);class xt extends e.E{constructor(t,e,n){super(),this.id=t,this.dispatcher=n,this.on("data",t=>this._dataHandler(t)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((t,e,n,i)=>{const r=new(Q(e.type))(t,e,n,i);if(r.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(r.id));return r})(t,e,n,this),this._tiles={},this._cache=new at(0,t=>this._unloadTile(t)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ot,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,i){return e._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,i)}catch(n){t.state="errored",404!==n.status?this._source.fire(new e.k(n,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new e.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(bt).map(t=>t.key)}getRenderableIds(t){const n=[];for(const e in this._tiles)this._isIdRenderable(e,t)&&n.push(this._tiles[e]);return t?n.sort((t,n)=>{const i=t.tileID,r=n.tileID,a=new e.P(i.canonical.x,i.canonical.y)._rotate(-this.transform.bearingInRadians),o=new e.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians);return i.overscaledZ-r.overscaledZ||o.y-a.y||o.x-a.x}).map(t=>t.tileID.key):n.map(t=>t.tileID).sort(bt).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)t?this._reloadTile(e,"expired"):"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading")}}_reloadTile(t,n){return e._(this,void 0,void 0,function*(){const e=this._tiles[t];e&&("loading"!==e.state&&(e.state=n),yield this._loadTile(e,t,n))})}_tileLoaded(t,n,i){t.timeAdded=o.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let i=0;i<e.length;i++){const r=e[i];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);n(t,e),n(e,t)}}function n(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let n=e.tileID.canonical.x-t.tileID.canonical.x;const i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,n,i){for(const r in this._tiles){let a=this._tiles[r];if(i[r]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>n)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>e+1;){const t=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[t.key],a&&a.hasData()&&(o=t)}let s=o;for(;s.overscaledZ>e;)if(s=s.scaledTo(s.overscaledZ-1),t[s.key]||t[s.canonical.key]){i[o.key]=o;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(let n=t.overscaledZ-1;n>=e;n--){const e=t.scaledTo(n),i=this._getLoadedTile(e);if(i)return i}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,i=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(n*i*(null===this._maxTileCacheZoomLevels?e.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(a)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),t[i.tileID.key]=i}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}_updateCoveredAndRetainedTiles(t,e,n,i,r,a){const s={},l={},c=Object.keys(t),u=o.now();for(const o of c){const n=t[o],i=this._tiles[o];if(!i||0!==i.fadeEndTime&&i.fadeEndTime<=u)continue;const r=this.findLoadedParent(n,e),a=this.findLoadedSibling(n),c=r||a||null;c&&(this._addTile(c.tileID),s[c.tileID.key]=c.tileID),l[o]=n}this._retainLoadedChildren(l,i,n,t);for(const o in s)t[o]||(this._coveredTiles[o]=!0,t[o]=s[o]);if(a){const e={},n={};for(const t of r)this._tiles[t.key].hasData()?e[t.key]=t:n[t.key]=t;for(const i in n){const r=n[i].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(e[r[0].key]=t[r[0].key]=r[0],e[r[1].key]=t[r[1].key]=r[1],e[r[2].key]=t[r[2].key]=r[2],e[r[3].key]=t[r[3].key]=r[3],delete n[i])}for(const i in n){const r=n[i],a=this.findLoadedParent(r,this._source.minzoom),o=this.findLoadedSibling(r),s=a||o||null;if(s){e[s.tileID.key]=t[s.tileID.key]=s.tileID;for(const t in e)e[t].isChildOf(s.tileID)&&delete e[t]}}for(const t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}update(t,n){if(!this._sourceLoaded||this._paused)return;let i;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.Z(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(i=vt(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(i=i.filter(t=>this._source.hasTile(t)))):i=[];const r=yt(t,this._source),a=Math.max(r-xt.maxOverzooming,this._source.minzoom),o=Math.max(r+xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of i)if(e.canonical.z>this._source.minzoom){const n=e.scaledTo(e.canonical.z-1);t[n.key]=n;const i=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[i.key]=i}i=i.concat(Object.values(t))}const s=0===i.length&&!this._updated&&this._didEmitContent;this._updated=!0,s&&this.fire(new e.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(i,r);wt(this._source.type)&&this._updateCoveredAndRetainedTiles(l,a,o,r,i,n);for(const e in l)this._tiles[e].clearFadeHold();const c=e.am(this._tiles,l);for(const e of c){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){var n;const i={},r={},a=Math.max(e-xt.maxOverzooming,this._source.minzoom),o=Math.max(e+xt.maxUnderzooming,this._source.minzoom),s={};for(const l of t){const t=this._addTile(l);i[l.key]=l,t.hasData()||e<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,e,o,i);for(const l of t){let t=this._tiles[l.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=l.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){i[t.key]=t;continue}}else{const t=l.children(this._source.maxzoom);if(i[t[0].key]&&i[t[1].key]&&i[t[2].key]&&i[t[3].key])continue}let o=t.wasRequested();for(let e=l.overscaledZ-1;e>=a;--e){const a=l.scaledTo(e);if(r[a.key])break;if(r[a.key]=!0,t=this.getTile(a),!t&&o&&(t=this._addTile(a)),t){const e=t.hasData();if((e||!(null===(n=this.map)||void 0===n?void 0:n.cancelPendingTileRequestsWhileZooming)||o)&&(i[a.key]=a),o=t.wasRequested(),e)break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let n,i=this._tiles[t].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}e.push(i.key);const t=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(t),n)break;i=t}for(const t of e)this._loadedParentTiles[t]=n}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const e=this._tiles[t].tileID,n=this._getLoadedTile(e);this._loadedSiblingTiles[e.key]=n}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const i=n;return n||(n=new rt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._tiles[t.key]=n,i||this._source.fire(new e.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},n))}refreshTiles(t){for(const e in this._tiles)(this._isIdRenderable(e)||"errored"==this._tiles[e].state)&&t.some(t=>t.equals(this._tiles[e].tileID.canonical))&&this._reloadTile(e,"expired")}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}_dataHandler(t){const e=t.sourceDataType;"source"===t.dataType&&"metadata"===e&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===e&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,i){const r=[],a=this.transform;if(!a)return r;const o=a.getCoveringTilesDetailsProvider().allowWorldCopies(),s=i?a.getCameraQueryGeometry(t):t,l=t=>a.screenPointToMercatorCoordinate(t,this.terrain),c=this.transformBbox(t,l,!o),u=this.transformBbox(s,l,!o),h=this.getIds(),d=e.a2.fromPoints(u);for(let p=0;p<h.length;p++){const t=this._tiles[h[p]];if(t.holdingForFade())continue;const i=o?[t.tileID]:[t.tileID.unwrapTo(-1),t.tileID.unwrapTo(0)],s=Math.pow(2,a.zoom-t.tileID.overscaledZ),l=n*t.queryPadding*e.$/t.tileSize/s;for(const n of i){const i=d.map(t=>n.getTilePoint(new e.a1(t.x,t.y)));if(i.expandBy(l),i.intersects(_t)){const e=c.map(t=>n.getTilePoint(t)),i=u.map(t=>n.getTilePoint(t));r.push({tile:t,tileID:o?n:n.unwrapTo(0),queryGeometry:e,cameraQueryGeometry:i,scale:s})}}}return r}transformBbox(t,n,i){let r=t.map(n);if(i){const i=e.a2.fromPoints(t);i.shrinkBy(.001*Math.min(i.width(),i.height()));const a=i.map(n);e.a2.fromPoints(r).covers(a)||(r=r.map(t=>t.x>.5?new e.a1(t.x-1,t.y,t.z):t))}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);return this.transform&&this.transform.populateCache(e),e}hasTransition(){if(this._source.hasTransition())return!0;if(wt(this._source.type)){const t=o.now();for(const e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)}removeFeatureState(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,n){const i=this._tiles[t];i&&i.setDependencies(e,n)}reloadTilesForDependencies(t,e){for(const n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter(n=>!n.hasDependency(t,e))}}function bt(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function wt(t){return"raster"===t||"image"===t||"video"===t}xt.maxOverzooming=10,xt.maxUnderzooming=3;class St{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ah(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const a=n-1,o=this._distances[a],s=i-o,l=s>0?(r-o)/s:0;return this.points[a].mult(1-l).add(this.points[n].mult(l))}}function Mt(t,e){let n=!0;return"always"===t||"never"!==t&&"never"!==e||(n=!1),n}class Tt{constructor(t,e,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(let a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)}_insertBoxCell(t,e,n,i,r,a){this.boxCells[r].push(a)}_insertCircleCell(t,e,n,i,r,a){this.circleCells[r].push(a)}_query(t,e,n,i,r,a,o){if(n<0||t>this.width||i<0||e>this.height)return[];const s=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return[{key:null,x1:t,y1:e,x2:n,y2:i}];for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],n=this.circles[3*t+1],i=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-i,y1:n-i,x2:e+i,y2:n+i})}}else this._forEachCell(t,e,n,i,this._queryCell,s,{hitTest:r,overlapMode:a,seenUids:{box:{},circle:{}}},o);return s}query(t,e,n,i){return this._query(t,e,n,i,!1,null)}hitTest(t,e,n,i,r,a){return this._query(t,e,n,i,!0,r,a).length>0}hitTestCircle(t,e,n,i,r){const a=t-n,o=t+n,s=e-n,l=e+n;if(o<0||a>this.width||l<0||s>this.height)return!1;const c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(t,e,n,i,r,a,o,s){const{seenUids:l,hitTest:c,overlapMode:u}=o,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const o of h)if(!l.box[o]){l.box[o]=!0;const h=4*o,d=this.boxKeys[o];if(t<=r[h+2]&&e<=r[h+3]&&n>=r[h+0]&&i>=r[h+1]&&(!s||s(d))&&(!c||!Mt(u,d.overlapMode))&&(a.push({key:d,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const o of d)if(!l.circle[o]){l.circle[o]=!0;const h=3*o,d=this.circleKeys[o];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],t,e,n,i)&&(!s||s(d))&&(!c||!Mt(u,d.overlapMode))){const t=r[h],e=r[h+1],n=r[h+2];if(a.push({key:d,x1:t-n,y1:e-n,x2:t+n,y2:e+n}),c)return!0}}}return!1}_queryCellCircle(t,e,n,i,r,a,o,s){const{circle:l,seenUids:c,overlapMode:u}=o,h=this.boxCells[r];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const n=4*e,i=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[n+0],t[n+1],t[n+2],t[n+3])&&(!s||s(i))&&!Mt(u,i.overlapMode))return a.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const t=this.circles;for(const e of d)if(!c.circle[e]){c.circle[e]=!0;const n=3*e,i=this.circleKeys[e];if(this._circlesCollide(t[n],t[n+1],t[n+2],l.x,l.y,l.radius)&&(!s||s(i))&&!Mt(u,i.overlapMode))return a.push(!0),!0}}}_forEachCell(t,e,n,i,r,a,o,s){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,t,e,n,i,this.xCellCount*l+d,a,o,s))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,n,i,r,a){const o=i-t,s=r-e,l=n+a;return l*l>o*o+s*s}_circleAndRectCollide(t,e,n,i,r,a,o){const s=(a-i)/2,l=Math.abs(t-(i+s));if(l>s+n)return!1;const c=(o-r)/2,u=Math.abs(e-(r+c));if(u>c+n)return!1;if(l<=s||u<=c)return!0;const h=l-s,d=u-c;return h*h+d*d<=n*n}}function Et(t,n,r){const a=e.L();if(!t){const{vecSouth:t,vecEast:e}=Ct(n),r=i();r[0]=e[0],r[1]=e[1],r[2]=t[0],r[3]=t[1],o=r,(d=(l=(s=r)[0])*(h=s[3])-(u=s[2])*(c=s[1]))&&(o[0]=h*(d=1/d),o[1]=-c*d,o[2]=-u*d,o[3]=l*d),a[0]=r[0],a[1]=r[1],a[4]=r[2],a[5]=r[3]}var o,s,l,c,u,h,d;return e.N(a,a,[1/r,1/r,1]),a}function At(t,n,i,r){if(t){const t=e.L();if(!n){const{vecSouth:e,vecEast:n}=Ct(i);t[0]=n[0],t[1]=n[1],t[4]=e[0],t[5]=e[1]}return e.N(t,t,[r,r,1]),t}return i.pixelsToClipSpaceMatrix}function Ct(t){const n=Math.cos(t.rollInRadians),i=Math.sin(t.rollInRadians),r=Math.cos(t.pitchInRadians),a=Math.cos(t.bearingInRadians),o=Math.sin(t.bearingInRadians),s=e.ar();s[0]=-a*r*i-o*n,s[1]=-o*r*i+a*n;const l=e.as(s);l<1e-9?e.at(s):e.au(s,s,1/l);const c=e.ar();c[0]=a*r*n-o*i,c[1]=o*r*n+a*i;const u=e.as(c);return u<1e-9?e.at(c):e.au(c,c,1/u),{vecEast:c,vecSouth:s}}function Pt(t,n,i,r){let a;r?(a=[t,n,r(t,n),1],e.aw(a,a,i)):(a=[t,n,0,1],qt(a,a,i));const o=a[3];return{point:new e.P(a[0]/o,a[1]/o),signedDistanceFromCamera:o,isOccluded:!1}}function It(t,e){return.5+t/e*.5}function Rt(t,e){return t.x>=-e[0]&&t.x<=e[0]&&t.y>=-e[1]&&t.y<=e[1]}function kt(t,n,i,r,a,o,s,l,c,u,h,d,p){const f=i?t.textSizeData:t.iconSizeData,m=e.an(f,n.transform.zoom),g=[256/n.width*2+1,256/n.height*2+1],y=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;y.clear();const v=t.lineVertexArray,_=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b=!1;for(let w=0;w<_.length;w++){const i=_.get(w);if(i.hidden||i.writingMode===e.ao.vertical&&!b){Wt(i.numGlyphs,y);continue}b=!1;const S=new e.P(i.anchorX,i.anchorY),M={getElevation:p,pitchedLabelPlaneMatrix:r,lineVertexArray:v,pitchWithMap:o,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:S,unwrappedTileID:c,width:u,height:h,translation:d},T=Ut(i.anchorX,i.anchorY,M);if(!Rt(T.point,g)){Wt(i.numGlyphs,y);continue}const E=It(n.transform.cameraToCenterDistance,T.signedDistanceFromCamera),A=e.ap(f,m,i),C=o?A*n.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,c)/E:A*E,P=zt({projectionContext:M,pitchedLabelPlaneMatrixInverse:a,symbol:i,fontSize:C,flip:!1,keepUpright:s,glyphOffsetArray:t.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l});b=P.useVertical,(P.notEnoughRoom||b||P.needsFlipping&&zt({projectionContext:M,pitchedLabelPlaneMatrixInverse:a,symbol:i,fontSize:C,flip:!0,keepUpright:s,glyphOffsetArray:t.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l}).notEnoughRoom)&&Wt(i.numGlyphs,y)}i?t.text.dynamicLayoutVertexBuffer.updateData(y):t.icon.dynamicLayoutVertexBuffer.updateData(y)}function Lt(t,e,n,i,r,a,o,s){const l=a.glyphStartIndex+a.numGlyphs,c=a.lineStartIndex,u=a.lineStartIndex+a.lineLength,h=e.getoffsetX(a.glyphStartIndex),d=e.getoffsetX(l-1),p=Ht(t*h,n,i,r,a.segment,c,u,s,o);if(!p)return null;const f=Ht(t*d,n,i,r,a.segment,c,u,s,o);return f?s.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function Dt(t,n,i,r){return t===e.ao.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(t===e.ao.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function zt(t){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:i,symbol:r,fontSize:a,flip:o,keepUpright:s,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=t,d=a/24,p=r.lineOffsetX*d,f=r.lineOffsetY*d;let m;if(r.numGlyphs>1){const t=r.glyphStartIndex+r.numGlyphs,e=r.lineStartIndex,a=r.lineStartIndex+r.lineLength,c=Lt(d,l,p,f,o,r,h,n);if(!c)return{notEnoughRoom:!0};const g=Bt(c.first.point.x,c.first.point.y,n,i),y=Bt(c.last.point.x,c.last.point.y,n,i);if(s&&!o){const t=Dt(r.writingMode,g,y,u);if(t)return t}m=[c.first];for(let i=r.glyphStartIndex+1;i<t-1;i++){const t=Ht(d*l.getoffsetX(i),p,f,o,r.segment,e,a,n,h);if(!t)return{notEnoughRoom:!0};m.push(t)}m.push(c.last)}else{if(s&&!o){const t=Ft(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,a=r.lineStartIndex+r.segment+1,o=new e.P(n.lineVertexArray.getx(a),n.lineVertexArray.gety(a)),s=Ft(o.x,o.y,n),l=s.signedDistanceFromCamera>0?s.point:Nt(n.tileAnchorPoint,o,t,1,n),c=Bt(t.x,t.y,n,i),h=Bt(l.x,l.y,n,i),d=Dt(r.writingMode,c,h,u);if(d)return d}const t=Ht(d*l.getoffsetX(r.glyphStartIndex),p,f,o,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,n,h);if(!t||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[t]}for(const g of m)e.av(c,g.point,g.angle);return{}}function Nt(t,e,n,i,r){const a=t.add(t.sub(e)._unit()),o=Ft(a.x,a.y,r).point,s=n.sub(o);return n.add(s._mult(i/s.mag()))}function Ot(t,n,i){const r=n.projectionCache;if(r.projections[t])return r.projections[t];const a=new e.P(n.lineVertexArray.getx(t),n.lineVertexArray.gety(t)),o=Ft(a.x,a.y,n);if(o.signedDistanceFromCamera>0)return r.projections[t]=o.point,r.anyProjectionOccluded=r.anyProjectionOccluded||o.isOccluded,o.point;const s=t-i.direction;return Nt(0===i.distanceFromAnchor?n.tileAnchorPoint:new e.P(n.lineVertexArray.getx(s),n.lineVertexArray.gety(s)),a,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,n)}function Ft(t,e,n){const i=t+n.translation[0],r=e+n.translation[1];let a;return n.pitchWithMap?(a=Pt(i,r,n.pitchedLabelPlaneMatrix,n.getElevation),a.isOccluded=!1):(a=n.transform.projectTileCoordinates(i,r,n.unwrappedTileID,n.getElevation),a.point.x=(.5*a.point.x+.5)*n.width,a.point.y=(.5*-a.point.y+.5)*n.height),a}function Bt(t,n,i,r){if(i.pitchWithMap){const a=[t,n,0,1];return e.aw(a,a,r),i.transform.projectTileCoordinates(a[0]/a[3],a[1]/a[3],i.unwrappedTileID,i.getElevation).point}return{x:t/i.width*2-1,y:1-n/i.height*2}}function Ut(t,e,n){return n.transform.projectTileCoordinates(t,e,n.unwrappedTileID,n.getElevation)}function jt(t,e,n){return t._unit()._perp()._mult(e*n)}function Vt(t,n,i,r,a,o,s,l,c){if(l.projectionCache.offsets[t])return l.projectionCache.offsets[t];const u=i.add(n);if(t+c.direction<r||t+c.direction>=a)return l.projectionCache.offsets[t]=u,u;const h=Ot(t+c.direction,l,c),d=jt(h.sub(i),s,c.direction),p=i.add(d),f=h.add(d);return l.projectionCache.offsets[t]=e.ax(o,u,p,f)||u,l.projectionCache.offsets[t]}function Ht(t,e,n,i,r,a,o,s,l){const c=i?t-e:t+e;let u=c>0?1:-1,h=0;i&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?a+r:a+r+1;s.projectionCache.cachedAnchorPoint?d=s.projectionCache.cachedAnchorPoint:(d=Ft(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,s.projectionCache.cachedAnchorPoint=d);let f,m,g=d,y=d,v=0,_=0;const x=Math.abs(c),b=[];let w;for(;v+_<=x;){if(p+=u,p<a||p>=o)return null;v+=_,y=g,m=f;const t={absOffsetX:x,direction:u,distanceFromAnchor:v,previousVertex:y};if(g=Ot(p,s,t),0===n)b.push(y),w=g.sub(y);else{let e;const i=g.sub(y);e=0===i.mag()?jt(Ot(p+u,s,t).sub(g),n,u):jt(i,n,u),m||(m=y.add(e)),f=Vt(p,e,g,a,o,m,n,s,t),b.push(m),w=f.sub(m)}_=w.mag()}const S=w._mult((x-v)/_)._add(m||y),M=h+Math.atan2(g.y-y.y,g.x-y.x);return b.push(S),{point:S,angle:l?M:0,path:b}}const Gt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wt(t,e){for(let n=0;n<t;n++){const t=e.length;e.resize(t+4),e.float32.set(Gt,3*t)}}function qt(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}const Zt=100;class Xt{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Tt(t.width+200,t.height+200,25),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Tt(t.width+200,t.height+200,25);this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zt,this.screenBottomBoundary=t.height+Zt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,n,i,r,a,o,s,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(t.anchorPointX+s[0],t.anchorPointY+s[1],r,c,h),p=n*d.perspectiveRatio;let f;if(a||o)f=this._projectCollisionBox(t,p,i,r,a,o,s,d,c,u,h);else{const e=d.x+(u?u.x*p:0),n=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[e+t.x1*p,n+t.y1*p,e+t.x2*p,n+t.y2*p]}}const[m,g,y,v]=f.box,_=a?f.allPointsOccluded:d.isOccluded;let x=_;return x||(x=d.perspectiveRatio<this.perspectiveRatioCutoff),x||(x=!this.isInsideGrid(m,g,y,v)),x||"always"!==e&&this.grid.hitTest(m,g,y,v,e,l)?{box:[m,g,y,v],placeable:!1,offscreen:!1,occluded:_}:{box:[m,g,y,v],placeable:!0,offscreen:this.isOffscreen(m,g,y,v),occluded:_}}placeCollisionCircles(t,n,i,r,a,o,s,l,c,u,h,d,p,f){const m=[],g=new e.P(n.anchorX,n.anchorY),y=this.getPerspectiveRatio(g.x,g.y,o,f),v=(c?a*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,o)/y:a*y)/e.aB,_={getElevation:f,pitchedLabelPlaneMatrix:s,lineVertexArray:i,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:g,unwrappedTileID:o,width:this.transform.width,height:this.transform.height,translation:p},x=Lt(v,r,n.lineOffsetX*v,n.lineOffsetY*v,!1,n,!1,_);let b=!1,w=!1,S=!0;if(x){const n=.5*h*y+d,i=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),a=new St,o=x.first,s=x.last;let p=[];for(let t=o.path.length-1;t>=1;t--)p.push(o.path[t]);for(let t=1;t<s.path.length;t++)p.push(s.path[t]);const f=2.5*n;if(c){const t=this.projectPathToScreenSpace(p,_);p=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let g=[];if(p.length>0){const t=p[0].clone(),n=p[0].clone();for(let e=1;e<p.length;e++)t.x=Math.min(t.x,p[e].x),t.y=Math.min(t.y,p[e].y),n.x=Math.max(n.x,p[e].x),n.y=Math.max(n.y,p[e].y);g=t.x>=i.x&&n.x<=r.x&&t.y>=i.y&&n.y<=r.y?[p]:n.x<i.x||t.x>r.x||n.y<i.y||t.y>r.y?[]:e.ay([p],i.x,i.y,r.x,r.y)}for(const e of g){a.reset(e,.25*n);let i=0;i=a.length<=.5*n?1:Math.ceil(a.paddedLength/f)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),o=a.lerp(r),s=o.x+Zt,c=o.y+Zt;m.push(s,c,n,0);const h=s-n,d=c-n,p=s+n,f=c+n;if(S=S&&this.isOffscreen(h,d,p,f),w=w||this.isInsideGrid(h,d,p,f),"always"!==t&&this.grid.hitTestCircle(s,c,n,t,u)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w||y<this.perspectiveRatioCutoff?[]:m,offscreen:S,collisionDetected:b}}projectPathToScreenSpace(t,n){const i=function(t,n){const i=e.L();return e.aq(i,n.pitchedLabelPlaneMatrix),t.map(t=>{const e=Pt(t.x,t.y,i,n.getElevation),r=n.transform.projectTileCoordinates(e.point.x,e.point.y,n.unwrappedTileID,n.getElevation);return r.point.x=(.5*r.point.x+.5)*n.width,r.point.y=(.5*-r.point.y+.5)*n.height,r})}(t,n);return function(t){let e=0,n=0,i=0,r=0;for(let a=0;a<t.length;a++)t[a].isOccluded?(i=a+1,r=0):(r++,r>n&&(n=r,e=i));return t.slice(e,e+n)}(i)}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[],i=new e.a2;for(const h of t){const t=new e.P(h.x+Zt,h.y+Zt);i.extend(t),n.push(t)}const{minX:r,minY:a,maxX:o,maxY:s}=i,l=this.grid.query(r,a,o,s).concat(this.ignoredGrid.query(r,a,o,s)),c={},u={};for(const h of l){const t=h.key;if(void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]={}),c[t.bucketInstanceId][t.featureIndex])continue;const i=[new e.P(h.x1,h.y1),new e.P(h.x2,h.y1),new e.P(h.x2,h.y2),new e.P(h.x1,h.y2)];e.az(n,i)&&(c[t.bucketInstanceId][t.featureIndex]=!0,void 0===u[t.bucketInstanceId]&&(u[t.bucketInstanceId]=[]),u[t.bucketInstanceId].push(t.featureIndex))}return u}insertCollisionBox(t,e,n,i,r,a){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:a,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,n,i,r,a){const o=n?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:a,overlapMode:e};for(let l=0;l<t.length;l+=4)o.insertCircle(s,t[l],t[l+1],t[l+2])}projectAndGetPerspectiveRatio(t,n,i,r,a){if(a){let i;r?(i=[t,n,r(t,n),1],e.aw(i,i,a)):(i=[t,n,0,1],qt(i,i,a));const o=i[3];return{x:(i[0]/o+1)/2*this.transform.width+Zt,y:(-i[1]/o+1)/2*this.transform.height+Zt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/o*.5,isOccluded:!1,signedDistanceFromCamera:o}}{const e=this.transform.projectTileCoordinates(t,n,i,r);return{x:(e.point.x+1)/2*this.transform.width+Zt,y:(1-e.point.y)/2*this.transform.height+Zt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/e.signedDistanceFromCamera*.5,isOccluded:e.isOccluded,signedDistanceFromCamera:e.signedDistanceFromCamera}}}getPerspectiveRatio(t,e,n,i){const r=this.transform.projectTileCoordinates(t,e,n,i);return.5+this.transform.cameraToCenterDistance/r.signedDistanceFromCamera*.5}isOffscreen(t,e,n,i){return n<Zt||t>=this.screenRightBoundary||i<Zt||e>this.screenBottomBoundary}isInsideGrid(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const t=e.ag([]);return e.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,i,r,a,o,s,l,c,u,h){let d=1,p=0,f=0,m=1;const g=t.anchorPointX+s[0],y=t.anchorPointY+s[1];if(o&&!a){const t=this.projectAndGetPerspectiveRatio(g+1,y,r,c,h),e=t.x-l.x,n=Math.atan((t.y-l.y)/e)+(e<0?Math.PI:0),i=Math.sin(n),a=Math.cos(n);d=a,p=i,f=-i,m=a}else if(!o&&a){const t=Ct(this.transform);d=t.vecEast[0],p=t.vecEast[1],f=t.vecSouth[0],m=t.vecSouth[1]}let v=l.x,_=l.y,x=n;a&&(v=g,_=y,x=Math.pow(2,-(this.transform.zoom-i.overscaledZ)),x*=this.transform.getPitchedTextCorrection(g,y,r),u||(x*=e.ah(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(v+=d*u.x*x+f*u.y*x,_+=p*u.x*x+m*u.y*x);const b=t.x1*x,w=t.x2*x,S=(b+w)/2,M=t.y1*x,T=t.y2*x,E=(M+T)/2,A=[{offsetX:b,offsetY:M},{offsetX:S,offsetY:M},{offsetX:w,offsetY:M},{offsetX:w,offsetY:E},{offsetX:w,offsetY:T},{offsetX:S,offsetY:T},{offsetX:b,offsetY:T},{offsetX:b,offsetY:E}];let C=[];for(const{offsetX:I,offsetY:R}of A)C.push(new e.P(v+d*I+f*R,_+p*I+m*R));let P=!1;if(a){const t=C.map(t=>this.projectAndGetPerspectiveRatio(t.x,t.y,r,c,h));P=t.some(t=>!t.isOccluded),C=t.map(t=>new e.P(t.x,t.y))}else P=!0;return{box:e.aA(C),allPointsOccluded:!P}}}class Yt{constructor(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class Kt{constructor(t,e,n,i,r){this.text=new Yt(t?t.text:null,e,n,r),this.icon=new Yt(t?t.icon:null,e,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jt{constructor(t,e,n){this.text=t,this.icon=e,this.skipFade=n}}class $t{constructor(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class Qt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function te(t,n,i,r,a){const{horizontalAlign:o,verticalAlign:s}=e.aH(t);return new e.P(-(o-.5)*n+r[0]*a,-(s-.5)*i+r[1]*a)}class ee{constructor(t,e,n,i,r){this.transform=t.clone(),this.terrain=e,this.collisionIndex=new Xt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Qt(i),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const e=this.terrain;return e?(n,i)=>e.getElevation(t,n,i):null}getBucketParts(t,n,i,r){const a=i.getBucket(n),o=i.latestFeatureIndex;if(!a||!o||n.id!==a.layerIds[0])return;const s=i.collisionBoxArray,l=a.layers[0].layout,c=a.layers[0].paint,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/e.$,d=i.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=e.aC(i,1,this.transform.zoom),m=e.aD(this.collisionIndex.transform,i,c.get("text-translate"),c.get("text-translate-anchor")),g=e.aD(this.collisionIndex.transform,i,c.get("icon-translate"),c.get("icon-translate-anchor")),y=Et(p,this.transform,f);this.retainedQueryData[a.bucketInstanceId]=new $t(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,i.tileID);const v={bucket:a,layout:l,translationText:m,translationIcon:g,unwrappedTileID:d,pitchedLabelPlaneMatrix:y,scale:u,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.an(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r)for(const e of a.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:v})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:v})}attemptAnchorPlacement(t,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v,_,x){const b=e.aE[t.textAnchor],w=[t.textOffset0,t.textOffset1],S=te(b,i,r,w,a),M=this.collisionIndex.placeCollisionBox(n,d,l,c,u,s,o,g,h.predicate,_,S,x);if((!v||this.collisionIndex.placeCollisionBox(v,d,l,c,u,s,o,y,h.predicate,_,S,x).placeable)&&M.placeable){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(t=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:w,width:i,height:r,anchor:b,textBoxScale:a,prevAnchor:t},this.markUsedJustification(f,b,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:S,placedGlyphBoxes:M}}}placeLayerBucketPart(t,n,i){const{bucket:r,layout:a,translationText:o,translationIcon:s,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=t.parameters,m=a.get("text-optional"),g=a.get("icon-optional"),y=e.aF(a,"text-overlap","text-allow-overlap"),v="always"===y,_=e.aF(a,"icon-overlap","icon-allow-overlap"),x="always"===_,b="map"===a.get("text-rotation-alignment"),w="map"===a.get("text-pitch-alignment"),S="none"!==a.get("icon-text-fit"),M="viewport-y"===a.get("symbol-z-order"),T=v&&(x||!r.hasIconData()||g),E=x&&(v||!r.hasTextData()||m);!r.collisionArrays&&d&&r.deserializeCollisionBoxes(d);const A=this.retainedQueryData[r.bucketInstanceId].tileID,C=this._getTerrainElevationFunc(A),P=this.transform.getFastPathSimpleProjectionMatrix(A),I=(t,d,x)=>{var M,I;if(n[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new Jt(!1,!1,!1));let R=!1,k=!1,L=!0,D=null,z={box:null,placeable:!1,offscreen:null,occluded:!1},N={placeable:!1},O=null,F=null,B=null,U=0,j=0,V=0;d.textFeatureIndex?U=d.textFeatureIndex:t.useRuntimeCollisionCircles&&(U=t.featureIndex),d.verticalTextFeatureIndex&&(j=d.verticalTextFeatureIndex);const H=d.textBox;if(H){const n=n=>{let i=e.ao.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,i=e,this.markUsedOrientation(r,i,t))}return i},a=(n,i)=>{if(r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const t of r.writingModes)if(t===e.ao.vertical?(z=i(),N=z):z=n(),z&&z.placeable)break}else z=n()},c=t.textAnchorOffsetStartIndex,h=t.textAnchorOffsetEndIndex;if(h===c){const i=(e,n)=>{const i=this.collisionIndex.placeCollisionBox(e,y,u,A,l,w,b,o,f.predicate,C,void 0,P);return i&&i.placeable&&(this.markUsedOrientation(r,n,t),this.placedOrientations[t.crossTileID]=n),i};a(()=>i(H,e.ao.horizontal),()=>{const n=d.verticalTextBox;return r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?i(n,e.ao.vertical):{box:null,offscreen:null}}),n(z&&z.placeable)}else{let p=e.aE[null===(I=null===(M=this.prevPlacement)||void 0===M?void 0:M.variableOffsets[t.crossTileID])||void 0===I?void 0:I.anchor];const m=(e,n,a)=>{const d=e.x2-e.x1,m=e.y2-e.y1,g=t.textBoxScale,v=S&&"never"===_?n:null;let x=null,M="never"===y?1:2,T="never";p&&M++;for(let i=0;i<M;i++){for(let n=c;n<h;n++){const i=r.textAnchorOffsets.get(n);if(p&&i.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(i,e,d,m,g,b,w,u,A,l,f,T,t,r,a,o,s,v,C);if(c&&(x=c.placedGlyphBoxes,x&&x.placeable))return R=!0,D=c.shift,x}p?p=null:T=y}return i&&!x&&(x={box:this.collisionIndex.placeCollisionBox(H,"always",u,A,l,w,b,o,f.predicate,C,void 0,P).box,offscreen:!1,placeable:!1,occluded:!1}),x};a(()=>m(H,d.iconBox,e.ao.horizontal),()=>{const n=d.verticalTextBox;return r.allowVerticalPlacement&&(!z||!z.placeable)&&t.numVerticalGlyphVertices>0&&n?m(n,d.verticalIconBox,e.ao.vertical):{box:null,occluded:!0,offscreen:null}}),z&&(R=z.placeable,L=z.offscreen);const g=n(z&&z.placeable);if(!R&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(r,e.anchor,t,g))}}}if(O=z,R=O&&O.placeable,L=O&&O.offscreen,t.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),s=e.ap(r.textSizeData,p,n),u=a.get("text-padding");F=this.collisionIndex.placeCollisionCircles(y,n,r.lineVertexArray,r.glyphOffsetArray,s,l,c,i,w,f.predicate,t.collisionCircleDiameter,u,o,C),F.circles.length&&F.collisionDetected&&!i&&e.w("Collisions detected, but collision boxes are not shown"),R=v||F.circles.length>0&&!F.collisionDetected,L=L&&F.offscreen}if(d.iconFeatureIndex&&(V=d.iconFeatureIndex),d.iconBox){const t=t=>this.collisionIndex.placeCollisionBox(t,_,u,A,l,w,b,s,f.predicate,C,S&&D?D:void 0,P);N&&N.placeable&&d.verticalIconBox?(B=t(d.verticalIconBox),k=B.placeable):(B=t(d.iconBox),k=B.placeable),L=L&&B.offscreen}const G=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,W=g||0===t.numIconVertices;G||W?W?G||(k=k&&R):R=k&&R:k=R=k&&R;const q=k&&B.placeable;if(R&&O.placeable&&this.collisionIndex.insertCollisionBox(O.box,y,a.get("text-ignore-placement"),r.bucketInstanceId,N&&N.placeable&&j?j:U,f.ID),q&&this.collisionIndex.insertCollisionBox(B.box,_,a.get("icon-ignore-placement"),r.bucketInstanceId,V,f.ID),F&&R&&this.collisionIndex.insertCollisionCircles(F.circles,y,a.get("text-ignore-placement"),r.bucketInstanceId,U,f.ID),i&&this.storeCollisionData(r.bucketInstanceId,x,d,O,B,F),0===t.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===r.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[t.crossTileID]=new Jt((R||T)&&!(null==O?void 0:O.occluded),(k||E)&&!(null==B?void 0:B.occluded),L||r.justReloaded),n[t.crossTileID]=!0};if(M){if(0!==t.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const e=r.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let t=e.length-1;t>=0;--t){const n=e[t];I(r.symbolInstances.get(n),r.collisionArrays[n],n)}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)I(r.symbolInstances.get(e),r.collisionArrays[e],e);r.justReloaded=!1}storeCollisionData(t,e,n,i,r,a){if(n.textBox||n.iconBox){let a,o;this.collisionBoxArrays.has(t)?a=this.collisionBoxArrays.get(t):(a=new Map,this.collisionBoxArrays.set(t,a)),a.has(e)?o=a.get(e):(o={text:null,icon:null},a.set(e,o)),n.textBox&&(o.text=i.box),n.iconBox&&(o.icon=r.box)}if(a){let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=[]);for(let t=0;t<a.circles.length;t+=4)e.push(a.circles[t+0]-Zt),e.push(a.circles[t+1]-Zt),e.push(a.circles[t+2]),e.push(a.collisionDetected?1:0)}}markUsedJustification(t,n,i,r){let a;a=r===e.ao.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[e.aG(n)];const o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const e of o)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=a>=0&&e!==a?0:i.crossTileID)}markUsedOrientation(t,n,i){const r=n===e.ao.horizontal||n===e.ao.horizontalOnly?n:0,a=n===e.ao.vertical?n:0,o=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const e of o)t.text.placedSymbolArray.get(e).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=a)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const i=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},a=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(const s in this.placements){const t=this.placements[s],e=r[s];e?(this.opacities[s]=new Kt(e,i,t.text,t.icon),n=n||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[s]=new Kt(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const s in r){const t=r[s];if(!this.opacities[s]){const e=new Kt(t,i,!1,!1);e.isHidden()||(this.opacities[s]=e,n=n||t.text.placed||t.icon.placed)}}for(const s in a)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=a[s]);for(const s in o)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=o[s]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const n={};for(const i of e){const e=i.getBucket(t);e&&i.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i.tileID,n,i.collisionBoxArray)}}updateBucketOpacities(t,n,i,r){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const a=t.layers[0],o=a.layout,s=new Kt(null,0,!1,!1,!0),l=o.get("text-allow-overlap"),c=o.get("icon-allow-overlap"),u=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===o.get("text-rotation-alignment"),d="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),f=new Kt(null,0,l&&(c||!t.hasIconData()||o.get("icon-optional")),c&&(l||!t.hasTextData()||o.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const m=(t,e,n)=>{for(let i=0;i<e/4;i++)t.opacityVertexArray.emplaceBack(n);t.hasVisibleVertices=t.hasVisibleVertices||n!==he},g=this.collisionBoxArrays.get(t.bucketInstanceId);for(let y=0;y<t.symbolInstances.length;y++){const n=t.symbolInstances.get(y),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:a,crossTileID:o}=n;let l=this.opacities[o];i[o]?l=s:l||(l=f,this.opacities[o]=l),i[o]=!0;const c=n.numIconVertices>0,v=this.placedOrientations[n.crossTileID],_=v===e.ao.vertical,x=v===e.ao.horizontal||v===e.ao.horizontalOnly;if(r>0||a>0){const e=ue(l.text);m(t.text,r,_?he:e),m(t.text,a,x?he:e);const i=l.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||_?1:0)}),n.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||x?1:0);const o=this.variableOffsets[n.crossTileID];o&&this.markUsedJustification(t,o.anchor,n,v);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(t,"left",n,s),this.markUsedOrientation(t,s,n))}if(c){const e=ue(l.icon),i=!(p&&n.verticalPlacedIconSymbolIndex&&_);n.placedIconSymbolIndex>=0&&(m(t.icon,n.numIconVertices,i?e:he),t.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=l.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(m(t.icon,n.numVerticalIconVertices,i?he:e),t.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=l.icon.isHidden())}const b=g&&g.has(y)?g.get(y):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[y];if(n){let i=new e.P(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(u){const t=this.variableOffsets[o];t?(i=te(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),h&&i._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):e=!1}if(n.textBox||n.verticalTextBox){let r;n.textBox&&(r=_),n.verticalTextBox&&(r=x),ne(t.textCollisionBox.collisionVertexArray,l.text.placed,!e||r,b.text,i.x,i.y)}}if(n.iconBox||n.verticalIconBox){const e=Boolean(!x&&n.verticalIconBox);let r;n.iconBox&&(r=e),n.verticalIconBox&&(r=!e),ne(t.iconCollisionBox.collisionVertexArray,l.icon.placed,r,b.icon,p?i.x:0,p?i.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error("bucket.text.opacityVertexArray.length (= ".concat(t.text.opacityVertexArray.length,") !== bucket.text.layoutVertexArray.length (= ").concat(t.text.layoutVertexArray.length,") / 4"));if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error("bucket.icon.opacityVertexArray.length (= ".concat(t.icon.opacityVertexArray.length,") !== bucket.icon.layoutVertexArray.length (= ").concat(t.icon.layoutVertexArray.length,") / 4"));t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function ne(t,e,n,i,r,a){i&&0!==i.length||(i=[0,0,0,0]);const o=i[0]-Zt,s=i[1]-Zt,l=i[2]-Zt,c=i[3]-Zt;t.emplaceBack(e?1:0,n?1:0,r||0,a||0,o,s),t.emplaceBack(e?1:0,n?1:0,r||0,a||0,l,s),t.emplaceBack(e?1:0,n?1:0,r||0,a||0,l,c),t.emplaceBack(e?1:0,n?1:0,r||0,a||0,o,c)}const ie=Math.pow(2,25),re=Math.pow(2,24),ae=Math.pow(2,17),oe=Math.pow(2,16),se=Math.pow(2,9),le=Math.pow(2,8),ce=Math.pow(2,1);function ue(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*ie+e*re+n*ae+e*oe+n*se+e*le+n*ce+e}const he=0;class de{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,n,i,r){const a=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(a,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<a.length;)if(e.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class pe{constructor(t,e,n,i,r,a,o,s){this.placement=new ee(t,e,a,o,s),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,e,n){const i=o.now(),r=()=>!this._forceFullPlacement&&o.now()-i>2;for(;this._currentPlacementIndex>=0;){const i=e[t[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=a)&&(!i.maxzoom||i.maxzoom>a)){if(this._inProgressLayer||(this._inProgressLayer=new de(i)),this._inProgressLayer.continuePlacement(n[i.source],this.placement,this._showCollisionBoxes,i,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const fe=512/e.$/2;class me{constructor(t,n,i){this.tileID=t,this.bucketInstanceId=i,this._symbolsByKey={};const r=new Map;for(let e=0;e<n.length;e++){const t=n.get(e),i=t.key,a=r.get(i);a?a.push(t):r.set(i,[t])}for(const[a,o]of r){const t={positions:o.map(t=>({x:Math.floor(t.anchorX*fe),y:Math.floor(t.anchorY*fe)})),crossTileIDs:o.map(t=>t.crossTileID)};if(t.positions.length>128){const n=new e.aI(t.positions.length,16,Uint16Array);for(const{x:e,y:i}of t.positions)n.add(e,i);n.finish(),delete t.positions,t.index=n}this._symbolsByKey[a]=t}}getScaledCoordinates(t,n){const{x:i,y:r,z:a}=this.tileID.canonical,{x:o,y:s,z:l}=n.canonical,c=fe/Math.pow(2,l-a),u=(s*e.$+t.anchorY)*c,h=r*e.$*fe;return{x:Math.floor((o*e.$+t.anchorX)*c-i*e.$*fe),y:Math.floor(u-h)}}findMatches(t,e,n){const i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const a=t.get(r);if(a.crossTileID)continue;const o=this._symbolsByKey[a.key];if(!o)continue;const s=this.getScaledCoordinates(a,e);if(o.index){const t=o.index.range(s.x-i,s.y-i,s.x+i,s.y+i).sort();for(const e of t){const t=o.crossTileIDs[e];if(!n[t]){n[t]=!0,a.crossTileID=t;break}}}else if(o.positions)for(let t=0;t<o.positions.length;t++){const e=o.positions[t],r=o.crossTileIDs[t];if(Math.abs(e.x-s.x)<=i&&Math.abs(e.y-s.y)<=i&&!n[r]){n[r]=!0,a.crossTileID=r;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(t=>{let{crossTileIDs:e}=t;return e})}}class ge{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ye{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const n in this.indexes){const t=this.indexes[n],i={};for(const n in t){const r=t[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),i[r.tileID.key]=r}this.indexes[n]=i}this.lng=t}addBucket(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const i=this.usedCrossTileIDs[t.overscaledZ];for(const r in this.indexes){const n=this.indexes[r];if(Number(r)>t.overscaledZ)for(const r in n){const a=n[r];a.tileID.isChildOf(t)&&a.findMatches(e.symbolInstances,t,i)}else{const a=n[t.scaledTo(Number(r)).key];a&&a.findMatches(e.symbolInstances,t,i)}}for(let r=0;r<e.symbolInstances.length;r++){const t=e.symbolInstances.get(r);t.crossTileID||(t.crossTileID=n.generate(),i[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new me(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const n of e.getCrossTileIDsLists())for(const e of n)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e}}class ve{constructor(){this.layerIndexes={},this.crossTileIDs=new ge,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,n){let i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new ye);let r=!1;const a={};i.handleWrapJump(n);for(const o of e){const e=o.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(o.tileID,e,this.crossTileIDs)&&(r=!0),a[e.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const n in this.layerIndexes)e[n]||delete this.layerIndexes[n]}}var _e="void main() {fragColor=vec4(1.0);}";const xe={prelude:be("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:be("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:be("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:be("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:be("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:be("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:be(_e,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:be("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:be("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:be("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:be("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:be("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:be(_e,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:be("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:be("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:be("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:be("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:be("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:be("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:be("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:be("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:be("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:be("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:be("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:be("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:be("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:be("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:be("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:be("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:be("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:be("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:be("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function be(t,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=e.match(/in ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=a?a.concat(r):r,s={};return{fragmentSource:t=t.replace(n,(t,e,n,i,r)=>(s[r]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nin ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"\n#ifdef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"))),vertexSource:e=e.replace(n,(t,e,n,i,r)=>{const a="float"===i?"vec2":"vec4",o=r.match(/color/)?"color":a;return s[r]?"define"===e?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\nout ").concat(n," ").concat(i," ").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(r," = unpack_mix_").concat(o,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"define"===e?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\nuniform lowp float u_").concat(r,"_t;\nin ").concat(n," ").concat(a," a_").concat(r,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(r,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = a_").concat(r,";\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(r,"\n    ").concat(n," ").concat(i," ").concat(r," = unpack_mix_").concat(o,"(a_").concat(r,", u_").concat(r,"_t);\n#else\n    ").concat(n," ").concat(i," ").concat(r," = u_").concat(r,";\n#endif\n")}),staticAttributes:i,staticUniforms:o}}class we{constructor(t,e,n){this.vertexBuffer=t,this.indexBuffer=e,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Se=e.aJ([{name:"a_pos",type:"Int16",components:2}]);const Me="#define PROJECTION_MERCATOR",Te="mercator";class Ee{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Te}get shaderDefine(){return Me}get shaderPreludeCode(){return xe.projectionMercator}get vertexShaderPreludeCode(){return xe.projectionMercator.vertexSource}get subdivisionGranularity(){return e.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,i,r,a){if(this._cachedMesh)return this._cachedMesh;const o=new e.aL;o.emplaceBack(0,0),o.emplaceBack(e.$,0),o.emplaceBack(0,e.$),o.emplaceBack(e.$,e.$);const s=t.createVertexBuffer(o,Se.members),l=e.aM.simpleSegment(0,0,4,2),c=new e.aN;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=t.createIndexBuffer(c);return this._cachedMesh=new we(s,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Ae{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.C.number(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.C.number(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.C.number(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.C.number(t.right,n.right,i)),this}getCenter(t,n){const i=e.ah((this.left+t-this.right)/2,0,t),r=e.ah((this.top+n-this.bottom)/2,0,n);return new e.P(i,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ae(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ce(t,e){if(!t.renderWorldCopies||t.lngRange)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}function Pe(t){return Math.max(0,Math.floor(t))}class Ie{constructor(t,n,i,r,a,o){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=void 0===o||!!o,this._minZoom=n||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==a?60:a,this.setMaxBounds(),this._width=0,this._height=0,this._center=new e.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Pe(this._zoom),this._scale=e.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ae,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,i){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Pe(this._zoom),this._scale=e.af(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Ae(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!i&&t.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=e.aO(t,-180,180)*Math.PI/180;var r,a,o,s,l,c,u,h,d;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=i(),r=this._rotationMatrix,o=-this._bearingInRadians,s=(a=this._rotationMatrix)[0],l=a[1],c=a[2],u=a[3],h=Math.sin(o),d=Math.cos(o),r[0]=s*d+c*h,r[1]=l*d+u*h,r[2]=s*-h+c*d,r[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=e.ah(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const e=t/180*Math.PI;this._rollInRadians!==e&&(this._unmodified=!1,this._rollInRadians=e,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return e.aP(this._fovInRadians)}setFov(t){t=e.ah(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=e.ae(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.getConstrained(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=e.af(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,e){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=e,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()}resize(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._width=t,this._height=e,n&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new H([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-e.ai,e.ai])}getConstrained(t,e){return this._callbacks.getConstrained(t,e)}getCameraQueryGeometry(t,n){if(1===n.length)return[n[0],t];{const{minX:i,minY:r,maxX:a,maxY:o}=e.a2.fromPoints(n).extend(t);return[new e.P(i,r),new e.P(a,r),new e.P(a,o),new e.P(i,o),new e.P(i,r)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:n}=this.getConstrained(this.center,this.zoom);this.setCenter(e),this.setZoom(n),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=e.ag(new Float64Array(16));e.N(t,t,[this._width/2,-this._height/2,1]),e.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=e.ag(new Float64Array(16)),e.N(t,t,[1,-1,1]),e.M(t,t,[-1,-1,0]),e.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,i,r){const a=void 0!==i?i:this.bearing,o=r=void 0!==r?r:this.pitch,s=e.a1.fromLngLat(t,n),l=-Math.cos(e.ae(o)),c=Math.sin(e.ae(o)),u=c*Math.sin(e.ae(a)),h=-c*Math.cos(e.ae(a));let d=this.elevation;const p=n-d;let f;l*p>=0||Math.abs(l)<.1?(f=1e4,d=n+f*l):f=-p/l;let m,g,y=e.aQ(1,s.y),v=0;do{if(v+=1,v>10)break;g=f/y,m=new e.a1(s.x+u*g,s.y+h*g),y=1/m.meterInMercatorCoordinateUnits()}while(Math.abs(f-g*y)>1e-12);return{center:m.toLngLat(),elevation:d,zoom:e.ak(this.height/2/Math.tan(this.fovInRadians/2)/g/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=e.aj(1,this.center.lat)*this.worldSize,i=this.cameraToCenterDistance/n,r=e.a1.fromLngLat(this.center,this.elevation),a=dt(this.center,this.elevation,this.pitch,this.bearing,i);this._elevation=t;const o=this.calculateCenterFromCameraLngLatAlt(a.toLngLat(),e.aQ(a.z,r.y),this.bearing,this.pitch);this._elevation=o.elevation,this._center=o.center,this.setZoom(o.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=e.aj(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/e.$,1/n/e.$]}}class Re{constructor(t,n){this.min=t,this.max=n,this.center=e.aR([],e.aS([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],i=e.aT(this.min),r=e.aT(this.max);for(let e=0;e<n.length;e++)i[e]=n[e]?this.min[e]:this.center[e],r[e]=n[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Re(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let e=!0;for(let n=0;n<t.planes.length;n++){const i=this.intersectsPlane(t.planes[n]);if(0===i)return 0;1===i&&(e=!1)}return e?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let e=t[3],n=t[3];for(let i=0;i<3;i++)t[i]>0?(e+=t[i]*this.min[i],n+=t[i]*this.max[i]):(n+=t[i]*this.min[i],e+=t[i]*this.max[i]);return e>=0?2:n<0?0:1}}class ke{distanceToTile2d(t,e,n,i){const r=i.distanceX([t,e]),a=i.distanceY([t,e]);return Math.hypot(r,a)}getWrap(t,e,n){return n}getTileBoundingVolume(t,n,i,r){var a,o;let s=0,l=0;if(null==r?void 0:r.terrain){const c=new e.Z(t.z,n,t.z,t.x,t.y),u=r.terrain.getMinMaxElevation(c);s=null!==(a=u.minElevation)&&void 0!==a?a:Math.min(0,i),l=null!==(o=u.maxElevation)&&void 0!==o?o:Math.max(0,i)}const c=1<<t.z;return new Re([n+t.x/c,t.y/c,s],[n+(t.x+1)/c,(t.y+1)/c,l])}allowVariableZoom(t,n){const i=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,r=e.ah(78.5-i/2,0,60);return!!n.terrain||t.pitch>r}allowWorldCopies(){return!0}prepareNextFrame(){}}class Le{constructor(t,e,n){this.points=t,this.planes=e,this.aabb=n}static fromInvProjectionMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;const o=a?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],s=Math.pow(2,i),l=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(i=>function(t,n,i,r){const a=e.aw([],t,n),o=1/a[3]/i*r;return e.aY(a,a,[o,o,1/a[3],o])}(i,t,n,s));r&&function(t,n,i,r){const a=r?4:0,o=r?0:4;let s=0;const l=[],c=[];for(let d=0;d<4;d++){const n=e.aU([],t[d+o],t[d+a]),i=e.aZ(n);e.aR(n,n,1/i),l.push(i),c.push(n)}for(let d=0;d<4;d++){const n=e.a_(t[d+a],c[d],i);s=null!==n&&n>=0?Math.max(s,n):Math.max(s,l[d])}const u=function(t,n){const i=e.aU([],t[n[0]],t[n[1]]),r=e.aU([],t[n[2]],t[n[1]]),a=[0,0,0,0];return e.aV(a,e.aW([],i,r)),a[3]=-e.aX(a,t[n[0]]),a}(t,n),h=function(t,n){const i=e.a$(t),r=e.b0([],t,1/i),a=e.aU([],n,e.aR([],r,e.aX(n,r))),o=e.a$(a);if(o>0){const t=Math.sqrt(1-r[3]*r[3]),i=e.aR([],r,-r[3]),s=e.aS([],i,e.aR([],a,t/o));return e.b1(n,s)}return null}(i,u);if(null!==h){const t=h/e.aX(c[0],u);s=Math.min(s,t)}for(let e=0;e<4;e++){const n=Math.min(s,l[e]);t[e+o]=[t[e+a][0]+c[e][0]*n,t[e+a][1]+c[e][1]*n,t[e+a][2]+c[e][2]*n,1]}}(l,o[0],r,a);const c=o.map(t=>{const n=e.aU([],l[t[0]],l[t[1]]),i=e.aU([],l[t[2]],l[t[1]]),r=e.aV([],e.aW([],n,i)),a=-e.aX(r,l[t[1]]);return r.concat(a)}),u=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],h=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of l)for(let t=0;t<3;t++)u[t]=Math.min(u[t],e[t]),h[t]=Math.max(h[t],e[t]);return new Le(l,c,new Re(u,h))}}class De{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,n){return this._helper.interpolatePadding(t,e,n)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._helper.resize(t,e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,e){}constructor(t,e,n,i,r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ie({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)},t,e,n,i,r),this._coveringTilesDetailsProvider=new ke}clone(){const t=new De;return t.apply(this),t}apply(t,e,n){this._helper.apply(t,e,n)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new e.b2(0,t)];if(this._helper._renderWorldCopies){const i=this.screenPointToMercatorCoordinate(new e.P(0,0)),r=this.screenPointToMercatorCoordinate(new e.P(this._helper._width,0)),a=this.screenPointToMercatorCoordinate(new e.P(this._helper._width,this._helper._height)),o=this.screenPointToMercatorCoordinate(new e.P(0,this._helper._height)),s=Math.floor(Math.min(i.x,r.x,a.x,o.x)),l=Math.floor(Math.max(i.x,r.x,a.x,o.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&n.push(new e.b2(u,t))}return n}getCameraFrustum(){return Le.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const e=this.screenPointToLocation(this.centerPoint,t),n=t?t.getElevationForLngLatZoom(e,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(n)}setLocationAtPoint(t,n){const i=e.aj(this.elevation,this.center.lat),r=this.screenPointToMercatorCoordinateAtZ(n,i),a=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,i),o=e.a1.fromLngLat(t),s=new e.a1(o.x-(r.x-a.x),o.y-(r.y-a.y));this.setCenter(null==s?void 0:s.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(e.a1.fromLngLat(t),n.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(e.a1.fromLngLat(t))}screenPointToLocation(t,e){var n;return null===(n=this.screenPointToMercatorCoordinate(t,e))||void 0===n?void 0:n.toLngLat()}screenPointToMercatorCoordinate(t,e){if(e){const n=e.pointCoordinate(t);if(null!=n)return n}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const i=n||0,r=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.aw(r,r,this._pixelMatrixInverse),e.aw(a,a,this._pixelMatrixInverse);const o=r[3],s=a[3],l=r[1]/o,c=a[1]/s,u=r[2]/o,h=a[2]/s,d=u===h?0:(i-u)/(h-u);return new e.a1(e.C.number(r[0]/o,a[0]/s,d)/this.worldSize,e.C.number(l,c,d)/this.worldSize,i)}coordinatePoint(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._pixelMatrix;const r=[t.x*this.worldSize,t.y*this.worldSize,n,1];return e.aw(r,r,i),new e.P(r[0]/r[3],r[1]/r[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ut(this));return(new H).extend(this.screenPointToLocation(new e.P(0,t))).extend(this.screenPointToLocation(new e.P(this._helper._width,t))).extend(this.screenPointToLocation(new e.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new e.P(0,this._helper._height)))}isPointOnMapSurface(t,e){return e?null!=e.pointCoordinate(t):t.y>this.height/2-ut(this)}calculatePosMatrix(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;var r;const a=null!==(r=t.key)&&void 0!==r?r:e.b3(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),o=n?this._alignedPosMatrixCache:this._posMatrixCache;if(o.has(a)){const t=o.get(a);return i?t.f32:t.f64}const s=ht(t,this.worldSize);e.O(s,n?this._alignedProjMatrix:this._viewProjMatrix,s);const l={f64:s,f32:new Float32Array(s)};return o.set(a,l),i?l.f32:l.f64}calculateFogMatrix(t){const n=t.key,i=this._fogMatrixCacheF32;if(i.has(n))return i.get(n);const r=ht(t,this.worldSize);return e.O(r,this._fogMatrix,r),i.set(n,new Float32Array(r)),i.get(n)}getConstrained(t,n){n=e.ah(+n,this.minZoom,this.maxZoom);const i={center:new e.S(t.lng,t.lat),zoom:n};let r=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===r){const t=180-1e-10;r=[-t,t]}const a=this.tileSize*e.af(i.zoom);let o=0,s=a,l=0,c=a,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const t=this._helper._latRange;o=e.U(t[1])*a,s=e.U(t[0])*a,s-o<p&&(u=p/(s-o))}r&&(l=e.aO(e.V(r[0])*a,0,a),c=e.aO(e.V(r[1])*a,0,a),c<l&&(c+=a),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=lt(a,t);let g,y;const v=Math.max(h||0,u||0);if(v){const t=new e.P(h?(c+l)/2:f,u?(s+o)/2:m);return i.center=ct(a,t).wrap(),i.zoom+=e.ak(v),i}if(this._helper._latRange){const t=p/2;m-t<o&&(y=o+t),m+t>s&&(y=s-t)}if(r){const t=(l+c)/2;let n=f;this._helper._renderWorldCopies&&(n=e.aO(f,t-a/2,t+a/2));const i=d/2;n-i<l&&(g=l+i),n+i>c&&(g=c-i)}if(void 0!==g||void 0!==y){const t=new e.P(null!=g?g:f,null!=y?y:m);i.center=ct(a,t).wrap()}return i}calculateCenterFromCameraLngLatAlt(t,e,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,n,i)}_calculateNearFarZIfNeeded(t,n,i){if(!this._helper.autoCalculateNearFarZ)return;const r=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),a=t-r*this._helper._pixelPerMeter/Math.cos(n),o=r<0?a:t,s=Math.PI/2+this.pitchInRadians,l=e.ae(this.fov)*(Math.abs(Math.cos(e.ae(this.roll)))*this.height+Math.abs(Math.sin(e.ae(this.roll)))*this.width)/this.height*(.5+i.y/this.height),c=Math.sin(l)*o/Math.sin(e.ah(Math.PI-s-l,.01,Math.PI-.01)),u=ut(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=e.ae(.75),p=h>d?2*h*(.5+i.y/(2*u)):d,f=Math.sin(p)*o/Math.sin(e.ah(Math.PI-s-p,.01,Math.PI-.01)),m=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*m+o),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=lt(this.worldSize,this.center),i=n.x,r=n.y;this._helper._pixelPerMeter=e.aj(1,this.center.lat)*this.worldSize;const a=e.ae(Math.min(this.pitch,st)),o=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(a));let s;this._calculateNearFarZIfNeeded(o,a,t),s=new Float64Array(16),e.b4(s,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),e.aq(this._invProjMatrix,s),s[8]=2*-t.x/this._helper._width,s[9]=2*t.y/this._helper._height,this._projectionMatrix=e.b5(s),e.N(s,s,[1,-1,1]),e.M(s,s,[0,0,-this._helper.cameraToCenterDistance]),e.b6(s,s,-this.rollInRadians),e.b7(s,s,this.pitchInRadians),e.b6(s,s,-this.bearingInRadians),e.M(s,s,[-i,-r,0]),this._mercatorMatrix=e.N([],s,[this.worldSize,this.worldSize,this.worldSize]),e.N(s,s,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=e.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,s),e.M(s,s,[0,0,-this.elevation]),this._viewProjMatrix=s,this._invViewProjMatrix=e.aq([],s);const l=[0,0,-1,1];e.aw(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),e.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,o,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,e.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),e.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),e.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),e.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),e.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),e.M(this._fogMatrix,this._fogMatrix,[-i,-r,0]),e.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),e.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=e.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,s);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=i-Math.round(i)+h*c+d*u,f=r-Math.round(r)+h*u+d*c,m=new Float64Array(s);if(e.M(m,m,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=m,s=e.aq(new Float64Array(16),this._pixelMatrix),!s)throw new Error("failed to invert matrix");this._pixelMatrixInverse=s,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new e.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.aw(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=e.aj(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const i=e.a1.fromLngLat(t),r=[i.x*this.worldSize,i.y*this.worldSize,n,1];return e.aw(r,r,this._viewProjMatrix),r[2]/r[3]}getProjectionData(t){const{overscaledTileID:n,aligned:i,applyTerrainMatrix:r}=t,a=this._helper.getMercatorTileCoordinates(n),o=n?this.calculatePosMatrix(n,i,!0):null;let s;return s=n&&n.terrainRttPosMatrix32f&&r?n.terrainRttPosMatrix32f:o||e.b8(),{mainMatrix:s,tileMercatorCoords:a,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:s}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,e,n){return 1}transformLightDirection(t){return e.aT(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,i,r){const a=this.calculatePosMatrix(i);let o;r?(o=[t,n,r(t,n),1],e.aw(o,o,a)):(o=[t,n,0,1],qt(o,o,a));const s=o[3];return{point:new e.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}populateCache(t){for(const e of t)this.calculatePosMatrix(e)}getMatrixForModel(t,n){const i=e.a1.fromLngLat(t,n),r=i.meterInMercatorCoordinateUnits(),a=e.b9();return e.M(a,a,[i.x,i.y,i.z]),e.b6(a,a,Math.PI),e.b7(a,a,Math.PI/2),e.N(a,a,[-r,r,r]),a}getProjectionDataForCustomLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=new e.Z(0,0,0,0,0),i=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),r=ht(n,this.worldSize);e.O(r,this._viewProjMatrix,r),i.tileMercatorCoords=[0,0,1,1];const a=[e.$,e.$,this.worldSize/this._helper.pixelsPerMeter],o=e.ba();return e.N(o,r,a),i.fallbackMatrix=o,i.mainMatrix=o,i}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ze(){e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ne(t){if(t.useSlerp)if(t.k<1){const n=e.bb(t.startEulerAngles.roll,t.startEulerAngles.pitch,t.startEulerAngles.bearing),i=e.bb(t.endEulerAngles.roll,t.endEulerAngles.pitch,t.endEulerAngles.bearing),r=new Float64Array(4);e.bc(r,n,i,t.k);const a=e.bd(r);t.tr.setRoll(a.roll),t.tr.setPitch(a.pitch),t.tr.setBearing(a.bearing)}else t.tr.setRoll(t.endEulerAngles.roll),t.tr.setPitch(t.endEulerAngles.pitch),t.tr.setBearing(t.endEulerAngles.bearing);else t.tr.setRoll(e.C.number(t.startEulerAngles.roll,t.endEulerAngles.roll,t.k)),t.tr.setPitch(e.C.number(t.startEulerAngles.pitch,t.endEulerAngles.pitch,t.k)),t.tr.setBearing(e.C.number(t.startEulerAngles.bearing,t.endEulerAngles.bearing,t.k))}function Oe(t,n,i,r,a){const o=a.padding,s=lt(a.worldSize,i.getNorthWest()),l=lt(a.worldSize,i.getNorthEast()),c=lt(a.worldSize,i.getSouthEast()),u=lt(a.worldSize,i.getSouthWest()),h=e.ae(-r),d=s.rotate(h),p=l.rotate(h),f=c.rotate(h),m=u.rotate(h),g=new e.P(Math.max(d.x,p.x,m.x,f.x),Math.max(d.y,p.y,m.y,f.y)),y=new e.P(Math.min(d.x,p.x,m.x,f.x),Math.min(d.y,p.y,m.y,f.y)),v=g.sub(y),_=(a.width-(o.left+o.right+n.left+n.right))/v.x,x=(a.height-(o.top+o.bottom+n.top+n.bottom))/v.y;if(x<0||_<0)return void ze();const b=Math.min(e.ak(a.scale*Math.min(_,x)),t.maxZoom),w=e.P.convert(t.offset),S=new e.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(e.ae(r)),M=w.add(S).mult(a.scale/e.af(b));return{center:ct(a.worldSize,s.add(c).div(2).sub(M)),zoom:b,bearing:r}}class Fe{get useGlobeControls(){return!1}handlePanInertia(t,e){return{easingOffset:t,easingCenter:e.center}}handleMapControlsRollPitchBearingZoom(t,e){t.bearingDelta&&e.setBearing(e.bearing+t.bearingDelta),t.pitchDelta&&e.setPitch(e.pitch+t.pitchDelta),t.rollDelta&&e.setRoll(e.roll+t.rollDelta),t.zoomDelta&&e.setZoom(e.zoom+t.zoomDelta)}handleMapControlsPan(t,e,n){t.around.distSqr(e.centerPoint)<.01||e.setLocationAtPoint(n,t.around)}cameraForBoxAndBearing(t,e,n,i,r){return Oe(t,e,n,i,r)}handleJumpToCenterZoom(t,n){t.zoom!==(void 0!==n.zoom?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),void 0!==n.center&&t.setCenter(e.S.convert(n.center))}handleEaseTo(t,n){const i=t.zoom,r=t.padding,a={roll:t.roll,pitch:t.pitch,bearing:t.bearing},o={roll:void 0===n.roll?t.roll:n.roll,pitch:void 0===n.pitch?t.pitch:n.pitch,bearing:void 0===n.bearing?t.bearing:n.bearing},s=void 0!==n.zoom,l=!t.isPaddingEqual(n.padding);let c=!1;const u=s?+n.zoom:t.zoom;let h=t.centerPoint.add(n.offsetAsPoint);const d=t.screenPointToLocation(h),{center:p,zoom:f}=t.getConstrained(e.S.convert(n.center||d),null!=u?u:i);Ce(t,p);const m=lt(t.worldSize,d),g=lt(t.worldSize,p).sub(m),y=e.af(f-i);return c=f!==i,{easeFunc:s=>{if(c&&t.setZoom(e.C.number(i,f,s)),e.be(a,o)||Ne({startEulerAngles:a,endEulerAngles:o,tr:t,k:s,useSlerp:a.roll!=o.roll}),l&&(t.interpolatePadding(r,n.padding,s),h=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const n=e.af(t.zoom-i),r=f>i?Math.min(2,y):Math.max(.5,y),a=Math.pow(r,1-s),o=ct(t.worldSize,m.add(g.mult(s*a)).mult(n));t.setLocationAtPoint(t.renderWorldCopies?o.wrap():o,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(t,n){const i=void 0!==n.zoom,r=t.zoom,a=t.getConstrained(e.S.convert(n.center||n.locationAtOffset),i?+n.zoom:r),o=a.center,s=a.zoom;Ce(t,o);const l=lt(t.worldSize,n.locationAtOffset),c=lt(t.worldSize,o).sub(l),u=c.mag(),h=e.af(s-r);let d;if(void 0!==n.minZoom){const i=Math.min(+n.minZoom,r,s),a=t.getConstrained(o,i).zoom;d=e.af(a-r)}return{easeFunc:(n,i,a,u)=>{t.setZoom(1===n?s:r+e.ak(i));const h=1===n?o:ct(t.worldSize,l.add(c.mult(a)).mult(i));t.setLocationAtPoint(t.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:o,scaleOfMinZoom:d,pixelPathLength:u}}}class Be{constructor(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}}Be.Replace=[1,0],Be.disabled=new Be(Be.Replace,e.bf.transparent,[!1,!1,!1,!1]),Be.unblended=new Be(Be.Replace,e.bf.transparent,[!0,!0,!0,!0]),Be.alphaBlended=new Be([1,771],e.bf.transparent,[!0,!0,!0,!0]);const Ue=2305;class je{constructor(t,e,n){this.enable=t,this.mode=e,this.frontFace=n}}je.disabled=new je(!1,1029,Ue),je.backCCW=new je(!0,1029,Ue),je.frontCCW=new je(!0,1028,Ue);class Ve{constructor(t,e,n){this.func=t,this.mask=e,this.range=n}}Ve.ReadOnly=!1,Ve.ReadWrite=!0,Ve.disabled=new Ve(519,Ve.ReadOnly,[0,1]);const He=7680;class Ge{constructor(t,e,n,i,r,a){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=a}}Ge.disabled=new Ge({func:519,mask:0},0,0,He,He,He);const We=new WeakMap;function qe(t){var e;if(We.has(t))return We.get(t);{const n=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return We.set(t,n),n}}class Ze{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,i=n.gl;this._texFormat=i.RGBA,this._texType=i.UNSIGNED_BYTE;const r=new e.aL;r.emplaceBack(-1,-1),r.emplaceBack(2,-1),r.emplaceBack(-1,2);const a=new e.aN;a.emplaceBack(0,1,2),this._fullscreenTriangle=new we(n.createVertexBuffer(r,Se.members),n.createIndexBuffer(a),e.aM.simpleSegment(0,0,r.length,a.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(i.TEXTURE1);const o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(o),qe(i)&&(this._pbo=i.createBuffer(),i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.bufferData(i.PIXEL_PACK_BUFFER,4,i.STREAM_READ),i.bindBuffer(i.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,e){const n=this._updateCount;return this._readbackQueue?n>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():n>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,e),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,e=t.gl;t.activeTexture.set(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const i=this._cachedRenderContext.context,r=i.gl;if(this._bindFramebuffer(),i.viewport.set([0,0,this._texWidth,this._texHeight]),i.clear({color:e.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(i,r.TRIANGLES,Ve.disabled,Ge.disabled,Be.unblended,je.disabled,((t,e)=>({u_input:t,u_output_expected:e}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&qe(r)){r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null);const t=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);r.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:t}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&qe(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return e.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ze._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let e=0;return e+=t[0]/256,e+=t[1]/65536,e+=t[2]/16777216,t[3]<127&&(e=-e),e/128}}const Xe=e.$/128;function Ye(t,n){const i=void 0!==t.granularity?Math.max(t.granularity,1):1,r=i+(t.generateBorders?2:0),a=i+(t.extendToNorthPole||t.generateBorders?1:0)+(t.extendToSouthPole||t.generateBorders?1:0),o=r+1,s=a+1,l=t.generateBorders?-1:0,c=t.generateBorders||t.extendToNorthPole?-1:0,u=i+(t.generateBorders?1:0),h=i+(t.generateBorders||t.extendToSouthPole?1:0),d=o*s,p=r*a*6,f=o*s>65536;if(f&&"16bit"===n)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const m=f||"32bit"===n,g=new Int16Array(2*d);let y=0;for(let x=c;x<=h;x++)for(let n=l;n<=u;n++){let r=n/i*e.$;-1===n&&(r=-Xe),n===i+1&&(r=e.$+Xe);let a=x/i*e.$;-1===x&&(a=t.extendToNorthPole?e.bh:-Xe),x===i+1&&(a=t.extendToSouthPole?e.bi:e.$+Xe),g[y++]=r,g[y++]=a}const v=m?new Uint32Array(p):new Uint16Array(p);let _=0;for(let e=0;e<a;e++)for(let t=0;t<r;t++){const n=t+1+e*o,i=t+(e+1)*o,r=t+1+(e+1)*o;v[_++]=t+e*o,v[_++]=i,v[_++]=n,v[_++]=n,v[_++]=i,v[_++]=r}return{vertices:g.buffer.slice(0),indices:v.buffer.slice(0),uses32bitIndices:m}}const Ke=new e.aK({fill:new e.bj(128,2),line:new e.bj(512,0),tile:new e.bj(128,32),stencil:new e.bj(128,1),circle:3});class Je{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return xe.projectionGlobe}get vertexShaderPreludeCode(){return xe.projectionMercator.vertexSource}get subdivisionGranularity(){return Ke}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Ze(t));const n=e.U(this._errorQueryLatitudeDegrees),i=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,r=this._errorMeasurement.updateErrorLoop(n,i),a=o.now();r!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=r,this._errorMeasurementLastChangeTime=a);const s=Math.min(Math.max((a-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=e.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,e.bl(s))}_getMeshKey(t){return"".concat(t.granularity.toString(36),"_").concat(t.generateBorders?"b":"").concat(t.extendToNorthPole?"n":"").concat(t.extendToSouthPole?"s":"")}getMeshFromTileID(t,e,n,i,r){const a=("stencil"===r?Ke.stencil:Ke.tile).getGranularityForZoomLevel(e.z);return this._getMesh(t,{granularity:a,generateBorders:n,extendToNorthPole:0===e.y&&i,extendToSouthPole:e.y===(1<<e.z)-1&&i})}_getMesh(t,n){const i=this._getMeshKey(n);if(i in this._tileMeshCache)return this._tileMeshCache[i];const r=function(t,n){const i=Ye(n,"16bit"),r=e.aL.deserialize({arrayBuffer:i.vertices,length:i.vertices.byteLength/2/2}),a=e.aN.deserialize({arrayBuffer:i.indices,length:i.indices.byteLength/2/3});return new we(t.createVertexBuffer(r,Se.members),t.createIndexBuffer(a),e.aM.simpleSegment(0,0,r.length,a.length))}(t,n);return this._tileMeshCache[i]=r,r}recalculate(t){}hasTransition(){const t=o.now();let e=!1;return e=e||(t-this._errorMeasurementLastChangeTime)/1e3<.7,e=e||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,e}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const $e=new e.r({type:new e.D(e.v.projection.type)});class Qe extends e.E{constructor(t){super(),this._transitionable=new e.t($e),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.F(0)),this._mercatorProjection=new Ee,this._verticalPerspectiveProjection=new Je}get transitionState(){const t=this.properties.get("type");if("string"==typeof t&&"mercator"===t)return 0;if("string"==typeof t&&"vertical-perspective"===t)return 1;if(t instanceof e.bm){if("vertical-perspective"===t.from&&"mercator"===t.to)return 1-t.transition;if("mercator"===t.from&&"vertical-perspective"===t.to)return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,e,n,i,r){return this.currentProjection.getMeshFromTileID(t,e,n,i,r)}setProjection(t){this._transitionable.setValue("type",(null==t?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function tn(t){const e=rn(t.worldSize,t.center.lat);return 2*Math.PI*e}function en(t,n,i,r,a){const o=1/(1<<a),s=n/e.$*o+r*o,l=e.bo((t/e.$*o+i*o)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function nn(t){return function(t,e){const n=Math.cos(e),i=new Float64Array(3);return i[0]=Math.sin(t)*n,i[1]=Math.sin(e),i[2]=Math.cos(t)*n,i}(t.lng*Math.PI/180,t.lat*Math.PI/180)}function rn(t,e){return t/(2*Math.PI)/Math.cos(e*Math.PI/180)}function an(t){const n=Math.asin(t[1])/Math.PI*180,i=Math.sqrt(t[0]*t[0]+t[2]*t[2]);if(i>1e-6){const r=t[0]/i,a=Math.acos(t[2]/i),o=(r>0?a:-a)/Math.PI*180;return new e.S(e.aO(o,-180,180),n)}return new e.S(0,n)}function on(t){return Math.cos(t*Math.PI/180)}function sn(t,n){const i=on(t),r=on(n);return e.ak(r/i)}function ln(t,n){const i=t.rotate(n.bearingInRadians),r=n.zoom+sn(n.center.lat,0),a=e.bk(1/on(n.center.lat),1/on(Math.min(Math.abs(n.center.lat),60)),e.bn(r,7,3,0,1)),o=360/tn({worldSize:n.worldSize,center:{lat:n.center.lat}});return new e.S(n.center.lng-i.x*o*a,e.ah(n.center.lat+i.y*o,-e.ai,e.ai))}function cn(t){const e=.5*t,n=Math.sin(e),i=Math.cos(e);return Math.log(n+i)-Math.log(i-n)}function un(t,n,i,r){const a=t.lat+i*r;if(Math.abs(i)>1){const o=(Math.sign(t.lat+i)!==Math.sign(t.lat)?-Math.abs(t.lat):Math.abs(t.lat))*Math.PI/180,s=Math.abs(t.lat+i)*Math.PI/180,l=cn(o+r*(s-o)),c=cn(o),u=cn(s);return new e.S(t.lng+n*((l-c)/(u-c)),a)}return new e.S(t.lng+n*r,a)}class hn{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,e,n,i){const r="".concat(t.z,"_").concat(t.x,"_").concat(t.y,"_").concat((null==i?void 0:i.terrain)?"t":""),a=this._cache.get(r);if(a)return a;const o=this._cachePrevious.get(r);if(o)return this._cache.set(r,o),o;const s=this._boundingVolumeFactory(t,e,n,i);return this._cache.set(r,s),this._hadAnyChanges=!0,s}}class dn{constructor(t,e,n,i){this.min=n,this.max=i,this.points=t,this.planes=e}static fromAabb(t,e){const n=[];for(let i=0;i<8;i++)n.push([1&~i?t[0]:e[0],1==(i>>1&1)?e[1]:t[1],1==(i>>2&1)?e[2]:t[2]]);return new dn(n,[[-1,0,0,e[0]],[1,0,0,-t[0]],[0,-1,0,e[1]],[0,1,0,-t[1]],[0,0,-1,e[2]],[0,0,1,-t[2]]],t,e)}static fromCenterSizeAngles(t,n,i){const r=e.br([],i[0],i[1],i[2]),a=e.bs([],[n[0],0,0],r),o=e.bs([],[0,n[1],0],r),s=e.bs([],[0,0,n[2]],r),l=[...t],c=[...t];for(let e=0;e<8;e++)for(let n=0;n<3;n++){const i=t[n]+a[n]*(1&~e?-1:1)+o[n]*(1==(e>>1&1)?1:-1)+s[n]*(1==(e>>2&1)?1:-1);l[n]=Math.min(l[n],i),c[n]=Math.max(c[n],i)}const u=[];for(let h=0;h<8;h++){const n=[...t];e.aS(n,n,e.aR([],a,1&~h?-1:1)),e.aS(n,n,e.aR([],o,1==(h>>1&1)?1:-1)),e.aS(n,n,e.aR([],s,1==(h>>2&1)?1:-1)),u.push(n)}return new dn(u,[[...a,-e.aX(a,u[0])],[...o,-e.aX(o,u[0])],[...s,-e.aX(s,u[0])],[-a[0],-a[1],-a[2],-e.aX(a,u[7])],[-o[0],-o[1],-o[2],-e.aX(o,u[7])],[-s[0],-s[1],-s[2],-e.aX(s,u[7])]],l,c)}intersectsFrustum(t){let e=!0;const n=this.points.length,i=this.planes.length,r=t.planes.length,a=t.points.length;for(let o=0;o<r;o++){const i=t.planes[o];let r=0;for(let t=0;t<n;t++){const e=this.points[t];i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0&&r++}if(0===r)return 0;r<n&&(e=!1)}if(e)return 2;for(let o=0;o<i;o++){const e=this.planes[o];let n=0;for(let i=0;i<a;i++){const r=t.points[i];e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]>=0&&n++}if(0===n)return 0}return 1}intersectsPlane(t){const e=this.points.length;let n=0;for(let i=0;i<e;i++){const e=this.points[i];t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0&&n++}return n===e?2:0===n?0:1}}function pn(t,e,n){const i=t-e;return i<0?-i:Math.max(0,i-n)}function fn(t,e,n,i,r){const a=t-n;let o;return o=a<0?Math.min(-a,1+a-r):a>1?Math.min(Math.max(a-r,0),1-a):0,Math.max(o,pn(e,i,r))}class mn{constructor(){this._boundingVolumeCache=new hn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,e,n,i){const r=1<<n.z,a=1/r,o=n.x/r,s=n.y/r;let l=2;return l=Math.min(l,fn(t,e,o,s,a)),l=Math.min(l,fn(t,e,o+.5,-s-a,a)),l=Math.min(l,fn(t,e,o+.5,2-s-a,a)),l}getWrap(t,e,n){const i=1<<e.z,r=1/i,a=e.x/i,o=pn(t.x,a,r),s=pn(t.x,a-1,r),l=pn(t.x,a+1,r),c=Math.min(o,s,l);return c===l?1:c===s?-1:0}allowVariableZoom(t,e){return yt(t,e)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,e,n,i){return this._boundingVolumeCache.getTileBoundingVolume(t,e,n,i)}_computeTileBoundingVolume(t,n,i,r){var a,o;let s=0,l=0;if(null==r?void 0:r.terrain){const c=new e.Z(t.z,n,t.z,t.x,t.y),u=r.terrain.getMinMaxElevation(c);s=null!==(a=u.minElevation)&&void 0!==a?a:Math.min(0,i),l=null!==(o=u.maxElevation)&&void 0!==o?o:Math.max(0,i)}if(s/=e.bu,l/=e.bu,s+=1,l+=1,t.z<=0)return dn.fromAabb([-l,-l,-l],[l,l,l]);if(1===t.z)return dn.fromAabb([0===t.x?-l:0,0===t.y?0:-l,-l],[0===t.x?0:l,0===t.y?l:0,l]);{const n=[en(0,0,t.x,t.y,t.z),en(e.$,0,t.x,t.y,t.z),en(e.$,e.$,t.x,t.y,t.z),en(0,e.$,t.x,t.y,t.z)],i=[];for(const t of n)i.push(e.aR([],t,l));if(l!==s)for(const t of n)i.push(e.aR([],t,s));0===t.y&&i.push([0,1,0]),t.y===(1<<t.z)-1&&i.push([0,-1,0]);const r=[1,1,1],a=[-1,-1,-1];for(const t of i)for(let e=0;e<3;e++)r[e]=Math.min(r[e],t[e]),a[e]=Math.max(a[e],t[e]);const o=en(e.$/2,e.$/2,t.x,t.y,t.z),c=e.aW([],[0,1,0],o);e.aV(c,c);const u=e.aW([],o,c);e.aV(u,u);const h=e.aW([],n[2],n[1]);e.aV(h,h);const d=e.aW([],n[0],n[3]);e.aV(d,d),i.push(e.aR([],o,l)),t.y>=(1<<t.z)/2&&i.push(e.aR([],en(e.$/2,0,t.x,t.y,t.z),l)),t.y<(1<<t.z)/2&&i.push(e.aR([],en(e.$/2,e.$,t.x,t.y,t.z),l));const p=gn(o,i),f=gn(u,i),m=[-o[0],-o[1],-o[2],p.max],g=[o[0],o[1],o[2],-p.min],y=[-u[0],-u[1],-u[2],f.max],v=[u[0],u[1],u[2],-f.min],_=[...h,0],x=[...d,0],b=[];return 0===t.y?b.push(e.bt(x,_,m),e.bt(x,_,g)):b.push(e.bt(y,_,m),e.bt(y,_,g),e.bt(y,x,m),e.bt(y,x,g)),t.y===(1<<t.z)-1?b.push(e.bt(x,_,m),e.bt(x,_,g)):b.push(e.bt(v,_,m),e.bt(v,_,g),e.bt(v,x,m),e.bt(v,x,g)),new dn(b,[m,g,y,v,_,x],r,a)}}}function gn(t,n){let i=1/0,r=-1/0;for(const a of n){const n=e.aX(t,a);i=Math.min(i,n),r=Math.max(r,n)}return{min:i,max:r}}class yn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,n){return this._helper.interpolatePadding(t,e,n)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){this._helper.resize(t,e)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=e.bv(),this._projectionMatrix=e.b9(),this._globeViewProjMatrix32f=e.b8(),this._globeViewProjMatrixNoCorrection=e.b9(),this._globeViewProjMatrixNoCorrectionInverted=e.b9(),this._globeProjMatrixInverted=e.b9(),this._cameraPosition=e.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ie({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)}),this._coveringTilesDetailsProvider=new mn}clone(){const t=new yn;return t.apply(this),t}apply(t,e){this._globeLatitudeErrorCorrectionRadians=e||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=e.bp();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:e,applyGlobeMatrix:n}=t,i=this._helper.getMercatorTileCoordinates(e);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:i,clippingPlane:this._cachedClippingPlane,projectionTransition:n?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,i=this.cameraToCenterDistance/t,r=Math.sin(n)*i,a=Math.cos(n)*i+1,o=1/Math.sqrt(r*r+a*a)*1;let s=-r,l=a;const c=Math.sqrt(s*s+l*l);s/=c,l/=c;const u=[0,s,l];e.bw(u,u,[0,0,0],-this.bearingInRadians),e.bx(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),e.by(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/e.aZ(u);return e.aR(u,u,h),[...u,-o*h]}isLocationOccluded(t){return!this.isSurfacePointVisible(nn(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,i=this._helper._center.lat*Math.PI/180,r=Math.cos(i),a=[Math.sin(n)*r,Math.sin(i),Math.cos(n)*r],o=[a[2],0,-a[0]],s=[0,0,0];e.aW(s,o,a),e.aV(o,o),e.aV(s,s);const l=[0,0,0];return e.aV(l,[o[0]*t[0]+s[0]*t[1]+a[0]*t[2],o[1]*t[0]+s[1]*t[1]+a[1]*t[2],o[2]*t[0]+s[2]*t[1]+a[2]*t[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,i){const r=function(t,n,i){const r=1/(1<<i.z);return new e.a1(t/e.$*r+i.x*r,n/e.$*r+i.y*r)}(t,n,i.canonical),a=(o=r.y,[e.bo(r.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI]);var o;return this.getCircleRadiusCorrection()/Math.cos(a[1])}projectTileCoordinates(t,n,i,r){const a=i.canonical,o=en(t,n,a.x,a.y,a.z),s=1+(r?r(t,n):0)/e.bu,l=[o[0]*s,o[1]*s,o[2]*s,1];e.aw(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*o[0]+c[1]*o[1]+c[2]*o[2]+c[3]<0;return{point:new e.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=rn(this.worldSize,this.center.lat),n=e.ba(),i=e.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),e.b4(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const r=this.centerOffset;n[8]=2*-r.x/this._helper._width,n[9]=2*r.y/this._helper._height,this._projectionMatrix=e.b5(n),this._globeProjMatrixInverted=e.ba(),e.aq(this._globeProjMatrixInverted,n),e.M(n,n,[0,0,-this.cameraToCenterDistance]),e.b6(n,n,this.rollInRadians),e.b7(n,n,-this.pitchInRadians),e.b6(n,n,this.bearingInRadians),e.M(n,n,[0,0,-t]);const a=e.bp();a[0]=t,a[1]=t,a[2]=t,e.b7(i,n,this.center.lat*Math.PI/180),e.bz(i,i,-this.center.lng*Math.PI/180),e.N(i,i,a),this._globeViewProjMatrixNoCorrection=i,e.b7(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),e.bz(n,n,-this.center.lng*Math.PI/180),e.N(n,n,a),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=e.ba(),e.aq(this._globeViewProjMatrixNoCorrectionInverted,i);const o=e.bp();this._cameraPosition=e.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/t,e.bw(this._cameraPosition,this._cameraPosition,o,-this.rollInRadians),e.bx(this._cameraPosition,this._cameraPosition,o,this.pitchInRadians),e.bw(this._cameraPosition,this._cameraPosition,o,-this.bearingInRadians),e.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),e.bx(this._cameraPosition,this._cameraPosition,o,-this.center.lat*Math.PI/180),e.by(this._cameraPosition,this._cameraPosition,o,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const s=e.b5(this._globeViewProjMatrixNoCorrectionInverted);e.N(s,s,[1,1,-1]),this._cachedFrustum=Le.fromInvProjectionMatrix(s,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){e.w("calculateFogMatrix is not supported on globe projection.");const n=e.ba();return e.ag(n),n}getVisibleUnwrappedCoordinates(t){return[new e.b2(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&e.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const i=nn(t);e.aR(i,i,1+n/e.bu);const r=e.bv();return e.aw(r,[i[0],i[1],i[2],1],this._globeViewProjMatrixNoCorrection),r[2]/r[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,i=[new e.P(0,0),new e.P(t,0),new e.P(this.width,0),new e.P(this.width,n),new e.P(this.width,this.height),new e.P(t,this.height),new e.P(0,this.height),new e.P(0,n)],r=[];for(const e of i)r.push(this.unprojectScreenPoint(e));let a=0,o=0,s=0,l=0;const c=this.center;for(const h of r){const t=e.bA(c.lng,h.lng),n=e.bA(c.lat,h.lat);t<o&&(o=t),t>a&&(a=t),n<l&&(l=n),n>s&&(s=n)}const u=[c.lng+o,c.lat+l,c.lng+a,c.lat+s];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new H(u)}getConstrained(t,n){const i=e.ah(t.lat,-e.ai,e.ai),r=e.ah(+n,this.minZoom+sn(0,i),this.maxZoom);return{center:new e.S(t.lng,i),zoom:r}}calculateCenterFromCameraLngLatAlt(t,e,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,n,i)}setLocationAtPoint(t,n){const i=nn(this.unprojectScreenPoint(n)),r=nn(t),a=e.bp();e.bB(a);const o=e.bp();e.by(o,i,a,-this.center.lng*Math.PI/180),e.bx(o,o,a,this.center.lat*Math.PI/180);const s=r[0]*r[0]+r[2]*r[2],l=o[0]*o[0];if(s<l)return;const c=Math.sqrt(s-l),u=-c,h=e.bC(r[0],r[2],o[0],c),d=e.bC(r[0],r[2],o[0],u),p=e.bp();e.by(p,r,a,-h);const f=e.bC(p[1],p[2],o[1],o[2]),m=e.bp();e.by(m,r,a,-d);const g=e.bC(m[1],m[2],o[1],o[2]),y=.5*Math.PI,v=f>=-y&&f<=y,_=g>=-y&&g<=y;let x,b;if(v&&_){const t=this.center.lng*Math.PI/180,n=this.center.lat*Math.PI/180;e.bD(h,t)+e.bD(f,n)<e.bD(d,t)+e.bD(g,n)?(x=h,b=f):(x=d,b=g)}else if(v)x=h,b=f;else{if(!_)return;x=d,b=g}const w=x/Math.PI*180,S=b/Math.PI*180,M=this.center.lat;this.setCenter(new e.S(w,e.ah(S,-90,90))),this.setZoom(this.zoom+sn(M,this.center.lat))}locationToScreenPoint(t,n){const i=nn(t);if(n){const r=n.getElevationForLngLatZoom(t,this._helper._tileZoom);e.aR(i,i,1+r/e.bu)}return this._projectSurfacePointToScreen(i)}_projectSurfacePointToScreen(t){const n=e.bv();return e.aw(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new e.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const e=n.pointCoordinate(t);if(e)return e}return e.a1.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,e){var n;return null===(n=this.screenPointToMercatorCoordinate(t,e))||void 0===n?void 0:n.toLngLat()}isPointOnMapSurface(t,e){const n=this._cameraPosition,i=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(n,i)}getRayDirectionFromPixel(t){const n=e.bv();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,e.aw(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const i=e.bp();i[0]=n[0]-this._cameraPosition[0],i[1]=n[1]-this._cameraPosition[1],i[2]=n[2]-this._cameraPosition[2];const r=e.bp();return e.aV(r,i),r}isSurfacePointVisible(t){const e=this._cachedClippingPlane;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=e.bv();return e.aw(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const i=e.aX(t,n),r=e.bp(),a=e.bp();e.aR(a,n,i),e.aU(r,t,a);const o=1-e.aX(r,r);if(o<0)return null;const s=e.aX(t,t)-1,l=-i+(i<0?1:-1)*Math.sqrt(o),c=s/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(t){const n=this._cameraPosition,i=this.getRayDirectionFromPixel(t),r=this.rayPlanetIntersection(n,i);if(r){const t=e.bp();e.aS(t,n,[i[0]*r.tMin,i[1]*r.tMin,i[2]*r.tMin]);const a=e.bp();return e.aV(a,t),an(a)}const a=this._cachedClippingPlane,o=a[0]*i[0]+a[1]*i[1]+a[2]*i[2],s=-e.b1(a,n)/o,l=e.bp();if(s>0)e.aS(l,n,[i[0]*s,i[1]*s,i[2]*s]);else{const t=e.bp();e.aS(t,n,[2*i[0],2*i[1],2*i[2]]);const r=e.b1(this._cachedClippingPlane,t);e.aU(l,t,[this._cachedClippingPlane[0]*r,this._cachedClippingPlane[1]*r,this._cachedClippingPlane[2]*r])}const c=function(t){const n=e.bp();return n[0]=t[0]*-t[3],n[1]=t[1]*-t[3],n[2]=t[2]*-t[3],{center:n,radius:Math.sqrt(1-t[3]*t[3])}}(a);return an(function(t,n,i){const r=e.bp();e.aU(r,i,t);const a=e.bp();return e.bq(a,t,r,n/e.a$(r)),a}(c.center,c.radius,l))}getMatrixForModel(t,n){const i=e.S.convert(t),r=1/e.bu,a=e.b9();return e.bz(a,a,i.lng/180*Math.PI),e.b7(a,a,-i.lat/180*Math.PI),e.M(a,a,[0,0,1+n/e.bu]),e.b7(a,a,.5*Math.PI),e.N(a,a,[r,r,r]),a}getProjectionDataForCustomLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const n=this.getProjectionData({overscaledTileID:new e.Z(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class vn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,n){return this._helper.interpolatePadding(t,e,n)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._helper.resize(t,e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,e){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=e,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ie({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)}),this._globeness=1,this._mercatorTransform=new De,this._verticalPerspectiveTransform=new yn}clone(){const t=new vn;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const e=this._mercatorTransform.getProjectionData(t),n=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?n.mainMatrix:e.mainMatrix,clippingPlane:n.clippingPlane,tileMercatorCoords:n.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:e.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return e.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return e.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,i){const r=this._mercatorTransform.getPitchedTextCorrection(t,n,i),a=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,i);return e.bk(r,a,this._globeness)}projectTileCoordinates(t,e,n,i){return this.currentTransform.projectTileCoordinates(t,e,n,i)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,e){return this.currentTransform.lngLatToCameraDepth(t,e)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,e){return this.currentTransform.getConstrained(t,e)}calculateCenterFromCameraLngLatAlt(t,e,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,n,i)}setLocationAtPoint(t,e){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,e),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,e),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,e){return this.currentTransform.locationToScreenPoint(t,e)}screenPointToMercatorCoordinate(t,e){return this.currentTransform.screenPointToMercatorCoordinate(t,e)}screenPointToLocation(t,e){return this.currentTransform.screenPointToLocation(t,e)}isPointOnMapSurface(t,e){return this.currentTransform.isPointOnMapSurface(t,e)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,e){return this.currentTransform.getMatrixForModel(t,e)}getProjectionDataForCustomLayer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return e;const n=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return n.fallbackMatrix=e.mainMatrix,n}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class _n{get useGlobeControls(){return!0}handlePanInertia(t,n){const i=ln(t,n);return Math.abs(i.lng-n.center.lng)>180&&(i.lng=n.center.lng+179.5*Math.sign(i.lng-n.center.lng)),{easingCenter:i,easingOffset:new e.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const i=t.around,r=n.screenPointToLocation(i);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const a=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const o=n.zoom-a;if(0===o)return;const s=e.bA(n.center.lng,r.lng),l=s/(Math.abs(s/180)+1),c=e.bA(n.center.lat,r.lat),u=n.getRayDirectionFromPixel(i),h=n.cameraPosition,d=-1*e.aX(h,u),p=e.bp();e.aS(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=e.aZ(p)-1,m=Math.exp(.5*-Math.max(f-.3,0)),g=rn(n.worldSize,n.center.lat)/Math.min(n.width,n.height),y=e.bn(g,.9,.5,1,.25),v=(1-e.af(-o))*Math.min(m,y),_=n.center.lat,x=n.zoom,b=new e.S(n.center.lng+l*v,e.ah(n.center.lat+c*v,-e.ai,e.ai));n.setLocationAtPoint(r,i);const w=n.center,S=e.bn(Math.abs(s),45,85,0,1),M=e.bn(g,.75,.35,0,1),T=Math.pow(Math.max(S,M),.25),E=e.bA(w.lng,b.lng),A=e.bA(w.lat,b.lat);n.setCenter(new e.S(w.lng+E*T,w.lat+A*T).wrap()),n.setZoom(x+sn(_,n.center.lat))}handleMapControlsPan(t,e,n){if(!t.panDelta)return;const i=e.center.lat,r=e.zoom;e.setCenter(ln(t.panDelta,e).wrap()),e.setZoom(r+sn(i,e.center.lat))}cameraForBoxAndBearing(t,n,i,r,a){const o=Oe(t,n,i,r,a),s=n.left/a.width*2-1,l=(a.width-n.right)/a.width*2-1,c=n.top/a.height*-2+1,u=(a.height-n.bottom)/a.height*-2+1,h=e.bA(i.getWest(),i.getEast())<0,d=h?i.getEast():i.getWest(),p=h?i.getWest():i.getEast(),f=Math.max(i.getNorth(),i.getSouth()),m=Math.min(i.getNorth(),i.getSouth()),g=d+.5*e.bA(d,p),y=f+.5*e.bA(f,m),v=a.clone();v.setCenter(o.center),v.setBearing(o.bearing),v.setPitch(0),v.setRoll(0),v.setZoom(o.zoom);const _=v.modelViewProjectionMatrix,x=[nn(i.getNorthWest()),nn(i.getNorthEast()),nn(i.getSouthWest()),nn(i.getSouthEast()),nn(new e.S(p,y)),nn(new e.S(d,y)),nn(new e.S(g,f)),nn(new e.S(g,m))],b=nn(o.center);let w=Number.POSITIVE_INFINITY;for(const e of x)s<0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,b,_,"x",s))),l>0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,b,_,"x",l))),c>0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,b,_,"y",c))),u<0&&(w=_n.getLesserNonNegativeNonNull(w,_n.solveVectorScale(e,b,_,"y",u)));if(Number.isFinite(w)&&0!==w)return o.zoom=v.zoom+e.ak(w),o;ze()}handleJumpToCenterZoom(t,n){const i=t.center.lat,r=t.getConstrained(n.center?e.S.convert(n.center):t.center,t.zoom).center;t.setCenter(r.wrap());const a=void 0!==n.zoom?+n.zoom:t.zoom+sn(i,r.lat);t.zoom!==a&&t.setZoom(a)}handleEaseTo(t,n){const i=t.zoom,r=t.center,a=t.padding,o={roll:t.roll,pitch:t.pitch,bearing:t.bearing},s={roll:void 0===n.roll?t.roll:n.roll,pitch:void 0===n.pitch?t.pitch:n.pitch,bearing:void 0===n.bearing?t.bearing:n.bearing},l=void 0!==n.zoom,c=!t.isPaddingEqual(n.padding);let u=!1;const h=n.center?e.S.convert(n.center):r,d=t.getConstrained(h,i).center;Ce(t,d);const p=t.clone();p.setCenter(d),p.setZoom(l?+n.zoom:i+sn(r.lat,h.lat)),p.setBearing(n.bearing);const f=new e.P(e.ah(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),e.ah(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));p.setLocationAtPoint(d,f);const m=(n.offset&&n.offsetAsPoint.mag())>0?p.center:d,g=l?+n.zoom:i+sn(r.lat,m.lat),y=i+sn(r.lat,0),v=g+sn(m.lat,0),_=e.bA(r.lng,m.lng),x=e.bA(r.lat,m.lat),b=e.af(v-y);return u=g!==i,{easeFunc:i=>{if(e.be(o,s)||Ne({startEulerAngles:o,endEulerAngles:s,tr:t,k:i,useSlerp:o.roll!=s.roll}),c&&t.interpolatePadding(a,n.padding,i),n.around)e.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const e=v>y?Math.min(2,b):Math.max(.5,b),n=Math.pow(e,1-i),a=un(r,_,x,i*n);t.setCenter(a.wrap())}if(u){const n=e.C.number(y,v,i)+sn(0,t.center.lat);t.setZoom(n)}},isZooming:u,elevationCenter:m}}handleFlyTo(t,n){const i=void 0!==n.zoom,r=t.center,a=t.zoom,o=t.padding,s=!t.isPaddingEqual(n.padding),l=t.getConstrained(e.S.convert(n.center||n.locationAtOffset),a).center,c=i?+n.zoom:t.zoom+sn(t.center.lat,l.lat),u=t.clone();u.setCenter(l),u.setZoom(c),u.setBearing(n.bearing);const h=new e.P(e.ah(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),e.ah(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));u.setLocationAtPoint(l,h);const d=u.center;Ce(t,d);const p=function(t,n,i){const r=nn(n),a=nn(i),o=e.aX(r,a),s=Math.acos(o),l=tn(t);return s/(2*Math.PI)*l}(t,r,d),f=a+sn(r.lat,0),m=c+sn(d.lat,0),g=e.af(m-f);let y;if("number"==typeof n.minZoom){const i=+n.minZoom+sn(d.lat,0),r=Math.min(i,f,m)+sn(0,d.lat),a=t.getConstrained(d,r).zoom+sn(d.lat,0);y=e.af(a-f)}const v=e.bA(r.lng,d.lng),_=e.bA(r.lat,d.lat);return{easeFunc:(i,a,l,u)=>{const h=un(r,v,_,l);s&&t.interpolatePadding(o,n.padding,i);const p=1===i?d:h;t.setCenter(p.wrap());const m=f+e.ak(a);t.setZoom(1===i?c:m+sn(0,p.lat))},scaleOfZoom:g,targetCenter:d,scaleOfMinZoom:y,pixelPathLength:p}}static solveVectorScale(t,e,n,i,r){const a="x"===i?[n[0],n[4],n[8],n[12]]:[n[1],n[5],n[9],n[13]],o=[n[3],n[7],n[11],n[15]],s=t[0]*a[0]+t[1]*a[1]+t[2]*a[2],l=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],c=e[0]*a[0]+e[1]*a[1]+e[2]*a[2],u=e[0]*o[0]+e[1]*o[1]+e[2]*o[2];return c+r*l===s+r*u||o[3]*(s-c)+a[3]*(u-l)+s*u==c*l?null:(c+a[3]-r*u-r*o[3])/(c-s-r*u+r*l)}static getLesserNonNegativeNonNull(t,e){return null!==e&&e>=0&&e<t?e:t}}class xn{constructor(t){this._globe=t,this._mercatorCameraHelper=new Fe,this._verticalPerspectiveCameraHelper=new _n}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,e){return this.currentHelper.handlePanInertia(t,e)}handleMapControlsRollPitchBearingZoom(t,e){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,e)}handleMapControlsPan(t,e,n){this.currentHelper.handleMapControlsPan(t,e,n)}cameraForBoxAndBearing(t,e,n,i,r){return this.currentHelper.cameraForBoxAndBearing(t,e,n,i,r)}handleJumpToCenterZoom(t,e){this.currentHelper.handleJumpToCenterZoom(t,e)}handleEaseTo(t,e){return this.currentHelper.handleEaseTo(t,e)}handleFlyTo(t,e){return this.currentHelper.handleFlyTo(t,e)}}const bn=(t,n)=>e.y(t,n&&n.filter(t=>"source.canvas"!==t.identifier)),wn=e.bE();class Sn extends e.E{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const t in this.sourceCaches){const e=this.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||this.sourceCaches[t].reload()}},this.map=t,this.dispatcher=new N(z(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(t,e)=>this.getGlyphs(t,e)),this.dispatcher.registerMessageHandler("GI",(t,e)=>this.getImages(t,e)),this.imageManager=new _,this.imageManager.setEventedParent(this),this.glyphManager=new S(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new P(256,512),this.crossTileSymbolIndex=new ve,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",e.bG()),it().on(tt,this._rtlPluginLoaded),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const n=e.getSource();if(n&&n.vectorLayerIds)for(const i in this._layers){const t=this._layers[i];t.source===n.id&&this._validateLayer(t)}})}setGlobalStateProperty(t,n){var i,r,a;this._checkLoaded();const o=null===n?null!==(a=null===(r=null===(i=this.stylesheet.state)||void 0===i?void 0:i[t])||void 0===r?void 0:r.default)&&void 0!==a?a:null:n;if(e.bH(o,this._globalState[t]))return this;this._globalState[t]=o;const s=this._findGlobalStateAffectedSources([t]);for(const e in this.sourceCaches)s.has(e)&&(this._reloadSource(e),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const r in t)!e.bH(this._globalState[r],t[r].default)&&(n.push(r),this._globalState[r]=t[r].default);const i=this._findGlobalStateAffectedSources(n);for(const e in this.sourceCaches)i.has(e)&&(this._reloadSource(e),this._changed=!0)}_findGlobalStateAffectedSources(t){if(0===t.length)return new Set;const e=new Set;for(const n in this._layers){const i=this._layers[n],r=i.getLayoutAffectingGlobalStateRefs();for(const n of t)r.has(n)&&e.add(i.source)}return e}loadURL(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.fire(new e.l("dataloading",{dataType:"style"})),n.validate="boolean"!=typeof n.validate||n.validate;const r=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const a=this._loadStyleRequest;e.j(r,this._loadStyleRequest).then(t=>{this._loadStyleRequest=null,this._load(t.data,n,i)}).catch(t=>{this._loadStyleRequest=null,t&&!a.signal.aborted&&this.fire(new e.k(t))})}loadJSON(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.fire(new e.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=!1!==n.validate,this._load(t,n,i)}).catch(()=>{})}loadEmpty(){this.fire(new e.l("dataloading",{dataType:"style"})),this._load(wn,{validate:!1})}_load(t,n,i){var r,a,o;const s=n.transformStyle?n.transformStyle(i,t):t;if(!n.validate||!bn(this,e.z(s))){this._loaded=!0,this.stylesheet=s;for(const t in s.sources)this.addSource(t,s.sources[t],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs),this._createLayers(),this.light=new E(this.stylesheet.light),this._setProjectionInternal((null===(r=this.stylesheet.projection)||void 0===r?void 0:r.type)||"mercator"),this.sky=new C(this.stylesheet.sky),this.map.setTerrain(null!==(a=this.stylesheet.terrain)&&void 0!==a?a:null),this.setGlobalState(null!==(o=this.stylesheet.state)&&void 0!==o?o:null),this.fire(new e.l("data",{dataType:"style"})),this.fire(new e.l("style.load"))}}_createLayers(){const t=e.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(t=>t.id),this._layers={},this._serializedLayers=null;for(const n of t){const t=e.bJ(n);t.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=t}}_loadSprite(t){let n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(t,n,i,r){return e._(this,void 0,void 0,function*(){const a=g(t),s=i>1?"@2x":"",l={},c={};for(const{id:t,url:i}of a){const a=n.transformRequest(y(i,s,".json"),"SpriteJSON");l[t]=e.j(a,r);const o=n.transformRequest(y(i,s,".png"),"SpriteImage");c[t]=f.getImage(o,r)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(t,n){return e._(this,void 0,void 0,function*(){const e={};for(const i in t){e[i]={};const r=o.getImageCanvasContext((yield n[i]).data),a=(yield t[i]).data;for(const t in a){const{width:n,height:o,x:s,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=a[t];e[i][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:n,height:o,x:s,y:l,context:r}}}}return e})}(l,c)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(t=>{if(this._spriteRequest=null,t)for(const e in t){this._spritesImagesIds[e]=[];const n=this._spritesImagesIds[e]?this._spritesImagesIds[e].filter(e=>!(e in t)):[];for(const t of n)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const r in t[e]){const n="default"===e?r:"".concat(e,":").concat(r);this._spritesImagesIds[e].push(n),n in this.imageManager.images?this.imageManager.updateImage(n,t[e][r],!1):this.imageManager.addImage(n,t[e][r]),i&&(this._changedImages[n]=!0)}}}).catch(t=>{this._spriteRequest=null,n=t,this.fire(new e.k(n))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"})),r&&r(n)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const i=t.sourceLayer;if(!i)return;const r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new e.k(new Error('Source layer "'.concat(i,'" does not exist on source "').concat(r.id,'" as specified by style layer "').concat(t.id,'".'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._serializedAllLayers();if(!t||0===t.length)return Object.values(n?e.bK(i):i);const r=[];for(const a of t)if(i[a]){const t=n?e.bK(i[a]):i[a];r.push(t)}return r}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const n of e){const e=this._layers[n];"custom"!==e.type&&(t[n]=e.serialize())}return t}hasTransitions(){var t,e,n;if(null===(t=this.light)||void 0===t?void 0:t.hasTransition())return!0;if(null===(e=this.sky)||void 0===e?void 0:e.hasTransition())return!0;if(null===(n=this.projection)||void 0===n?void 0:n.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const e=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(e.length||n.length)&&this._updateWorkerLayers(e,n);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error("Invalid action ".concat(e));this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const i in this._updatedPaintProps)this._layers[i].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const i={};for(const e in this.sourceCaches){const t=this.sourceCaches[e];i[e]=t.used,t.used=!1}for(const e of this._order){const n=this._layers[e];n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)&&n.source&&(this.sourceCaches[n.source].used=!0)}for(const r in i){const t=this.sourceCaches[r];!!i[r]!=!!t.used&&t.fire(new e.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:r}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new e.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;this._checkLoaded();const r=this.serialize();if(t=n.transformStyle?n.transformStyle(r,t):t,(null===(i=n.validate)||void 0===i||i)&&bn(this,e.z(t)))return!1;(t=e.bK(t)).layers=e.bI(t.layers);const a=e.bL(r,t),o=this._getOperationsToPerform(a);if(o.unimplemented.length>0)throw new Error("Unimplemented: ".concat(o.unimplemented.join(", "),"."));if(0===o.operations.length)return!1;for(const e of o.operations)e();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const e=[],n=[];for(const i of t)switch(i.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":e.push(()=>this.addLayer.apply(this,i.args));break;case"removeLayer":e.push(()=>this.removeLayer.apply(this,i.args));break;case"setPaintProperty":e.push(()=>this.setPaintProperty.apply(this,i.args));break;case"setLayoutProperty":e.push(()=>this.setLayoutProperty.apply(this,i.args));break;case"setFilter":e.push(()=>this.setFilter.apply(this,i.args));break;case"addSource":e.push(()=>this.addSource.apply(this,i.args));break;case"removeSource":e.push(()=>this.removeSource.apply(this,i.args));break;case"setLayerZoomRange":e.push(()=>this.setLayerZoomRange.apply(this,i.args));break;case"setLight":e.push(()=>this.setLight.apply(this,i.args));break;case"setGeoJSONSourceData":e.push(()=>this.setGeoJSONSourceData.apply(this,i.args));break;case"setGlyphs":e.push(()=>this.setGlyphs.apply(this,i.args));break;case"setSprite":e.push(()=>this.setSprite.apply(this,i.args));break;case"setTerrain":e.push(()=>this.map.setTerrain.apply(this,i.args));break;case"setSky":e.push(()=>this.setSky.apply(this,i.args));break;case"setProjection":this.setProjection.apply(this,i.args);break;case"setGlobalState":e.push(()=>this.setGlobalState.apply(this,i.args));break;case"setTransition":e.push(()=>{});break;default:n.push(i.command)}return{operations:e,unimplemented:n}}addImage(t,n){if(this.getImage(t))return this.fire(new e.k(new Error('An image named "'.concat(t,'" already exists.'))));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new e.k(new Error('An image named "'.concat(t,'" does not exist.'))));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error('Source "'.concat(t,'" already exists.'));if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.z.source,"sources.".concat(t),n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=this.sourceCaches[t]=new xt(t,n,this.dispatcher);r.style=this,r.setEventedParent(this,()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:t})),r.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.k(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(i,'" is using it.'))));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new e.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID=".concat(t));const n=this.sourceCaches[t].getSource();if("geojson"!==n.type)throw new Error("geojsonSource.type is ".concat(n.type,", which is !== 'geojson"));n.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.k(new Error('Layer "'.concat(r,'" already exists on this map.'))));let a;if("custom"===t.type){if(bn(this,e.bM(t)))return;a=e.bJ(t)}else{if("source"in t&&"object"==typeof t.source&&(this.addSource(r,t.source),t=e.bK(t),t=e.e(t,{source:r})),this._validate(e.z.layer,"layers.".concat(r),t,{arrayIndex:-1},i))return;a=e.bJ(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}})}const o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new e.k(new Error('Cannot add layer "'.concat(r,'" before non-existing layer "').concat(n,'".'))));else{if(this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a,this._removedLayers[r]&&a.source&&"custom"!==a.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.k(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be moved."))));if(t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new e.k(new Error('Cannot move layer "'.concat(t,'" before non-existing layer "').concat(n,'".')))):(this._order.splice(r,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new e.k(new Error('Cannot remove non-existing layer "'.concat(t,'".'))));n.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,i){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new e.k(new Error('Cannot set the zoom range of non-existing layer "'.concat(t,'".'))))}setFilter(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const r=this.getLayer(t);if(r){if(!e.bH(r.filter,n))return null==n?(r.setFilter(void 0),void this._updateLayer(r)):void(this._validate(e.z.filter,"layers.".concat(r.id,".filter"),n,null,i)||(r.setFilter(e.bK(n)),this._updateLayer(r)))}else this.fire(new e.k(new Error('Cannot filter non-existing layer "'.concat(t,'".'))))}getFilter(t){return e.bK(this.getLayer(t).filter)}setLayoutProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this.getLayer(t);a?e.bH(a.getLayoutProperty(n),i)||(a.setLayoutProperty(n,i,r),this._updateLayer(a)):this.fire(new e.k(new Error('Cannot style non-existing layer "'.concat(t,'".'))))}getLayoutProperty(t,n){const i=this.getLayer(t);if(i)return i.getLayoutProperty(n);this.fire(new e.k(new Error('Cannot get style of non-existing layer "'.concat(t,'".'))))}setPaintProperty(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this.getLayer(t);a?e.bH(a.getPaintProperty(n),i)||(a.setPaintProperty(n,i,r)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new e.k(new Error('Cannot style non-existing layer "'.concat(t,'".'))))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(t,n){this._checkLoaded();const i=t.source,r=t.sourceLayer,a=this.sourceCaches[i];if(void 0===a)return void this.fire(new e.k(new Error("The source '".concat(i,"' does not exist in the map's style."))));const o=a.getSource().type;"geojson"===o&&r?this.fire(new e.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===t.id&&this.fire(new e.k(new Error("The feature id parameter must be provided."))),a.setFeatureState(r,t.id,n)):this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const i=t.source,r=this.sourceCaches[i];if(void 0===r)return void this.fire(new e.k(new Error("The source '".concat(i,"' does not exist in the map's style."))));const a=r.getSource().type,o="vector"===a?t.sourceLayer:void 0;"vector"!==a||o?n&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.k(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(o,t.id,n):this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,i=t.sourceLayer,r=this.sourceCaches[n];if(void 0!==r)return"vector"!==r.getSource().type||i?(void 0===t.id&&this.fire(new e.k(new Error("The feature id parameter must be provided."))),r.getFeatureState(i,t.id)):void this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new e.k(new Error("The source '".concat(n,"' does not exist in the map's style."))))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=e.bN(this.sourceCaches,t=>t.serialize()),n=this._serializeByIds(this._order,!0),i=this.map.getTerrain()||void 0,r=this.stylesheet;return e.bO({version:r.version,name:r.name,metadata:r.metadata,light:r.light,sky:r.sky,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,projection:r.projection,sources:t,layers:n,terrain:i},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,n={},i=[];for(let a=this._order.length-1;a>=0;a--){const r=this._order[a];if(e(r)){n[r]=a;for(const e of t){const t=e[r];if(t)for(const e of t)i.push(e)}}}i.sort((t,e)=>e.intersectionZ-t.intersectionZ);const r=[];for(let a=this._order.length-1;a>=0;a--){const o=this._order[a];if(e(o))for(let t=i.length-1;t>=0;t--){const e=i[t].feature;if(n[e.layer.id]<a)break;r.push(e),i.pop()}else for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(t,n,i){n&&n.filter&&this._validate(e.z.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new e.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.k(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];r[n.source]=!0}}const a=[];n.availableImages=this._availableImages;const o=this._serializedAllLayers(),s=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,l=Object.assign(Object.assign({},n),{layers:s});for(const e in this.sourceCaches)n.layers&&!r[e]||a.push(B(this.sourceCaches[e],this._layers,o,t,l,i,this.map.terrain?(t,e,n)=>this.map.terrain.getElevation(t,e,n):void 0));return this.placement&&a.push(function(t,e,n,i,r,a,o){const s={},l=a.queryRenderedSymbols(i),c=[];for(const u of Object.keys(l).map(Number))c.push(o[u]);c.sort(U);for(const u of c){const n=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=s[t]=s[t]||[],i=n[t];i.sort((t,e)=>{const n=u.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex});for(const t of i)e.push(t)}}return function(t,e,n){for(const i in t)for(const r of t[i])j(r,n[e[i].source]);return t}(s,t,n)}(this._layers,o,this.sourceCaches,t,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(t,n){n&&n.filter&&this._validate(e.z.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this.sourceCaches[t];return i?function(t,e){const n=t.getRenderableIds().map(e=>t.getTileByID(e)),i=[],r={};for(let a=0;a<n.length;a++){const t=n[a],o=t.tileID.canonical.key;r[o]||(r[o]=!0,t.querySourceFeatures(i,e))}return i}(i,n):[]}getLight(){return this.light.getLight()}setLight(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();const i=this.light.getLight();let r=!1;for(const o in t)if(!e.bH(t[o],i[o])){r=!0;break}if(!r)return;const a={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(a)}getProjection(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.sky}setSky(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();const i=this.getSky();let r=!1;if(!t&&!i)return;if(t&&!i)r=!0;else if(!t&&i)r=!0;else for(const o in t)if(!e.bH(t[o],i[o])){r=!0;break}if(!r)return;const a={now:o.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(a)}_setProjectionInternal(t){const n=function(t){if(Array.isArray(t)){const e=new Qe({type:t});return{projection:e,transform:new vn,cameraHelper:new xn(e)}}switch(t){case"mercator":return{projection:new Ee,transform:new De,cameraHelper:new Fe};case"globe":{const t=new Qe({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:t,transform:new vn,cameraHelper:new xn(t)}}case"vertical-perspective":return{projection:new Je,transform:new yn,cameraHelper:new _n};default:return e.w("Unknown projection name: ".concat(t,". Falling back to mercator projection.")),{projection:new Ee,transform:new De,cameraHelper:new Fe}}}(t);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const e in this.sourceCaches)this.sourceCaches[e].reload()}_validate(t,n,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!a||!1!==a.validate)&&bn(this,t.call(e.z,e.e({key:n,style:this.serialize(),value:i,styleSpec:e.v},r)))}_remove(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),it().off(tt,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!1,s=!1;const l={};for(const o of this._order){const e=this._layers[o];if("symbol"!==e.type)continue;if(!l[e.source]){const t=this.sourceCaches[e.source];l[e.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const n=this.crossTileSymbolIndex.addLayer(e,l[e.source],t.center.lng);a=a||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((r=r||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.now(),t.zoom))&&(this.pauseablePlacement=new pe(t,this.map.terrain,this._order,r,e,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(const o of this._order){const t=this._layers[o];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n){return e._(this,void 0,void 0,function*(){const t=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const e=this.sourceCaches[n.source];return e&&e.setDependencies(n.tileID.key,n.type,n.icons),t})}getGlyphs(t,n){return e._(this,void 0,void 0,function*(){const t=yield this.glyphManager.getGlyphs(n.stacks),e=this.sourceCaches[n.source];return e&&e.setDependencies(n.tileID.key,n.type,[""]),t})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded(),t&&this._validate(e.z.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const a=[{id:t,url:n}],o=[...g(this.stylesheet.sprite),...a];this._validate(e.z.sprite,"sprite",o,null,i)||(this.stylesheet.sprite=o,this._loadSprite(a,!0,r))}removeSprite(t){this._checkLoaded();const n=g(this.stylesheet.sprite);if(n.find(e=>e.id===t)){if(this._spritesImagesIds[t])for(const e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;n.splice(n.findIndex(e=>e.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}else this.fire(new e.k(new Error('Sprite "'.concat(t,"\" doesn't exists on this map."))))}getSprite(){return g(this.stylesheet.sprite)}setSprite(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),t&&this._validate(e.z.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,i):(this._unloadSprite(),i&&i(null)))}}var Mn=e.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,n,i,r,a,o,s,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==i.length;for(let u=0;!c&&u<i.length;u++)this.boundPaintVertexBuffers[u]!==i[u]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==n||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,n,i,r,a,o,s,l):(t.bindVertexArray.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind(),l&&l.bind())}freshBind(t,e,n,i,r,a,o,s){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o,this.boundDynamicVertexBuffer3=s,e.enableAttributes(u,t);for(const h of n)h.enableAttributes(u,t);a&&a.enableAttributes(u,t),o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const h of n)h.bind(),h.setVertexAttribPointers(u,t,r);a&&(a.bind(),a.setVertexAttribPointers(u,t,r)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const En=(t,n,i,r,a)=>({u_texture:0,u_ele_delta:t,u_fog_matrix:n,u_fog_color:i?i.properties.get("fog-color"):e.bf.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?0:i?i.calculateFogBlendOpacity(r):0,u_horizon_color:i?i.properties.get("horizon-color"):e.bf.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:a?1:0}),An={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Cn(t){const e=[];for(let n=0;n<t.length;n++){if(null===t[n])continue;const i=t[n].split(" ");e.push(i.pop())}return e}class Pn{constructor(t,n,i,r,a,o,s,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[];const u=t.gl;this.program=u.createProgram();const h=Cn(n.staticAttributes),d=i?i.getBinderAttributes():[],p=h.concat(d),f=xe.prelude.staticUniforms?Cn(xe.prelude.staticUniforms):[],m=s.staticUniforms?Cn(s.staticUniforms):[],g=n.staticUniforms?Cn(n.staticUniforms):[],y=i?i.getBinderUniforms():[],v=f.concat(m).concat(g).concat(y),_=[];for(const e of v)_.indexOf(e)<0&&_.push(e);const x=i?i.defines():[];qe(u)&&x.unshift("#version 300 es"),a&&x.push("#define OVERDRAW_INSPECTOR;"),o&&x.push("#define TERRAIN3D;"),l&&x.push(l),c&&x.push(...c);let b=x.concat(xe.prelude.fragmentSource,s.fragmentSource,n.fragmentSource).join("\n"),w=x.concat(xe.prelude.vertexSource,s.vertexSource,n.vertexSource).join("\n");qe(u)||(b=function(t){return t.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(b),w=function(t){return t.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const S=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,b),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error("Could not compile fragment shader: ".concat(u.getShaderInfoLog(S)));u.attachShader(this.program,S);const M=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(M,w),u.compileShader(M),!u.getShaderParameter(M,u.COMPILE_STATUS))throw new Error("Could not compile vertex shader: ".concat(u.getShaderInfoLog(M)));u.attachShader(this.program,M),this.attributes={};const T={};this.numAttributes=p.length;for(let e=0;e<this.numAttributes;e++)p[e]&&(u.bindAttribLocation(this.program,e,p[e]),this.attributes[p[e]]=e);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error("Program failed to link: ".concat(u.getProgramInfoLog(this.program)));u.deleteShader(M),u.deleteShader(S);for(let e=0;e<_.length;e++){const t=_[e];if(t&&!T[t]){const e=u.getUniformLocation(this.program,t);e&&(T[t]=e)}}this.fixedUniforms=r(t,T),this.terrainUniforms=((t,n)=>({u_depth:new e.bP(t,n.u_depth),u_terrain:new e.bP(t,n.u_terrain),u_terrain_dim:new e.bg(t,n.u_terrain_dim),u_terrain_matrix:new e.bR(t,n.u_terrain_matrix),u_terrain_unpack:new e.bS(t,n.u_terrain_unpack),u_terrain_exaggeration:new e.bg(t,n.u_terrain_exaggeration)}))(t,T),this.projectionUniforms=((t,n)=>({u_projection_matrix:new e.bR(t,n.u_projection_matrix),u_projection_tile_mercator_coords:new e.bS(t,n.u_projection_tile_mercator_coords),u_projection_clipping_plane:new e.bS(t,n.u_projection_clipping_plane),u_projection_transition:new e.bg(t,n.u_projection_transition),u_projection_fallback_matrix:new e.bR(t,n.u_projection_fallback_matrix)}))(t,T),this.binderUniforms=i?i.getUniforms(t,T):[]}draw(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g,y,v){const _=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(a),s){t.activeTexture.set(_.TEXTURE2),_.bindTexture(_.TEXTURE_2D,s.depthTexture),t.activeTexture.set(_.TEXTURE3),_.bindTexture(_.TEXTURE_2D,s.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(s[t])}if(l)for(const b in l)this.projectionUniforms[An[b]].set(l[b]);if(o)for(const b in this.fixedUniforms)this.fixedUniforms[b].set(o[b]);m&&m.setUniforms(t,this.binderUniforms,p,{zoom:f});let x=0;switch(e){case _.LINES:x=2;break;case _.TRIANGLES:x=3;break;case _.LINE_STRIP:x=1}for(const b of d.get()){const n=b.vaos||(b.vaos={});(n[c]||(n[c]=new Tn)).bind(t,this,u,m?m.getPaintVertexBuffers():[],h,b.vertexOffset,g,y,v),_.drawElements(e,b.primitiveLength*x,_.UNSIGNED_SHORT,b.primitiveOffset*x*2)}}}function In(t,n,i){const r=1/e.aC(i,1,n.transform.tileZoom),a=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,n.transform.tileZoom)/a,s=o*(i.tileID.canonical.x+i.tileID.wrap*a),l=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,l>>16],u_pixel_coord_lower:[65535&s,65535&l]}}const Rn=(t,n,i,r)=>{const a=t.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=e.bV();"viewport"===a.properties.get("anchor")&&e.bW(l,t.transform.bearingInRadians),e.bX(s,s,l);const c=t.transform.transformLightDirection(s),u=a.properties.get("color");return{u_lightpos:s,u_lightpos_globe:c,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:i,u_fill_translate:r}},kn=(t,n,i,r,a,o,s)=>e.e(Rn(t,n,i,r),In(o,t,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8}),Ln=(t,n,i,r)=>e.e(In(n,t,i),{u_fill_translate:r}),Dn=(t,e)=>({u_world:t,u_fill_translate:e}),zn=(t,n,i,r,a)=>e.e(Ln(t,n,i,a),{u_world:r}),Nn=(t,n,i,r,a)=>{const o=t.transform;let s,l,c=0;if("map"===i.paint.get("circle-pitch-alignment")){const t=e.aC(n,1,o.zoom);s=!0,l=[t,t],c=t/(e.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*a}else s=!1,l=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_pitch_with_map:+s,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:r}},On=t=>({u_pixel_extrude_scale:[1/t.width,1/t.height]}),Fn=t=>({u_viewport_size:[t.width,t.height]}),Bn=function(t){return{u_color:t,u_overlay:0,u_overlay_scale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1}},Un=(t,n,i,r)=>{const a=e.aC(t,1,n)/(e.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*r;return{u_extrude_scale:e.aC(t,1,n),u_intensity:i,u_globe_extrude_scale:a}},jn=(t,n,i,r)=>{const a=e.L();e.bY(a,0,t.width,t.height,0,0,1);const o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:i,u_color_ramp:r,u_opacity:n.paint.get("heatmap-opacity")}},Vn=(t,e,n)=>{const i=n.paint.get("hillshade-accent-color");let r;switch(n.paint.get("hillshade-method")){case"basic":r=4;break;case"combined":r=1;break;case"igor":r=2;break;case"multidirectional":r=3;break;default:r=0}const a=n.getIlluminationProperties();for(let o=0;o<a.directionRadians.length;o++)"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a.directionRadians[o]+=t.transform.bearingInRadians);return{u_image:0,u_latrange:Gn(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:a.altitudeRadians,u_azimuths:a.directionRadians,u_accent:i,u_method:r,u_highlights:a.highlightColor,u_shadows:a.shadowColor}},Hn=(t,n)=>{const i=n.stride,r=e.L();return e.bY(r,0,e.$,-e.$,0,0,1),e.M(r,r,[0,-e.$,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ,u_unpack:n.getUnpackVector()}};function Gn(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.a1(0,r/i).toLngLat().lat,new e.a1(0,(r+1)/i).toLngLat().lat]}const Wn=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:t.paint.get("color-relief-opacity")}},qn=(t,n,i,r)=>{const a=t.transform;return{u_translation:Jn(t,n,i),u_ratio:r/e.aC(n,1,a.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Zn=(t,n,i,r,a)=>e.e(qn(t,n,i,r),{u_image:0,u_image_height:a}),Xn=(t,n,i,r,a)=>{const o=t.transform,s=Kn(n,o);return{u_translation:Jn(t,n,i),u_texsize:n.imageAtlasTexture.size,u_ratio:r/e.aC(n,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Yn=(t,n,i,r,a,o)=>{const s=t.lineAtlas,l=Kn(n,t.transform),c="round"===i.layout.get("line-cap"),u=s.getDash(a.from,c),h=s.getDash(a.to,c),d=u.width*o.fromScale,p=h.width*o.toScale;return e.e(qn(t,n,i,r),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:s.width/(256*Math.min(d,p)*t.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Kn(t,n){return 1/e.aC(t,1,n.tileZoom)}function Jn(t,n,i){return e.aD(t.transform,n,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const $n=(t,e,n,i,r)=>{return{u_tl_parent:t,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(o=i.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=i.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Qn(i.paint.get("raster-hue-rotate")),u_coords_top:[r[0].x,r[0].y,r[1].x,r[1].y],u_coords_bottom:[r[3].x,r[3].y,r[2].x,r[2].y]};var a,o};function Qn(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const ti=(t,e,n,i,r,a,o,s,l,c,u,h,d)=>{const p=o.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:p.width/p.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+i,u_is_along_line:r,u_is_variable_anchor:a,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},ei=(t,n,i,r,a,o,s,l,c,u,h,d,p,f)=>{const m=s.transform;return e.e(ti(t,n,i,r,a,o,s,l,c,u,h,d,f),{u_gamma_scale:r?Math.cos(m.pitch*Math.PI/180)*m.cameraToCenterDistance:1,u_device_pixel_ratio:s.pixelRatio,u_is_halo:1})},ni=(t,n,i,r,a,o,s,l,c,u,h,d,p)=>e.e(ei(t,n,i,r,a,o,s,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),ii=(t,e)=>({u_opacity:t,u_color:e}),ri=(t,n,i,r,a)=>e.e(function(t,n,i,r){const a=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:l}=i.imageManager.getPixelSize(),c=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(r.tileID.canonical.x+r.tileID.wrap*c),d=u*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:a.tl,u_pattern_br_a:a.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,l],u_mix:n.t,u_pattern_size_a:a.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:n.fromScale,u_scale_b:n.toScale,u_tile_units_to_pixels:1/e.aC(r,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(i,a,n,r),{u_opacity:t}),ai=(t,e)=>{},oi={fillExtrusion:(t,n)=>({u_lightpos:new e.bT(t,n.u_lightpos),u_lightpos_globe:new e.bT(t,n.u_lightpos_globe),u_lightintensity:new e.bg(t,n.u_lightintensity),u_lightcolor:new e.bT(t,n.u_lightcolor),u_vertical_gradient:new e.bg(t,n.u_vertical_gradient),u_opacity:new e.bg(t,n.u_opacity),u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillExtrusionPattern:(t,n)=>({u_lightpos:new e.bT(t,n.u_lightpos),u_lightpos_globe:new e.bT(t,n.u_lightpos_globe),u_lightintensity:new e.bg(t,n.u_lightintensity),u_lightcolor:new e.bT(t,n.u_lightcolor),u_vertical_gradient:new e.bg(t,n.u_vertical_gradient),u_height_factor:new e.bg(t,n.u_height_factor),u_opacity:new e.bg(t,n.u_opacity),u_fill_translate:new e.bU(t,n.u_fill_translate),u_image:new e.bP(t,n.u_image),u_texsize:new e.bU(t,n.u_texsize),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade)}),fill:(t,n)=>({u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillPattern:(t,n)=>({u_image:new e.bP(t,n.u_image),u_texsize:new e.bU(t,n.u_texsize),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade),u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillOutline:(t,n)=>({u_world:new e.bU(t,n.u_world),u_fill_translate:new e.bU(t,n.u_fill_translate)}),fillOutlinePattern:(t,n)=>({u_world:new e.bU(t,n.u_world),u_image:new e.bP(t,n.u_image),u_texsize:new e.bU(t,n.u_texsize),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade),u_fill_translate:new e.bU(t,n.u_fill_translate)}),circle:(t,n)=>({u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_scale_with_map:new e.bP(t,n.u_scale_with_map),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_extrude_scale:new e.bU(t,n.u_extrude_scale),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_globe_extrude_scale:new e.bg(t,n.u_globe_extrude_scale),u_translate:new e.bU(t,n.u_translate)}),collisionBox:(t,n)=>({u_pixel_extrude_scale:new e.bU(t,n.u_pixel_extrude_scale)}),collisionCircle:(t,n)=>({u_viewport_size:new e.bU(t,n.u_viewport_size)}),debug:(t,n)=>({u_color:new e.bQ(t,n.u_color),u_overlay:new e.bP(t,n.u_overlay),u_overlay_scale:new e.bg(t,n.u_overlay_scale)}),depth:ai,clippingMask:ai,heatmap:(t,n)=>({u_extrude_scale:new e.bg(t,n.u_extrude_scale),u_intensity:new e.bg(t,n.u_intensity),u_globe_extrude_scale:new e.bg(t,n.u_globe_extrude_scale)}),heatmapTexture:(t,n)=>({u_matrix:new e.bR(t,n.u_matrix),u_world:new e.bU(t,n.u_world),u_image:new e.bP(t,n.u_image),u_color_ramp:new e.bP(t,n.u_color_ramp),u_opacity:new e.bg(t,n.u_opacity)}),hillshade:(t,n)=>({u_image:new e.bP(t,n.u_image),u_latrange:new e.bU(t,n.u_latrange),u_exaggeration:new e.bg(t,n.u_exaggeration),u_altitudes:new e.b_(t,n.u_altitudes),u_azimuths:new e.b_(t,n.u_azimuths),u_accent:new e.bQ(t,n.u_accent),u_method:new e.bP(t,n.u_method),u_shadows:new e.bZ(t,n.u_shadows),u_highlights:new e.bZ(t,n.u_highlights)}),hillshadePrepare:(t,n)=>({u_matrix:new e.bR(t,n.u_matrix),u_image:new e.bP(t,n.u_image),u_dimension:new e.bU(t,n.u_dimension),u_zoom:new e.bg(t,n.u_zoom),u_unpack:new e.bS(t,n.u_unpack)}),colorRelief:(t,n)=>({u_image:new e.bP(t,n.u_image),u_unpack:new e.bS(t,n.u_unpack),u_dimension:new e.bU(t,n.u_dimension),u_elevation_stops:new e.bP(t,n.u_elevation_stops),u_color_stops:new e.bP(t,n.u_color_stops),u_color_ramp_size:new e.bP(t,n.u_color_ramp_size),u_opacity:new e.bg(t,n.u_opacity)}),line:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels)}),lineGradient:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels),u_image:new e.bP(t,n.u_image),u_image_height:new e.bg(t,n.u_image_height)}),linePattern:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_texsize:new e.bU(t,n.u_texsize),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_image:new e.bP(t,n.u_image),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels),u_scale:new e.bT(t,n.u_scale),u_fade:new e.bg(t,n.u_fade)}),lineSDF:(t,n)=>({u_translation:new e.bU(t,n.u_translation),u_ratio:new e.bg(t,n.u_ratio),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.bU(t,n.u_units_to_pixels),u_patternscale_a:new e.bU(t,n.u_patternscale_a),u_patternscale_b:new e.bU(t,n.u_patternscale_b),u_sdfgamma:new e.bg(t,n.u_sdfgamma),u_image:new e.bP(t,n.u_image),u_tex_y_a:new e.bg(t,n.u_tex_y_a),u_tex_y_b:new e.bg(t,n.u_tex_y_b),u_mix:new e.bg(t,n.u_mix)}),raster:(t,n)=>({u_tl_parent:new e.bU(t,n.u_tl_parent),u_scale_parent:new e.bg(t,n.u_scale_parent),u_buffer_scale:new e.bg(t,n.u_buffer_scale),u_fade_t:new e.bg(t,n.u_fade_t),u_opacity:new e.bg(t,n.u_opacity),u_image0:new e.bP(t,n.u_image0),u_image1:new e.bP(t,n.u_image1),u_brightness_low:new e.bg(t,n.u_brightness_low),u_brightness_high:new e.bg(t,n.u_brightness_high),u_saturation_factor:new e.bg(t,n.u_saturation_factor),u_contrast_factor:new e.bg(t,n.u_contrast_factor),u_spin_weights:new e.bT(t,n.u_spin_weights),u_coords_top:new e.bS(t,n.u_coords_top),u_coords_bottom:new e.bS(t,n.u_coords_bottom)}),symbolIcon:(t,n)=>({u_is_size_zoom_constant:new e.bP(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bP(t,n.u_is_size_feature_constant),u_size_t:new e.bg(t,n.u_size_t),u_size:new e.bg(t,n.u_size),u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_pitch:new e.bg(t,n.u_pitch),u_rotate_symbol:new e.bP(t,n.u_rotate_symbol),u_aspect_ratio:new e.bg(t,n.u_aspect_ratio),u_fade_change:new e.bg(t,n.u_fade_change),u_label_plane_matrix:new e.bR(t,n.u_label_plane_matrix),u_coord_matrix:new e.bR(t,n.u_coord_matrix),u_is_text:new e.bP(t,n.u_is_text),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_is_along_line:new e.bP(t,n.u_is_along_line),u_is_variable_anchor:new e.bP(t,n.u_is_variable_anchor),u_texsize:new e.bU(t,n.u_texsize),u_texture:new e.bP(t,n.u_texture),u_translation:new e.bU(t,n.u_translation),u_pitched_scale:new e.bg(t,n.u_pitched_scale)}),symbolSDF:(t,n)=>({u_is_size_zoom_constant:new e.bP(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bP(t,n.u_is_size_feature_constant),u_size_t:new e.bg(t,n.u_size_t),u_size:new e.bg(t,n.u_size),u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_pitch:new e.bg(t,n.u_pitch),u_rotate_symbol:new e.bP(t,n.u_rotate_symbol),u_aspect_ratio:new e.bg(t,n.u_aspect_ratio),u_fade_change:new e.bg(t,n.u_fade_change),u_label_plane_matrix:new e.bR(t,n.u_label_plane_matrix),u_coord_matrix:new e.bR(t,n.u_coord_matrix),u_is_text:new e.bP(t,n.u_is_text),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_is_along_line:new e.bP(t,n.u_is_along_line),u_is_variable_anchor:new e.bP(t,n.u_is_variable_anchor),u_texsize:new e.bU(t,n.u_texsize),u_texture:new e.bP(t,n.u_texture),u_gamma_scale:new e.bg(t,n.u_gamma_scale),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_is_halo:new e.bP(t,n.u_is_halo),u_translation:new e.bU(t,n.u_translation),u_pitched_scale:new e.bg(t,n.u_pitched_scale)}),symbolTextAndIcon:(t,n)=>({u_is_size_zoom_constant:new e.bP(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bP(t,n.u_is_size_feature_constant),u_size_t:new e.bg(t,n.u_size_t),u_size:new e.bg(t,n.u_size),u_camera_to_center_distance:new e.bg(t,n.u_camera_to_center_distance),u_pitch:new e.bg(t,n.u_pitch),u_rotate_symbol:new e.bP(t,n.u_rotate_symbol),u_aspect_ratio:new e.bg(t,n.u_aspect_ratio),u_fade_change:new e.bg(t,n.u_fade_change),u_label_plane_matrix:new e.bR(t,n.u_label_plane_matrix),u_coord_matrix:new e.bR(t,n.u_coord_matrix),u_is_text:new e.bP(t,n.u_is_text),u_pitch_with_map:new e.bP(t,n.u_pitch_with_map),u_is_along_line:new e.bP(t,n.u_is_along_line),u_is_variable_anchor:new e.bP(t,n.u_is_variable_anchor),u_texsize:new e.bU(t,n.u_texsize),u_texsize_icon:new e.bU(t,n.u_texsize_icon),u_texture:new e.bP(t,n.u_texture),u_texture_icon:new e.bP(t,n.u_texture_icon),u_gamma_scale:new e.bg(t,n.u_gamma_scale),u_device_pixel_ratio:new e.bg(t,n.u_device_pixel_ratio),u_is_halo:new e.bP(t,n.u_is_halo),u_translation:new e.bU(t,n.u_translation),u_pitched_scale:new e.bg(t,n.u_pitched_scale)}),background:(t,n)=>({u_opacity:new e.bg(t,n.u_opacity),u_color:new e.bQ(t,n.u_color)}),backgroundPattern:(t,n)=>({u_opacity:new e.bg(t,n.u_opacity),u_image:new e.bP(t,n.u_image),u_pattern_tl_a:new e.bU(t,n.u_pattern_tl_a),u_pattern_br_a:new e.bU(t,n.u_pattern_br_a),u_pattern_tl_b:new e.bU(t,n.u_pattern_tl_b),u_pattern_br_b:new e.bU(t,n.u_pattern_br_b),u_texsize:new e.bU(t,n.u_texsize),u_mix:new e.bg(t,n.u_mix),u_pattern_size_a:new e.bU(t,n.u_pattern_size_a),u_pattern_size_b:new e.bU(t,n.u_pattern_size_b),u_scale_a:new e.bg(t,n.u_scale_a),u_scale_b:new e.bg(t,n.u_scale_b),u_pixel_coord_upper:new e.bU(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.bU(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.bg(t,n.u_tile_units_to_pixels)}),terrain:(t,n)=>({u_texture:new e.bP(t,n.u_texture),u_ele_delta:new e.bg(t,n.u_ele_delta),u_fog_matrix:new e.bR(t,n.u_fog_matrix),u_fog_color:new e.bQ(t,n.u_fog_color),u_fog_ground_blend:new e.bg(t,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new e.bg(t,n.u_fog_ground_blend_opacity),u_horizon_color:new e.bQ(t,n.u_horizon_color),u_horizon_fog_blend:new e.bg(t,n.u_horizon_fog_blend),u_is_globe_mode:new e.bg(t,n.u_is_globe_mode)}),terrainDepth:(t,n)=>({u_ele_delta:new e.bg(t,n.u_ele_delta)}),terrainCoords:(t,n)=>({u_texture:new e.bP(t,n.u_texture),u_terrain_coords_id:new e.bg(t,n.u_terrain_coords_id),u_ele_delta:new e.bg(t,n.u_ele_delta)}),projectionErrorMeasurement:(t,n)=>({u_input:new e.bg(t,n.u_input),u_output_expected:new e.bg(t,n.u_output_expected)}),atmosphere:(t,n)=>({u_sun_pos:new e.bT(t,n.u_sun_pos),u_atmosphere_blend:new e.bg(t,n.u_atmosphere_blend),u_globe_position:new e.bT(t,n.u_globe_position),u_globe_radius:new e.bg(t,n.u_globe_radius),u_inv_proj_matrix:new e.bR(t,n.u_inv_proj_matrix)}),sky:(t,n)=>({u_sky_color:new e.bQ(t,n.u_sky_color),u_horizon_color:new e.bQ(t,n.u_horizon_color),u_horizon:new e.bU(t,n.u_horizon),u_horizon_normal:new e.bU(t,n.u_horizon_normal),u_sky_horizon_blend:new e.bg(t,n.u_sky_horizon_blend),u_sky_blend:new e.bg(t,n.u_sky_blend)})};class si{constructor(t,e,n){this.context=t;const i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const li={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ci{constructor(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error("Length of new data is ".concat(t.length,", which doesn't match current length of ").concat(this.length));const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let n=0;n<this.attributes.length;n++){const i=e.attributes[this.attributes[n].name];void 0!==i&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,e,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],a=e.attributes[r.name];void 0!==a&&t.vertexAttribPointer(a,r.components,t[li[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ui{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hi extends ui{getDefault(){return e.bf.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class di extends ui{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class pi extends ui{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class fi extends ui{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mi extends ui{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gi extends ui{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class yi extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class vi extends ui{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class _i extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class xi extends ui{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class bi extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class wi extends ui{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Si extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class Mi extends ui{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ti extends ui{getDefault(){return e.bf.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ei extends ui{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ai extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class Ci extends ui{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Pi extends ui{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ii extends ui{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ri extends ui{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ki extends ui{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Li extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Di extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zi extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ni extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Oi extends ui{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Fi extends ui{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const n=this.gl;qe(n)?n.bindVertexArray(t):null===(e=n.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Bi extends ui{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ui extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ji extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Vi extends ui{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Hi extends Vi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Gi extends Vi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wi extends Vi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const qi="Framebuffer is not complete";class Zi{constructor(t,e,n,i,r){this.context=t,this.width=e,this.height=n;const a=t.gl,o=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new Hi(t,o),i)this.depthAttachment=r?new Wi(t,o):new Gi(t,o);else if(r)throw new Error("Stencil cannot be set without depth");if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw new Error(qi)}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Xi{constructor(t){var e,n;if(this.gl=t,this.clearColor=new hi(this),this.clearDepth=new di(this),this.clearStencil=new pi(this),this.colorMask=new fi(this),this.depthMask=new mi(this),this.stencilMask=new gi(this),this.stencilFunc=new yi(this),this.stencilOp=new vi(this),this.stencilTest=new _i(this),this.depthRange=new xi(this),this.depthTest=new bi(this),this.depthFunc=new wi(this),this.blend=new Si(this),this.blendFunc=new Mi(this),this.blendColor=new Ti(this),this.blendEquation=new Ei(this),this.cullFace=new Ai(this),this.cullFaceSide=new Ci(this),this.frontFace=new Pi(this),this.program=new Ii(this),this.activeTexture=new Ri(this),this.viewport=new ki(this),this.bindFramebuffer=new Li(this),this.bindRenderbuffer=new Di(this),this.bindTexture=new zi(this),this.bindVertexBuffer=new Ni(this),this.bindElementBuffer=new Oi(this),this.bindVertexArray=new Fi(this),this.pixelStoreUnpack=new Bi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ui(this),this.pixelStoreUnpackFlipY=new ji(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),qe(t)){this.HALF_FLOAT=t.HALF_FLOAT;const i=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==i?void 0:i.RGBA16F_EXT,this.RGB16F=null!==(n=t.RGB16F)&&void 0!==n?n:null==i?void 0:i.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new si(this,t,e)}createVertexBuffer(t,e,n){return new ci(this,t,e,n)}createRenderbuffer(t,e,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,n,i){return new Zi(this,t,e,n,i)}clear(t){let{color:e,depth:n,stencil:i}=t;const r=this.gl;let a=0;e&&(a|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(a|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==i&&(a|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(a)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bH(t.blendFunction,Be.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return qe(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return qe(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Yi;function Ki(t,n,i,r,a){const o=t.context,s=t.transform,l=o.gl,c=t.useProgram("collisionBox"),u=[];let h=0,d=0;for(let e=0;e<r.length;e++){const p=r[e],f=n.getTile(p).getBucket(i);if(!f)continue;const m=a?f.textCollisionBox:f.iconCollisionBox,g=f.collisionCircleArray;g.length>0&&(u.push({circleArray:g,circleOffset:d,coord:p}),h+=g.length/4,d=h),m&&c.draw(o,l.LINES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,On(t.transform),t.style.map.terrain&&t.style.map.terrain.getTerrainData(p),s.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,t.transform.zoom,null,null,m.collisionVertexBuffer)}if(!a||!u.length)return;const p=t.useProgram("collisionCircle"),f=new e.b$;f.resize(4*h),f._trim();let m=0;for(const e of u)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],a=e.circleArray[n+2],o=e.circleArray[n+3];f.emplace(m++,i,r,a,o,0),f.emplace(m++,i,r,a,o,1),f.emplace(m++,i,r,a,o,2),f.emplace(m++,i,r,a,o,3)}(!Yi||Yi.length<2*h)&&(Yi=function(t){const n=2*t,i=new e.c1;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(h));const g=o.createIndexBuffer(Yi,!0),y=o.createVertexBuffer(f,e.c0.members,!0);for(const v of u){const n=Fn(t.transform);p.draw(o,l.TRIANGLES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,n,t.style.map.terrain&&t.style.map.terrain.getTerrainData(v.coord),null,i.id,y,g,e.aM.simpleSegment(0,2*v.circleOffset,v.circleArray.length,v.circleArray.length/2),null,t.transform.zoom,null,null,null)}y.destroy(),g.destroy()}const Ji=e.ag(new Float32Array(16));function $i(t,n,i,r,a,o){const{horizontalAlign:s,verticalAlign:l}=e.aH(t);return new e.P((-(s-.5)*n/a+r[0])*o,(-(l-.5)*i/a+r[1])*o)}function Qi(t,n,i,r,a,o){const s=n.tileAnchorPoint.add(new e.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let t=r.mult(o);i||(t=t.rotate(-a));const e=s.add(t);return Pt(e.x,e.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(i){const e=Ft(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(t),i=Math.atan(e.y/e.x)+(e.x<0?Math.PI:0);return t.add(r.rotate(i))}return t.add(r)}function tr(t,n,i,r,a,o,s,l,c,u,h,d){const p=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,g={};f.clear();for(let y=0;y<p.length;y++){const m=p.get(y),v=m.hidden||!m.crossTileID||t.allowVerticalPlacement&&!m.placedOrientation?null:r[m.crossTileID];if(v){const r=new e.P(m.anchorX,m.anchorY),p={getElevation:d,width:a.width,height:a.height,pitchedLabelPlaneMatrix:o,pitchWithMap:i,transform:a,tileAnchorPoint:r,translation:u,unwrappedTileID:h},y=i?Ut(r.x,r.y,p):Ft(r.x,r.y,p),_=It(a.cameraToCenterDistance,y.signedDistanceFromCamera);let x=e.ap(t.textSizeData,l,m)*_/e.aB;i&&(x*=t.tilePixelRatio/s);const{width:b,height:w,anchor:S,textOffset:M,textBoxScale:T}=v,E=$i(S,b,w,M,T,x),A=a.getPitchedTextCorrection(r.x+u[0],r.y+u[1],h),C=Qi(y.point,p,n,E,-a.bearingInRadians,A),P=t.allowVerticalPlacement&&m.placedOrientation===e.ao.vertical?Math.PI/2:0;for(let t=0;t<m.numGlyphs;t++)e.av(f,C,P);c&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:C,angle:P})}else Wt(m.numGlyphs,f)}if(c){m.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t);if(i.hidden)Wt(i.numGlyphs,m);else{const n=g[t];if(n)for(let t=0;t<i.numGlyphs;t++)e.av(m,n.shiftedAnchor,n.angle);else Wt(i.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function er(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nr(t,n,i,r,a,o,s,l,c,u,h,d,p){const f=t.context,m=f.gl,g=t.transform,y="map"===l,v="map"===c,_="viewport"!==l&&"point"!==i.layout.get("symbol-placement"),x=y&&!v&&!_,b=!i.layout.get("symbol-sort-key").isConstant();let w=!1;const S=t.getDepthModeForSublayer(0,Ve.ReadOnly),M=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=[],E=g.getCircleRadiusCorrection();for(const A of r){const r=n.getTile(A),l=r.getBucket(i);if(!l)continue;const c=a?l.text:l.icon;if(!c||!c.segments.get().length||!c.hasVisibleVertices)continue;const h=c.programConfigurations.get(i.id),d=a||l.sdfIcons,f=a?l.textSizeData:l.iconSizeData,S=v||0!==g.pitch,C=t.useProgram(er(d,a,l),h),P=e.an(f,g.zoom),I=t.style.map.terrain&&t.style.map.terrain.getTerrainData(A);let R,k,L,D,z=[0,0],N=null;if(a)k=r.glyphAtlasTexture,L=m.LINEAR,R=r.glyphAtlasTexture.size,l.iconsInText&&(z=r.imageAtlasTexture.size,N=r.imageAtlasTexture,D=S||t.options.rotating||t.options.zooming||"composite"===f.kind||"camera"===f.kind?m.LINEAR:m.NEAREST);else{const e=1!==i.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;k=r.imageAtlasTexture,L=d||t.options.rotating||t.options.zooming||e||S?m.LINEAR:m.NEAREST,R=r.imageAtlasTexture.size}const O=e.aC(r,1,t.transform.zoom),F=Et(y,t.transform,O),B=e.L();e.aq(B,F);const U=At(v,y,t.transform,O),j=e.aD(g,r,o,s),V=g.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),H=M&&l.hasTextData(),G="none"!==i.layout.get("icon-text-fit")&&H&&l.hasIconData();if(_){const e=t.style.map.terrain?(e,n)=>t.style.map.terrain.getElevation(A,e,n):null,n="map"===i.layout.get("text-rotation-alignment");kt(l,t,a,F,B,v,u,n,A.toUnwrapped(),g.width,g.height,j,e)}const W=a&&M||G,q=_||W?Ji:v?F:t.transform.clipSpaceToPixelsMatrix,Z=d&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1);let X;X=d?l.iconsInText?ni(f.kind,P,x,v,_,W,t,q,U,j,R,z,E):ei(f.kind,P,x,v,_,W,t,q,U,j,a,R,0,E):ti(f.kind,P,x,v,_,W,t,q,U,j,a,R,E);const Y={program:C,buffers:c,uniformValues:X,projectionData:V,atlasTexture:k,atlasTextureIcon:N,atlasInterpolation:L,atlasInterpolationIcon:D,isSDF:d,hasHalo:Z};if(b&&l.canOverlap){w=!0;const t=c.segments.get();for(const n of t)T.push({segments:new e.aM([n]),sortKey:n.sortKey,state:Y,terrainData:I})}else T.push({segments:c.segments,sortKey:0,state:Y,terrainData:I})}w&&T.sort((t,e)=>t.sortKey-e.sortKey);for(const e of T){const n=e.state;if(f.activeTexture.set(m.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,m.CLAMP_TO_EDGE),n.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,ir(n.buffers,e.segments,i,t,n.program,S,h,d,r,n.projectionData,e.terrainData)),r.u_is_halo=0}ir(n.buffers,e.segments,i,t,n.program,S,h,d,n.uniformValues,n.projectionData,e.terrainData)}}function ir(t,e,n,i,r,a,o,s,l,c,u){const h=i.context;r.draw(h,h.gl.TRIANGLES,a,o,s,je.backCCW,l,u,c,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function rr(t,n,i,r,a){const o=t.context,s=o.gl,l=Ge.disabled,c=new Be([s.ONE,s.ONE],e.bf.transparent,[!0,!0,!0,!0]),u=n.getBucket(i);if(!u)return;const h=r.key;let d=i.heatmapFbos.get(h);d||(d=or(o,n.tileSize,n.tileSize),i.heatmapFbos.set(h,d)),o.bindFramebuffer.set(d.framebuffer),o.viewport.set([0,0,n.tileSize,n.tileSize]),o.clear({color:e.bf.transparent});const p=u.programConfigurations.get(i.id),f=t.useProgram("heatmap",p,!a),m=t.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g=t.style.map.terrain.getTerrainData(r);f.draw(o,s.TRIANGLES,Ve.disabled,l,c,je.disabled,Un(n,t.transform.zoom,i.paint.get("heatmap-intensity"),1),g,m,i.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,i.paint,t.transform.zoom,p)}function ar(t,e,n,i,r){const a=t.context,o=a.gl,s=t.transform;a.setColorMode(t.colorModeForRenderPass());const l=sr(a,e),c=n.key,u=e.heatmapFbos.get(c);if(!u)return;a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,u.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1),l.bind(o.LINEAR,o.CLAMP_TO_EDGE);const h=s.getProjectionData({overscaledTileID:n,applyTerrainMatrix:r,applyGlobeMatrix:!i});t.useProgram("heatmapTexture").draw(a,o.TRIANGLES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,jn(t,e,0,1),null,h,e.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments,e.paint,s.zoom),u.destroy(),e.heatmapFbos.delete(c)}function or(t,e,n){var i,r;const a=t.gl,o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);const s=null!==(i=t.HALF_FLOAT)&&void 0!==i?i:a.UNSIGNED_BYTE,l=null!==(r=t.RGBA16F)&&void 0!==r?r:a.RGBA;a.texImage2D(a.TEXTURE_2D,0,l,e,n,0,a.RGBA,s,null);const c=t.createFramebuffer(e,n,!1,!1);return c.colorAttachment.set(o),c}function sr(t,n){return n.colorRampTexture||(n.colorRampTexture=new e.T(t,n.colorRamp,t.gl.RGBA)),n.colorRampTexture}function lr(t,e,n,i,r){if(!n||!i||!i.imageAtlas)return;const a=i.imageAtlas.patternPositions;let o=a[n.to.toString()],s=a[n.from.toString()];if(!o&&s&&(o=s),!s&&o&&(s=o),!o||!s){const t=r.getPaintProperty(e);o=a[t],s=a[t]}o&&s&&t.setConstantPatternPositions(o,s)}function cr(t,n,i,r,a,o,s,l){const c=t.context.gl,u="fill-pattern",h=i.paint.get(u),d=h&&h.constantOr(1),p=i.getCrossfadeParameters();let f,m,g,y,v;const _=t.transform,x=i.paint.get("fill-translate"),b=i.paint.get("fill-translate-anchor");s?(m=d&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(m=d?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const S of r){const r=n.getTile(S);if(d&&!r.patternsLoaded())continue;const h=r.getBucket(i);if(!h)continue;const M=h.programConfigurations.get(i.id),T=t.useProgram(m,M),E=t.style.map.terrain&&t.style.map.terrain.getTerrainData(S);d&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),M.updatePaintBuffers(p)),lr(M,u,w,r,i);const A=_.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),C=e.aD(_,r,x,b);if(s){y=h.indexBuffer2,v=h.segments2;const e=[c.drawingBufferWidth,c.drawingBufferHeight];g="fillOutlinePattern"===m&&d?zn(t,p,r,e,C):Dn(e,C)}else y=h.indexBuffer,v=h.segments,g=d?Ln(t,p,r,C):{u_fill_translate:C};const P=t.stencilModeForClipping(S);T.draw(t.context,f,a,P,o,je.backCCW,g,E,A,i.id,h.layoutVertexBuffer,y,v,i.paint,t.transform.zoom,M)}}function ur(t,n,i,r,a,o,s,l){const c=t.context,u=c.gl,h="fill-extrusion-pattern",d=i.paint.get(h),p=d.constantOr(1),f=i.getCrossfadeParameters(),m=i.paint.get("fill-extrusion-opacity"),g=d.constantOr(null),y=t.transform;for(const v of r){const r=n.getTile(v),d=r.getBucket(i);if(!d)continue;const _=t.style.map.terrain&&t.style.map.terrain.getTerrainData(v),x=d.programConfigurations.get(i.id),b=t.useProgram(p?"fillExtrusionPattern":"fillExtrusion",x);p&&(t.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers(f));const w=y.getProjectionData({overscaledTileID:v,applyGlobeMatrix:!l,applyTerrainMatrix:!0});lr(x,h,g,r,i);const S=e.aD(y,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),M=i.paint.get("fill-extrusion-vertical-gradient"),T=p?kn(t,M,m,S,v,f,r):Rn(t,M,m,S);b.draw(c,c.gl.TRIANGLES,a,o,s,je.backCCW,T,_,w,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,x,t.style.map.terrain&&d.centroidVertexBuffer)}}function hr(t,e,n,i,r,a,o,s,l){var c;const u=t.style.projection,h=t.context,d=t.transform,p=h.gl,f=["#define NUM_ILLUMINATION_SOURCES ".concat(n.paint.get("hillshade-highlight-color").values.length)],m=t.useProgram("hillshade",null,!1,f),g=!t.options.moving;for(const y of i){const i=e.getTile(y),f=i.fbo;if(!f)continue;const v=u.getMeshFromTileID(h,y.canonical,s,!0,"raster"),_=null===(c=t.style.map.terrain)||void 0===c?void 0:c.getTerrainData(y);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,f.colorAttachment.get());const x=d.getProjectionData({overscaledTileID:y,aligned:g,applyGlobeMatrix:!l,applyTerrainMatrix:!0});m.draw(h,p.TRIANGLES,a,r[y.overscaledZ],o,je.backCCW,Vn(t,i,n),_,x,n.id,v.vertexBuffer,v.indexBuffer,v.segments)}}function dr(t,n,i,r,a,o,s,l,c){var u;const h=t.style.projection,d=t.context,p=t.transform,f=d.gl,m=t.useProgram("colorRelief"),g=!t.options.moving;let y=!0,v=0;for(const _ of r){const r=n.getTile(_),x=r.dem;if(y){const t=f.getParameter(f.MAX_TEXTURE_SIZE),{elevationTexture:e,colorTexture:n}=i.getColorRampTextures(d,t,x.getUnpackVector());d.activeTexture.set(f.TEXTURE1),e.bind(f.NEAREST,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE4),n.bind(f.LINEAR,f.CLAMP_TO_EDGE),y=!1,v=e.size[0]}if(!x||!x.data)continue;const b=x.stride,w=x.getPixels();if(d.activeTexture.set(f.TEXTURE0),d.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(b),r.demTexture){const t=r.demTexture;t.update(w,{premultiply:!1}),t.bind(f.LINEAR,f.CLAMP_TO_EDGE)}else r.demTexture=new e.T(d,w,f.RGBA,{premultiply:!1}),r.demTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=h.getMeshFromTileID(d,_.canonical,l,!0,"raster"),M=null===(u=t.style.map.terrain)||void 0===u?void 0:u.getTerrainData(_),T=p.getProjectionData({overscaledTileID:_,aligned:g,applyGlobeMatrix:!c,applyTerrainMatrix:!0});m.draw(d,f.TRIANGLES,o,a[_.overscaledZ],s,je.backCCW,Wn(i,r.dem,v),M,T,i.id,S.vertexBuffer,S.indexBuffer,S.segments)}}const pr=[new e.P(0,0),new e.P(e.$,0),new e.P(e.$,e.$),new e.P(0,e.$)];function fr(t,e,n,i,r,a,o,s){let l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const u=i[i.length-1].overscaledZ,h=t.context,d=h.gl,p=t.useProgram("raster"),f=t.transform,m=t.style.projection,g=t.colorModeForRenderPass(),y=!t.options.moving;for(const v of i){const i=t.getDepthModeForSublayer(v.overscaledZ-u,1===n.paint.get("raster-opacity")?Ve.ReadWrite:Ve.ReadOnly,d.LESS),_=e.getTile(v);_.registerFadeDuration(n.paint.get("raster-fade-duration"));const x=e.findLoadedParent(v,0),b=e.findLoadedSibling(v),w=mr(_,x||b||null,e,n,t.transform,t.style.map.terrain);let S,M;const T="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),_.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1),x?(x.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),S=Math.pow(2,x.tileID.overscaledZ-_.tileID.overscaledZ),M=[_.tileID.canonical.x*S%1,_.tileID.canonical.y*S%1]):_.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),_.texture.useMipmap&&h.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const E=t.style.map.terrain&&t.style.map.terrain.getTerrainData(v),A=f.getProjectionData({overscaledTileID:v,aligned:y,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),C=$n(M||[0,0],S||1,w,n,s),P=m.getMeshFromTileID(h,v.canonical,a,o,"raster");p.draw(h,d.TRIANGLES,i,r?r[v.overscaledZ]:Ge.disabled,g,l?je.frontCCW:je.backCCW,C,E,A,n.id,P.vertexBuffer,P.indexBuffer,P.segments)}}function mr(t,n,i,r,a,s){const l=r.paint.get("raster-fade-duration");if(!s&&l>0){const r=o.now(),s=(r-t.timeAdded)/l,c=n?(r-n.timeAdded)/l:-1,u=i.getSource(),h=yt(a,{tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),p=d&&t.refreshedUponExpiration?1:e.ah(d?s:1-c,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const gr=new e.bf(1,0,0,1),yr=new e.bf(0,1,0,1),vr=new e.bf(0,0,1,1),_r=new e.bf(1,0,1,1),xr=new e.bf(0,1,1,1);function br(t,e,n,i){Sr(t,0,e+n/2,t.transform.width,n,i)}function wr(t,e,n,i){Sr(t,e-n/2,0,n,t.transform.height,i)}function Sr(t,e,n,i,r,a){const o=t.context,s=o.gl;s.enable(s.SCISSOR_TEST),s.scissor(e*t.pixelRatio,n*t.pixelRatio,i*t.pixelRatio,r*t.pixelRatio),o.clear({color:a}),s.disable(s.SCISSOR_TEST)}function Mr(t,n,i){const r=t.context,a=r.gl,o=t.useProgram("debug"),s=Ve.disabled,l=Ge.disabled,c=t.colorModeForRenderPass(),u="$debug",h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(i);r.activeTexture.set(a.TEXTURE0);const d=n.getTileByID(i.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(i).tileSize,m=512/Math.min(f,512)*(i.overscaledZ/t.transform.zoom)*.5;let g=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(g+=" => ".concat(i.overscaledZ)),function(t,e){t.initDebugOverlayCanvas();const n=t.debugOverlayCanvas,i=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,"".concat(g," ").concat(p,"kB"));const y=t.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});o.draw(r,a.TRIANGLES,s,l,Be.alphaBlended,je.disabled,Bn(e.bf.transparent,m),null,y,u,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),o.draw(r,a.LINE_STRIP,s,l,c,je.disabled,Bn(e.bf.red),h,y,u,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}function Tr(t,e,n,i){const{isRenderingGlobe:r}=i,a=t.context,o=a.gl,s=t.transform,l=t.colorModeForRenderPass(),c=t.getDepthModeFor3D(),u=t.useProgram("terrain");a.bindFramebuffer.set(null),a.viewport.set([0,0,t.width,t.height]);for(const h of n){const n=e.getTerrainMesh(h.tileID),i=t.renderToTexture.getTexture(h),d=e.getTerrainData(h.tileID);a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,i.texture);const p=e.getMeshFrameDelta(s.zoom),f=s.calculateFogMatrix(h.tileID.toUnwrapped()),m=En(p,f,t.style.sky,s.pitch,r),g=s.getProjectionData({overscaledTileID:h.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(a,o.TRIANGLES,c,Ge.disabled,l,je.backCCW,m,d,g,"terrain",n.vertexBuffer,n.indexBuffer,n.segments)}}function Er(t,n){if(!n.mesh){const i=new e.aL;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const r=new e.aN;r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),n.mesh=new we(t.createVertexBuffer(i,Se.members),t.createIndexBuffer(r),e.aM.simpleSegment(0,0,i.length,r.length))}return n.mesh}class Ar{constructor(t,n){this.context=new Xi(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ve}resize(t,e,n){if(this.width=Math.floor(t*n),this.height=Math.floor(e*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const i of this.style._order)this.style._layers[i].resize()}setup(){const t=this.context,n=new e.aL;n.emplaceBack(0,0),n.emplaceBack(e.$,0),n.emplaceBack(0,e.$),n.emplaceBack(e.$,e.$),this.tileExtentBuffer=t.createVertexBuffer(n,Se.members),this.tileExtentSegments=e.aM.simpleSegment(0,0,4,2);const i=new e.aL;i.emplaceBack(0,0),i.emplaceBack(e.$,0),i.emplaceBack(0,e.$),i.emplaceBack(e.$,e.$),this.debugBuffer=t.createVertexBuffer(i,Se.members),this.debugSegments=e.aM.simpleSegment(0,0,4,5);const r=new e.c6;r.emplaceBack(0,0,0,0),r.emplaceBack(e.$,0,e.$,0),r.emplaceBack(0,e.$,0,e.$),r.emplaceBack(e.$,e.$,e.$,e.$),this.rasterBoundsBuffer=t.createVertexBuffer(r,Mn.members),this.rasterBoundsSegments=e.aM.simpleSegment(0,0,4,2);const a=new e.aL;a.emplaceBack(0,0),a.emplaceBack(e.$,0),a.emplaceBack(0,e.$),a.emplaceBack(e.$,e.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(a,Se.members),this.rasterBoundsSegmentsPosOnly=e.aM.simpleSegment(0,0,4,5);const o=new e.aL;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,Se.members),this.viewportSegments=e.aM.simpleSegment(0,0,4,2);const s=new e.c7;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(s);const l=new e.aN;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Ge({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new we(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const i=e.L();e.bY(i,0,this.width,this.height,0,0,1),e.N(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const r={mainMatrix:i,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:i};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,Ve.disabled,this.stencilClearMode,Be.disabled,je.disabled,null,null,r,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source,this.nextStencilID+e.length>256&&this.clearStencil();const i=this.context;i.setColorMode(Be.disabled),i.setDepthMode(Ve.disabled);const r={};for(const a of e)r[a.key]=this.nextStencilID++;this._renderTileMasks(r,e,n,!0),this._renderTileMasks(r,e,n,!1),this._tileClippingMaskIDs=r}_renderTileMasks(t,e,n,i){const r=this.context,a=r.gl,o=this.style.projection,s=this.transform,l=this.useProgram("clippingMask");for(const c of e){const e=t[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=o.getMeshFromTileID(this.context,c.canonical,i,!0,"stencil"),d=s.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!n,applyTerrainMatrix:!0});l.draw(r,a.TRIANGLES,Ve.disabled,new Ge({func:a.ALWAYS,mask:0},e,255,a.KEEP,a.KEEP,a.REPLACE),Be.disabled,n?je.disabled:je.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const t=this.context,e=t.gl,n=this.style.projection,i=this.transform,r=this.useProgram("depth"),a=this.getDepthModeFor3D(),o=vt(i,{tileSize:i.tileSize});for(const s of o){const o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(s),l=n.getMeshFromTileID(this.context,s.canonical,!0,!0,"raster"),c=i.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});r.draw(t,e.TRIANGLES,a,Ge.disabled,Be.disabled,je.backCCW,null,o,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Ge({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Ge({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const e=this.context.gl,n=t.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const t={};for(let n=0;n<r;n++)t[n+i]=new Ge({func:e.GEQUAL,mask:255},n+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=r,[t,n]}return[{[i]:Ge.disabled},n]}stencilConfigForOverlapTwoPass(t){const e=this.context.gl,n=t.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(this.clearStencil(),r>1){const t={},a={};for(let n=0;n<r;n++)t[n+i]=new Ge({func:e.GREATER,mask:255},r+1+n,255,e.KEEP,e.KEEP,e.REPLACE),a[n+i]=new Ge({func:e.GREATER,mask:255},1+n,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID=2*r+1,[t,a,n]}return this.nextStencilID=3,[{[i]:new Ge({func:e.GREATER,mask:255},2,255,e.KEEP,e.KEEP,e.REPLACE)},{[i]:new Ge({func:e.GREATER,mask:255},1,255,e.KEEP,e.KEEP,e.REPLACE)},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new Be([t.CONSTANT_COLOR,t.ONE],new e.bf(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Be.unblended:Be.alphaBlended}getDepthModeForSublayer(t,e,n){if(!this.opaquePassEnabledForLayer())return Ve.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ve(n||this.context.gl.LEQUAL,e,[i,i])}getDepthModeFor3D(){return new Ve(this.context.gl.LEQUAL,Ve.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var i,r;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.now()),this.imageManager.beginFrame();const a=this.style._order,s=this.style.sourceCaches,l={},c={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(i=t.projection)||void 0===i?void 0:i.transitionState)>0};for(const e in s){const t=s[e];t.used&&t.prepare(this.context),l[e]=t.getVisibleCoordinates(!1),c[e]=l[e].slice().reverse(),u[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<a.length;e++)if(this.style._layers[a[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of a){const t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=c[t.source];("custom"===t.type||n.length)&&this.renderLayer(this,s[t.source],t,n,h)}if(null===(r=this.style.projection)||void 0===r||r.updateGPUdependent({context:this.context,useProgram:t=>this.useProgram(t)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?e.bf.black:e.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(t,e){const n=t.context,i=n.gl,r=((t,e,n)=>{const i=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),a=ut(e),o=e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:t.properties.get("sky-color"),u_horizon_color:t.properties.get("horizon-color"),u_horizon:[(e.width/2-a*r)*n,(e.height/2+a*i)*n],u_horizon_normal:[-r,i],u_sky_horizon_blend:t.properties.get("sky-horizon-blend")*e.height/2*n,u_sky_blend:o}})(e,t.style.map.transform,t.pixelRatio),a=new Ve(i.LEQUAL,Ve.ReadWrite,[0,1]),o=Ge.disabled,s=t.colorModeForRenderPass(),l=t.useProgram("sky"),c=Er(n,e);l.draw(n,i.TRIANGLES,a,o,s,je.disabled,r,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[a[this.currentLayer]],e=s[t.source],n=l[t.source];this._renderTileClippingMasks(t,n,!1),this.renderLayer(this,e,t,n,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const t=this.style._layers[a[this.currentLayer]],e=s[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const n=("symbol"===t.type?u:c)[t.source];this._renderTileClippingMasks(t,l[t.source],!!this.renderToTexture),this.renderLayer(this,e,t,n,h)}if(h.isRenderingGlobe&&function(t,n,i){const r=t.context,a=r.gl,o=t.useProgram("atmosphere"),s=new Ve(a.LEQUAL,Ve.ReadOnly,[0,1]),l=t.transform,c=function(t,n){const i=t.properties.get("position"),r=[-i.x,-i.y,-i.z],a=e.ag(new Float64Array(16));return"map"===t.properties.get("anchor")&&(e.b6(a,a,n.rollInRadians),e.b7(a,a,-n.pitchInRadians),e.b6(a,a,n.bearingInRadians),e.b7(a,a,n.center.lat*Math.PI/180),e.bz(a,a,-n.center.lng*Math.PI/180)),e.c5(r,r,a),r}(i,t.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=n.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=rn(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,e.aw(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,e.aw(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const m=((t,e,n,i,r)=>({u_sun_pos:t,u_atmosphere_blend:e,u_globe_position:n,u_globe_radius:i,u_inv_proj_matrix:r}))(c,h,[f[0],f[1],f[2]],d,p),g=Er(r,n);o.draw(r,a.TRIANGLES,s,Ge.disabled,Be.alphaBlended,je.disabled,m,null,null,"atmosphere",g.vertexBuffer,g.indexBuffer,g.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const t=function(t,e){let n=null;const i=Object.values(t._layers).flatMap(n=>n.source&&!n.isHidden(e)?[t.sourceCaches[n.source]]:[]),r=i.filter(t=>"vector"===t.getSource().type),a=i.filter(t=>"vector"!==t.getSource().type),o=t=>{(!n||n.getSource().maxzoom<t.getSource().maxzoom)&&(n=t)};return r.forEach(t=>o(t)),n||a.forEach(t=>o(t)),n}(this.style,this.transform.zoom);t&&function(t,e,n){for(let i=0;i<n.length;i++)Mr(t,e,n[i])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;br(t,t.transform.height-(e.top||0),3,gr),br(t,e.bottom||0,3,yr),wr(t,e.left||0,3,vr),wr(t,t.transform.width-(e.right||0),3,_r);const n=t.transform.centerPoint;!function(t,e,n,i){Sr(t,e-1,n-10,2,20,i),Sr(t,e-10,n-1,20,2,i)}(t,n.x,t.transform.height-n.y,xr)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,i=this.transform.modelViewProjectionMatrix;let r=this.terrainFacilitator.dirty;r||(r=t?!e.c8(n,i):!e.c9(n,i)),r||(r=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),r&&(e.ca(n,i),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,n){const i=t.context,r=i.gl,a=t.transform,o=Be.unblended,s=new Ve(r.LEQUAL,Ve.ReadWrite,[0,1]),l=n.sourceCache.getRenderableTiles(),c=t.useProgram("terrainDepth");i.bindFramebuffer.set(n.getFramebuffer("depth").framebuffer),i.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),i.clear({color:e.bf.transparent,depth:1});for(const e of l){const t=n.getTerrainMesh(e.tileID),l=n.getTerrainData(e.tileID),u=a.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:n.getMeshFrameDelta(a.zoom)};c.draw(i,r.TRIANGLES,s,Ge.disabled,o,je.backCCW,h,l,u,"terrain",t.vertexBuffer,t.indexBuffer,t.segments)}i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,n){const i=t.context,r=i.gl,a=t.transform,o=Be.unblended,s=new Ve(r.LEQUAL,Ve.ReadWrite,[0,1]),l=n.getCoordsTexture(),c=n.sourceCache.getRenderableTiles(),u=t.useProgram("terrainCoords");i.bindFramebuffer.set(n.getFramebuffer("coords").framebuffer),i.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),i.clear({color:e.bf.transparent,depth:1}),n.coordsIndex=[];for(const e of c){const t=n.getTerrainMesh(e.tileID),c=n.getTerrainData(e.tileID);i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(a.zoom)},d=a.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(i,r.TRIANGLES,s,Ge.disabled,o,je.backCCW,h,c,d,"terrain",t.vertexBuffer,t.indexBuffer,t.segments),n.coordsIndex.push(e.tileID.key)}i.bindFramebuffer.set(null),i.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}renderLayer(t,n,i,r,a){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||(r||[]).length)&&(this.id=i.id,e.cb(i)?function(t,n,i,r,a,o){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:s}=o,l=Ge.disabled,c=t.colorModeForRenderPass();(i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(t,n,i,r,a,o,s,l,c){const u=n.transform,h=n.style.map.terrain,d="map"===a,p="map"===o;for(const f of t){const t=r.getTile(f),a=t.getBucket(i);if(!a||!a.text||!a.text.segments.get().length)continue;const o=e.an(a.textSizeData,u.zoom),m=e.aC(t,1,n.transform.zoom),g=Et(d,n.transform,m),y="none"!==i.layout.get("icon-text-fit")&&a.hasIconData();if(o){const n=Math.pow(2,u.zoom-t.tileID.overscaledZ),i=h?(t,e)=>h.getElevation(f,t,e):null;tr(a,d,p,c,u,g,n,o,y,e.aD(u,t,s,l),f.toUnwrapped(),i)}}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),a),0!==i.paint.get("icon-opacity").constantOr(1)&&nr(t,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),l,c,s),0!==i.paint.get("text-opacity").constantOr(1)&&nr(t,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),l,c,s),n.map.showCollisionBoxes&&(Ki(t,n,i,r,!0),Ki(t,n,i,r,!1))}(t,n,i,r,this.style.placement.variableOffsets,a):e.cc(i)?function(t,n,i,r,a){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=a,s=i.paint.get("circle-opacity"),l=i.paint.get("circle-stroke-width"),c=i.paint.get("circle-stroke-opacity"),u=!i.layout.get("circle-sort-key").isConstant();if(0===s.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=t.context,d=h.gl,p=t.transform,f=t.getDepthModeForSublayer(0,Ve.ReadOnly),m=Ge.disabled,g=t.colorModeForRenderPass(),y=[],v=p.getCircleRadiusCorrection();for(let _=0;_<r.length;_++){const a=r[_],s=n.getTile(a),l=s.getBucket(i);if(!l)continue;const c=i.paint.get("circle-translate"),h=i.paint.get("circle-translate-anchor"),d=e.aD(p,s,c,h),f=l.programConfigurations.get(i.id),m=t.useProgram("circle",f),g=l.layoutVertexBuffer,x=l.indexBuffer,b=t.style.map.terrain&&t.style.map.terrain.getTerrainData(a),w={programConfiguration:f,program:m,layoutVertexBuffer:g,indexBuffer:x,uniformValues:Nn(t,s,i,d,v),terrainData:b,projectionData:p.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!o,applyTerrainMatrix:!0})};if(u){const t=l.segments.get();for(const n of t)y.push({segments:new e.aM([n]),sortKey:n.sortKey,state:w})}else y.push({segments:l.segments,sortKey:0,state:w})}u&&y.sort((t,e)=>t.sortKey-e.sortKey);for(const e of y){const{programConfiguration:n,program:r,layoutVertexBuffer:a,indexBuffer:o,uniformValues:s,terrainData:l,projectionData:c}=e.state;r.draw(h,d.TRIANGLES,f,m,g,je.backCCW,s,l,c,i.id,a,o,e.segments,i.paint,t.transform.zoom,n)}}(t,n,i,r,a):e.cd(i)?function(t,n,i,r,a){if(0===i.paint.get("heatmap-opacity"))return;const o=t.context,{isRenderingToTexture:s,isRenderingGlobe:l}=a;if(t.style.map.terrain){for(const e of r){const r=n.getTile(e);n.hasRenderableParent(e)||("offscreen"===t.renderPass?rr(t,r,i,e,l):"translucent"===t.renderPass&&ar(t,i,e,s,l))}o.viewport.set([0,0,t.width,t.height])}else"offscreen"===t.renderPass?function(t,n,i,r){const a=t.context,o=a.gl,s=t.transform,l=Ge.disabled,c=new Be([o.ONE,o.ONE],e.bf.transparent,[!0,!0,!0,!0]);(function(t,n,i){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,n.width/4,n.height/4]);let a=i.heatmapFbos.get(e.c2);a?(r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)):(a=or(t,n.width/4,n.height/4),i.heatmapFbos.set(e.c2,a))})(a,t,i),a.clear({color:e.bf.transparent});for(let e=0;e<r.length;e++){const u=r[e];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(i);if(!d)continue;const p=d.programConfigurations.get(i.id),f=t.useProgram("heatmap",p),m=s.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),g=s.getCircleRadiusCorrection();f.draw(a,o.TRIANGLES,Ve.disabled,l,c,je.backCCW,Un(h,s.zoom,i.paint.get("heatmap-intensity"),g),null,m,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,s.zoom,p)}a.viewport.set([0,0,t.width,t.height])}(t,n,i,r):"translucent"===t.renderPass&&function(t,n){const i=t.context,r=i.gl;i.setColorMode(t.colorModeForRenderPass());const a=n.heatmapFbos.get(e.c2);a&&(i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1),sr(i,n).bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,r.TRIANGLES,Ve.disabled,Ge.disabled,t.colorModeForRenderPass(),je.disabled,jn(t,n,0,1),null,null,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom))}(t,i)}(t,n,i,r,a):e.ce(i)?function(t,n,i,r,a){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=a,s=i.paint.get("line-opacity"),l=i.paint.get("line-width");if(0===s.constantOr(1)||0===l.constantOr(1))return;const c=t.getDepthModeForSublayer(0,Ve.ReadOnly),u=t.colorModeForRenderPass(),h=i.paint.get("line-dasharray"),d=i.paint.get("line-pattern"),p=d.constantOr(1),f=i.paint.get("line-gradient"),m=i.getCrossfadeParameters(),g=p?"linePattern":h?"lineSDF":f?"lineGradient":"line",y=t.context,v=y.gl,_=t.transform;let x=!0;for(const b of r){const r=n.getTile(b);if(p&&!r.patternsLoaded())continue;const a=r.getBucket(i);if(!a)continue;const s=a.programConfigurations.get(i.id),l=t.context.program.get(),w=t.useProgram(g,s),S=x||w.program!==l,M=t.style.map.terrain&&t.style.map.terrain.getTerrainData(b),T=d.constantOr(null);if(T&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[T.to.toString()],n=t.patternPositions[T.from.toString()];e&&n&&s.setConstantPatternPositions(e,n)}const E=_.getProjectionData({overscaledTileID:b,applyGlobeMatrix:!o,applyTerrainMatrix:!0}),A=_.getPixelScale(),C=p?Xn(t,r,i,A,m):h?Yn(t,r,i,A,h,m):f?Zn(t,r,i,A,a.lineClipsArray.length):qn(t,r,i,A);if(p)y.activeTexture.set(v.TEXTURE0),r.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),s.updatePaintBuffers(m);else if(h&&(S||t.lineAtlas.dirty))y.activeTexture.set(v.TEXTURE0),t.lineAtlas.bind(y);else if(f){const r=a.gradients[i.id];let o=r.texture;if(i.gradientVersion!==r.version){let s=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=b.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-b.canonical.z):1;s=e.ah(e.c3(a.maxLineLength/e.$*1024*r),256,y.maxTextureSize)}r.gradient=e.c4({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:r.gradient||void 0,clips:a.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.T(y,r.gradient,v.RGBA),r.version=i.gradientVersion,o=r.texture}y.activeTexture.set(v.TEXTURE0),o.bind(i.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}const P=t.stencilModeForClipping(b);w.draw(y,v.TRIANGLES,c,P,u,je.disabled,C,M,E,i.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,i.paint,t.transform.zoom,s,a.layoutVertexBuffer2),x=!1}}(t,n,i,r,a):e.cf(i)?function(t,n,i,r,a){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const{isRenderingToTexture:l}=a,c=t.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),h=t.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(e.bf.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===h){const e=t.getDepthModeForSublayer(1,"opaque"===t.renderPass?Ve.ReadWrite:Ve.ReadOnly);cr(t,n,i,r,e,c,!1,l)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const e=t.getDepthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Ve.ReadOnly);cr(t,n,i,r,e,c,!0,l)}}(t,n,i,r,a):e.cg(i)?function(t,e,n,i,r){const a=n.paint.get("fill-extrusion-opacity");if(0===a)return;const{isRenderingToTexture:o}=r;if("translucent"===t.renderPass){const r=new Ve(t.context.gl.LEQUAL,Ve.ReadWrite,t.depthRangeFor3D);if(1!==a||n.paint.get("fill-extrusion-pattern").constantOr(1))ur(t,e,n,i,r,Ge.disabled,Be.disabled,o),ur(t,e,n,i,r,t.stencilModeFor3D(),t.colorModeForRenderPass(),o);else{const a=t.colorModeForRenderPass();ur(t,e,n,i,r,Ge.disabled,a,o)}}}(t,n,i,r,a):e.ch(i)?function(t,n,i,r,a){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=a,s=t.context,l=t.style.projection.useSubdivision,c=t.getDepthModeForSublayer(0,Ve.ReadOnly),u=t.colorModeForRenderPass();if("offscreen"===t.renderPass)!function(t,n,i,r,a,o,s){const l=t.context,c=l.gl;for(const u of i){const i=n.getTile(u),h=i.dem;if(!h||!h.data)continue;if(!i.needsHillshadePrepare)continue;const d=h.dim,p=h.stride,f=h.getPixels();if(l.activeTexture.set(c.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(p),i.demTexture){const t=i.demTexture;t.update(f,{premultiply:!1}),t.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else i.demTexture=new e.T(l,f,c.RGBA,{premultiply:!1}),i.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);l.activeTexture.set(c.TEXTURE0);let m=i.fbo;if(!m){const t=new e.T(l,{width:d,height:d,data:null},c.RGBA);t.bind(c.LINEAR,c.CLAMP_TO_EDGE),m=i.fbo=l.createFramebuffer(d,d,!0,!1),m.colorAttachment.set(t.texture)}l.bindFramebuffer.set(m.framebuffer),l.viewport.set([0,0,d,d]),t.useProgram("hillshadePrepare").draw(l,c.TRIANGLES,a,o,s,je.disabled,Hn(i.tileID,h),null,null,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}}(t,n,r,i,c,Ge.disabled,u),s.viewport.set([0,0,t.width,t.height]);else if("translucent"===t.renderPass)if(l){const[e,a,s]=t.stencilConfigForOverlapTwoPass(r);hr(t,n,i,s,e,c,u,!1,o),hr(t,n,i,s,a,c,u,!0,o)}else{const[e,a]=t.getStencilConfigForOverlapAndUpdateStencilID(r);hr(t,n,i,a,e,c,u,!1,o)}}(t,n,i,r,a):e.ci(i)?function(t,e,n,i,r){if("translucent"!==t.renderPass)return;if(!i.length)return;const{isRenderingToTexture:a}=r,o=t.style.projection.useSubdivision,s=t.getDepthModeForSublayer(0,Ve.ReadOnly),l=t.colorModeForRenderPass();if(o){const[r,o,c]=t.stencilConfigForOverlapTwoPass(i);dr(t,e,n,c,r,s,l,!1,a),dr(t,e,n,c,o,s,l,!0,a)}else{const[r,o]=t.getStencilConfigForOverlapAndUpdateStencilID(i);dr(t,e,n,o,r,s,l,!1,a)}}(t,n,i,r,a):e.cj(i)?function(t,e,n,i,r){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!i.length)return;const{isRenderingToTexture:a}=r,o=e.getSource(),s=t.style.projection.useSubdivision;if(o instanceof Y)fr(t,e,n,i,null,!1,!1,o.tileCoords,o.flippedWindingOrder,a);else if(s){const[r,o,s]=t.stencilConfigForOverlapTwoPass(i);fr(t,e,n,s,r,!1,!0,pr,!1,a),fr(t,e,n,s,o,!0,!0,pr,!1,a)}else{const[r,o]=t.getStencilConfigForOverlapAndUpdateStencilID(i);fr(t,e,n,o,r,!1,!0,pr,!1,a)}}(t,n,i,r,a):e.ck(i)?function(t,e,n,i,r){const a=n.paint.get("background-color"),o=n.paint.get("background-opacity");if(0===o)return;const{isRenderingToTexture:s}=r,l=t.context,c=l.gl,u=t.style.projection,h=t.transform,d=h.tileSize,p=n.paint.get("background-pattern");if(t.isPatternMissing(p))return;const f=!p&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==f)return;const m=Ge.disabled,g=t.getDepthModeForSublayer(0,"opaque"===f?Ve.ReadWrite:Ve.ReadOnly),y=t.colorModeForRenderPass(),v=t.useProgram(p?"backgroundPattern":"background"),_=i||vt(h,{tileSize:d,terrain:t.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),t.imageManager.bind(t.context));const x=n.getCrossfadeParameters();for(const b of _){const e=h.getProjectionData({overscaledTileID:b,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),i=p?ri(o,t,p,{tileID:b,tileSize:d},x):ii(o,a),r=t.style.map.terrain&&t.style.map.terrain.getTerrainData(b),f=u.getMeshFromTileID(l,b.canonical,!1,!0,"raster");v.draw(l,c.TRIANGLES,g,m,y,je.backCCW,i,r,e,n.id,f.vertexBuffer,f.indexBuffer,f.segments)}}(t,0,i,r,a):e.cl(i)&&function(t,e,n,i){const{isRenderingGlobe:r}=i,a=t.context,o=n.implementation,s=t.style.projection,l=t.transform,c=l.getProjectionDataForCustomLayer(r),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:s.shaderVariantName,vertexShaderPrelude:"const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n".concat(s.shaderPreludeCode.vertexSource),define:s.shaderDefine},defaultProjectionData:c},h=o.renderingMode?o.renderingMode:"2d";if("offscreen"===t.renderPass){const e=o.prerender;e&&(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),e.call(o,a.gl,u),a.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(Ge.disabled);const e="3d"===h?t.getDepthModeFor3D():t.getDepthModeForSublayer(0,Ve.ReadOnly);a.setDepthMode(e),o.render(a.gl,u),a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}(t,0,i,a))}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n}useProgram(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.cache=this.cache||{};const r=!!this.style.map.terrain,a=this.style.projection,o=n?xe.projectionMercator:a.shaderPreludeCode,s=n?Me:a.shaderDefine,l=t+(e?e.cacheKey:"")+"/".concat(n?Te:a.shaderVariantName)+(this._showOverdrawInspector?"/overdraw":"")+(r?"/terrain":"")+(i?"/".concat(i.join("/")):"");return this.cache[l]||(this.cache[l]=new Pn(this.context,xe[t],e,oi[t],this._showOverdrawInspector,r,o,s,i)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}function Cr(t,e){var n=this;let i,r=!1,a=null,o=null;const s=()=>{a=null,r&&(t.apply(o,i),a=setTimeout(s,e),r=!1)};return function(){for(var t=arguments.length,e=new Array(t),l=0;l<t;l++)e[l]=arguments[l];return r=!0,o=n,i=e,a||s(),a}}class Pr{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map(t=>t.split("=")).forEach(t=>{t[0]===this._hashName&&(e=t)}),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(!this._isValidHash(t))return!1;const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,t)},this._removeHash=()=>{const t=this._getCurrentHash();if(0===t.length)return;const e=t.join("/");let n=e;n.split("&").length>0&&(n=n.split("&")[0]),this._hashName&&(n="".concat(this._hashName,"=").concat(e));let i=window.location.hash.replace(n,"");i.startsWith("#&")?i=i.slice(0,1)+i.slice(2):"#"===i&&(i="");let r=window.location.href.replace(/(#.+)?$/,i);r=r.replace("&&","&"),window.history.replaceState(window.history.state,null,r)},this._updateHash=Cr(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const e=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),a=Math.round(e.lng*r)/r,o=Math.round(e.lat*r)/r,s=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?"/".concat(a,"/").concat(o,"/").concat(n):"".concat(n,"/").concat(o,"/").concat(a),(s||l)&&(c+="/"+Math.round(10*s)/10),l&&(c+="/".concat(Math.round(l))),this._hashName){const t=this._hashName;let e=!1;const n=window.location.hash.slice(1).split("&").map(n=>{const i=n.split("=")[0];return i===t?(e=!0,"".concat(i,"=").concat(c)):n}).filter(t=>t);return e||n.push("".concat(t,"=").concat(c)),"#".concat(n.join("&"))}return"#".concat(c)}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new e.S(+t[2],+t[1])}catch(t){return!1}const n=+t[0],i=+(t[3]||0),r=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&i>=-180&&i<=180&&r>=this._map.getMinPitch()&&r<=this._map.getMaxPitch()}}const Ir={linearity:.3,easing:e.cm(0,0,.3,1)},Rr=e.e({deceleration:2500,maxSpeed:1400},Ir),kr=e.e({deceleration:20,maxSpeed:1400},Ir),Lr=e.e({deceleration:1e3,maxSpeed:360},Ir),Dr=e.e({deceleration:1e3,maxSpeed:90},Ir),zr=e.e({deceleration:1e3,maxSpeed:360},Ir);class Nr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=o.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,n.roll+=e.rollDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const a=Fr(n.pan.mag(),i,e.e({},Rr,t||{})),o=n.pan.mult(a.amount/n.pan.mag()),s=this._map.cameraHelper.handlePanInertia(o,this._map.transform);r.center=s.easingCenter,r.offset=s.easingOffset,Or(r,a)}if(n.zoom){const t=Fr(n.zoom,i,kr);r.zoom=this._map.transform.zoom+t.amount,Or(r,t)}if(n.bearing){const t=Fr(n.bearing,i,Lr);r.bearing=this._map.transform.bearing+e.ah(t.amount,-179,179),Or(r,t)}if(n.pitch){const t=Fr(n.pitch,i,Dr);r.pitch=this._map.transform.pitch+t.amount,Or(r,t)}if(n.roll){const t=Fr(n.roll,i,zr);r.roll=this._map.transform.roll+e.ah(t.amount,-179,179),Or(r,t)}if(r.zoom||r.bearing){const t=void 0===n.pinchAround?n.around:n.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),e.e(r,{noMoveStart:!0})}}function Or(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Fr(t,n,i){const{maxSpeed:r,linearity:a,deceleration:o}=i,s=e.ah(t*a/(n/1e3),-r,r),l=Math.abs(s)/(o*a);return{easing:i.easing,duration:1e3*l,amount:s*(l/2)}}class Br extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i=i instanceof MouseEvent?i:new MouseEvent(t,i);const a=s.mousePos(n.getCanvas(),i),o=n.unproject(a);super(t,e.e({point:a,lngLat:o,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Ur extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,a=s.touchPos(n.getCanvasContainer(),r),o=a.map(t=>n.unproject(t)),l=a.reduce((t,e,n,i)=>t.add(e.div(i.length)),new e.P(0,0));super(t,{points:a,point:l,lngLats:o,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class jr extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}}class Vr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new jr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Br(t.type,this._map,t))}mouseup(t){this._map.fire(new Br(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Br(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Br(t.type,this._map,t))}mouseover(t){this._map.fire(new Br(t.type,this._map,t))}mouseout(t){this._map.fire(new Br(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ur(t.type,this._map,t))}touchmove(t){this._map.fire(new Ur(t.type,this._map,t))}touchend(t){this._map.fire(new Ur(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ur(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Br(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Br(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(e.P.convert(t),this._map.terrain)}}class Wr{constructor(t,e){this._map=t,this._tr=new Gr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(s.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const n=e;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=s.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(i.x,n.x),a=Math.max(i.x,n.x),o=Math.min(i.y,n.y),l=Math.max(i.y,n.y);s.setTransform(this._box,"translate(".concat(r,"px,").concat(o,"px)")),this._box.style.width=a-r+"px",this._box.style.height=l-o+"px"}mouseupWindow(t,n){if(!this._active)return;if(0!==t.button)return;const i=this._startPos,r=n;if(this.reset(),s.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.l("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(i,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.l(t,{originalEvent:n}))}}function qr(t,e){if(t.length!==e.length)throw new Error("The number of touches and points are not equal - touches ".concat(t.length,", points ").concat(e.length));const n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class Zr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.P(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=qr(i,n)))}touchmove(t,e,n){if(this.aborted||!this.centroid)return;const i=qr(n,e);for(const r in this.touches){const t=i[r];(!t||t.dist(this.touches[r])>30)&&(this.aborted=!0)}}touchend(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Xr{constructor(t){this.singleTap=new Zr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,n){this.singleTap.touchstart(t,e,n)}touchmove(t,e,n){this.singleTap.touchmove(t,e,n)}touchend(t,e,n){const i=this.singleTap.touchend(t,e,n);if(i){const e=t.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(e&&n||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Yr{constructor(t){this._tr=new Gr(t),this._zoomIn=new Xr({numTouches:1,numTaps:2}),this._zoomOut=new Xr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)}touchmove(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)}touchend(t,e,n){const i=this._zoomIn.touchend(t,e,n),r=this._zoomOut.touchend(t,e,n),a=this._tr;return i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(i)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(){const t=this._moveFunction(...arguments);if(t.bearingDelta||t.pitchDelta||t.rollDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(e)?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const i=Array.isArray(e)?e[0]:e;return!this._moved&&i.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=i,this._move(n,i))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&s.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jr=0,$r=2,Qr={[Jr]:1,[$r]:2};class ta{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=s.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const n=Qr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton)}isValidEndEvent(t){return s.mouseButton(t)===this._eventButton}}class ea{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class na{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ta({checkCorrectEvent:()=>!0}),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ea;this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=e}_executeRelevantHandler(t,e,n){return t instanceof MouseEvent?e(t):"undefined"!=typeof TouchEvent&&t instanceof TouchEvent?n(t):void 0}startMove(t){this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.startMove(t),t=>this.oneFingerTouchMoveStateManager.startMove(t))}endMove(t){this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.endMove(t),t=>this.oneFingerTouchMoveStateManager.endMove(t))}isValidStartEvent(t){return this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.isValidStartEvent(t),t=>this.oneFingerTouchMoveStateManager.isValidStartEvent(t))}isValidMoveEvent(t){return this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.isValidMoveEvent(t),t=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(t))}isValidEndEvent(t){return this._executeRelevantHandler(t,t=>this.mouseMoveStateManager.isValidEndEvent(t),t=>this.oneFingerTouchMoveStateManager.isValidEndEvent(t))}}const ia=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=t=>{t.preventDefault()}};class ra{constructor(t,e){this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,e,n){return this._calculateTransform(t,e,n)}touchmove(t,e,n){if(this._active){if(!this._shouldBePrevented(n.length))return t.preventDefault(),this._calculateTransform(t,e,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,e,n){this._calculateTransform(t,e,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=qr(i,n),a=new e.P(0,0),o=new e.P(0,0);let s=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(a._add(t),o._add(t.sub(n)),s++,r[e]=t)}if(this._touches=r,this._shouldBePrevented(s)||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,n){if(!this._firstTwoTouches)return;t.preventDefault();const[i,r]=this._firstTwoTouches,a=oa(n,e,i),o=oa(n,e,r);if(!a||!o)return;const s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,t)}touchend(t,e,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,a=oa(n,e,i),o=oa(n,e,r);a&&o||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function oa(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function sa(t,e){return Math.log(t/e)/Math.LN2}class la extends aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(sa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sa(this._distance,n),pinchAround:e}}}function ca(t,e){return 180*t.angleWith(e)/Math.PI}class ua extends aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,n){const i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ca(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,n=ca(t,this._startVector);return Math.abs(n)<e}}function ha(t){return Math.abs(t.y)>Math.abs(t.x)}class da extends aa{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,n){super.touchstart(t,e,n),this._currentTouchCount=n.length}_start(t){this._lastPoints=t,ha(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const i=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,n){if(void 0!==this._valid)return this._valid;const i=t.mag()>=2,r=e.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const a=t.y>0==e.y>0;return ha(t)&&ha(e)&&a}}const pa={panStep:100,bearingStep:15,pitchStep:10};class fa{constructor(t){this._tr=new Gr(t);const e=pa;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,n=0,i=0,r=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:o=>{const s=this._tr;o.easeTo({duration:300,easeId:"keyboardHandler",easing:ma,zoom:e?Math.round(s.zoom)+e*(t.shiftKey?2:1):s.zoom,bearing:s.bearing+n*this._bearingStep,pitch:s.pitch+i*this._pitchStep,offset:[-r*this._panStep,-a*this._panStep],center:s.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ma(t){return t*(2-t)}const ga=4.000244140625,ya=1/450;class va{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new Gr(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ya}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=o.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==e&&e%ga==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=s.mousePos(this._map.getCanvas(),t),i=this._tr;this._aroundPoint=this._aroundCenter?i.transform.locationToScreenPoint(e.S.convert(i.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const e=t.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=e),"number"==typeof this._targetZoom&&(this._targetZoom+=e)}if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>ga?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);const r="number"!=typeof this._targetZoom?t.scale:e.af(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),e.ak(r*i)).zoom,"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"!=typeof this._targetZoom?t.zoom:this._targetZoom,i=this._startZoom,r=this._easing;let a,s=!1;if("wheel"===this._type&&i&&r){const t=o.now()-this._lastWheelEventTime,l=Math.min((t+5)/200,1),c=r(l);a=e.C.number(i,n,c),l<1?this._frameId||(this._frameId=!0):s=!0}else a=n,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=a,{noInertia:!0,needsRenderFrame:!s,zoomDelta:a-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.co;if(this._prevEase){const t=this._prevEase,i=(o.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),a=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=e.cm(a,s,.25,1)}return this._prevEase={start:o.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class _a{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xa{constructor(t){this._tr=new Gr(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ba{constructor(){this._tap=new Xr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,n){if(!this._swipePoint)if(this._tapTime){const i=e[0],r=t.timeStamp-this._tapTime<500,a=this._tapPoint.dist(i)<30;r&&a?n.length>0&&(this._swipePoint=i,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(t,e,n)}touchmove(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=e[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,n)}touchend(t,e,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{const i=this._tap.touchend(t,e,n);i&&(this._tapTime=t.timeStamp,this._tapPoint=i)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa{constructor(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sa{constructor(t,e,n,i){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=e,this._mousePitch=n,this._mouseRoll=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ma{constructor(t,e,n,i){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ta{constructor(t,e){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=s.create("div","maplibregl-cooperative-gesture-screen",t);let e=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(e=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),i=document.createElement("div");i.className="maplibregl-desktop-message",i.textContent=e,this._container.appendChild(i);const r=document.createElement("div");r.className="maplibregl-mobile-message",r.textContent=n,this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(s.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new e.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ea=t=>t.zoom||t.drag||t.roll||t.pitch||t.rotate;class Aa extends e.l{}function Ca(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta||t.rollDelta}class Pa{constructor(t,n){this.handleWindowEvent=t=>{this.handleEvent(t,"".concat(t.type,"Window"))},this.handleEvent=(t,n)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},a={},o={};for(const{handlerName:u,handler:h,allowed:d}of this._handlers){if(!h.isEnabled())continue;let l;if(this._blockedByActive(o,d,u))h.reset();else if(h[n||t.type]){if(e.cp(t,n||t.type)){const e=s.mousePos(this._map.getCanvas(),t);l=h[n||t.type](t,e)}else if(e.cq(t,n||t.type)){const e=this._getMapTouches(t.touches),i=s.touchPos(this._map.getCanvas(),e);l=h[n||t.type](t,i,e)}else e.cr(n||t.type)||(l=h[n||t.type](t));this.mergeHandlerResult(r,a,l,u,i),l&&l.needsRenderFrame&&this._triggerRenderFrame()}(l||h.isActive())&&(o[u]=h)}const l={};for(const e in this._previousActiveHandlers)o[e]||(l[e]=i);this._previousActiveHandlers=o,(Object.keys(l).length||Ca(r))&&(this._changes.push([r,a,l]),this._triggerRenderFrame()),(Object.keys(o).length||Ca(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=r;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nr(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,r,a]of this._listeners)s.addEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[t,e,n]of this._listeners)s.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new Vr(n,t));const r=n.boxZoom=new Wr(n,t);this._add("boxZoom",r),t.interactive&&t.boxZoom&&r.enable();const a=n.cooperativeGestures=new Ta(n,t.cooperativeGestures);this._add("cooperativeGestures",a),t.cooperativeGestures&&a.enable();const o=new Yr(n),l=new xa(n);n.doubleClickZoom=new _a(l,o),this._add("tapZoom",o),this._add("clickZoom",l),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const c=new ba;this._add("tapDragZoom",c);const u=n.touchPitch=new da(n);this._add("touchPitch",u),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const h=()=>n.project(n.getCenter()),d=function(t,n){let{enable:i,clickTolerance:r,aroundCenter:a=!0,minPixelCenterThreshold:o=100,rotateDegreesPerPixelMoved:l=.8}=t;const c=new ta({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)&&!t.ctrlKey});return new Kr({clickTolerance:r,move:(t,i)=>{const r=n();if(a&&Math.abs(r.y-t.y)>o)return{bearingDelta:e.cn(new e.P(t.x,i.y),i,r)};let s=(i.x-t.x)*l;return a&&i.y<r.y&&(s=-s),{bearingDelta:s}},moveStateManager:c,enable:i,assignEvents:ia})}(t,h),p=function(t){let{enable:e,clickTolerance:n,pitchDegreesPerPixelMoved:i=-.5}=t;const r=new ta({checkCorrectEvent:t=>0===s.mouseButton(t)&&t.ctrlKey||2===s.mouseButton(t)});return new Kr({clickTolerance:n,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:r,enable:e,assignEvents:ia})}(t),f=function(t,e){let{enable:n,clickTolerance:i,rollDegreesPerPixelMoved:r=.3}=t;const a=new ta({checkCorrectEvent:t=>2===s.mouseButton(t)&&t.ctrlKey});return new Kr({clickTolerance:i,move:(t,n)=>{const i=e();let a=(n.x-t.x)*r;return n.y<i.y&&(a=-a),{rollDelta:a}},moveStateManager:a,enable:n,assignEvents:ia})}(t,h);n.dragRotate=new Sa(t,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const m=function(t){let{enable:e,clickTolerance:n}=t;const i=new ta({checkCorrectEvent:t=>0===s.mouseButton(t)&&!t.ctrlKey});return new Kr({clickTolerance:n,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:i,enable:e,assignEvents:ia})}(t),g=new ra(t,n);n.dragPan=new wa(i,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const y=new ua,v=new la;n.touchZoomRotate=new Ma(i,v,y,c),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",v,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const _=n.scrollZoom=new va(n,()=>this._triggerRenderFrame());this._add("scrollZoom",_,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const x=n.keyboard=new fa(n);this._add("keyboard",x),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Hr(n))}_add(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ea(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,n){for(const i in t)if(i!==n&&(!e||e.indexOf(i)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const n of t)this._el.contains(n.target)&&e.push(n);return e}mergeHandlerResult(t,n,i,r,a){if(!i)return;e.e(t,i);const o={handlerName:r,originalEvent:i.originalEvent||a};void 0!==i.zoomDelta&&(n.zoom=o),void 0!==i.panDelta&&(n.drag=o),void 0!==i.rollDelta&&(n.roll=o),void 0!==i.pitchDelta&&(n.pitch=o),void 0!==i.bearingDelta&&(n.rotate=o)}_applyChanges(){const t={},n={},i={};for(const[r,a,o]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),r.rollDelta&&(t.rollDelta=(t.rollDelta||0)+r.rollDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.e(n,a),e.e(i,o);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,e,n){const i=this._map,r=i._getTransformForUpdate(),a=i.terrain;if(!(Ca(t)||a&&this._terrainMovement))return this._fireEvents(e,n,!0);i._stop(!0);let{panDelta:o,zoomDelta:s,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=t;void 0!==d&&(h=d),h=h||i.transform.centerPoint,a&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const p={panDelta:o,zoomDelta:s,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const f=h.distSqr(r.centerPoint)<.01?r.center:r.screenPointToLocation(o?h.sub(o):h);a?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,r),this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(o))):this._map.cameraHelper.handleMapControlsPan(p,r,f):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(p,r,f))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,r),this._map.cameraHelper.handleMapControlsPan(p,r,f)),i._applyUpdatedTransform(r),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)}_fireEvents(t,n,i){const r=Ea(this._eventsInProgress),a=Ea(t),s={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(s["".concat(e,"start")]=n),this._eventsInProgress[e]=t[e]}!r&&a&&this._fireEvent("movestart",a.originalEvent);for(const e in s)this._fireEvent(e,s[e]);a&&this._fireEvent("move",a.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const l={};let c;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=n[t]||i,l["".concat(e,"end")]=c)}for(const e in l)this._fireEvent(e,l[e]);const u=Ea(this._eventsInProgress),h=(r||a)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const t=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&t.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(t)}if(i&&h){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!t||!t.essential&&o.prefersReducedMotion?(this._map.fire(new e.l("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Aa("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Ia extends e.E{constructor(t,e,n){super(),this._renderFrameCallback=()=>{const t=Math.min((o.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.cameraHelper=e,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,e){t.apply(this.transform),this.transform=t,this.cameraHelper=e}getCenter(){return new e.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,e){return this.jumpTo({elevation:t},e),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,i){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.e({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,n,i){return this.easeTo(e.e({zoom:t},n),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new e.l("movestart",n)).fire(new e.l("move",n)).fire(new e.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,n,i){return this.easeTo(e.e({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}getRoll(){return this.transform.roll}setRoll(t,e){return this.jumpTo({roll:t},e),this}cameraForBounds(t,e){t=H.convert(t).adjustAntiMeridian();const n=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),n,e)}_cameraForBoxAndBearing(t,n,i,r){const a={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=e.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const t=r.padding;r.padding={top:t,bottom:t,right:t,left:t}}const o=e.e(a,r.padding);r.padding=o;const s=this.transform,l=new H(t,n);return this.cameraHelper.cameraForBoxAndBearing(r,o,l,i,s)}fitBounds(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)}fitScreenCoordinates(t,n,i,r,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(e.P.convert(t)),this.transform.screenPointToLocation(e.P.convert(n)),i,r),r,a)}_fitInternal(t,n,i){return t?(delete(n=e.e(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(t,n){this.stop();const i=this._getTransformForUpdate();let r=!1,a=!1,o=!1;const s=i.zoom;this.cameraHelper.handleJumpToCenterZoom(i,t);const l=i.zoom!==s;return"elevation"in t&&i.elevation!==+t.elevation&&i.setElevation(+t.elevation),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.setBearing(+t.bearing)),"pitch"in t&&i.pitch!==+t.pitch&&(a=!0,i.setPitch(+t.pitch)),"roll"in t&&i.roll!==+t.roll&&(o=!0,i.setRoll(+t.roll)),null==t.padding||i.isPaddingEqual(t.padding)||i.setPadding(t.padding),this._applyUpdatedTransform(i),this.fire(new e.l("movestart",n)).fire(new e.l("move",n)),l&&this.fire(new e.l("zoomstart",n)).fire(new e.l("zoom",n)).fire(new e.l("zoomend",n)),r&&this.fire(new e.l("rotatestart",n)).fire(new e.l("rotate",n)).fire(new e.l("rotateend",n)),a&&this.fire(new e.l("pitchstart",n)).fire(new e.l("pitch",n)).fire(new e.l("pitchend",n)),o&&this.fire(new e.l("rollstart",n)).fire(new e.l("roll",n)).fire(new e.l("rollend",n)),this.fire(new e.l("moveend",n))}calculateCameraOptionsFromTo(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=e.a1.fromLngLat(t,n),o=e.a1.fromLngLat(i,r),s=o.x-a.x,l=o.y-a.y,c=o.z-a.z,u=Math.hypot(s,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(s,l),d=e.ak(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(s,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:o.toLngLat(),elevation:r,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(t,e,n,i,r){const a=this.transform.calculateCenterFromCameraLngLatAlt(t,e,n,i);return{center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:n,pitch:i,roll:r}}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.co},t)).animate||!t.essential&&o.prefersReducedMotion)&&(t.duration=0);const i=this._getTransformForUpdate(),r=this.getBearing(),a=i.pitch,s=i.roll,l="bearing"in t?this._normalizeBearing(t.bearing,r):r,c="pitch"in t?+t.pitch:a,u="roll"in t?this._normalizeBearing(t.roll,s):s,h="padding"in t?t.padding:i.padding,d=e.P.convert(t.offset);let p,f;t.around&&(p=e.S.convert(t.around),f=i.locationToScreenPoint(p));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},g=this.cameraHelper.handleEaseTo(i,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||r!==l,this._pitching=this._pitching||c!==a,this._rolling=this._rolling||u!==s,this._padding=!i.isPaddingEqual(h),this._zooming=this._zooming||g.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,m),this.terrain&&this._prepareElevation(g.elevationCenter),this._ease(e=>{g.easeFunc(e),this.terrain&&!t.freezeElevation&&this._updateElevation(e),this._applyUpdatedTransform(i),this._fireMoveEvents(n)},e=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,e)},t),this}_prepareEase(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,n||i.moving||this.fire(new e.l("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.l("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.l("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.l("pitchstart",t)),this._rolling&&!i.rolling&&this.fire(new e.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(n-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(e.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const e=t.getCameraLngLat(),n=t.getCameraAltitude(),i=this.terrain?this.terrain.getElevationForLngLatZoom(e,t.zoom):0;if(n<i){const n=this.calculateCameraOptionsFromTo(e,i,t.center,t.elevation);return{pitch:n.pitch,zoom:n.zoom}}return{}}_applyUpdatedTransform(t){const e=[];if(e.push(t=>this._elevateCameraIfInsideTerrain(t)),this.transformCameraUpdate&&e.push(t=>this.transformCameraUpdate(t)),!e.length)return;const n=t.clone();for(const i of e){const t=n.clone(),{center:e,zoom:r,roll:a,pitch:o,bearing:s,elevation:l}=i(t);e&&t.setCenter(e),void 0!==l&&t.setElevation(l),void 0!==r&&t.setZoom(r),void 0!==a&&t.setRoll(a),void 0!==o&&t.setPitch(o),void 0!==s&&t.setBearing(s),n.apply(t)}this.transform.apply(n)}_fireMoveEvents(t){this.fire(new e.l("move",t)),this._zooming&&this.fire(new e.l("zoom",t)),this._rotating&&this.fire(new e.l("rotate",t)),this._pitching&&this.fire(new e.l("pitch",t)),this._rolling&&this.fire(new e.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const i=this._zooming,r=this._rotating,a=this._pitching,o=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,i&&this.fire(new e.l("zoomend",t)),r&&this.fire(new e.l("rotateend",t)),a&&this.fire(new e.l("pitchend",t)),o&&this.fire(new e.l("rollend",t)),this.fire(new e.l("moveend",t))}flyTo(t,n){if(!t.essential&&o.prefersReducedMotion){const i=e.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(i,n)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.co},t);const i=this._getTransformForUpdate(),r=i.bearing,a=i.pitch,s=i.roll,l=i.padding,c="bearing"in t?this._normalizeBearing(t.bearing,r):r,u="pitch"in t?+t.pitch:a,h="roll"in t?this._normalizeBearing(t.roll,s):s,d="padding"in t?t.padding:i.padding,p=e.P.convert(t.offset);let f=i.centerPoint.add(p);const m=i.screenPointToLocation(f),g=this.cameraHelper.handleFlyTo(i,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:m,offsetAsPoint:p,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let y=t.curve;const v=Math.max(i.width,i.height),_=v/g.scaleOfZoom,x=g.pixelPathLength;"number"==typeof g.scaleOfMinZoom&&(y=Math.sqrt(v/g.scaleOfMinZoom/x*2));const b=y*y;function w(t){const e=(_*_-v*v+(t?-1:1)*b*b*x*x)/(2*(t?_:v)*b*x);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}const T=w(!1);let E=function(t){return M(T)/M(T+y*t)},A=function(t){return v*((M(T)*(S(e=T+y*t)/M(e))-S(T))/b)/x;var e},C=(w(!0)-T)/y;if(Math.abs(x)<2e-6||!isFinite(C)){if(Math.abs(v-_)<1e-6)return this.easeTo(t,n);const e=_<v?-1:1;C=Math.abs(Math.log(_/v))/y,A=()=>0,E=t=>Math.exp(e*y*t)}return t.duration="duration"in t?+t.duration:1e3*C/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=r!==c,this._pitching=u!==a,this._rolling=h!==s,this._padding=!i.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(g.targetCenter),this._ease(o=>{const m=o*C,y=1/E(m),v=A(m);this._rotating&&i.setBearing(e.C.number(r,c,o)),this._pitching&&i.setPitch(e.C.number(a,u,o)),this._rolling&&i.setRoll(e.C.number(s,h,o)),this._padding&&(i.interpolatePadding(l,d,o),f=i.centerPoint.add(p)),g.easeFunc(o,y,v,f),this.terrain&&!t.freezeElevation&&this._updateElevation(o),this._applyUpdatedTransform(i),this._fireMoveEvents(n)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}return t||null===(n=this.handlers)||void 0===n||n.stop(!1),this}_ease(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this._easeStart=o.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=e.aO(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.S.convert(t),this.transform.tileZoom):null}}const Ra={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ka{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ra;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=s.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=s.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const n=this._map._getUIString("AttributionControl.".concat(e));t.title=n,t.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(t=>"string"!=typeof t?"":t)):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const n=e[i];if(n.used||n.usedForTerrain){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter(t=>String(t).trim()),t.sort((t,e)=>t.length-e.length),t=t.filter((e,n)=>{for(let i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0});const n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=s.sanitize(n),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class La{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=s.create("div","maplibregl-ctrl");const e=s.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Da{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,n=e?this._queue.concat(e):this._queue;for(const i of n)if(i.id===t)return void(i.cancelled=!0)}run(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const n of e)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var za=e.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Na extends e.E{constructor(t){super(),this._lastTilesetChange=o.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const i={};for(const r of vt(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))i[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.terrainRttPosMatrix32f=new Float64Array(16),e.bY(r.terrainRttPosMatrix32f,0,e.$,e.$,0,0,1),this._tiles[r.key]=new rt(r,this.tileSize),this._lastTilesetChange=o.now());for(const e in this._tiles)i[e]||delete this._tiles[e]}freeRtt(t){for(const e in this._tiles){const n=this._tiles[e];(!t||n.tileID.equals(t)||n.tileID.isChildOf(t)||t.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,e){return e?this._getTerrainCoordsForTileRanges(t,e):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const i of this._renderableTilesKeys){const r=this._tiles[i].tileID,a=t.clone(),o=e.ba();if(r.canonical.equals(t.canonical))e.bY(o,0,e.$,e.$,0,0,1);else if(r.canonical.isChildOf(t.canonical)){const n=r.canonical.z-t.canonical.z,i=r.canonical.x-(r.canonical.x>>n<<n),a=r.canonical.y-(r.canonical.y>>n<<n),s=e.$>>n;e.bY(o,0,s,s,0,0,1),e.M(o,o,[-i*s,-a*s,0])}else{if(!t.canonical.isChildOf(r.canonical))continue;{const n=t.canonical.z-r.canonical.z,i=t.canonical.x-(t.canonical.x>>n<<n),a=t.canonical.y-(t.canonical.y>>n<<n),s=e.$>>n;e.bY(o,0,e.$,e.$,0,0,1),e.M(o,o,[i*s,a*s,0]),e.N(o,o,[1/2**n,1/2**n,0])}}a.terrainRttPosMatrix32f=new Float32Array(o),n[i]=a}return n}_getTerrainCoordsForTileRanges(t,n){const i={};for(const r of this._renderableTilesKeys){const a=this._tiles[r].tileID;if(!this._isWithinTileRanges(a,n))continue;const o=t.clone(),s=e.ba();if(a.canonical.z===t.canonical.z){const n=t.canonical.x-a.canonical.x,i=t.canonical.y-a.canonical.y;e.bY(s,0,e.$,e.$,0,0,1),e.M(s,s,[n*e.$,i*e.$,0])}else if(a.canonical.z>t.canonical.z){const n=a.canonical.z-t.canonical.z,i=a.canonical.x-(a.canonical.x>>n<<n),r=a.canonical.y-(a.canonical.y>>n<<n),o=t.canonical.x-(a.canonical.x>>n),l=t.canonical.y-(a.canonical.y>>n),c=e.$>>n;e.bY(s,0,c,c,0,0,1),e.M(s,s,[-i*c+o*e.$,-r*c+l*e.$,0])}else{const n=t.canonical.z-a.canonical.z,i=t.canonical.x-(t.canonical.x>>n<<n),r=t.canonical.y-(t.canonical.y>>n<<n),o=(t.canonical.x>>n)-a.canonical.x,l=(t.canonical.y>>n)-a.canonical.y,c=e.$<<n;e.bY(s,0,c,c,0,0,1),e.M(s,s,[i*e.$+o*c,r*e.$+l*c,0])}o.terrainRttPosMatrix32f=new Float32Array(s),i[r]=o}return i}getSourceTile(t,e){const n=this.sourceCache._source;let i=t.overscaledZ-this.deltaZoom;if(i>n.maxzoom&&(i=n.maxzoom),i<n.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(i).key);let r=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!r||!r.dem)&&e)for(;i>=n.minzoom&&(!r||!r.dem);)r=this.sourceCache.getTileByID(t.scaledTo(i--).key);return r}anyTilesAfterTime(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return this._lastTilesetChange>=t}_isWithinTileRanges(t,e){return e[t.canonical.z]&&t.canonical.x>=e[t.canonical.z].minTileX&&t.canonical.x<=e[t.canonical.z].maxTileX&&t.canonical.y>=e[t.canonical.z].minTileY&&t.canonical.y<=e[t.canonical.z].maxTileY}}class Oa{constructor(t,e,n){this._meshCache={},this.painter=t,this.sourceCache=new Na(e),this.options=n,this.exaggeration="number"==typeof n.exaggeration?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.$;var a;if(!(n>=0&&n<r&&i>=0&&i<r))return 0;const o=this.getTerrainData(t),s=null===(a=o.tile)||void 0===a?void 0:a.dem;if(!s)return 0;const l=e.cs([],[n/r*e.$,i/r*e.$],o.u_terrain_matrix),c=[l[0]*s.dim,l[1]*s.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return s.get(u,h)*(1-d)*(1-p)+s.get(u+1,h)*d*(1-p)+s.get(u,h+1)*(1-d)*p+s.get(u+1,h+1)*d*p}getElevationForLngLatZoom(t,n){if(!e.ct(n,t.wrap()))return 0;const{tileID:i,mercatorX:r,mercatorY:a}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(i,r%e.$,a%e.$,e.$)}getElevation(t,n,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.$;return this.getDEMElevation(t,n,i,r)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const t=this.painter.context,n=new e.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new e.T(t,n,t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new e.T(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.ag([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const t=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new e.T(t,n.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),n.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const i=n&&n+n.tileID.key+t.key;if(i&&!this._demMatrixCache[i]){const i=this.sourceCache.sourceCache._source.maxzoom;let r=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=i?r=t.canonical.z-i:e.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const a=t.canonical.x-(t.canonical.x>>r<<r),o=t.canonical.y-(t.canonical.y>>r<<r),s=e.cu(new Float64Array(16),[1/(e.$<<r),1/(e.$<<r),0]);e.M(s,s,[a*e.$,o*e.$,0]),this._demMatrixCache[t.key]={matrix:s,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:i?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,i=n.width/devicePixelRatio,r=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new e.T(n.context,{width:i,height:r,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new e.T(n.context,{width:i,height:r,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,a=0;e<this._coordsTextureSize;e++)for(let t=0;t<this._coordsTextureSize;t++,a+=4)n[a+0]=255&t,n[a+1]=255&e,n[a+2]=t>>8<<4|e>>8,n[a+3]=0;const i=new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),r=new e.T(t,i,t.gl.RGBA,{premultiply:!1});return r.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),i=this.painter.context,r=i.gl,a=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),o=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),s=Math.round(this.painter.height/devicePixelRatio);i.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(a,s-o-1,1,1,r.RGBA,r.UNSIGNED_BYTE,n),i.bindFramebuffer.set(null);const l=n[0]+(n[2]>>4<<8),c=n[1]+((15&n[2])<<8),u=this.coordsIndex[255-n[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new e.a1((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(t){const e=new Uint8Array(4),n=this.painter.context,i=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),i.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,i.RGBA,i.UNSIGNED_BYTE,e),n.bindFramebuffer.set(null),(e[0]/16777216+e[1]/65536+e[2]/256+e[3])/256}getTerrainMesh(t){var n;const i=(null===(n=this.painter.style.projection)||void 0===n?void 0:n.transitionState)>0,r=i&&0===t.canonical.y,a=i&&t.canonical.y===(1<<t.canonical.z)-1,o="m_".concat(r?"n":"","_").concat(a?"s":"");if(this._meshCache[o])return this._meshCache[o];const s=this.painter.context,l=new e.cv,c=new e.aN,u=this.meshSize,h=e.$/u,d=u*u;for(let e=0;e<=u;e++)for(let t=0;t<=u;t++)l.emplaceBack(t*h,e*h,0);for(let e=0;e<d;e+=u+1)for(let t=0;t<u;t++)c.emplaceBack(t+e,u+t+e+1,u+t+e+2),c.emplaceBack(t+e,u+t+e+2,t+e+1);const p=l.length,f=p+(u+1),m=(u+1)*u,g=r?e.bh:0,y=r?0:1,v=a?e.bi:e.$,_=a?0:1;for(let e=0;e<=u;e++)l.emplaceBack(e*h,g,y);for(let e=0;e<=u;e++)l.emplaceBack(e*h,v,_);for(let e=0;e<u;e++)c.emplaceBack(m+e,f+e,f+e+1),c.emplaceBack(m+e,f+e+1,m+e+1),c.emplaceBack(0+e,p+e+1,p+e),c.emplaceBack(0+e,0+e+1,p+e+1);const x=l.length,b=x+2*(u+1);for(const S of[0,1])for(let t=0;t<=u;t++)for(const n of[0,1])l.emplaceBack(S*e.$,t*h,n);for(let e=0;e<2*u;e+=2)c.emplaceBack(x+e,x+e+1,x+e+3),c.emplaceBack(x+e,x+e+3,x+e+2),c.emplaceBack(b+e,b+e+3,b+e+1),c.emplaceBack(b+e,b+e+2,b+e+3);const w=new we(s.createVertexBuffer(l,za.members),s.createIndexBuffer(c),e.aM.simpleSegment(0,0,l.length,c.length));return this._meshCache[o]=w,w}getMeshFrameDelta(t){return 2*Math.PI*e.bu/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,e){var n;const{tileID:i}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(n=this.getMinMaxElevation(i).minElevation)&&void 0!==n?n:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,n={minElevation:null,maxElevation:null};return e&&e.dem&&(n.minElevation=e.dem.min*this.exaggeration,n.maxElevation=e.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(t,n){const i=e.a1.fromLngLat(t.wrap()),r=(1<<n)*e.$,a=i.x*r,o=i.y*r,s=Math.floor(a/e.$),l=Math.floor(o/e.$);return{tileID:new e.Z(n,0,n,s,l),mercatorX:a,mercatorY:o}}}class Fa{constructor(t,e,n){this._context=t,this._size=e,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new e.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(i.texture),{id:t,fbo:n,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(e=>t.id!==e),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(t=>!t.inUse)}}const Ba={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ua{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new Fa(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(n=>!t._layers[n].isHidden(e)),this._coordsAscending={};for(const n in t.sourceCaches){this._coordsAscending[n]={};const e=t.sourceCaches[n].getVisibleCoordinates(),i=t.sourceCaches[n].getSource(),r=i instanceof Y?i.terrainTileRanges:null;for(const t of e){const e=this.terrain.sourceCache.getTerrainCoords(t,r);for(const t in e)this._coordsAscending[n][t]||(this._coordsAscending[n][t]=[]),this._coordsAscending[n][t].push(e[t])}}this._coordsAscendingStr={};for(const n of t._order){const e=t._layers[n],i=e.source;if(Ba[e.type]&&!this._coordsAscendingStr[i]){this._coordsAscendingStr[i]={};for(const t in this._coordsAscending[i])this._coordsAscendingStr[i][t]=this._coordsAscending[i][t].map(t=>t.key).sort().join()}}for(const n of this._renderableTiles)for(const t in this._coordsAscendingStr){const e=this._coordsAscendingStr[t][n.tileID.key];e&&e!==n.rttCoords[t]&&(n.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const i=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),r=t.type,a=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ba[r]&&(this._prevType&&Ba[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!o))return!0;if(Ba[this._prevType]||Ba[r]&&o){this._prevType=r;const t=this._stacks.length-1,n=this._stacks[t]||[];for(const r of this._renderableTiles){if(this.pool.isFull()&&(Tr(this.painter,this.terrain,this._rttTiles,i),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(r),r.rtt[t]){const e=this.pool.getObjectForId(r.rtt[t].id);if(e.stamp===r.rtt[t].stamp){this.pool.useObject(e);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),r.rtt[t]={id:o.id,stamp:o.stamp},a.context.bindFramebuffer.set(o.fbo.framebuffer),a.context.clear({color:e.bf.transparent,stencil:0}),a.currentStencilSource=void 0;for(let t=0;t<n.length;t++){const e=a.style._layers[n[t]],s=e.source?this._coordsAscending[e.source][r.tileID.key]:[r.tileID];a.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),a._renderTileClippingMasks(e,s,!0),a.renderLayer(a,a.style.sourceCaches[e.source],e,s,i),e.source&&(r.rttCoords[e.source]=this._coordsAscendingStr[e.source][r.tileID.key])}}return Tr(this.painter,this.terrain,this._rttTiles,i),this._rttTiles=[],this.pool.freeAllObjects(),Ba[r]}return!1}}const ja={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Va=n,Ha={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ra,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Ga={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Wa{constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.mousedown=t=>{this.startMove(t,s.mousePos(this.element,t)),s.addEventListener(window,"mousemove",this.mousemove),s.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.move(t,s.mousePos(this.element,t))},this.mouseup=t=>{this._rotatePitchHandler.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.startMove(t,this._startPos),s.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,t.targetTouches)[0],this.move(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const r=new na;this._rotatePitchHandler=new Kr({clickTolerance:3,move:(t,r)=>{const a=n.getBoundingClientRect(),o=new e.P((a.bottom-a.top)/2,(a.right-a.left)/2);return{bearingDelta:e.cn(new e.P(t.x,r.y),r,o),pitchDelta:i?-.5*(r.y-t.y):void 0}},moveStateManager:r,enable:!0,assignEvents:()=>{}}),this.map=t,s.addEventListener(n,"mousedown",this.mousedown),s.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(n,"touchcancel",this.reset)}startMove(t,e){this._rotatePitchHandler.dragStart(t,e),s.disableDrag()}move(t,e){const n=this.map,{bearingDelta:i,pitchDelta:r}=this._rotatePitchHandler.dragMove(t,e)||{};i&&n.setBearing(n.getBearing()+i),r&&n.setPitch(n.getPitch()+r)}off(){const t=this.element;s.removeEventListener(t,"mousedown",this.mousedown),s.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend),s.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(window,"mousemove",this.mousemove),s.removeEventListener(window,"mouseup",this.mouseup),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend)}}let qa;function Za(t,n,i){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return null==t?void 0:t.wrap();const r=new e.S(t.lng,t.lat);if(t=new e.S(t.lng,t.lat),n){const r=new e.S(t.lng-360,t.lat),a=new e.S(t.lng+360,t.lat),o=i.locationToScreenPoint(t).distSqr(n);i.locationToScreenPoint(r).distSqr(n)<o?t=r:i.locationToScreenPoint(a).distSqr(n)<o&&(t=a)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationToScreenPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t.lng!==r.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(t))?t:r}const Xa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ya(t,e,n){const i=t.classList;for(const r in Xa)i.remove("maplibregl-".concat(n,"-anchor-").concat(r));i.add("maplibregl-".concat(n,"-anchor-").concat(e))}class Ka extends e.E{constructor(t){if(super(),this._onKeyPress=t=>{const e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},this._update=t=>{if(!this._map)return;const e=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!e)&&this._map.once("render",this._update),this._lngLat=Za(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let n="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?n="rotateZ(".concat(this._rotation,"deg)"):"map"===this._rotationAlignment&&(n="rotateZ(".concat(this._rotation-this._map.getBearing(),"deg)"));let i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i="rotateX(".concat(this._map.getPitch(),"deg)")),this._subpixelPositioning||t&&"moveend"!==t.type||(this._pos=this._pos.round()),s.setTransform(this._element,"".concat(Xa[this._anchor]," translate(").concat(this._pos.x,"px, ").concat(this._pos.y,"px) ").concat(i," ").concat(n)),o.frameAsync(new AbortController).then(()=>{this._updateOpacity(t&&"moveend"===t.type)}).catch(()=>{})},this._onMove=t=>{if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.l("dragstart"))),this.fire(new e.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.l("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this.setOpacity(null==t?void 0:t.opacity,null==t?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div");const n=s.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","".concat(i,"px")),n.setAttributeNS(null,"width","".concat(r,"px")),n.setAttributeNS(null,"viewBox","0 0 ".concat(r," ").concat(i));const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=s.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=s.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),o.appendChild(l),o.appendChild(u),o.appendChild(d),o.appendChild(f),o.appendChild(m),n.appendChild(o),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()}),Ya(this._element,this._anchor,"marker"),t&&t.className)for(const e of t.className.split(" "))this._element.classList.add(e);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,n=13.5,i=Math.abs(n)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[i,-1*(e-n+i)],"bottom-right":[-i,-1*(e-n+i)],left:[n,-1*(e-n)],right:[-n,-1*(e-n)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var n,i;const r=null===(n=this._map)||void 0===n?void 0:n.terrain,a=this._map.transform.isLocationOccluded(this._lngLat);if(!r||a){const t=a?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==t&&(this._element.style.opacity=t))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const o=this._map,s=o.terrain.depthAtPoint(this._pos),l=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,l)-s<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/o.transform.pixelsPerMeter,u=Math.sin(o.getPitch()*Math.PI/180)*c,h=o.terrain.depthAtPoint(new e.P(this._pos.x,this._pos.y-this._offset.y)),d=o.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(i=this._popup)||void 0===i?void 0:i.isOpen())&&d&&this._popup.remove(),this._element.style.opacity=d?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,e){return(void 0===this._opacity||void 0===t&&void 0===e)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==t&&(this._opacity=t),void 0!==e&&(this._opacityWhenCovered=e),this._map&&this._updateOpacity(!0),this}}const Ja={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $a=0,Qa=!1;const to={maxWidth:100,unit:"metric"};function eo(t,e,n){const i=n&&n.maxWidth||100,r=t._container.clientHeight/2,a=t._container.clientWidth/2,o=t.unproject([a-i/2,r]),s=t.unproject([a+i/2,r]),l=Math.round(t.project(s).x-t.project(o).x),c=Math.min(i,l,t._container.clientWidth),u=o.distanceTo(s);if(n&&"imperial"===n.unit){const n=3.2808*u;n>5280?no(e,c,n/5280,t._getUIString("ScaleControl.Miles")):no(e,c,n,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?no(e,c,u/1852,t._getUIString("ScaleControl.NauticalMiles")):u>=1e3?no(e,c,u/1e3,t._getUIString("ScaleControl.Kilometers")):no(e,c,u,t._getUIString("ScaleControl.Meters"))}function no(t,e,n,i){const r=function(t){const e=Math.pow(10,"".concat(Math.floor(t)).length-1);let n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n),e*n}(n);t.style.width=e*(r/n)+"px",t.innerHTML="".concat(r,"&nbsp;").concat(i)}const io={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ro=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ao(t){if(t){if("number"==typeof t){const n=Math.round(Math.abs(t)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,t),"top-left":new e.P(n,n),"top-right":new e.P(-n,n),bottom:new e.P(0,-t),"bottom-left":new e.P(n,-n),"bottom-right":new e.P(-n,-n),left:new e.P(t,0),right:new e.P(-t,0)}}if(t instanceof e.P||Array.isArray(t)){const n=e.P.convert(t);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:e.P.convert(t.center||[0,0]),top:e.P.convert(t.top||[0,0]),"top-left":e.P.convert(t["top-left"]||[0,0]),"top-right":e.P.convert(t["top-right"]||[0,0]),bottom:e.P.convert(t.bottom||[0,0]),"bottom-left":e.P.convert(t["bottom-left"]||[0,0]),"bottom-right":e.P.convert(t["bottom-right"]||[0,0]),left:e.P.convert(t.left||[0,0]),right:e.P.convert(t.right||[0,0])}}return ao(new e.P(0,0))}const oo=n;t.AJAXError=e.cz,t.Event=e.l,t.Evented=e.E,t.LngLat=e.S,t.MercatorCoordinate=e.a1,t.Point=e.P,t.addProtocol=e.cA,t.config=e.a,t.removeProtocol=e.cB,t.AttributionControl=ka,t.BoxZoomHandler=Wr,t.CanvasSource=J,t.CooperativeGesturesHandler=Ta,t.DoubleClickZoomHandler=_a,t.DragPanHandler=wa,t.DragRotateHandler=Sa,t.EdgeInsets=Ae,t.FullscreenControl=class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._onFullscreenChange=()=>{var t;let e=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.fullscreenElement;)e=e.shadowRoot.fullscreenElement;e===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=s.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);s.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new e.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new e.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},t.GeoJSONSource=X,t.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new e.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new e.S(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),a=e.e({bearing:r},this.options.fitBoundsOptions),o=H.fromLngLat(n,i);this._map.fitBounds(o,a,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new e.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Qa)return;this.options.trackUserLocation&&this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new e.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=s.create("button","maplibregl-ctrl-geolocate",this._container),s.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ka({element:this._dotElement}),this._circleElement=s.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ka({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{const n=(null==t?void 0:t[0])instanceof ResizeObserverEntry;t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new e.l("trackuserlocationend")),this.fire(new e.l("userlocationlostfocus")))})}},this.options=e.e({},Ja,t)}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return e._(this,arguments,void 0,function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function*(){if(void 0!==qa&&!t)return qa;if(void 0===window.navigator.permissions)return qa=!!window.navigator.geolocation,qa;try{const t=yield window.navigator.permissions.query({name:"geolocation"});qa="denied"!==t.state}catch(t){qa=!!window.navigator.geolocation}return qa}()})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$a=0,Qa=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),n=t.getNorthEast(),i=e.distanceTo(n),r=Math.ceil(this._accuracy/(i/this._map._container.clientHeight)*2);this._circleElement.style.width="".concat(r,"px"),this._circleElement.style.height="".concat(r,"px")}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$a--,Qa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new e.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.l("trackuserlocationstart")),this.fire(new e.l("userlocationfocus"));break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$a++,$a>1?(t={maximumAge:6e5,timeout:0},Qa=!0):(t=this.options.positionOptions,Qa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},t.GlobeControl=class{constructor(){this._toggleProjection=()=>{var t;const e=null===(t=this._map.getProjection())||void 0===t?void 0:t.type;this._map.setProjection("mercator"!==e&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var t;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(t=this._map.getProjection())||void 0===t?void 0:t.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=s.create("button","maplibregl-ctrl-globe",this._container),s.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},t.Hash=Pr,t.ImageSource=Y,t.KeyboardHandler=fa,t.LngLatBounds=H,t.LogoControl=La,t.Map=class extends Ia{constructor(t){var n,i;e.cw.mark(e.cx.create);const r=Object.assign(Object.assign(Object.assign({},Ha),t),{canvasContextAttributes:Object.assign(Object.assign({},Ha.canvasContextAttributes),t.canvasContextAttributes)});if(null!=r.minZoom&&null!=r.maxZoom&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=r.minPitch&&null!=r.maxPitch&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=r.minPitch&&r.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=r.maxPitch&&r.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const a=new De,o=new Fe;if(void 0!==r.minZoom&&a.setMinZoom(r.minZoom),void 0!==r.maxZoom&&a.setMaxZoom(r.maxZoom),void 0!==r.minPitch&&a.setMinPitch(r.minPitch),void 0!==r.maxPitch&&a.setMaxPitch(r.maxPitch),void 0!==r.renderWorldCopies&&a.setRenderWorldCopies(r.renderWorldCopies),super(a,o,{bearingSnap:r.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Da,this._controls=[],this._mapId=e.a7(),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new e.l("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.l("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._maxTileCacheZoomLevels=r.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},r.canvasContextAttributes),this._trackResize=!0===r.trackResize,this._bearingSnap=r.bearingSnap,this._centerClampedToGround=r.centerClampedToGround,this._refreshExpiredTiles=!0===r.refreshExpiredTiles,this._fadeDuration=r.fadeDuration,this._crossSourceCollisions=!0===r.crossSourceCollisions,this._collectResourceTiming=!0===r.collectResourceTiming,this._locale=Object.assign(Object.assign({},ja),r.locale),this._clickTolerance=r.clickTolerance,this._overridePixelRatio=r.pixelRatio,this._maxCanvasSize=r.maxCanvasSize,this.transformCameraUpdate=r.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===r.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=f.addThrottleControl(()=>this.isMoving()),this._requestManager=new m(r.transformRequest),"string"==typeof r.container){if(this._container=document.getElementById(r.container),!this._container)throw new Error("Container '".concat(r.container,"' not found."))}else{if(!(r.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=Cr(t=>{this._trackResize&&!this._removed&&(this.resize(t),this.redraw())},50);this._resizeObserver=new ResizeObserver(n=>{t?e(n):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Pa(this,r),this._hash=r.hash&&new Pr("string"==typeof r.hash&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,elevation:r.elevation,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,roll:r.roll}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,e.e({},r.fitBoundsOptions,{duration:0}))));const s="string"==typeof r.style||!("globe"===(null===(i=null===(n=r.style)||void 0===n?void 0:n.projection)||void 0===i?void 0:i.type));this.resize(null,s),this._localIdeographFontFamily=r.localIdeographFontFamily,this._validateStyle=r.validateStyle,r.style&&this.setStyle(r.style,{localIdeographFontFamily:r.localIdeographFontFamily}),r.attributionControl&&this.addControl(new ka("boolean"==typeof r.attributionControl?void 0:r.attributionControl)),r.maplibreLogo&&this.addControl(new La,r.logoPosition),this.on("style.load",()=>{if(s||this._resizeTransform(),this.transform.unmodified){const t=e.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(t)}}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.l("".concat(t.dataType,"data"),t))}),this.on("dataloading",t=>{this.fire(new e.l("".concat(t.dataType,"dataloading"),t))}),this.on("dataabort",t=>{this.fire(new e.l("sourcedataabort",t))})}_getMapId(){return this._mapId}setGlobalStateProperty(t,e){return this.style.setGlobalStateProperty(t,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,n,i){return null==i&&this.terrain&&(i=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,n,i)}resize(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[i,r]=this._containerDimensions(),a=this._getClampedPixelRatio(i,r);if(this._resizeCanvas(i,r,a),this.painter.resize(i,r,a),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(i,r);this._resizeCanvas(i,r,e),this.painter.resize(i,r,e)}this._resizeTransform(n);const o=!this._moving;return o&&(this.stop(),this.fire(new e.l("movestart",t)).fire(new e.l("move",t))),this.fire(new e.l("resize",t)),o&&this.fire(new e.l("moveend",t)),this}_resizeTransform(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e;const[n,i]=this._containerDimensions();this.transform.resize(n,i,t),null===(e=this._requestedCameraState)||void 0===e||e.resize(n,i,t)}_getClampedPixelRatio(t,e){const{0:n,1:i}=this._maxCanvasSize,r=this.getPixelRatio(),a=t*r,o=e*r;return Math.min(a>n?n/a:1,o>i?i/o:1)*r}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(H.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.setMinZoom(t),this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.setMaxZoom(t),this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.setMinPitch(t),this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>180)throw new Error("maxPitch must be less than or equal to 180");if(t>=this.transform.minPitch)return this.transform.setMaxPitch(t),this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.setRenderWorldCopies(t),this._update()}project(t){return this.transform.locationToScreenPoint(e.S.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.screenPointToLocation(e.P.convert(t),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let i=!1;const r=r=>{const a=e.filter(t=>this.getLayer(t)),o=0!==a.length?this.queryRenderedFeatures(r.point,{layers:a}):[];o.length?i||(i=!0,n.call(this,new Br(t,this,r.originalEvent,{features:o}))):i=!1};return{layers:e,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===t||"mouseout"===t){let i=!1;const r=r=>{const a=e.filter(t=>this.getLayer(t));(0!==a.length?this.queryRenderedFeatures(r.point,{layers:a}):[]).length?i=!0:i&&(i=!1,n.call(this,new Br(t,this,r.originalEvent)))},a=e=>{i&&(i=!1,n.call(this,new Br(t,this,e.originalEvent)))};return{layers:e,listener:n,delegates:{mousemove:r,mouseout:a}}}{const i=t=>{const i=e.filter(t=>this.getLayer(t)),r=0!==i.length?this.queryRenderedFeatures(t.point,{layers:i}):[];r.length&&(t.features=r,n.call(this,t),delete t.features)};return{layers:e,listener:n,delegates:{[t]:i}}}}_saveDelegatedListener(t,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(e)}_removeDelegatedListener(t,e,n){if(!this._delegatedListeners||!this._delegatedListeners[t])return;const i=this._delegatedListeners[t];for(let r=0;r<i.length;r++){const t=i[r];if(t.listener===n&&t.layers.length===e.length&&t.layers.every(t=>e.includes(t))){for(const e in t.delegates)this.off(e,t.delegates[e]);return void i.splice(r,1)}}}on(t,e,n){if(void 0===n)return super.on(t,e);const i="string"==typeof e?[e]:e,r=this._createDelegatedListener(t,i,n);this._saveDelegatedListener(t,r);for(const a in r.delegates)this.on(a,r.delegates[a]);return{unsubscribe:()=>{this._removeDelegatedListener(t,i,n)}}}once(t,e,n){var i=this;if(void 0===n)return super.once(t,e);const r="string"==typeof e?[e]:e,a=this._createDelegatedListener(t,r,n);for(const o in a.delegates){const e=a.delegates[o];a.delegates[o]=function(){i._removeDelegatedListener(t,r,n),e(...arguments)}}this._saveDelegatedListener(t,a);for(const o in a.delegates)this.once(o,a.delegates[o]);return this}off(t,e,n){return void 0===n?super.off(t,e):(this._removeDelegatedListener(t,"string"==typeof e?[e]:e,n),this)}queryRenderedFeatures(t,n){if(!this.style)return[];let i;const r=t instanceof e.P||Array.isArray(t),a=r?t:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(r?{}:t)||{},a instanceof e.P||"number"==typeof a[0])i=[e.P.convert(a)];else{const t=e.P.convert(a[0]),n=e.P.convert(a[1]);i=[t,new e.P(n.x,t.y),n,new e.P(t.x,n.y),t]}return this.style.queryRenderedFeatures(i,n,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(t,n){return!1!==(n=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(t,n))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error("Missing UI string '".concat(t,"'"));return e}_updateStyle(t,e){var n,i;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(t,e));const r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new Sn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,r):this.style.loadJSON(t,e,r),this):(null===(i=null===(n=this.style)||void 0===n?void 0:n.projection)||void 0===i||i.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,n){if("string"==typeof t){const i=this._requestManager.transformRequest(t,"Style");e.j(i,new AbortController).then(t=>{this._updateDiff(t.data,n)}).catch(t=>{t&&this.fire(new e.k(t))})}else"object"==typeof t&&this._updateDiff(t,n)}_updateDiff(t,n){try{this.style.setState(t,n)&&this._update(!0)}catch(i){e.w("Unable to perform style diff: ".concat(i.message||i.error||i,".  Rebuilding the style from scratch.")),this._updateStyle(t,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){const n=this.style&&this.style.sourceCaches[t];if(void 0!==n)return n.loaded();this.fire(new e.k(new Error("There is no source with ID '".concat(t,"'"))))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),t){const n=this.style.sourceCaches[t.source];if(!n)throw new Error("cannot load terrain, because there exists no source with ID: ".concat(t.source));null===this.terrain&&n.reload();for(const i in this.style._layers){const n=this.style._layers[i];"hillshade"===n.type&&n.source===t.source&&e.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===n.type&&n.source===t.source&&e.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Oa(this.painter,n,t),this.painter.renderToTexture=new Ua(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=e=>{var n;"style"===e.dataType?this.terrain.sourceCache.freeRtt():"source"===e.dataType&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(n=e.source)||void 0===n?void 0:n.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new e.l("terrain",{terrain:t})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const n=t[e]._tiles;for(const t in n){const e=n[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}setSourceTileLodParams(t,e,n){if(n){const i=this.getSource(n);if(!i)throw new Error('There is no source with ID "'.concat(n,'", cannot set LOD parameters'));i.calculateTileZoom=mt(Math.max(1,t),Math.max(1,e))}else for(const i in this.style.sourceCaches)this.style.sourceCaches[i].getSource().calculateTileZoom=mt(Math.max(1,t),Math.max(1,e));return this._update(!0),this}refreshTiles(t,n){const i=this.style.sourceCaches[t];if(!i)throw new Error('There is no source cache with ID "'.concat(t,'", cannot refresh tile'));void 0===n?i.reload(!0):i.refreshTiles(n.map(t=>new e.a4(t.z,t.x,t.y)))}addImage(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{pixelRatio:r=1,sdf:a=!1,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=i;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||e.b(n))){if(void 0===n.width||void 0===n.height)return this.fire(new e.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:i,height:o,data:d}=n,p=n;return this.style.addImage(t,{data:new e.R({width:i,height:o},new Uint8Array(d)),pixelRatio:r,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:a,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t),this}}{const{width:i,height:d,data:p}=o.getImageData(n);this.style.addImage(t,{data:new e.R({width:i,height:d},p),pixelRatio:r,stretchX:s,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:a,version:0})}}updateImage(t,n){const i=this.style.getImage(t);if(!i)return this.fire(new e.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof HTMLImageElement||e.b(n)?o.getImageData(n):n,{width:a,height:s,data:l}=r;if(void 0===a||void 0===s)return this.fire(new e.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==i.data.width||s!==i.data.height)return this.fire(new e.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(n instanceof HTMLImageElement||e.b(n));return i.data.replace(l,c),this.style.updateImage(t,i),this}getImage(t){return this.style.getImage(t)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.k(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t){return f.getImage(this._requestManager.transformRequest(t,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)}setFilter(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.style.setFilter(t,e,n),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setPaintProperty(t,e,n,i),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setLayoutProperty(t,e,n,i),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,n,t=>{t||this._update(!0)}),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,t=>{t||this._update(!0)}),this}setLight(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSky(t,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=s.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=s.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),i=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],i);const r=this._controlContainer=s.create("div","maplibregl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{a[t]=s.create("div","maplibregl-ctrl-".concat(t," "),r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e,n){this._canvas.width=Math.floor(n*t),this._canvas.height=Math.floor(n*e),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(e,"px")}_setupPainter(){const t=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",n=>{e={requestedAttributes:t},n&&(e.statusMessage=n.statusMessage,e.type=n.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,t):this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t),!n){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new Ar(n,this.transform),l.testSupport(n)}migrateProjection(t,n){super.migrateProjection(t,n),this.painter.transform=t,this.fire(new e.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){var n,i,r,a,s;const l=this._idleTriggered?this._fadeDuration:0,c=(null===(n=this.style.projection)||void 0===n?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=o.now();this.style.zoomHistory.update(t,n);const i=new e.F(t,{now:n,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(u=!0,this._crossFadingFactor=r),this.style.update(i)}const h=(null===(i=this.style.projection)||void 0===i?void 0:i.transitionState)>0!==c;null===(r=this.style.projection)||void 0===r||r.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(a=this.style.projection)||void 0===a?void 0:a.transitionState,null===(s=this.style.projection)||void 0===s?void 0:s.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new e.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.cw.mark(e.cx.load),this.fire(new e.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,e.cw.mark(e.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),f.removeThrottleControl(this._imageQueueHandle),null===(t=this._resizeObserver)||void 0===t||t.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==n?void 0:n.loseContext)&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),s.remove(this._canvasContainer),s.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),e.cw.clearMetrics(),this._removed=!0,this.fire(new e.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,o.frame(this._frameRequest,t=>{e.cw.frame(t),this._frameRequest=null;try{this._render(t)}catch(t){if(!e.cy(t)&&!function(t){return t.message===qi}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return Va}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(t){return this._lazyInitEmptyStyle(),this.style.setProjection(t),this._update(!0)}},t.MapMouseEvent=Br,t.MapTouchEvent=Ur,t.MapWheelEvent=jr,t.Marker=Ka,t.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5),") rotateZ(").concat(-this._map.transform.roll,"deg) rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(-this._map.transform.bearing,"deg)"):this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5),") rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(-this._map.transform.bearing,"deg)"):this.options.visualizeRoll?"rotate(".concat(-this._map.transform.bearing-this._map.transform.roll,"deg)"):"rotate(".concat(-this._map.transform.bearing,"deg)")},this._setButtonTitle=(t,e)=>{const n=this._map._getUIString("NavigationControl.".concat(e));t.title=n,t.setAttribute("aria-label",n)},this.options=e.e({},Ga,t),this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),s.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),s.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=s.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const n=s.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}},t.Popup=class extends e.E{constructor(t){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?"".concat(this.options.locationOccludedOpacity):"")},this.remove=()=>(this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new e.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=s.create("div","maplibregl-popup",this._map.getContainer()),this._tip=s.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Za(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const e=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let n=this.options.anchor;const i=ao(this.options.offset);if(!n){const t=this._container.offsetWidth,r=this._container.offsetHeight;let a;a=e.y+i.bottom.y<r?["top"]:e.y>this._map.transform.height-r?["bottom"]:[],e.x<t/2?a.push("left"):e.x>this._map.transform.width-t/2&&a.push("right"),n=0===a.length?"bottom":a.join("-")}let r=e.add(i[n]);this.options.subpixelPositioning||(r=r.round()),s.setTransform(this._container,"".concat(Xa[n]," translate(").concat(r.x,"px,").concat(r.y,"px)")),Ya(this._container,n,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(io),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new e.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.S.convert(t),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){return this._container&&this._container.classList.add(t),this}removeClassName(t){return this._container&&this._container.classList.remove(t),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}setSubpixelPositioning(t){this.options.subpixelPositioning=t}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(ro);t&&t.focus()}},t.RasterDEMTileSource=Z,t.RasterTileSource=q,t.ScaleControl=class{constructor(t){this._onMove=()=>{eo(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,eo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},to),t)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},t.ScrollZoomHandler=va,t.Style=Sn,t.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=t}onAdd(t){return this._map=t,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=s.create("button","maplibregl-ctrl-terrain",this._container),s.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){s.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},t.TwoFingersTouchPitchHandler=da,t.TwoFingersTouchRotateHandler=ua,t.TwoFingersTouchZoomHandler=la,t.TwoFingersTouchZoomRotateHandler=Ma,t.VectorTileSource=W,t.VideoSource=K,t.addSourceType=(t,n)=>e._(void 0,void 0,void 0,function*(){if(Q(t))throw new Error('A source type called "'.concat(t,'" already exists.'));((t,e)=>{$[t]=e})(t,n)}),t.clearPrewarmedResources=function(){const t=L;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(I),L=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.createTileMesh=Ye,t.getMaxParallelImageRequests=function(){return e.a.MAX_PARALLEL_IMAGE_REQUESTS},t.getRTLTextPluginStatus=function(){return it().getRTLTextPluginStatus()},t.getVersion=function(){return oo},t.getWorkerCount=function(){return R.workerCount},t.getWorkerUrl=function(){return e.a.WORKER_URL},t.importScriptInWorkers=function(t){return O().broadcast("IS",t)},t.prewarm=function(){z().acquire(I)},t.setMaxParallelImageRequests=function(t){e.a.MAX_PARALLEL_IMAGE_REQUESTS=t},t.setRTLTextPlugin=function(t,e){return it().setRTLTextPlugin(t,e)},t.setWorkerCount=function(t){R.workerCount=t},t.setWorkerUrl=function(t){e.a.WORKER_URL=t}}),t}()},153:(t,e)=>{"use strict";e.ConcurrentRoot=1,e.ContinuousEventPriority=4,e.DefaultEventPriority=16,e.DiscreteEventPriority=1},204:(t,e,n)=>{"use strict";t.exports=n(969)},235:(t,e,n)=>{"use strict";t.exports=n(473)},340:(t,e,n)=>{"use strict";t.exports=n(761)},345:(t,e,n)=>{"use strict";var i=n(950),r=n(204);function a(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(s[t]=e,t=0;t<e.length;t++)o.add(e[t])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(t,e,n,i,r,a,o){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){g[t]=new m(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];g[e]=new m(e,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){g[t]=new m(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){g[t]=new m(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){g[t]=new m(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){g[t]=new m(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){g[t]=new m(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){g[t]=new m(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){g[t]=new m(t,5,!1,t.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(t){return t[1].toUpperCase()}function _(t,e,n,i){var r=g.hasOwnProperty(e)?g[e]:null;(null!==r?0!==r.type:i||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,i){if(null===e||"undefined"===typeof e||function(t,e,n,i){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,r,i)&&(n=null),i||null===r?function(t){return!!h.call(f,t)||!h.call(p,t)&&(d.test(t)?f[t]=!0:(p[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=null===n?3!==r.type&&"":n:(e=r.attributeName,i=r.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(y,v);g[e]=new m(e,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(y,v);g[e]=new m(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(y,v);g[e]=new m(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!0,!0)});var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),A=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function z(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=D&&t[D]||t["@@iterator"])?t:null}var N,O=Object.assign;function F(t){if(void 0===N)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);N=e&&e[1]||""}return"\n"+N+t}var B=!1;function U(t,e){if(!t||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?F(t):""}function j(t){switch(t.tag){case 5:return F(t.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return t=U(t.type,!1);case 11:return t=U(t.type.render,!1);case 1:return t=U(t.type,!0);default:return""}}function V(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case S:return"Fragment";case w:return"Portal";case T:return"Profiler";case M:return"StrictMode";case P:return"Suspense";case I:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case A:return(t.displayName||"Context")+".Consumer";case E:return(t._context.displayName||"Context")+".Provider";case C:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case R:return null!==(e=t.displayName||null)?e:V(t.type)||"Memo";case k:e=t._payload,t=t._init;try{return V(t(e))}catch(n){}}return null}function H(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(e);case 8:return e===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function G(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function W(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function q(t){t._valueTracker||(t._valueTracker=function(t){var e=W(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){i=""+t,a.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function Z(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=W(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function X(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Y(t,e){var n=e.checked;return O({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function K(t,e){var n=null==e.defaultValue?"":e.defaultValue,i=null!=e.checked?e.checked:e.defaultChecked;n=G(null!=e.value?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function J(t,e){null!=(e=e.checked)&&_(t,"checked",e,!1)}function $(t,e){J(t,e);var n=G(e.value),i=e.type;if(null!=n)"number"===i?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===i||"reset"===i)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,G(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function Q(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!("submit"!==i&&"reset"!==i||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&X(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+G(n),e=null,r=0;r<t.length;r++){if(t[r].value===n)return t[r].selected=!0,void(i&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function it(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(a(91));return O({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rt(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(a(92));if(et(n)){if(1<n.length)throw Error(a(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:G(n)}}function at(t,e){var n=G(e.value),i=G(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=i&&(t.defaultValue=""+i)}function ot(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function st(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?st(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,ut,ht=(ut=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,i){MSApp.execUnsafeLocalFunction(function(){return ut(t,e)})}:ut);function dt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var pt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ft=["Webkit","ms","Moz","O"];function mt(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||pt.hasOwnProperty(t)&&pt[t]?(""+e).trim():e+"px"}function gt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=mt(n,e[n],i);"float"===n&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}Object.keys(pt).forEach(function(t){ft.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pt[e]=pt[t]})});var yt=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vt(t,e){if(e){if(yt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(a(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(a(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(a(62))}}function _t(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xt=null;function bt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var wt=null,St=null,Mt=null;function Tt(t){if(t=_r(t)){if("function"!==typeof wt)throw Error(a(280));var e=t.stateNode;e&&(e=br(e),wt(t.stateNode,t.type,e))}}function Et(t){St?Mt?Mt.push(t):Mt=[t]:St=t}function At(){if(St){var t=St,e=Mt;if(Mt=St=null,Tt(t),e)for(t=0;t<e.length;t++)Tt(e[t])}}function Ct(t,e){return t(e)}function Pt(){}var It=!1;function Rt(t,e,n){if(It)return t(e,n);It=!0;try{return Ct(t,e,n)}finally{It=!1,(null!==St||null!==Mt)&&(Pt(),At())}}function kt(t,e){var n=t.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(a(231,e,typeof n));return n}var Lt=!1;if(u)try{var Dt={};Object.defineProperty(Dt,"passive",{get:function(){Lt=!0}}),window.addEventListener("test",Dt,Dt),window.removeEventListener("test",Dt,Dt)}catch(ut){Lt=!1}function zt(t,e,n,i,r,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Nt=!1,Ot=null,Ft=!1,Bt=null,Ut={onError:function(t){Nt=!0,Ot=t}};function jt(t,e,n,i,r,a,o,s,l){Nt=!1,Ot=null,zt.apply(Ut,arguments)}function Vt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function Ht(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function Gt(t){if(Vt(t)!==t)throw Error(a(188))}function Wt(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=Vt(t)))throw Error(a(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Gt(r),t;if(o===i)return Gt(r),e;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=o;break}if(l===i){s=!0,i=r,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=r;break}if(l===i){s=!0,i=o,n=r;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?t:e}(t))?qt(t):null}function qt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=qt(t);if(null!==e)return e;t=t.sibling}return null}var Zt=r.unstable_scheduleCallback,Xt=r.unstable_cancelCallback,Yt=r.unstable_shouldYield,Kt=r.unstable_requestPaint,Jt=r.unstable_now,$t=r.unstable_getCurrentPriorityLevel,Qt=r.unstable_ImmediatePriority,te=r.unstable_UserBlockingPriority,ee=r.unstable_NormalPriority,ne=r.unstable_LowPriority,ie=r.unstable_IdlePriority,re=null,ae=null;var oe=Math.clz32?Math.clz32:function(t){return t>>>=0,0===t?32:31-(se(t)/le|0)|0},se=Math.log,le=Math.LN2;var ce=64,ue=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=he(s):0!==(a&=o)&&(i=he(a))}else 0!==(o=n&~r)?i=he(o):0!==a&&(i=he(a));if(0===i)return 0;if(0!==e&&e!==i&&0===(e&r)&&((r=i&-i)>=(a=e&-e)||16===r&&0!==(4194240&a)))return e;if(0!==(4&i)&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-oe(e)),i|=t[n],e&=~r;return i}function pe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function fe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function me(){var t=ce;return 0===(4194240&(ce<<=1))&&(ce=64),t}function ge(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ye(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-oe(e)]=n}function ve(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-oe(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var _e=0;function xe(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var be,we,Se,Me,Te,Ee=!1,Ae=[],Ce=null,Pe=null,Ie=null,Re=new Map,ke=new Map,Le=[],De="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ze(t,e){switch(t){case"focusin":case"focusout":Ce=null;break;case"dragenter":case"dragleave":Pe=null;break;case"mouseover":case"mouseout":Ie=null;break;case"pointerover":case"pointerout":Re.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ke.delete(e.pointerId)}}function Ne(t,e,n,i,r,a){return null===t||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==e&&(null!==(e=_r(e))&&we(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function Oe(t){var e=vr(t.target);if(null!==e){var n=Vt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=Ht(n)))return t.blockedOn=e,void Te(t.priority,function(){Se(n)})}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function Fe(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ye(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=_r(n))&&we(e),t.blockedOn=n,!1;var i=new(n=t.nativeEvent).constructor(n.type,n);xt=i,n.target.dispatchEvent(i),xt=null,e.shift()}return!0}function Be(t,e,n){Fe(t)&&n.delete(e)}function Ue(){Ee=!1,null!==Ce&&Fe(Ce)&&(Ce=null),null!==Pe&&Fe(Pe)&&(Pe=null),null!==Ie&&Fe(Ie)&&(Ie=null),Re.forEach(Be),ke.forEach(Be)}function je(t,e){t.blockedOn===e&&(t.blockedOn=null,Ee||(Ee=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ue)))}function Ve(t){function e(e){return je(e,t)}if(0<Ae.length){je(Ae[0],t);for(var n=1;n<Ae.length;n++){var i=Ae[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==Ce&&je(Ce,t),null!==Pe&&je(Pe,t),null!==Ie&&je(Ie,t),Re.forEach(e),ke.forEach(e),n=0;n<Le.length;n++)(i=Le[n]).blockedOn===t&&(i.blockedOn=null);for(;0<Le.length&&null===(n=Le[0]).blockedOn;)Oe(n),null===n.blockedOn&&Le.shift()}var He=x.ReactCurrentBatchConfig,Ge=!0;function We(t,e,n,i){var r=_e,a=He.transition;He.transition=null;try{_e=1,Ze(t,e,n,i)}finally{_e=r,He.transition=a}}function qe(t,e,n,i){var r=_e,a=He.transition;He.transition=null;try{_e=4,Ze(t,e,n,i)}finally{_e=r,He.transition=a}}function Ze(t,e,n,i){if(Ge){var r=Ye(t,e,n,i);if(null===r)Gi(t,e,i,Xe,n),ze(t,i);else if(function(t,e,n,i,r){switch(e){case"focusin":return Ce=Ne(Ce,t,e,n,i,r),!0;case"dragenter":return Pe=Ne(Pe,t,e,n,i,r),!0;case"mouseover":return Ie=Ne(Ie,t,e,n,i,r),!0;case"pointerover":var a=r.pointerId;return Re.set(a,Ne(Re.get(a)||null,t,e,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,ke.set(a,Ne(ke.get(a)||null,t,e,n,i,r)),!0}return!1}(r,t,e,n,i))i.stopPropagation();else if(ze(t,i),4&e&&-1<De.indexOf(t)){for(;null!==r;){var a=_r(r);if(null!==a&&be(a),null===(a=Ye(t,e,n,i))&&Gi(t,e,i,Xe,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Gi(t,e,i,null,n)}}var Xe=null;function Ye(t,e,n,i){if(Xe=null,null!==(t=vr(t=bt(i))))if(null===(e=Vt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=Ht(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Xe=t,null}function Ke(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($t()){case Qt:return 1;case te:return 4;case ee:case ne:return 16;case ie:return 536870912;default:return 16}default:return 16}}var Je=null,$e=null,Qe=null;function tn(){if(Qe)return Qe;var t,e,n=$e,i=n.length,r="value"in Je?Je.value:Je.textContent,a=r.length;for(t=0;t<i&&n[t]===r[t];t++);var o=i-t;for(e=1;e<=o&&n[i-e]===r[a-e];e++);return Qe=r.slice(t,1<e?1-e:void 0)}function en(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function nn(){return!0}function rn(){return!1}function an(t){function e(e,n,i,r,a){for(var o in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,t)t.hasOwnProperty(o)&&(e=t[o],this[o]=e?e(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return O(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),e}var on,sn,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(cn),hn=O({},cn,{view:0,detail:0}),dn=an(hn),pn=O({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ln&&(ln&&"mousemove"===t.type?(on=t.screenX-ln.screenX,sn=t.screenY-ln.screenY):sn=on=0,ln=t),on)},movementY:function(t){return"movementY"in t?t.movementY:sn}}),fn=an(pn),mn=an(O({},pn,{dataTransfer:0})),gn=an(O({},hn,{relatedTarget:0})),yn=an(O({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=O({},cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),_n=an(vn),xn=an(O({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Sn[t])&&!!e[t]}function Tn(){return Mn}var En=O({},hn,{key:function(t){if(t.key){var e=bn[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=en(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?wn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tn,charCode:function(t){return"keypress"===t.type?en(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?en(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),An=an(En),Cn=an(O({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pn=an(O({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tn})),In=an(O({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=O({},pn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kn=an(Rn),Ln=[9,13,27,32],Dn=u&&"CompositionEvent"in window,zn=null;u&&"documentMode"in document&&(zn=document.documentMode);var Nn=u&&"TextEvent"in window&&!zn,On=u&&(!Dn||zn&&8<zn&&11>=zn),Fn=String.fromCharCode(32),Bn=!1;function Un(t,e){switch(t){case"keyup":return-1!==Ln.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Vn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Hn[t.type]:"textarea"===e}function Wn(t,e,n,i){Et(i),0<(e=qi(e,"onChange")).length&&(n=new un("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var qn=null,Zn=null;function Xn(t){Fi(t,0)}function Yn(t){if(Z(xr(t)))return t}function Kn(t,e){if("change"===t)return e}var Jn=!1;if(u){var $n;if(u){var Qn="oninput"in document;if(!Qn){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),Qn="function"===typeof ti.oninput}$n=Qn}else $n=!1;Jn=$n&&(!document.documentMode||9<document.documentMode)}function ei(){qn&&(qn.detachEvent("onpropertychange",ni),Zn=qn=null)}function ni(t){if("value"===t.propertyName&&Yn(Zn)){var e=[];Wn(e,Zn,t,bt(t)),Rt(Xn,e)}}function ii(t,e,n){"focusin"===t?(ei(),Zn=n,(qn=e).attachEvent("onpropertychange",ni)):"focusout"===t&&ei()}function ri(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Yn(Zn)}function ai(t,e){if("click"===t)return Yn(e)}function oi(t,e){if("input"===t||"change"===t)return Yn(e)}var si="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function li(t,e){if(si(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(e,r)||!si(t[r],e[r]))return!1}return!0}function ci(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ui(t,e){var n,i=ci(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=ci(i)}}function hi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function di(){for(var t=window,e=X();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(i){n=!1}if(!n)break;e=X((t=e.contentWindow).document)}return e}function pi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function fi(t){var e=di(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&pi(n))if(e=i.start,void 0===(t=i.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!t.extend&&a>i&&(r=i,i=a,a=r),r=ui(n,a);var o=ui(n,i);r&&o&&(1!==t.rangeCount||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&((e=e.createRange()).setStart(r.node,r.offset),t.removeAllRanges(),a>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,yi=null,vi=null,_i=!1;function xi(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==gi||gi!==X(i)||("selectionStart"in(i=gi)&&pi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=qi(yi,"onSelect")).length&&(e=new un("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=gi)))}function bi(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var wi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Si={},Mi={};function Ti(t){if(Si[t])return Si[t];if(!wi[t])return t;var e,n=wi[t];for(e in n)if(n.hasOwnProperty(e)&&e in Mi)return Si[t]=n[e];return t}u&&(Mi=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ei=Ti("animationend"),Ai=Ti("animationiteration"),Ci=Ti("animationstart"),Pi=Ti("transitionend"),Ii=new Map,Ri="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ki(t,e){Ii.set(t,e),l(e,[t])}for(var Li=0;Li<Ri.length;Li++){var Di=Ri[Li];ki(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}ki(Ei,"onAnimationEnd"),ki(Ai,"onAnimationIteration"),ki(Ci,"onAnimationStart"),ki("dblclick","onDoubleClick"),ki("focusin","onFocus"),ki("focusout","onBlur"),ki(Pi,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ni=new Set("cancel close invalid load scroll toggle".split(" ").concat(zi));function Oi(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,i,r,o,s,l,c){if(jt.apply(this,arguments),Nt){if(!Nt)throw Error(a(198));var u=Ot;Nt=!1,Ot=null,Ft||(Ft=!0,Bt=u)}}(i,e,void 0,t),t.currentTarget=null}function Fi(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;t:{var a=void 0;if(e)for(var o=i.length-1;0<=o;o--){var s=i[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&r.isPropagationStopped())break t;Oi(r,s,c),a=l}else for(o=0;o<i.length;o++){if(l=(s=i[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&r.isPropagationStopped())break t;Oi(r,s,c),a=l}}}if(Ft)throw t=Bt,Ft=!1,Bt=null,t}function Bi(t,e){var n=e[mr];void 0===n&&(n=e[mr]=new Set);var i=t+"__bubble";n.has(i)||(Hi(e,t,2,!1),n.add(i))}function Ui(t,e,n){var i=0;e&&(i|=4),Hi(n,t,i,e)}var ji="_reactListening"+Math.random().toString(36).slice(2);function Vi(t){if(!t[ji]){t[ji]=!0,o.forEach(function(e){"selectionchange"!==e&&(Ni.has(e)||Ui(e,!1,t),Ui(e,!0,t))});var e=9===t.nodeType?t:t.ownerDocument;null===e||e[ji]||(e[ji]=!0,Ui("selectionchange",!1,e))}}function Hi(t,e,n,i){switch(Ke(e)){case 1:var r=We;break;case 4:r=qe;break;default:r=Ze}n=r.bind(null,e,n,t),r=void 0,!Lt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),i?void 0!==r?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):void 0!==r?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Gi(t,e,n,i,r){var a=i;if(0===(1&e)&&0===(2&e)&&null!==i)t:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=vr(s)))return;if(5===(l=o.tag)||6===l){i=a=o;continue t}s=s.parentNode}}i=i.return}Rt(function(){var i=a,r=bt(n),o=[];t:{var s=Ii.get(t);if(void 0!==s){var l=un,c=t;switch(t){case"keypress":if(0===en(n))break t;case"keydown":case"keyup":l=An;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pn;break;case Ei:case Ai:case Ci:l=yn;break;case Pi:l=In;break;case"scroll":l=dn;break;case"wheel":l=kn;break;case"copy":case"cut":case"paste":l=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var u=0!==(4&e),h=!u&&"scroll"===t,d=u?null!==s?s+"Capture":null:s;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=kt(f,d))&&u.push(Wi(f,m,p)))),h)break;f=f.return}0<u.length&&(s=new l(s,c,null,n,r),o.push({event:s,listeners:u}))}}if(0===(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(s="mouseover"===t||"pointerover"===t)||n===xt||!(c=n.relatedTarget||n.fromElement)||!vr(c)&&!c[fr])&&(l||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?vr(c):null)&&(c!==(h=Vt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==t&&"pointerover"!==t||(u=Cn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?s:xr(l),p=null==c?s:xr(c),(s=new u(m,f+"leave",l,n,r)).target=h,s.relatedTarget=p,m=null,vr(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)t:{for(d=c,f=0,p=u=l;p;p=Zi(p))f++;for(p=0,m=d;m;m=Zi(m))p++;for(;0<f-p;)u=Zi(u),f--;for(;0<p-f;)d=Zi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break t;u=Zi(u),d=Zi(d)}u=null}else u=null;null!==l&&Xi(o,s,l,u,!1),null!==c&&null!==h&&Xi(o,h,c,u,!0)}if("select"===(l=(s=i?xr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Kn;else if(Gn(s))if(Jn)g=oi;else{g=ri;var y=ii}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ai);switch(g&&(g=g(t,i))?Wn(o,g,n,r):(y&&y(t,s,i),"focusout"===t&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&tt(s,"number",s.value)),y=i?xr(i):window,t){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(gi=y,yi=i,vi=null);break;case"focusout":vi=yi=gi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,xi(o,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(o,n,r)}var v;if(Dn)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else Vn?Un(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(On&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Vn&&(v=tn()):($e="value"in(Je=r)?Je.value:Je.textContent,Vn=!0)),0<(y=qi(i,_)).length&&(_=new xn(_,t,null,n,r),o.push({event:_,listeners:y}),v?_.data=v:null!==(v=jn(n))&&(_.data=v))),(v=Nn?function(t,e){switch(t){case"compositionend":return jn(e);case"keypress":return 32!==e.which?null:(Bn=!0,Fn);case"textInput":return(t=e.data)===Fn&&Bn?null:t;default:return null}}(t,n):function(t,e){if(Vn)return"compositionend"===t||!Dn&&Un(t,e)?(t=tn(),Qe=$e=Je=null,Vn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return On&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(i=qi(i,"onBeforeInput")).length&&(r=new xn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=v))}Fi(o,e)})}function Wi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function qi(t,e){for(var n=e+"Capture",i=[];null!==t;){var r=t,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=kt(t,n))&&i.unshift(Wi(t,a,r)),null!=(a=kt(t,e))&&i.push(Wi(t,a,r))),t=t.return}return i}function Zi(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Xi(t,e,n,i,r){for(var a=e._reactName,o=[];null!==n&&n!==i;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===i)break;5===s.tag&&null!==c&&(s=c,r?null!=(l=kt(n,a))&&o.unshift(Wi(n,l,s)):r||null!=(l=kt(n,a))&&o.push(Wi(n,l,s))),n=n.return}0!==o.length&&t.push({event:e,listeners:o})}var Yi=/\r\n?/g,Ki=/\u0000|\uFFFD/g;function Ji(t){return("string"===typeof t?t:""+t).replace(Yi,"\n").replace(Ki,"")}function $i(t,e,n){if(e=Ji(e),Ji(t)!==e&&n)throw Error(a(425))}function Qi(){}var tr=null,er=null;function nr(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(t){return ar.resolve(null).then(t).catch(sr)}:ir;function sr(t){setTimeout(function(){throw t})}function lr(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return t.removeChild(r),void Ve(e);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ve(e)}function cr(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function ur(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,pr="__reactProps$"+hr,fr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,yr="__reactHandles$"+hr;function vr(t){var e=t[dr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fr]||n[dr]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=ur(t);null!==t;){if(n=t[dr])return n;t=ur(t)}return e}n=(t=n).parentNode}return null}function _r(t){return!(t=t[dr]||t[fr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function xr(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(a(33))}function br(t){return t[pr]||null}var wr=[],Sr=-1;function Mr(t){return{current:t}}function Tr(t){0>Sr||(t.current=wr[Sr],wr[Sr]=null,Sr--)}function Er(t,e){Sr++,wr[Sr]=t.current,t.current=e}var Ar={},Cr=Mr(Ar),Pr=Mr(!1),Ir=Ar;function Rr(t,e){var n=t.type.contextTypes;if(!n)return Ar;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function kr(t){return null!==(t=t.childContextTypes)&&void 0!==t}function Lr(){Tr(Pr),Tr(Cr)}function Dr(t,e,n){if(Cr.current!==Ar)throw Error(a(168));Er(Cr,e),Er(Pr,n)}function zr(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(a(108,H(t)||"Unknown",r));return O({},n,i)}function Nr(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ar,Ir=Cr.current,Er(Cr,t),Er(Pr,Pr.current),!0}function Or(t,e,n){var i=t.stateNode;if(!i)throw Error(a(169));n?(t=zr(t,e,Ir),i.__reactInternalMemoizedMergedChildContext=t,Tr(Pr),Tr(Cr),Er(Cr,t)):Tr(Pr),Er(Pr,n)}var Fr=null,Br=!1,Ur=!1;function jr(t){null===Fr?Fr=[t]:Fr.push(t)}function Vr(){if(!Ur&&null!==Fr){Ur=!0;var t=0,e=_e;try{var n=Fr;for(_e=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}Fr=null,Br=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(t+1)),Zt(Qt,Vr),r}finally{_e=e,Ur=!1}}return null}var Hr=[],Gr=0,Wr=null,qr=0,Zr=[],Xr=0,Yr=null,Kr=1,Jr="";function $r(t,e){Hr[Gr++]=qr,Hr[Gr++]=Wr,Wr=t,qr=e}function Qr(t,e,n){Zr[Xr++]=Kr,Zr[Xr++]=Jr,Zr[Xr++]=Yr,Yr=t;var i=Kr;t=Jr;var r=32-oe(i)-1;i&=~(1<<r),n+=1;var a=32-oe(e)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Kr=1<<32-oe(e)+r|n<<r|i,Jr=a+t}else Kr=1<<a|n<<r|i,Jr=t}function ta(t){null!==t.return&&($r(t,1),Qr(t,1,0))}function ea(t){for(;t===Wr;)Wr=Hr[--Gr],Hr[Gr]=null,qr=Hr[--Gr],Hr[Gr]=null;for(;t===Yr;)Yr=Zr[--Xr],Zr[Xr]=null,Jr=Zr[--Xr],Zr[Xr]=null,Kr=Zr[--Xr],Zr[Xr]=null}var na=null,ia=null,ra=!1,aa=null;function oa(t,e){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function sa(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,na=t,ia=cr(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,na=t,ia=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Yr?{id:Kr,overflow:Jr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=e,n.return=t,t.child=n,na=t,ia=null,!0);default:return!1}}function la(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function ca(t){if(ra){var e=ia;if(e){var n=e;if(!sa(t,e)){if(la(t))throw Error(a(418));e=cr(n.nextSibling);var i=na;e&&sa(t,e)?oa(i,n):(t.flags=-4097&t.flags|2,ra=!1,na=t)}}else{if(la(t))throw Error(a(418));t.flags=-4097&t.flags|2,ra=!1,na=t}}}function ua(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;na=t}function ha(t){if(t!==na)return!1;if(!ra)return ua(t),ra=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!nr(t.type,t.memoizedProps)),e&&(e=ia)){if(la(t))throw da(),Error(a(418));for(;e;)oa(t,e),e=cr(e.nextSibling)}if(ua(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(a(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){ia=cr(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}ia=null}}else ia=na?cr(t.stateNode.nextSibling):null;return!0}function da(){for(var t=ia;t;)t=cr(t.nextSibling)}function pa(){ia=na=null,ra=!1}function fa(t){null===aa?aa=[t]:aa.push(t)}var ma=x.ReactCurrentBatchConfig;function ga(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,t));var r=i,o=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===o?e.ref:(e=function(t){var e=r.refs;null===t?delete e[o]:e[o]=t},e._stringRef=o,e)}if("string"!==typeof t)throw Error(a(284));if(!n._owner)throw Error(a(290,t))}return t}function ya(t,e){throw t=Object.prototype.toString.call(e),Error(a(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function va(t){return(0,t._init)(t._payload)}function _a(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=Lc(t,e)).index=0,t.sibling=null,t}function o(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function s(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,n,i){return null===e||6!==e.tag?((e=Oc(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function c(t,e,n,i){var a=n.type;return a===S?h(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===k&&va(a)===e.type)?((i=r(e,n.props)).ref=ga(t,e,n),i.return=t,i):((i=Dc(n.type,n.key,n.props,null,t.mode,i)).ref=ga(t,e,n),i.return=t,i)}function u(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Fc(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function h(t,e,n,i,a){return null===e||7!==e.tag?((e=zc(n,t.mode,i,a)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Oc(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case b:return(n=Dc(e.type,e.key,e.props,null,t.mode,n)).ref=ga(t,null,e),n.return=t,n;case w:return(e=Fc(e,t.mode,n)).return=t,e;case k:return d(t,(0,e._init)(e._payload),n)}if(et(e)||z(e))return(e=zc(e,t.mode,n,null)).return=t,e;ya(t,e)}return null}function p(t,e,n,i){var r=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?c(t,e,n,i):null;case w:return n.key===r?u(t,e,n,i):null;case k:return p(t,e,(r=n._init)(n._payload),i)}if(et(n)||z(n))return null!==r?null:h(t,e,n,i,null);ya(t,n)}return null}function f(t,e,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(e,t=t.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return c(e,t=t.get(null===i.key?n:i.key)||null,i,r);case w:return u(e,t=t.get(null===i.key?n:i.key)||null,i,r);case k:return f(t,e,n,(0,i._init)(i._payload),r)}if(et(i)||z(i))return h(e,t=t.get(n)||null,i,r,null);ya(e,i)}return null}function m(r,a,s,l){for(var c=null,u=null,h=a,m=a=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(r,h,s[m],l);if(null===y){null===h&&(h=g);break}t&&h&&null===y.alternate&&e(r,h),a=o(y,a,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===s.length)return n(r,h),ra&&$r(r,m),c;if(null===h){for(;m<s.length;m++)null!==(h=d(r,s[m],l))&&(a=o(h,a,m),null===u?c=h:u.sibling=h,u=h);return ra&&$r(r,m),c}for(h=i(r,h);m<s.length;m++)null!==(g=f(h,r,m,s[m],l))&&(t&&null!==g.alternate&&h.delete(null===g.key?m:g.key),a=o(g,a,m),null===u?c=g:u.sibling=g,u=g);return t&&h.forEach(function(t){return e(r,t)}),ra&&$r(r,m),c}function g(r,s,l,c){var u=z(l);if("function"!==typeof u)throw Error(a(150));if(null==(l=u.call(l)))throw Error(a(151));for(var h=u=null,m=s,g=s=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var _=p(r,m,v.value,c);if(null===_){null===m&&(m=y);break}t&&m&&null===_.alternate&&e(r,m),s=o(_,s,g),null===h?u=_:h.sibling=_,h=_,m=y}if(v.done)return n(r,m),ra&&$r(r,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(r,v.value,c))&&(s=o(v,s,g),null===h?u=v:h.sibling=v,h=v);return ra&&$r(r,g),u}for(m=i(r,m);!v.done;g++,v=l.next())null!==(v=f(m,r,g,v.value,c))&&(t&&null!==v.alternate&&m.delete(null===v.key?g:v.key),s=o(v,s,g),null===h?u=v:h.sibling=v,h=v);return t&&m.forEach(function(t){return e(r,t)}),ra&&$r(r,g),u}return function t(i,a,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:t:{for(var c=o.key,u=a;null!==u;){if(u.key===c){if((c=o.type)===S){if(7===u.tag){n(i,u.sibling),(a=r(u,o.props.children)).return=i,i=a;break t}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===k&&va(c)===u.type){n(i,u.sibling),(a=r(u,o.props)).ref=ga(i,u,o),a.return=i,i=a;break t}n(i,u);break}e(i,u),u=u.sibling}o.type===S?((a=zc(o.props.children,i.mode,l,o.key)).return=i,i=a):((l=Dc(o.type,o.key,o.props,null,i.mode,l)).ref=ga(i,a,o),l.return=i,i=l)}return s(i);case w:t:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break t}n(i,a);break}e(i,a),a=a.sibling}(a=Fc(o,i.mode,l)).return=i,i=a}return s(i);case k:return t(i,a,(u=o._init)(o._payload),l)}if(et(o))return m(i,a,o,l);if(z(o))return g(i,a,o,l);ya(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=Oc(o,i.mode,l)).return=i,i=a),s(i)):n(i,a)}}var xa=_a(!0),ba=_a(!1),wa=Mr(null),Sa=null,Ma=null,Ta=null;function Ea(){Ta=Ma=Sa=null}function Aa(t){var e=wa.current;Tr(wa),t._currentValue=e}function Ca(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Pa(t,e){Sa=t,Ta=Ma=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(_s=!0),t.firstContext=null)}function Ia(t){var e=t._currentValue;if(Ta!==t)if(t={context:t,memoizedValue:e,next:null},null===Ma){if(null===Sa)throw Error(a(308));Ma=t,Sa.dependencies={lanes:0,firstContext:t}}else Ma=Ma.next=t;return e}var Ra=null;function ka(t){null===Ra?Ra=[t]:Ra.push(t)}function La(t,e,n,i){var r=e.interleaved;return null===r?(n.next=n,ka(e)):(n.next=r.next,r.next=n),e.interleaved=n,Da(t,i)}function Da(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}var za=!1;function Na(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oa(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Fa(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ba(t,e,n){var i=t.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Cl)){var r=i.pending;return null===r?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Da(t,n)}return null===(r=i.interleaved)?(e.next=e,ka(i)):(e.next=r.next,r.next=e),i.interleaved=e,Da(t,n)}function Ua(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ve(t,n)}}function ja(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=e:a=a.next=e}else r=a=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Va(t,e,n,i){var r=t.updateQueue;za=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=t.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==a){var h=r.baseState;for(o=0,u=c=l=null,s=a;;){var d=s.lane,p=s.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});t:{var f=t,m=s;switch(d=e,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break t}h=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break t;h=O({},h,d);break t;case 2:za=!0}}null!==s.callback&&0!==s.lane&&(t.flags|=64,null===(d=r.effects)?r.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,o|=d;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(d=s).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(e=r.shared.interleaved)){r=e;do{o|=r.lane,r=r.next}while(r!==e)}else null===a&&(r.shared.lanes=0);Nl|=o,t.lanes=o,t.memoizedState=h}}function Ha(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Ga={},Wa=Mr(Ga),qa=Mr(Ga),Za=Mr(Ga);function Xa(t){if(t===Ga)throw Error(a(174));return t}function Ya(t,e){switch(Er(Za,e),Er(qa,t),Er(Wa,Ga),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}Tr(Wa),Er(Wa,e)}function Ka(){Tr(Wa),Tr(qa),Tr(Za)}function Ja(t){Xa(Za.current);var e=Xa(Wa.current),n=lt(e,t.type);e!==n&&(Er(qa,t),Er(Wa,n))}function $a(t){qa.current===t&&(Tr(Wa),Tr(qa))}var Qa=Mr(0);function to(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var eo=[];function no(){for(var t=0;t<eo.length;t++)eo[t]._workInProgressVersionPrimary=null;eo.length=0}var io=x.ReactCurrentDispatcher,ro=x.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,uo=!1,ho=0,po=0;function fo(){throw Error(a(321))}function mo(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!si(t[n],e[n]))return!1;return!0}function go(t,e,n,i,r,o){if(ao=o,oo=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,io.current=null===t||null===t.memoizedState?Qo:ts,t=n(i,r),uo){o=0;do{if(uo=!1,ho=0,25<=o)throw Error(a(301));o+=1,lo=so=null,e.updateQueue=null,io.current=es,t=n(i,r)}while(uo)}if(io.current=$o,e=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,e)throw Error(a(300));return t}function yo(){var t=0!==ho;return ho=0,t}function vo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=t:lo=lo.next=t,lo}function _o(){if(null===so){var t=oo.alternate;t=null!==t?t.memoizedState:null}else t=so.next;var e=null===lo?oo.memoizedState:lo.next;if(null!==e)lo=e,so=t;else{if(null===t)throw Error(a(310));t={memoizedState:(so=t).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=t:lo=lo.next=t}return lo}function xo(t,e){return"function"===typeof e?e(t):e}function bo(t){var e=_o(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var i=so,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=s=null,c=null,u=o;do{var h=u.lane;if((ao&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,s=i):c=c.next=d,oo.lanes|=h,Nl|=h}u=u.next}while(null!==u&&u!==o);null===c?s=i:c.next=l,si(i,e.memoizedState)||(_s=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=c,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{o=r.lane,oo.lanes|=o,Nl|=o,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function wo(t){var e=_o(),n=e.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,o=e.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=t(o,s.action),s=s.next}while(s!==r);si(o,e.memoizedState)||(_s=!0),e.memoizedState=o,null===e.baseQueue&&(e.baseState=o),n.lastRenderedState=o}return[o,i]}function So(){}function Mo(t,e){var n=oo,i=_o(),r=e(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,_s=!0),i=i.queue,No(Ao.bind(null,n,i,t),[t]),i.getSnapshot!==e||o||null!==lo&&1&lo.memoizedState.tag){if(n.flags|=2048,Ro(9,Eo.bind(null,n,i,r,e),void 0,null),null===Pl)throw Error(a(349));0!==(30&ao)||To(n,e,r)}return r}function To(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=oo.updateQueue)?(e={lastEffect:null,stores:null},oo.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Eo(t,e,n,i){e.value=n,e.getSnapshot=i,Co(e)&&Po(t)}function Ao(t,e,n){return n(function(){Co(e)&&Po(t)})}function Co(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!si(t,n)}catch(i){return!0}}function Po(t){var e=Da(t,1);null!==e&&nc(e,t,1,-1)}function Io(t){var e=vo();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xo,lastRenderedState:t},e.queue=t,t=t.dispatch=Xo.bind(null,oo,t),[e.memoizedState,t]}function Ro(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=oo.updateQueue)?(e={lastEffect:null,stores:null},oo.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function ko(){return _o().memoizedState}function Lo(t,e,n,i){var r=vo();oo.flags|=t,r.memoizedState=Ro(1|e,n,void 0,void 0===i?null:i)}function Do(t,e,n,i){var r=_o();i=void 0===i?null:i;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==i&&mo(i,o.deps))return void(r.memoizedState=Ro(e,n,a,i))}oo.flags|=t,r.memoizedState=Ro(1|e,n,a,i)}function zo(t,e){return Lo(8390656,8,t,e)}function No(t,e){return Do(2048,8,t,e)}function Oo(t,e){return Do(4,2,t,e)}function Fo(t,e){return Do(4,4,t,e)}function Bo(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Uo(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Do(4,4,Bo.bind(null,e,t),n)}function jo(){}function Vo(t,e){var n=_o();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&mo(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Ho(t,e){var n=_o();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&mo(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Go(t,e,n){return 0===(21&ao)?(t.baseState&&(t.baseState=!1,_s=!0),t.memoizedState=n):(si(n,e)||(n=me(),oo.lanes|=n,Nl|=n,t.baseState=!0),e)}function Wo(t,e){var n=_e;_e=0!==n&&4>n?n:4,t(!0);var i=ro.transition;ro.transition={};try{t(!1),e()}finally{_e=n,ro.transition=i}}function qo(){return _o().memoizedState}function Zo(t,e,n){var i=ec(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Yo(t))Ko(e,n);else if(null!==(n=La(t,e,n,i))){nc(n,t,i,tc()),Jo(n,e,i)}}function Xo(t,e,n){var i=ec(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yo(t))Ko(e,r);else{var a=t.alternate;if(0===t.lanes&&(null===a||0===a.lanes)&&null!==(a=e.lastRenderedReducer))try{var o=e.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var l=e.interleaved;return null===l?(r.next=r,ka(e)):(r.next=l.next,l.next=r),void(e.interleaved=r)}}catch(c){}null!==(n=La(t,e,r,i))&&(nc(n,t,i,r=tc()),Jo(n,e,i))}}function Yo(t){var e=t.alternate;return t===oo||null!==e&&e===oo}function Ko(t,e){uo=co=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Jo(t,e,n){if(0!==(4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ve(t,n)}}var $o={readContext:Ia,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},Qo={readContext:Ia,useCallback:function(t,e){return vo().memoizedState=[t,void 0===e?null:e],t},useContext:Ia,useEffect:zo,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Lo(4194308,4,Bo.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Lo(4194308,4,t,e)},useInsertionEffect:function(t,e){return Lo(4,2,t,e)},useMemo:function(t,e){var n=vo();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=vo();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Zo.bind(null,oo,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},vo().memoizedState=t},useState:Io,useDebugValue:jo,useDeferredValue:function(t){return vo().memoizedState=t},useTransition:function(){var t=Io(!1),e=t[0];return t=Wo.bind(null,t[1]),vo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=oo,r=vo();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=e(),null===Pl)throw Error(a(349));0!==(30&ao)||To(i,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,zo(Ao.bind(null,i,o,t),[t]),i.flags|=2048,Ro(9,Eo.bind(null,i,o,n,e),void 0,null),n},useId:function(){var t=vo(),e=Pl.identifierPrefix;if(ra){var n=Jr;e=":"+e+"R"+(n=(Kr&~(1<<32-oe(Kr)-1)).toString(32)+n),0<(n=ho++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=po++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ts={readContext:Ia,useCallback:Vo,useContext:Ia,useEffect:No,useImperativeHandle:Uo,useInsertionEffect:Oo,useLayoutEffect:Fo,useMemo:Ho,useReducer:bo,useRef:ko,useState:function(){return bo(xo)},useDebugValue:jo,useDeferredValue:function(t){return Go(_o(),so.memoizedState,t)},useTransition:function(){return[bo(xo)[0],_o().memoizedState]},useMutableSource:So,useSyncExternalStore:Mo,useId:qo,unstable_isNewReconciler:!1},es={readContext:Ia,useCallback:Vo,useContext:Ia,useEffect:No,useImperativeHandle:Uo,useInsertionEffect:Oo,useLayoutEffect:Fo,useMemo:Ho,useReducer:wo,useRef:ko,useState:function(){return wo(xo)},useDebugValue:jo,useDeferredValue:function(t){var e=_o();return null===so?e.memoizedState=t:Go(e,so.memoizedState,t)},useTransition:function(){return[wo(xo)[0],_o().memoizedState]},useMutableSource:So,useSyncExternalStore:Mo,useId:qo,unstable_isNewReconciler:!1};function ns(t,e){if(t&&t.defaultProps){for(var n in e=O({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}function is(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:O({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var rs={isMounted:function(t){return!!(t=t._reactInternals)&&Vt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=tc(),r=ec(t),a=Fa(i,r);a.payload=e,void 0!==n&&null!==n&&(a.callback=n),null!==(e=Ba(t,a,r))&&(nc(e,t,r,i),Ua(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=tc(),r=ec(t),a=Fa(i,r);a.tag=1,a.payload=e,void 0!==n&&null!==n&&(a.callback=n),null!==(e=Ba(t,a,r))&&(nc(e,t,r,i),Ua(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=tc(),i=ec(t),r=Fa(n,i);r.tag=2,void 0!==e&&null!==e&&(r.callback=e),null!==(e=Ba(t,r,i))&&(nc(e,t,i,n),Ua(e,t,i))}};function as(t,e,n,i,r,a,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,a,o):!e.prototype||!e.prototype.isPureReactComponent||(!li(n,i)||!li(r,a))}function os(t,e,n){var i=!1,r=Ar,a=e.contextType;return"object"===typeof a&&null!==a?a=Ia(a):(r=kr(e)?Ir:Cr.current,a=(i=null!==(i=e.contextTypes)&&void 0!==i)?Rr(t,r):Ar),e=new e(n,a),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=rs,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function ss(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&rs.enqueueReplaceState(e,e.state,null)}function ls(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Na(t);var a=e.contextType;"object"===typeof a&&null!==a?r.context=Ia(a):(a=kr(e)?Ir:Cr.current,r.context=Rr(t,a)),r.state=t.memoizedState,"function"===typeof(a=e.getDerivedStateFromProps)&&(is(t,e,a,n),r.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(e=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&rs.enqueueReplaceState(r,r.state,null),Va(t,n,r,i),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4194308)}function cs(t,e){try{var n="",i=e;do{n+=j(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:t,source:e,stack:r,digest:null}}function us(t,e,n){return{value:t,source:null,stack:null!=n?n:null,digest:null!=e?e:null}}function hs(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(t,e,n){(n=Fa(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Gl||(Gl=!0,Wl=i),hs(0,e)},n}function fs(t,e,n){(n=Fa(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"===typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){hs(0,e)}}var a=t.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){hs(0,e),"function"!==typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function ms(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new ds;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Tc.bind(null,t,e,n),e.then(t,t))}function gs(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function ys(t,e,n,i,r){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=Fa(-1,1)).tag=2,Ba(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var vs=x.ReactCurrentOwner,_s=!1;function xs(t,e,n,i){e.child=null===t?ba(e,null,n,i):xa(e,t.child,n,i)}function bs(t,e,n,i,r){n=n.render;var a=e.ref;return Pa(e,r),i=go(t,e,n,i,a,r),n=yo(),null===t||_s?(ra&&n&&ta(e),e.flags|=1,xs(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Gs(t,e,r))}function ws(t,e,n,i,r){if(null===t){var a=n.type;return"function"!==typeof a||kc(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Dc(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=a,Ss(t,e,a,i,r))}if(a=t.child,0===(t.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&t.ref===e.ref)return Gs(t,e,r)}return e.flags|=1,(t=Lc(a,i)).ref=e.ref,t.return=e,e.child=t}function Ss(t,e,n,i,r){if(null!==t){var a=t.memoizedProps;if(li(a,i)&&t.ref===e.ref){if(_s=!1,e.pendingProps=i=a,0===(t.lanes&r))return e.lanes=t.lanes,Gs(t,e,r);0!==(131072&t.flags)&&(_s=!0)}}return Es(t,e,n,i,r)}function Ms(t,e,n){var i=e.pendingProps,r=i.children,a=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Er(Ll,kl),kl|=n;else{if(0===(1073741824&n))return t=null!==a?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Er(Ll,kl),kl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Er(Ll,kl),kl|=i}else null!==a?(i=a.baseLanes|n,e.memoizedState=null):i=n,Er(Ll,kl),kl|=i;return xs(t,e,r,n),e.child}function Ts(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Es(t,e,n,i,r){var a=kr(n)?Ir:Cr.current;return a=Rr(e,a),Pa(e,r),n=go(t,e,n,i,a,r),i=yo(),null===t||_s?(ra&&i&&ta(e),e.flags|=1,xs(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Gs(t,e,r))}function As(t,e,n,i,r){if(kr(n)){var a=!0;Nr(e)}else a=!1;if(Pa(e,r),null===e.stateNode)Hs(t,e),os(e,n,i),ls(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,s=e.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ia(c):c=Rr(e,c=kr(n)?Ir:Cr.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==c)&&ss(e,o,i,c),za=!1;var d=e.memoizedState;o.state=d,Va(e,i,o,r),l=e.memoizedState,s!==i||d!==l||Pr.current||za?("function"===typeof u&&(is(e,n,u,i),l=e.memoizedState),(s=za||as(e,n,s,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4194308)):("function"===typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"===typeof o.componentDidMount&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Oa(t,e),s=e.memoizedProps,c=e.type===e.elementType?s:ns(e.type,s),o.props=c,h=e.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Ia(l):l=Rr(e,l=kr(n)?Ir:Cr.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&ss(e,o,i,l),za=!1,d=e.memoizedState,o.state=d,Va(e,i,o,r);var f=e.memoizedState;s!==h||d!==f||Pr.current||za?("function"===typeof p&&(is(e,n,p,i),f=e.memoizedState),(c=za||as(e,n,c,i,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Cs(t,e,n,i,a,r)}function Cs(t,e,n,i,r,a){Ts(t,e);var o=0!==(128&e.flags);if(!i&&!o)return r&&Or(e,n,!1),Gs(t,e,a);i=e.stateNode,vs.current=e;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=xa(e,t.child,null,a),e.child=xa(e,null,s,a)):xs(t,e,s,a),e.memoizedState=i.state,r&&Or(e,n,!0),e.child}function Ps(t){var e=t.stateNode;e.pendingContext?Dr(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Dr(0,e.context,!1),Ya(t,e.containerInfo)}function Is(t,e,n,i,r){return pa(),fa(r),e.flags|=256,xs(t,e,n,i),e.child}var Rs,ks,Ls,Ds,zs={dehydrated:null,treeContext:null,retryLane:0};function Ns(t){return{baseLanes:t,cachePool:null,transitions:null}}function Os(t,e,n){var i,r=e.pendingProps,o=Qa.current,s=!1,l=0!==(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&0!==(2&o)),i?(s=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(o|=1),Er(Qa,1&o),null===t)return ca(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(l=r.children,t=r.fallback,s?(r=e.mode,s=e.child,l={mode:"hidden",children:l},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Nc(l,r,0,null),t=zc(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Ns(n),e.memoizedState=zs,t):Fs(e,l));if(null!==(o=t.memoizedState)&&null!==(i=o.dehydrated))return function(t,e,n,i,r,o,s){if(n)return 256&e.flags?(e.flags&=-257,Bs(t,e,s,i=us(Error(a(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(o=i.fallback,r=e.mode,i=Nc({mode:"visible",children:i.children},r,0,null),(o=zc(o,r,s,null)).flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,0!==(1&e.mode)&&xa(e,t.child,null,s),e.child.memoizedState=Ns(s),e.memoizedState=zs,o);if(0===(1&e.mode))return Bs(t,e,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Bs(t,e,s,i=us(o=Error(a(419)),i,void 0))}if(l=0!==(s&t.childLanes),_s||l){if(null!==(i=Pl)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,Da(t,r),nc(i,t,r,-1))}return mc(),Bs(t,e,s,i=us(Error(a(421))))}return"$?"===r.data?(e.flags|=128,e.child=t.child,e=Ac.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,ia=cr(r.nextSibling),na=e,ra=!0,aa=null,null!==t&&(Zr[Xr++]=Kr,Zr[Xr++]=Jr,Zr[Xr++]=Yr,Kr=t.id,Jr=t.overflow,Yr=e),e=Fs(e,i.children),e.flags|=4096,e)}(t,e,l,r,i,o,n);if(s){s=r.fallback,l=e.mode,i=(o=t.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&e.child!==o?((r=e.child).childLanes=0,r.pendingProps=c,e.deletions=null):(r=Lc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Lc(i,s):(s=zc(s,l,n,null)).flags|=2,s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,l=null===(l=t.child.memoizedState)?Ns(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=t.childLanes&~n,e.memoizedState=zs,r}return t=(s=t.child).sibling,r=Lc(s,{mode:"visible",children:r.children}),0===(1&e.mode)&&(r.lanes=n),r.return=e,r.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Fs(t,e){return(e=Nc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Bs(t,e,n,i){return null!==i&&fa(i),xa(e,t.child,null,n),(t=Fs(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Us(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),Ca(t.return,e,n)}function js(t,e,n,i,r){var a=t.memoizedState;null===a?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Vs(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(xs(t,e,i.children,n),0!==(2&(i=Qa.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Us(t,n,e);else if(19===t.tag)Us(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Er(Qa,i),0===(1&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===to(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),js(e,!1,r,n,a);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===to(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}js(e,!0,n,null,a);break;case"together":js(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Hs(t,e){0===(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gs(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Nl|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(a(153));if(null!==e.child){for(n=Lc(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Lc(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Ws(t,e){if(!ra)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qs(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Zs(t,e,n){var i=e.pendingProps;switch(ea(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(e),null;case 1:case 17:return kr(e.type)&&Lr(),qs(e),null;case 3:return i=e.stateNode,Ka(),Tr(Pr),Tr(Cr),no(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(ha(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==aa&&(oc(aa),aa=null))),ks(t,e),qs(e),null;case 5:$a(e);var r=Xa(Za.current);if(n=e.type,null!==t&&null!=e.stateNode)Ls(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(a(166));return qs(e),null}if(t=Xa(Wa.current),ha(e)){i=e.stateNode,n=e.type;var o=e.memoizedProps;switch(i[dr]=e,i[pr]=o,t=0!==(1&e.mode),n){case"dialog":Bi("cancel",i),Bi("close",i);break;case"iframe":case"object":case"embed":Bi("load",i);break;case"video":case"audio":for(r=0;r<zi.length;r++)Bi(zi[r],i);break;case"source":Bi("error",i);break;case"img":case"image":case"link":Bi("error",i),Bi("load",i);break;case"details":Bi("toggle",i);break;case"input":K(i,o),Bi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Bi("invalid",i);break;case"textarea":rt(i,o),Bi("invalid",i)}for(var l in vt(n,o),r=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&$i(i.textContent,c,t),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&$i(i.textContent,c,t),r=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bi("scroll",i)}switch(n){case"input":q(i),Q(i,o,!0);break;case"textarea":q(i),ot(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Qi)}i=r,e.updateQueue=i,null!==i&&(e.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=st(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof i.is?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),"select"===n&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[dr]=e,t[pr]=i,Rs(t,e,!1,!1),e.stateNode=t;t:{switch(l=_t(n,i),n){case"dialog":Bi("cancel",t),Bi("close",t),r=i;break;case"iframe":case"object":case"embed":Bi("load",t),r=i;break;case"video":case"audio":for(r=0;r<zi.length;r++)Bi(zi[r],t);r=i;break;case"source":Bi("error",t),r=i;break;case"img":case"image":case"link":Bi("error",t),Bi("load",t),r=i;break;case"details":Bi("toggle",t),r=i;break;case"input":K(t,i),r=Y(t,i),Bi("invalid",t);break;case"option":default:r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=O({},i,{value:void 0}),Bi("invalid",t);break;case"textarea":rt(t,i),r=it(t,i),Bi("invalid",t)}for(o in vt(n,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?gt(t,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ht(t,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&dt(t,u):"number"===typeof u&&dt(t,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Bi("scroll",t):null!=u&&_(t,o,u,l))}switch(n){case"input":q(t),Q(t,i,!1);break;case"textarea":q(t),ot(t);break;case"option":null!=i.value&&t.setAttribute("value",""+G(i.value));break;case"select":t.multiple=!!i.multiple,null!=(o=i.value)?nt(t,!!i.multiple,o,!1):null!=i.defaultValue&&nt(t,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(t.onclick=Qi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return qs(e),null;case 6:if(t&&null!=e.stateNode)Ds(t,e,t.memoizedProps,i);else{if("string"!==typeof i&&null===e.stateNode)throw Error(a(166));if(n=Xa(Za.current),Xa(Wa.current),ha(e)){if(i=e.stateNode,n=e.memoizedProps,i[dr]=e,(o=i.nodeValue!==n)&&null!==(t=na))switch(t.tag){case 3:$i(i.nodeValue,n,0!==(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&$i(i.nodeValue,n,0!==(1&t.mode))}o&&(e.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=e,e.stateNode=i}return qs(e),null;case 13:if(Tr(Qa),i=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(ra&&null!==ia&&0!==(1&e.mode)&&0===(128&e.flags))da(),pa(),e.flags|=98560,o=!1;else if(o=ha(e),null!==i&&null!==i.dehydrated){if(null===t){if(!o)throw Error(a(318));if(!(o=null!==(o=e.memoizedState)?o.dehydrated:null))throw Error(a(317));o[dr]=e}else pa(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;qs(e),o=!1}else null!==aa&&(oc(aa),aa=null),o=!0;if(!o)return 65536&e.flags?e:null}return 0!==(128&e.flags)?(e.lanes=n,e):((i=null!==i)!==(null!==t&&null!==t.memoizedState)&&i&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&Qa.current)?0===Dl&&(Dl=3):mc())),null!==e.updateQueue&&(e.flags|=4),qs(e),null);case 4:return Ka(),ks(t,e),null===t&&Vi(e.stateNode.containerInfo),qs(e),null;case 10:return Aa(e.type._context),qs(e),null;case 19:if(Tr(Qa),null===(o=e.memoizedState))return qs(e),null;if(i=0!==(128&e.flags),null===(l=o.rendering))if(i)Ws(o,!1);else{if(0!==Dl||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(l=to(t))){for(e.flags|=128,Ws(o,!1),null!==(i=l.updateQueue)&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;null!==n;)t=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,t=l.dependencies,o.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Er(Qa,1&Qa.current|2),e.child}t=t.sibling}null!==o.tail&&Jt()>Vl&&(e.flags|=128,i=!0,Ws(o,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=to(l))){if(e.flags|=128,i=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),Ws(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!ra)return qs(e),null}else 2*Jt()-o.renderingStartTime>Vl&&1073741824!==n&&(e.flags|=128,i=!0,Ws(o,!1),e.lanes=4194304);o.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=o.last)?n.sibling=l:e.child=l,o.last=l)}return null!==o.tail?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Jt(),e.sibling=null,n=Qa.current,Er(Qa,i?1&n|2:1&n),e):(qs(e),null);case 22:case 23:return hc(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&0!==(1&e.mode)?0!==(1073741824&kl)&&(qs(e),6&e.subtreeFlags&&(e.flags|=8192)):qs(e),null;case 24:case 25:return null}throw Error(a(156,e.tag))}function Xs(t,e){switch(ea(e),e.tag){case 1:return kr(e.type)&&Lr(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return Ka(),Tr(Pr),Tr(Cr),no(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return $a(e),null;case 13:if(Tr(Qa),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(a(340));pa()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return Tr(Qa),null;case 4:return Ka(),null;case 10:return Aa(e.type._context),null;case 22:case 23:return hc(),null;default:return null}}Rs=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ks=function(){},Ls=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Xa(Wa.current);var a,o=null;switch(n){case"input":r=Y(t,r),i=Y(t,i),o=[];break;case"select":r=O({},r,{value:void 0}),i=O({},i,{value:void 0}),o=[];break;case"textarea":r=it(t,r),i=it(t,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(t.onclick=Qi)}for(u in vt(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var l=r[u];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Bi("scroll",t),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}},Ds=function(t,e,n,i){n!==i&&(e.flags|=4)};var Ys=!1,Ks=!1,Js="function"===typeof WeakSet?WeakSet:Set,$s=null;function Qs(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Mc(t,e,i)}else n.current=null}function tl(t,e,n){try{n()}catch(i){Mc(t,e,i)}}var el=!1;function nl(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,void 0!==a&&tl(e,n,a)}r=r.next}while(r!==i)}}function il(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function rl(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"===typeof e?e(t):e.current=t}}function al(t){var e=t.alternate;null!==e&&(t.alternate=null,al(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[dr],delete e[pr],delete e[mr],delete e[gr],delete e[yr])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ol(t){return 5===t.tag||3===t.tag||4===t.tag}function sl(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||ol(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ll(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=Qi));else if(4!==i&&null!==(t=t.child))for(ll(t,e,n),t=t.sibling;null!==t;)ll(t,e,n),t=t.sibling}function cl(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&null!==(t=t.child))for(cl(t,e,n),t=t.sibling;null!==t;)cl(t,e,n),t=t.sibling}var ul=null,hl=!1;function dl(t,e,n){for(n=n.child;null!==n;)pl(t,e,n),n=n.sibling}function pl(t,e,n){if(ae&&"function"===typeof ae.onCommitFiberUnmount)try{ae.onCommitFiberUnmount(re,n)}catch(s){}switch(n.tag){case 5:Ks||Qs(n,e);case 6:var i=ul,r=hl;ul=null,dl(t,e,n),hl=r,null!==(ul=i)&&(hl?(t=ul,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(hl?(t=ul,n=n.stateNode,8===t.nodeType?lr(t.parentNode,n):1===t.nodeType&&lr(t,n),Ve(t)):lr(ul,n.stateNode));break;case 4:i=ul,r=hl,ul=n.stateNode.containerInfo,hl=!0,dl(t,e,n),ul=i,hl=r;break;case 0:case 11:case 14:case 15:if(!Ks&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&tl(n,e,o),r=r.next}while(r!==i)}dl(t,e,n);break;case 1:if(!Ks&&(Qs(n,e),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Mc(n,e,s)}dl(t,e,n);break;case 21:dl(t,e,n);break;case 22:1&n.mode?(Ks=(i=Ks)||null!==n.memoizedState,dl(t,e,n),Ks=i):dl(t,e,n);break;default:dl(t,e,n)}}function fl(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new Js),e.forEach(function(e){var i=Cc.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))})}}function ml(t,e){var n=e.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=t,s=e,l=s;t:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,hl=!1;break t;case 3:case 4:ul=l.stateNode.containerInfo,hl=!0;break t}l=l.return}if(null===ul)throw Error(a(160));pl(o,s,r),ul=null,hl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Mc(r,e,u)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)gl(e,t),e=e.sibling}function gl(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ml(e,t),yl(t),4&i){try{nl(3,t,t.return),il(3,t)}catch(g){Mc(t,t.return,g)}try{nl(5,t,t.return)}catch(g){Mc(t,t.return,g)}}break;case 1:ml(e,t),yl(t),512&i&&null!==n&&Qs(n,n.return);break;case 5:if(ml(e,t),yl(t),512&i&&null!==n&&Qs(n,n.return),32&t.flags){var r=t.stateNode;try{dt(r,"")}catch(g){Mc(t,t.return,g)}}if(4&i&&null!=(r=t.stateNode)){var o=t.memoizedProps,s=null!==n?n.memoizedProps:o,l=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(r,o),_t(l,s);var u=_t(l,o);for(s=0;s<c.length;s+=2){var h=c[s],d=c[s+1];"style"===h?gt(r,d):"dangerouslySetInnerHTML"===h?ht(r,d):"children"===h?dt(r,d):_(r,h,d,u)}switch(l){case"input":$(r,o);break;case"textarea":at(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?nt(r,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?nt(r,!!o.multiple,o.defaultValue,!0):nt(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(g){Mc(t,t.return,g)}}break;case 6:if(ml(e,t),yl(t),4&i){if(null===t.stateNode)throw Error(a(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(g){Mc(t,t.return,g)}}break;case 3:if(ml(e,t),yl(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ve(e.containerInfo)}catch(g){Mc(t,t.return,g)}break;case 4:default:ml(e,t),yl(t);break;case 13:ml(e,t),yl(t),8192&(r=t.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Jt())),4&i&&fl(t);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&t.mode?(Ks=(u=Ks)||h,ml(e,t),Ks=u):ml(e,t),yl(t),8192&i){if(u=null!==t.memoizedState,(t.stateNode.isHidden=u)&&!h&&0!==(1&t.mode))for($s=t,h=t.child;null!==h;){for(d=$s=h;null!==$s;){switch(f=(p=$s).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:Qs(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){i=p,n=p.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){Mc(i,n,g)}}break;case 5:Qs(p,p.return);break;case 22:if(null!==p.memoizedState){bl(d);continue}}null!==f?(f.return=p,$s=f):bl(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,u?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=mt("display",s))}catch(g){Mc(t,t.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Mc(t,t.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(e,t),yl(t),4&i&&fl(t);case 21:}}function yl(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(ol(n)){var i=n;break t}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(dt(r,""),i.flags&=-33),cl(t,sl(t),r);break;case 3:case 4:var o=i.stateNode.containerInfo;ll(t,sl(t),o);break;default:throw Error(a(161))}}catch(s){Mc(t,t.return,s)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function vl(t,e,n){$s=t,_l(t,e,n)}function _l(t,e,n){for(var i=0!==(1&t.mode);null!==$s;){var r=$s,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Ys;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||Ks;s=Ys;var c=Ks;if(Ys=o,(Ks=l)&&!c)for($s=r;null!==$s;)l=(o=$s).child,22===o.tag&&null!==o.memoizedState?wl(r):null!==l?(l.return=o,$s=l):wl(r);for(;null!==a;)$s=a,_l(a,e,n),a=a.sibling;$s=r,Ys=s,Ks=c}xl(t)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,$s=a):xl(t)}}function xl(t){for(;null!==$s;){var e=$s;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Ks||il(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!Ks)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:ns(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;null!==o&&Ha(e,o,i);break;case 3:var s=e.updateQueue;if(null!==s){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}Ha(e,s,n)}break;case 5:var l=e.stateNode;if(null===n&&4&e.flags){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var u=e.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ve(d)}}}break;default:throw Error(a(163))}Ks||512&e.flags&&rl(e)}catch(p){Mc(e,e.return,p)}}if(e===t){$s=null;break}if(null!==(n=e.sibling)){n.return=e.return,$s=n;break}$s=e.return}}function bl(t){for(;null!==$s;){var e=$s;if(e===t){$s=null;break}var n=e.sibling;if(null!==n){n.return=e.return,$s=n;break}$s=e.return}}function wl(t){for(;null!==$s;){var e=$s;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{il(4,e)}catch(l){Mc(e,n,l)}break;case 1:var i=e.stateNode;if("function"===typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(l){Mc(e,r,l)}}var a=e.return;try{rl(e)}catch(l){Mc(e,a,l)}break;case 5:var o=e.return;try{rl(e)}catch(l){Mc(e,o,l)}}}catch(l){Mc(e,e.return,l)}if(e===t){$s=null;break}var s=e.sibling;if(null!==s){s.return=e.return,$s=s;break}$s=e.return}}var Sl,Ml=Math.ceil,Tl=x.ReactCurrentDispatcher,El=x.ReactCurrentOwner,Al=x.ReactCurrentBatchConfig,Cl=0,Pl=null,Il=null,Rl=0,kl=0,Ll=Mr(0),Dl=0,zl=null,Nl=0,Ol=0,Fl=0,Bl=null,Ul=null,jl=0,Vl=1/0,Hl=null,Gl=!1,Wl=null,ql=null,Zl=!1,Xl=null,Yl=0,Kl=0,Jl=null,$l=-1,Ql=0;function tc(){return 0!==(6&Cl)?Jt():-1!==$l?$l:$l=Jt()}function ec(t){return 0===(1&t.mode)?1:0!==(2&Cl)&&0!==Rl?Rl&-Rl:null!==ma.transition?(0===Ql&&(Ql=me()),Ql):0!==(t=_e)?t:t=void 0===(t=window.event)?16:Ke(t.type)}function nc(t,e,n,i){if(50<Kl)throw Kl=0,Jl=null,Error(a(185));ye(t,n,i),0!==(2&Cl)&&t===Pl||(t===Pl&&(0===(2&Cl)&&(Ol|=n),4===Dl&&sc(t,Rl)),ic(t,i),1===n&&0===Cl&&0===(1&e.mode)&&(Vl=Jt()+500,Br&&Vr()))}function ic(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-oe(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=pe(s,e)):l<=e&&(t.expiredLanes|=s),a&=~s}}(t,e);var i=de(t,t===Pl?Rl:0);if(0===i)null!==n&&Xt(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&Xt(n),1===e)0===t.tag?function(t){Br=!0,jr(t)}(lc.bind(null,t)):jr(lc.bind(null,t)),or(function(){0===(6&Cl)&&Vr()}),n=null;else{switch(xe(i)){case 1:n=Qt;break;case 4:n=te;break;case 16:default:n=ee;break;case 536870912:n=ie}n=Pc(n,rc.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function rc(t,e){if($l=-1,Ql=0,0!==(6&Cl))throw Error(a(327));var n=t.callbackNode;if(wc()&&t.callbackNode!==n)return null;var i=de(t,t===Pl?Rl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&t.expiredLanes)||e)e=gc(t,i);else{e=i;var r=Cl;Cl|=2;var o=fc();for(Pl===t&&Rl===e||(Hl=null,Vl=Jt()+500,dc(t,e));;)try{vc();break}catch(l){pc(t,l)}Ea(),Tl.current=o,Cl=r,null!==Il?e=0:(Pl=null,Rl=0,e=Dl)}if(0!==e){if(2===e&&(0!==(r=fe(t))&&(i=r,e=ac(t,r))),1===e)throw n=zl,dc(t,0),sc(t,i),ic(t,Jt()),n;if(6===e)sc(t,i);else{if(r=t.current.alternate,0===(30&i)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(s){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)&&(2===(e=gc(t,i))&&(0!==(o=fe(t))&&(i=o,e=ac(t,o))),1===e))throw n=zl,dc(t,0),sc(t,i),ic(t,Jt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(a(345));case 2:case 5:bc(t,Ul,Hl);break;case 3:if(sc(t,i),(130023424&i)===i&&10<(e=jl+500-Jt())){if(0!==de(t,0))break;if(((r=t.suspendedLanes)&i)!==i){tc(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=ir(bc.bind(null,t,Ul,Hl),e);break}bc(t,Ul,Hl);break;case 4:if(sc(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var s=31-oe(i);o=1<<s,(s=e[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=Jt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ml(i/1960))-i)){t.timeoutHandle=ir(bc.bind(null,t,Ul,Hl),i);break}bc(t,Ul,Hl);break;default:throw Error(a(329))}}}return ic(t,Jt()),t.callbackNode===n?rc.bind(null,t):null}function ac(t,e){var n=Bl;return t.current.memoizedState.isDehydrated&&(dc(t,e).flags|=256),2!==(t=gc(t,e))&&(e=Ul,Ul=n,null!==e&&oc(e)),t}function oc(t){null===Ul?Ul=t:Ul.push.apply(Ul,t)}function sc(t,e){for(e&=~Fl,e&=~Ol,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-oe(e),i=1<<n;t[n]=-1,e&=~i}}function lc(t){if(0!==(6&Cl))throw Error(a(327));wc();var e=de(t,0);if(0===(1&e))return ic(t,Jt()),null;var n=gc(t,e);if(0!==t.tag&&2===n){var i=fe(t);0!==i&&(e=i,n=ac(t,i))}if(1===n)throw n=zl,dc(t,0),sc(t,e),ic(t,Jt()),n;if(6===n)throw Error(a(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,bc(t,Ul,Hl),ic(t,Jt()),null}function cc(t,e){var n=Cl;Cl|=1;try{return t(e)}finally{0===(Cl=n)&&(Vl=Jt()+500,Br&&Vr())}}function uc(t){null!==Xl&&0===Xl.tag&&0===(6&Cl)&&wc();var e=Cl;Cl|=1;var n=Al.transition,i=_e;try{if(Al.transition=null,_e=1,t)return t()}finally{_e=i,Al.transition=n,0===(6&(Cl=e))&&Vr()}}function hc(){kl=Ll.current,Tr(Ll)}function dc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,rr(n)),null!==Il)for(n=Il.return;null!==n;){var i=n;switch(ea(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Lr();break;case 3:Ka(),Tr(Pr),Tr(Cr),no();break;case 5:$a(i);break;case 4:Ka();break;case 13:case 19:Tr(Qa);break;case 10:Aa(i.type._context);break;case 22:case 23:hc()}n=n.return}if(Pl=t,Il=t=Lc(t.current,null),Rl=kl=e,Dl=0,zl=null,Fl=Ol=Nl=0,Ul=Bl=null,null!==Ra){for(e=0;e<Ra.length;e++)if(null!==(i=(n=Ra[e]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}Ra=null}return t}function pc(t,e){for(;;){var n=Il;try{if(Ea(),io.current=$o,co){for(var i=oo.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}co=!1}if(ao=0,lo=so=oo=null,uo=!1,ho=0,El.current=null,null===n||null===n.return){Dl=1,zl=e,Il=null;break}t:{var o=t,s=n.return,l=n,c=e;if(e=Rl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,ys(f,s,l,0,e),1&f.mode&&ms(o,u,e),c=u;var m=(e=f).updateQueue;if(null===m){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break t}if(0===(1&e)){ms(o,u,e),mc();break t}c=Error(a(426))}else if(ra&&1&l.mode){var y=gs(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ys(y,s,l,0,e),fa(cs(c,l));break t}}o=c=cs(c,l),4!==Dl&&(Dl=2),null===Bl?Bl=[o]:Bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e,ja(o,ps(0,c,e));break t;case 1:l=c;var v=o.type,_=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===ql||!ql.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e,ja(o,fs(o,l,e));break t}}o=o.return}while(null!==o)}xc(n)}catch(x){e=x,Il===n&&null!==n&&(Il=n=n.return);continue}break}}function fc(){var t=Tl.current;return Tl.current=$o,null===t?$o:t}function mc(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Pl||0===(268435455&Nl)&&0===(268435455&Ol)||sc(Pl,Rl)}function gc(t,e){var n=Cl;Cl|=2;var i=fc();for(Pl===t&&Rl===e||(Hl=null,dc(t,e));;)try{yc();break}catch(r){pc(t,r)}if(Ea(),Cl=n,Tl.current=i,null!==Il)throw Error(a(261));return Pl=null,Rl=0,Dl}function yc(){for(;null!==Il;)_c(Il)}function vc(){for(;null!==Il&&!Yt();)_c(Il)}function _c(t){var e=Sl(t.alternate,t,kl);t.memoizedProps=t.pendingProps,null===e?xc(t):Il=e,El.current=null}function xc(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=Zs(n,e,kl)))return void(Il=n)}else{if(null!==(n=Xs(n,e)))return n.flags&=32767,void(Il=n);if(null===t)return Dl=6,void(Il=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Il=e);Il=e=t}while(null!==e);0===Dl&&(Dl=5)}function bc(t,e,n){var i=_e,r=Al.transition;try{Al.transition=null,_e=1,function(t,e,n,i){do{wc()}while(null!==Xl);if(0!==(6&Cl))throw Error(a(327));n=t.finishedWork;var r=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(a(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-oe(n),a=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~a}}(t,o),t===Pl&&(Il=Pl=null,Rl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Zl||(Zl=!0,Pc(ee,function(){return wc(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Al.transition,Al.transition=null;var s=_e;_e=1;var l=Cl;Cl|=4,El.current=null,function(t,e){if(tr=Ge,pi(t=di())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var i=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(b){n=null;break t}var s=0,l=-1,c=-1,u=0,h=0,d=t,p=null;e:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=s+r),d!==o||0!==i&&3!==d.nodeType||(c=s+i),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===t)break e;if(p===n&&++u===r&&(l=s),p===o&&++h===i&&(c=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(er={focusedElem:t,selectionRange:n},Ge=!1,$s=e;null!==$s;)if(t=(e=$s).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,$s=t;else for(;null!==$s;){e=$s;try{var m=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=e.stateNode,_=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:ns(e.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var x=e.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(b){Mc(e,e.return,b)}if(null!==(t=e.sibling)){t.return=e.return,$s=t;break}$s=e.return}m=el,el=!1}(t,n),gl(n,t),fi(er),Ge=!!tr,er=tr=null,t.current=n,vl(n,t,r),Kt(),Cl=l,_e=s,Al.transition=o}else t.current=n;if(Zl&&(Zl=!1,Xl=t,Yl=r),o=t.pendingLanes,0===o&&(ql=null),function(t){if(ae&&"function"===typeof ae.onCommitFiberRoot)try{ae.onCommitFiberRoot(re,t,void 0,128===(128&t.current.flags))}catch(e){}}(n.stateNode),ic(t,Jt()),null!==e)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Gl)throw Gl=!1,t=Wl,Wl=null,t;0!==(1&Yl)&&0!==t.tag&&wc(),o=t.pendingLanes,0!==(1&o)?t===Jl?Kl++:(Kl=0,Jl=t):Kl=0,Vr()}(t,e,n,i)}finally{Al.transition=r,_e=i}return null}function wc(){if(null!==Xl){var t=xe(Yl),e=Al.transition,n=_e;try{if(Al.transition=null,_e=16>t?16:t,null===Xl)var i=!1;else{if(t=Xl,Xl=null,Yl=0,0!==(6&Cl))throw Error(a(331));var r=Cl;for(Cl|=4,$s=t.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for($s=u;null!==$s;){var h=$s;switch(h.tag){case 0:case 11:case 15:nl(8,h,o)}var d=h.child;if(null!==d)d.return=h,$s=d;else for(;null!==$s;){var p=(h=$s).sibling,f=h.return;if(al(h),h===u){$s=null;break}if(null!==p){p.return=f,$s=p;break}$s=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else t:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:nl(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,$s=v;break t}$s=o.return}}var _=t.current;for($s=_;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else t:for(s=_;null!==$s;){if(0!==(2048&(l=$s).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(w){Mc(l,l.return,w)}if(l===s){$s=null;break t}var b=l.sibling;if(null!==b){b.return=l.return,$s=b;break t}$s=l.return}}if(Cl=r,Vr(),ae&&"function"===typeof ae.onPostCommitFiberRoot)try{ae.onPostCommitFiberRoot(re,t)}catch(w){}i=!0}return i}finally{_e=n,Al.transition=e}}return!1}function Sc(t,e,n){t=Ba(t,e=ps(0,e=cs(n,e),1),1),e=tc(),null!==t&&(ye(t,1,e),ic(t,e))}function Mc(t,e,n){if(3===t.tag)Sc(t,t,n);else for(;null!==e;){if(3===e.tag){Sc(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===ql||!ql.has(i))){e=Ba(e,t=fs(e,t=cs(n,t),1),1),t=tc(),null!==e&&(ye(e,1,t),ic(e,t));break}}e=e.return}}function Tc(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=tc(),t.pingedLanes|=t.suspendedLanes&n,Pl===t&&(Rl&n)===n&&(4===Dl||3===Dl&&(130023424&Rl)===Rl&&500>Jt()-jl?dc(t,0):Fl|=n),ic(t,e)}function Ec(t,e){0===e&&(0===(1&t.mode)?e=1:(e=ue,0===(130023424&(ue<<=1))&&(ue=4194304)));var n=tc();null!==(t=Da(t,e))&&(ye(t,e,n),ic(t,n))}function Ac(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Ec(t,n)}function Cc(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(e),Ec(t,n)}function Pc(t,e){return Zt(t,e)}function Ic(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(t,e,n,i){return new Ic(t,e,n,i)}function kc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Lc(t,e){var n=t.alternate;return null===n?((n=Rc(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Dc(t,e,n,i,r,o){var s=2;if(i=t,"function"===typeof t)kc(t)&&(s=1);else if("string"===typeof t)s=5;else t:switch(t){case S:return zc(n.children,r,o,e);case M:s=8,r|=8;break;case T:return(t=Rc(12,n,e,2|r)).elementType=T,t.lanes=o,t;case P:return(t=Rc(13,n,e,r)).elementType=P,t.lanes=o,t;case I:return(t=Rc(19,n,e,r)).elementType=I,t.lanes=o,t;case L:return Nc(n,r,o,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case E:s=10;break t;case A:s=9;break t;case C:s=11;break t;case R:s=14;break t;case k:s=16,i=null;break t}throw Error(a(130,null==t?t:typeof t,""))}return(e=Rc(s,n,e,r)).elementType=t,e.type=i,e.lanes=o,e}function zc(t,e,n,i){return(t=Rc(7,t,i,e)).lanes=n,t}function Nc(t,e,n,i){return(t=Rc(22,t,i,e)).elementType=L,t.lanes=n,t.stateNode={isHidden:!1},t}function Oc(t,e,n){return(t=Rc(6,t,null,e)).lanes=n,t}function Fc(t,e,n){return(e=Rc(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Bc(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ge(0),this.expirationTimes=ge(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ge(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(t,e,n,i,r,a,o,s,l){return t=new Bc(t,e,n,s,l),1===e?(e=1,!0===a&&(e|=8)):e=0,a=Rc(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Na(a),t}function jc(t){if(!t)return Ar;t:{if(Vt(t=t._reactInternals)!==t||1!==t.tag)throw Error(a(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(kr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(a(171))}if(1===t.tag){var n=t.type;if(kr(n))return zr(t,n,e)}return e}function Vc(t,e,n,i,r,a,o,s,l){return(t=Uc(n,i,!0,t,0,a,0,s,l)).context=jc(null),n=t.current,(a=Fa(i=tc(),r=ec(n))).callback=void 0!==e&&null!==e?e:null,Ba(n,a,r),t.current.lanes=r,ye(t,r,i),ic(t,i),t}function Hc(t,e,n,i){var r=e.current,a=tc(),o=ec(r);return n=jc(n),null===e.context?e.context=n:e.pendingContext=n,(e=Fa(a,o)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),null!==(t=Ba(r,e,o))&&(nc(t,r,o,a),Ua(t,r,o)),o}function Gc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Wc(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function qc(t,e){Wc(t,e),(t=t.alternate)&&Wc(t,e)}Sl=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||Pr.current)_s=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return _s=!1,function(t,e,n){switch(e.tag){case 3:Ps(e),pa();break;case 5:Ja(e);break;case 1:kr(e.type)&&Nr(e);break;case 4:Ya(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Er(wa,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=e.memoizedState))return null!==i.dehydrated?(Er(Qa,1&Qa.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Os(t,e,n):(Er(Qa,1&Qa.current),null!==(t=Gs(t,e,n))?t.sibling:null);Er(Qa,1&Qa.current);break;case 19:if(i=0!==(n&e.childLanes),0!==(128&t.flags)){if(i)return Vs(t,e,n);e.flags|=128}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Er(Qa,Qa.current),i)break;return null;case 22:case 23:return e.lanes=0,Ms(t,e,n)}return Gs(t,e,n)}(t,e,n);_s=0!==(131072&t.flags)}else _s=!1,ra&&0!==(1048576&e.flags)&&Qr(e,qr,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Hs(t,e),t=e.pendingProps;var r=Rr(e,Cr.current);Pa(e,n),r=go(null,e,i,t,r,n);var o=yo();return e.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,kr(i)?(o=!0,Nr(e)):o=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Na(e),r.updater=rs,e.stateNode=r,r._reactInternals=e,ls(e,i,t,n),e=Cs(null,e,i,!0,o,n)):(e.tag=0,ra&&o&&ta(e),xs(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(Hs(t,e),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"===typeof t)return kc(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===C)return 11;if(t===R)return 14}return 2}(i),t=ns(i,t),r){case 0:e=Es(null,e,i,t,n);break t;case 1:e=As(null,e,i,t,n);break t;case 11:e=bs(null,e,i,t,n);break t;case 14:e=ws(null,e,i,ns(i.type,t),n);break t}throw Error(a(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,Es(t,e,i,r=e.elementType===i?r:ns(i,r),n);case 1:return i=e.type,r=e.pendingProps,As(t,e,i,r=e.elementType===i?r:ns(i,r),n);case 3:t:{if(Ps(e),null===t)throw Error(a(387));i=e.pendingProps,r=(o=e.memoizedState).element,Oa(t,e),Va(e,i,null,n);var s=e.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,256&e.flags){e=Is(t,e,i,n,r=cs(Error(a(423)),e));break t}if(i!==r){e=Is(t,e,i,n,r=cs(Error(a(424)),e));break t}for(ia=cr(e.stateNode.containerInfo.firstChild),na=e,ra=!0,aa=null,n=ba(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pa(),i===r){e=Gs(t,e,n);break t}xs(t,e,i,n)}e=e.child}return e;case 5:return Ja(e),null===t&&ca(e),i=e.type,r=e.pendingProps,o=null!==t?t.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==o&&nr(i,o)&&(e.flags|=32),Ts(t,e),xs(t,e,s,n),e.child;case 6:return null===t&&ca(e),null;case 13:return Os(t,e,n);case 4:return Ya(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=xa(e,null,i,n):xs(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,bs(t,e,i,r=e.elementType===i?r:ns(i,r),n);case 7:return xs(t,e,e.pendingProps,n),e.child;case 8:case 12:return xs(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,o=e.memoizedProps,s=r.value,Er(wa,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!Pr.current){e=Gs(t,e,n);break t}}else for(null!==(o=e.child)&&(o.return=e);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Fa(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ca(o.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===e.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Ca(s,n,e),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===e){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}xs(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Pa(e,n),i=i(r=Ia(r)),e.flags|=1,xs(t,e,i,n),e.child;case 14:return r=ns(i=e.type,e.pendingProps),ws(t,e,i,r=ns(i.type,r),n);case 15:return Ss(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ns(i,r),Hs(t,e),e.tag=1,kr(i)?(t=!0,Nr(e)):t=!1,Pa(e,n),os(e,i,r),ls(e,i,r,n),Cs(null,e,i,!0,t,n);case 19:return Vs(t,e,n);case 22:return Ms(t,e,n)}throw Error(a(156,e.tag))};var Zc="function"===typeof reportError?reportError:function(t){console.error(t)};function Xc(t){this._internalRoot=t}function Yc(t){this._internalRoot=t}function Kc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Jc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function $c(){}function Qc(t,e,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var t=Gc(o);s.call(t)}}Hc(e,o,t,r)}else o=function(t,e,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var t=Gc(o);a.call(t)}}var o=Vc(e,i,t,0,null,!1,0,"",$c);return t._reactRootContainer=o,t[fr]=o.current,Vi(8===t.nodeType?t.parentNode:t),uc(),o}for(;r=t.lastChild;)t.removeChild(r);if("function"===typeof i){var s=i;i=function(){var t=Gc(l);s.call(t)}}var l=Uc(t,0,!1,null,0,!1,0,"",$c);return t._reactRootContainer=l,t[fr]=l.current,Vi(8===t.nodeType?t.parentNode:t),uc(function(){Hc(e,l,n,i)}),l}(n,e,t,r,i);return Gc(o)}Yc.prototype.render=Xc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(a(409));Hc(t,e,null,null)},Yc.prototype.unmount=Xc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;uc(function(){Hc(null,t,null,null)}),e[fr]=null}},Yc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Me();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Le.length&&0!==e&&e<Le[n].priority;n++);Le.splice(n,0,t),0===n&&Oe(t)}},be=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=he(e.pendingLanes);0!==n&&(ve(e,1|n),ic(e,Jt()),0===(6&Cl)&&(Vl=Jt()+500,Vr()))}break;case 13:uc(function(){var e=Da(t,1);if(null!==e){var n=tc();nc(e,t,1,n)}}),qc(t,1)}},we=function(t){if(13===t.tag){var e=Da(t,134217728);if(null!==e)nc(e,t,134217728,tc());qc(t,134217728)}},Se=function(t){if(13===t.tag){var e=ec(t),n=Da(t,e);if(null!==n)nc(n,t,e,tc());qc(t,e)}},Me=function(){return _e},Te=function(t,e){var n=_e;try{return _e=t,e()}finally{_e=n}},wt=function(t,e,n){switch(e){case"input":if($(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=br(i);if(!r)throw Error(a(90));Z(i),$(i,r)}}}break;case"textarea":at(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},Ct=cc,Pt=uc;var tu={usingClientEntryPoint:!1,Events:[_r,xr,br,Et,At,cc]},eu={findFiberByHostInstance:vr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Wt(t))?null:t.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{re=iu.inject(nu),ae=iu}catch(ut){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(e))throw Error(a(200));return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.createRoot=function(t,e){if(!Kc(t))throw Error(a(299));var n=!1,i="",r=Zc;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onRecoverableError&&(r=e.onRecoverableError)),e=Uc(t,1,!1,null,0,n,0,i,r),t[fr]=e.current,Vi(8===t.nodeType?t.parentNode:t),new Xc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(a(188));throw t=Object.keys(t).join(","),Error(a(268,t))}return t=null===(t=Wt(e))?null:t.stateNode},e.flushSync=function(t){return uc(t)},e.hydrate=function(t,e,n){if(!Jc(e))throw Error(a(200));return Qc(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!Kc(t))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=Zc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),e=Vc(e,null,t,1,null!=n?n:null,r,0,o,s),t[fr]=e.current,Vi(t),i)for(t=0;t<i.length;t++)r=(r=(n=i[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Yc(e)},e.render=function(t,e,n){if(!Jc(e))throw Error(a(200));return Qc(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Jc(t))throw Error(a(40));return!!t._reactRootContainer&&(uc(function(){Qc(null,null,t,!1,function(){t._reactRootContainer=null,t[fr]=null})}),!0)},e.unstable_batchedUpdates=cc,e.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Jc(n))throw Error(a(200));if(null==t||void 0===t._reactInternals)throw Error(a(38));return Qc(t,e,n,!1,i)},e.version="18.3.1-next-f1338f8080-20240426"},352:(t,e,n)=>{"use strict";var i=n(119);e.createRoot=i.createRoot,e.hydrateRoot=i.hydrateRoot},414:(t,e,n)=>{"use strict";t.exports=n(654)},473:(t,e,n)=>{t.exports=function(t){var e={},i=n(950),r=n(340),a=Object.assign;function o(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),v=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var x=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var b=Symbol.iterator;function w(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=b&&t[b]||t["@@iterator"])?t:null}function S(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case y:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case f:return(t.displayName||"Context")+".Consumer";case p:return(t._context.displayName||"Context")+".Provider";case m:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case v:return null!==(e=t.displayName||null)?e:S(t.type)||"Memo";case _:e=t._payload,t=t._init;try{return S(t(e))}catch(n){}}return null}function M(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return S(e);case 8:return e===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function T(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function E(t){if(T(t)!==t)throw Error(o(188))}function A(t){var e=t.alternate;if(!e){if(null===(e=T(t)))throw Error(o(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return E(r),t;if(a===i)return E(r),e;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,l=r.child;l;){if(l===n){s=!0,n=r,i=a;break}if(l===i){s=!0,i=r,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,i=r;break}if(l===i){s=!0,i=a,n=r;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?t:e}function C(t){return null!==(t=A(t))?P(t):null}function P(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=P(t);if(null!==e)return e;t=t.sibling}return null}function I(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){if(4!==t.tag){var e=I(t);if(null!==e)return e}t=t.sibling}return null}var R,k=Array.isArray,L=t.getPublicInstance,D=t.getRootHostContext,z=t.getChildHostContext,N=t.prepareForCommit,O=t.resetAfterCommit,F=t.createInstance,B=t.appendInitialChild,U=t.finalizeInitialChildren,j=t.prepareUpdate,V=t.shouldSetTextContent,H=t.createTextInstance,G=t.scheduleTimeout,W=t.cancelTimeout,q=t.noTimeout,Z=t.isPrimaryRenderer,X=t.supportsMutation,Y=t.supportsPersistence,K=t.supportsHydration,J=t.getInstanceFromNode,$=t.preparePortalMount,Q=t.getCurrentEventPriority,tt=t.detachDeletedInstance,et=t.supportsMicrotasks,nt=t.scheduleMicrotask,it=t.supportsTestSelectors,rt=t.findFiberRoot,at=t.getBoundingRect,ot=t.getTextContent,st=t.isHiddenSubtree,lt=t.matchAccessibilityRole,ct=t.setFocusIfFocusable,ut=t.setupIntersectionObserver,ht=t.appendChild,dt=t.appendChildToContainer,pt=t.commitTextUpdate,ft=t.commitMount,mt=t.commitUpdate,gt=t.insertBefore,yt=t.insertInContainerBefore,vt=t.removeChild,_t=t.removeChildFromContainer,xt=t.resetTextContent,bt=t.hideInstance,wt=t.hideTextInstance,St=t.unhideInstance,Mt=t.unhideTextInstance,Tt=t.clearContainer,Et=t.cloneInstance,At=t.createContainerChildSet,Ct=t.appendChildToContainerChildSet,Pt=t.finalizeContainerChildren,It=t.replaceContainerChildren,Rt=t.cloneHiddenInstance,kt=t.cloneHiddenTextInstance,Lt=t.canHydrateInstance,Dt=t.canHydrateTextInstance,zt=t.canHydrateSuspenseInstance,Nt=t.isSuspenseInstancePending,Ot=t.isSuspenseInstanceFallback,Ft=t.registerSuspenseInstanceRetry,Bt=t.getNextHydratableSibling,Ut=t.getFirstHydratableChild,jt=t.getFirstHydratableChildWithinContainer,Vt=t.getFirstHydratableChildWithinSuspenseInstance,Ht=t.hydrateInstance,Gt=t.hydrateTextInstance,Wt=t.hydrateSuspenseInstance,qt=t.getNextHydratableInstanceAfterSuspenseInstance,Zt=t.commitHydratedContainer,Xt=t.commitHydratedSuspenseInstance,Yt=t.clearSuspenseBoundary,Kt=t.clearSuspenseBoundaryFromContainer,Jt=t.shouldDeleteUnhydratedTailInstances,$t=t.didNotMatchHydratedContainerTextInstance,Qt=t.didNotMatchHydratedTextInstance;function te(t){if(void 0===R)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);R=e&&e[1]||""}return"\n"+R+t}var ee=!1;function ne(t,e){if(!t||ee)return"";ee=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var l="\n"+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=o&&0<=s);break}}}finally{ee=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?te(t):""}var ie=Object.prototype.hasOwnProperty,re=[],ae=-1;function oe(t){return{current:t}}function se(t){0>ae||(t.current=re[ae],re[ae]=null,ae--)}function le(t,e){ae++,re[ae]=t.current,t.current=e}var ce={},ue=oe(ce),he=oe(!1),de=ce;function pe(t,e){var n=t.type.contextTypes;if(!n)return ce;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=a),a}function fe(t){return null!==(t=t.childContextTypes)&&void 0!==t}function me(){se(he),se(ue)}function ge(t,e,n){if(ue.current!==ce)throw Error(o(168));le(ue,e),le(he,n)}function ye(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(o(108,M(t)||"Unknown",r));return a({},n,i)}function ve(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ce,de=ue.current,le(ue,t),le(he,he.current),!0}function _e(t,e,n){var i=t.stateNode;if(!i)throw Error(o(169));n?(t=ye(t,e,de),i.__reactInternalMemoizedMergedChildContext=t,se(he),se(ue),le(ue,t)):se(he),le(he,n)}var xe=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(be(t)/we|0)|0},be=Math.log,we=Math.LN2;var Se=64,Me=4194304;function Te(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ee(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=Te(s):0!==(a&=o)&&(i=Te(a))}else 0!==(o=n&~r)?i=Te(o):0!==a&&(i=Te(a));if(0===i)return 0;if(0!==e&&e!==i&&0===(e&r)&&((r=i&-i)>=(a=e&-e)||16===r&&0!==(4194240&a)))return e;if(0!==(4&i)&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-xe(e)),i|=t[n],e&=~r;return i}function Ae(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function Ce(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function Pe(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ie(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-xe(e)]=n}function Re(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-xe(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ke=0;function Le(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var De=r.unstable_scheduleCallback,ze=r.unstable_cancelCallback,Ne=r.unstable_shouldYield,Oe=r.unstable_requestPaint,Fe=r.unstable_now,Be=r.unstable_ImmediatePriority,Ue=r.unstable_UserBlockingPriority,je=r.unstable_NormalPriority,Ve=r.unstable_IdlePriority,He=null,Ge=null;var We="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e},qe=null,Ze=!1,Xe=!1;function Ye(t){null===qe?qe=[t]:qe.push(t)}function Ke(){if(!Xe&&null!==qe){Xe=!0;var t=0,e=ke;try{var n=qe;for(ke=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}qe=null,Ze=!1}catch(r){throw null!==qe&&(qe=qe.slice(t+1)),De(Be,Ke),r}finally{ke=e,Xe=!1}}return null}var Je=s.ReactCurrentBatchConfig;function $e(t,e){if(We(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!ie.call(e,r)||!We(t[r],e[r]))return!1}return!0}function Qe(t){switch(t.tag){case 5:return te(t.type);case 16:return te("Lazy");case 13:return te("Suspense");case 19:return te("SuspenseList");case 0:case 2:case 15:return t=ne(t.type,!1);case 11:return t=ne(t.type.render,!1);case 1:return t=ne(t.type,!0);default:return""}}function tn(t,e){if(t&&t.defaultProps){for(var n in e=a({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}var en=oe(null),nn=null,rn=null,an=null;function on(){an=rn=nn=null}function sn(t,e,n){Z?(le(en,e._currentValue),e._currentValue=n):(le(en,e._currentValue2),e._currentValue2=n)}function ln(t){var e=en.current;se(en),Z?t._currentValue=e:t._currentValue2=e}function cn(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function un(t,e){nn=t,an=rn=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(Nr=!0),t.firstContext=null)}function hn(t){var e=Z?t._currentValue:t._currentValue2;if(an!==t)if(t={context:t,memoizedValue:e,next:null},null===rn){if(null===nn)throw Error(o(308));rn=t,nn.dependencies={lanes:0,firstContext:t}}else rn=rn.next=t;return e}var dn=null,pn=!1;function fn(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function yn(t,e){var n=t.updateQueue;null!==n&&(n=n.shared,null!==Xa&&0!==(1&t.mode)&&0===(2&Za)?(null===(t=n.interleaved)?(e.next=e,null===dn?dn=[n]:dn.push(n)):(e.next=t.next,t.next=e),n.interleaved=e):(null===(t=n.pending)?e.next=e:(e.next=t.next,t.next=e),n.pending=e))}function vn(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,Re(t,n)}}function _n(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=e:a=a.next=e}else r=a=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function xn(t,e,n,i){var r=t.updateQueue;pn=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var c=l,u=c.next;c.next=null,null===s?o=u:s.next=u,s=c;var h=t.alternate;null!==h&&((l=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===l?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(null!==o){var d=r.baseState;for(s=0,h=u=c=null,l=o;;){var p=l.lane,f=l.eventTime;if((i&p)===p){null!==h&&(h=h.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});t:{var m=t,g=l;switch(p=e,f=n,g.tag){case 1:if("function"===typeof(m=g.payload)){d=m.call(f,d,p);break t}d=m;break t;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(p="function"===typeof(m=g.payload)?m.call(f,d,p):m)||void 0===p)break t;d=a({},d,p);break t;case 2:pn=!0}}null!==l.callback&&0!==l.lane&&(t.flags|=64,null===(p=r.effects)?r.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===h?(u=h=f,c=d):h=h.next=f,s|=p;if(null===(l=l.next)){if(null===(l=r.shared.pending))break;l=(p=l).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}if(null===h&&(c=d),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=h,null!==(e=r.shared.interleaved)){r=e;do{s|=r.lane,r=r.next}while(r!==e)}else null===o&&(r.shared.lanes=0);eo|=s,t.lanes=s,t.memoizedState=d}}function bn(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var wn=(new i.Component).refs;function Sn(t,e,n,i){n=null===(n=n(i,e=t.memoizedState))||void 0===n?e:a({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var Mn={isMounted:function(t){return!!(t=t._reactInternals)&&T(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=bo(),r=wo(t),a=gn(i,r);a.payload=e,void 0!==n&&null!==n&&(a.callback=n),yn(t,a),null!==(e=So(t,r,i))&&vn(e,t,r)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=bo(),r=wo(t),a=gn(i,r);a.tag=1,a.payload=e,void 0!==n&&null!==n&&(a.callback=n),yn(t,a),null!==(e=So(t,r,i))&&vn(e,t,r)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=bo(),i=wo(t),r=gn(n,i);r.tag=2,void 0!==e&&null!==e&&(r.callback=e),yn(t,r),null!==(e=So(t,i,n))&&vn(e,t,i)}};function Tn(t,e,n,i,r,a,o){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,a,o):!e.prototype||!e.prototype.isPureReactComponent||(!$e(n,i)||!$e(r,a))}function En(t,e,n){var i=!1,r=ce,a=e.contextType;return"object"===typeof a&&null!==a?a=hn(a):(r=fe(e)?de:ue.current,a=(i=null!==(i=e.contextTypes)&&void 0!==i)?pe(t,r):ce),e=new e(n,a),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=Mn,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function An(t,e,n,i){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Mn.enqueueReplaceState(e,e.state,null)}function Cn(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=wn,fn(t);var a=e.contextType;"object"===typeof a&&null!==a?r.context=hn(a):(a=fe(e)?de:ue.current,r.context=pe(t,a)),r.state=t.memoizedState,"function"===typeof(a=e.getDerivedStateFromProps)&&(Sn(t,e,a,n),r.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(e=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&Mn.enqueueReplaceState(r,r.state,null),xn(t,n,r,i),r.state=t.memoizedState),"function"===typeof r.componentDidMount&&(t.flags|=4194308)}var Pn=[],In=0,Rn=null,kn=0,Ln=[],Dn=0,zn=null,Nn=1,On="";function Fn(t,e){Pn[In++]=kn,Pn[In++]=Rn,Rn=t,kn=e}function Bn(t,e,n){Ln[Dn++]=Nn,Ln[Dn++]=On,Ln[Dn++]=zn,zn=t;var i=Nn;t=On;var r=32-xe(i)-1;i&=~(1<<r),n+=1;var a=32-xe(e)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Nn=1<<32-xe(e)+r|n<<r|i,On=a+t}else Nn=1<<a|n<<r|i,On=t}function Un(t){null!==t.return&&(Fn(t,1),Bn(t,1,0))}function jn(t){for(;t===Rn;)Rn=Pn[--In],Pn[In]=null,kn=Pn[--In],Pn[In]=null;for(;t===zn;)zn=Ln[--Dn],Ln[Dn]=null,On=Ln[--Dn],Ln[Dn]=null,Nn=Ln[--Dn],Ln[Dn]=null}var Vn=null,Hn=null,Gn=!1,Wn=!1,qn=null;function Zn(t,e){var n=$o(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function Xn(t,e){switch(t.tag){case 5:return null!==(e=Lt(e,t.type,t.pendingProps))&&(t.stateNode=e,Vn=t,Hn=Ut(e),!0);case 6:return null!==(e=Dt(e,t.pendingProps))&&(t.stateNode=e,Vn=t,Hn=null,!0);case 13:if(null!==(e=zt(e))){var n=null!==zn?{id:Nn,overflow:On}:null;return t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=$o(18,null,null,0)).stateNode=e,n.return=t,t.child=n,Vn=t,Hn=null,!0}return!1;default:return!1}}function Yn(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function Kn(t){if(Gn){var e=Hn;if(e){var n=e;if(!Xn(t,e)){if(Yn(t))throw Error(o(418));e=Bt(n);var i=Vn;e&&Xn(t,e)?Zn(i,n):(t.flags=-4097&t.flags|2,Gn=!1,Vn=t)}}else{if(Yn(t))throw Error(o(418));t.flags=-4097&t.flags|2,Gn=!1,Vn=t}}}function Jn(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;Vn=t}function $n(t){if(!K||t!==Vn)return!1;if(!Gn)return Jn(t),Gn=!0,!1;if(3!==t.tag&&(5!==t.tag||Jt(t.type)&&!V(t.type,t.memoizedProps))){var e=Hn;if(e){if(Yn(t)){for(t=Hn;t;)t=Bt(t);throw Error(o(418))}for(;e;)Zn(t,e),e=Bt(e)}}if(Jn(t),13===t.tag){if(!K)throw Error(o(316));if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(o(317));Hn=qt(t)}else Hn=Vn?Bt(t.stateNode):null;return!0}function Qn(){K&&(Hn=Vn=null,Wn=Gn=!1)}function ti(t){null===qn?qn=[t]:qn.push(t)}function ei(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,t));var r=i,a=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===a?e.ref:(e=function(t){var e=r.refs;e===wn&&(e=r.refs={}),null===t?delete e[a]:e[a]=t},e._stringRef=a,e)}if("string"!==typeof t)throw Error(o(284));if(!n._owner)throw Error(o(290,t))}return t}function ni(t,e){throw t=Object.prototype.toString.call(e),Error(o(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ii(t){return(0,t._init)(t._payload)}function ri(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=ts(t,e)).index=0,t.sibling=null,t}function a(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function s(e){return t&&null===e.alternate&&(e.flags|=2),e}function h(t,e,n,i){return null===e||6!==e.tag?((e=rs(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n,i){var a=n.type;return a===u?f(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===_&&ii(a)===e.type)?((i=r(e,n.props)).ref=ei(t,e,n),i.return=t,i):((i=es(n.type,n.key,n.props,null,t.mode,i)).ref=ei(t,e,n),i.return=t,i)}function p(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=as(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function f(t,e,n,i,a){return null===e||7!==e.tag?((e=ns(n,t.mode,i,a)).return=t,e):((e=r(e,n)).return=t,e)}function m(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=rs(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case l:return(n=es(e.type,e.key,e.props,null,t.mode,n)).ref=ei(t,null,e),n.return=t,n;case c:return(e=as(e,t.mode,n)).return=t,e;case _:return m(t,(0,e._init)(e._payload),n)}if(k(e)||w(e))return(e=ns(e,t.mode,n,null)).return=t,e;ni(t,e)}return null}function g(t,e,n,i){var r=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:h(t,e,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===r?d(t,e,n,i):null;case c:return n.key===r?p(t,e,n,i):null;case _:return g(t,e,(r=n._init)(n._payload),i)}if(k(n)||w(n))return null!==r?null:f(t,e,n,i,null);ni(t,n)}return null}function y(t,e,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return h(e,t=t.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case l:return d(e,t=t.get(null===i.key?n:i.key)||null,i,r);case c:return p(e,t=t.get(null===i.key?n:i.key)||null,i,r);case _:return y(t,e,n,(0,i._init)(i._payload),r)}if(k(i)||w(i))return f(e,t=t.get(n)||null,i,r,null);ni(e,i)}return null}function v(r,o,s,l){for(var c=null,u=null,h=o,d=o=0,p=null;null!==h&&d<s.length;d++){h.index>d?(p=h,h=null):p=h.sibling;var f=g(r,h,s[d],l);if(null===f){null===h&&(h=p);break}t&&h&&null===f.alternate&&e(r,h),o=a(f,o,d),null===u?c=f:u.sibling=f,u=f,h=p}if(d===s.length)return n(r,h),Gn&&Fn(r,d),c;if(null===h){for(;d<s.length;d++)null!==(h=m(r,s[d],l))&&(o=a(h,o,d),null===u?c=h:u.sibling=h,u=h);return Gn&&Fn(r,d),c}for(h=i(r,h);d<s.length;d++)null!==(p=y(h,r,d,s[d],l))&&(t&&null!==p.alternate&&h.delete(null===p.key?d:p.key),o=a(p,o,d),null===u?c=p:u.sibling=p,u=p);return t&&h.forEach(function(t){return e(r,t)}),Gn&&Fn(r,d),c}function x(r,s,l,c){var u=w(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,d=s,p=s=0,f=null,v=l.next();null!==d&&!v.done;p++,v=l.next()){d.index>p?(f=d,d=null):f=d.sibling;var _=g(r,d,v.value,c);if(null===_){null===d&&(d=f);break}t&&d&&null===_.alternate&&e(r,d),s=a(_,s,p),null===h?u=_:h.sibling=_,h=_,d=f}if(v.done)return n(r,d),Gn&&Fn(r,p),u;if(null===d){for(;!v.done;p++,v=l.next())null!==(v=m(r,v.value,c))&&(s=a(v,s,p),null===h?u=v:h.sibling=v,h=v);return Gn&&Fn(r,p),u}for(d=i(r,d);!v.done;p++,v=l.next())null!==(v=y(d,r,p,v.value,c))&&(t&&null!==v.alternate&&d.delete(null===v.key?p:v.key),s=a(v,s,p),null===h?u=v:h.sibling=v,h=v);return t&&d.forEach(function(t){return e(r,t)}),Gn&&Fn(r,p),u}return function t(i,a,o,h){if("object"===typeof o&&null!==o&&o.type===u&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case l:t:{for(var d=o.key,p=a;null!==p;){if(p.key===d){if((d=o.type)===u){if(7===p.tag){n(i,p.sibling),(a=r(p,o.props.children)).return=i,i=a;break t}}else if(p.elementType===d||"object"===typeof d&&null!==d&&d.$$typeof===_&&ii(d)===p.type){n(i,p.sibling),(a=r(p,o.props)).ref=ei(i,p,o),a.return=i,i=a;break t}n(i,p);break}e(i,p),p=p.sibling}o.type===u?((a=ns(o.props.children,i.mode,h,o.key)).return=i,i=a):((h=es(o.type,o.key,o.props,null,i.mode,h)).ref=ei(i,a,o),h.return=i,i=h)}return s(i);case c:t:{for(p=o.key;null!==a;){if(a.key===p){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break t}n(i,a);break}e(i,a),a=a.sibling}(a=as(o,i.mode,h)).return=i,i=a}return s(i);case _:return t(i,a,(p=o._init)(o._payload),h)}if(k(o))return v(i,a,o,h);if(w(o))return x(i,a,o,h);ni(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=rs(o,i.mode,h)).return=i,i=a),s(i)):n(i,a)}}var ai=ri(!0),oi=ri(!1),si={},li=oe(si),ci=oe(si),ui=oe(si);function hi(t){if(t===si)throw Error(o(174));return t}function di(t,e){le(ui,e),le(ci,t),le(li,si),t=D(e),se(li),le(li,t)}function pi(){se(li),se(ci),se(ui)}function fi(t){var e=hi(ui.current),n=hi(li.current);n!==(e=z(n,t.type,e))&&(le(ci,t),le(li,e))}function mi(t){ci.current===t&&(se(li),se(ci))}var gi=oe(0);function yi(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Nt(n)||Ot(n)))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var vi=[];function _i(){for(var t=0;t<vi.length;t++){var e=vi[t];Z?e._workInProgressVersionPrimary=null:e._workInProgressVersionSecondary=null}vi.length=0}var xi=s.ReactCurrentDispatcher,bi=s.ReactCurrentBatchConfig,wi=0,Si=null,Mi=null,Ti=null,Ei=!1,Ai=!1,Ci=0,Pi=0;function Ii(){throw Error(o(321))}function Ri(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!We(t[n],e[n]))return!1;return!0}function ki(t,e,n,i,r,a){if(wi=a,Si=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xi.current=null===t||null===t.memoizedState?fr:mr,t=n(i,r),Ai){a=0;do{if(Ai=!1,Ci=0,25<=a)throw Error(o(301));a+=1,Ti=Mi=null,e.updateQueue=null,xi.current=gr,t=n(i,r)}while(Ai)}if(xi.current=pr,e=null!==Mi&&null!==Mi.next,wi=0,Ti=Mi=Si=null,Ei=!1,e)throw Error(o(300));return t}function Li(){var t=0!==Ci;return Ci=0,t}function Di(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ti?Si.memoizedState=Ti=t:Ti=Ti.next=t,Ti}function zi(){if(null===Mi){var t=Si.alternate;t=null!==t?t.memoizedState:null}else t=Mi.next;var e=null===Ti?Si.memoizedState:Ti.next;if(null!==e)Ti=e,Mi=t;else{if(null===t)throw Error(o(310));t={memoizedState:(Mi=t).memoizedState,baseState:Mi.baseState,baseQueue:Mi.baseQueue,queue:Mi.queue,next:null},null===Ti?Si.memoizedState=Ti=t:Ti=Ti.next=t}return Ti}function Ni(t,e){return"function"===typeof e?e(t):e}function Oi(t){var e=zi(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=Mi,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=s=null,c=null,u=a;do{var h=u.lane;if((wi&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:t(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,s=i):c=c.next=d,Si.lanes|=h,eo|=h}u=u.next}while(null!==u&&u!==a);null===c?s=i:c.next=l,We(i,e.memoizedState)||(Nr=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=c,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{a=r.lane,Si.lanes|=a,eo|=a,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Fi(t){var e=zi(),n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,a=e.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=t(a,s.action),s=s.next}while(s!==r);We(a,e.memoizedState)||(Nr=!0),e.memoizedState=a,null===e.baseQueue&&(e.baseState=a),n.lastRenderedState=a}return[a,i]}function Bi(){}function Ui(t,e){var n=Si,i=zi(),r=e(),a=!We(i.memoizedState,r);if(a&&(i.memoizedState=r,Nr=!0),i=i.queue,Ji(Hi.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||null!==Ti&&1&Ti.memoizedState.tag){if(n.flags|=2048,qi(9,Vi.bind(null,n,i,r,e),void 0,null),null===Xa)throw Error(o(349));0!==(30&wi)||ji(n,e,r)}return r}function ji(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=Si.updateQueue)?(e={lastEffect:null,stores:null},Si.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Vi(t,e,n,i){e.value=n,e.getSnapshot=i,Gi(e)&&So(t,1,-1)}function Hi(t,e,n){return n(function(){Gi(e)&&So(t,1,-1)})}function Gi(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!We(t,n)}catch(i){return!0}}function Wi(t){var e=Di();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:t},e.queue=t,t=t.dispatch=lr.bind(null,Si,t),[e.memoizedState,t]}function qi(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=Si.updateQueue)?(e={lastEffect:null,stores:null},Si.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function Zi(){return zi().memoizedState}function Xi(t,e,n,i){var r=Di();Si.flags|=t,r.memoizedState=qi(1|e,n,void 0,void 0===i?null:i)}function Yi(t,e,n,i){var r=zi();i=void 0===i?null:i;var a=void 0;if(null!==Mi){var o=Mi.memoizedState;if(a=o.destroy,null!==i&&Ri(i,o.deps))return void(r.memoizedState=qi(e,n,a,i))}Si.flags|=t,r.memoizedState=qi(1|e,n,a,i)}function Ki(t,e){return Xi(8390656,8,t,e)}function Ji(t,e){return Yi(2048,8,t,e)}function $i(t,e){return Yi(4,2,t,e)}function Qi(t,e){return Yi(4,4,t,e)}function tr(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function er(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Yi(4,4,tr.bind(null,e,t),n)}function nr(){}function ir(t,e){var n=zi();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&Ri(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function rr(t,e){var n=zi();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&Ri(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function ar(t,e){var n=ke;ke=0!==n&&4>n?n:4,t(!0);var i=bi.transition;bi.transition={};try{t(!1),e()}finally{ke=n,bi.transition=i}}function or(){return zi().memoizedState}function sr(t,e,n){var i=wo(t);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},cr(t)?ur(e,n):(hr(t,e,n),null!==(t=So(t,i,n=bo()))&&dr(t,e,i))}function lr(t,e,n){var i=wo(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(cr(t))ur(e,r);else{hr(t,e,r);var a=t.alternate;if(0===t.lanes&&(null===a||0===a.lanes)&&null!==(a=e.lastRenderedReducer))try{var o=e.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,We(s,o))return}catch(l){}null!==(t=So(t,i,n=bo()))&&dr(t,e,i)}}function cr(t){var e=t.alternate;return t===Si||null!==e&&e===Si}function ur(t,e){Ai=Ei=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function hr(t,e,n){null!==Xa&&0!==(1&t.mode)&&0===(2&Za)?(null===(t=e.interleaved)?(n.next=n,null===dn?dn=[e]:dn.push(e)):(n.next=t.next,t.next=n),e.interleaved=n):(null===(t=e.pending)?n.next=n:(n.next=t.next,t.next=n),e.pending=n)}function dr(t,e,n){if(0!==(4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,Re(t,n)}}var pr={readContext:hn,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useInsertionEffect:Ii,useLayoutEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useMutableSource:Ii,useSyncExternalStore:Ii,useId:Ii,unstable_isNewReconciler:!1},fr={readContext:hn,useCallback:function(t,e){return Di().memoizedState=[t,void 0===e?null:e],t},useContext:hn,useEffect:Ki,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Xi(4194308,4,tr.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Xi(4194308,4,t,e)},useInsertionEffect:function(t,e){return Xi(4,2,t,e)},useMemo:function(t,e){var n=Di();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Di();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=sr.bind(null,Si,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},Di().memoizedState=t},useState:Wi,useDebugValue:nr,useDeferredValue:function(t){var e=Wi(t),n=e[0],i=e[1];return Ki(function(){var e=bi.transition;bi.transition={};try{i(t)}finally{bi.transition=e}},[t]),n},useTransition:function(){var t=Wi(!1),e=t[0];return t=ar.bind(null,t[1]),Di().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Si,r=Di();if(Gn){if(void 0===n)throw Error(o(407));n=n()}else{if(n=e(),null===Xa)throw Error(o(349));0!==(30&wi)||ji(i,e,n)}r.memoizedState=n;var a={value:n,getSnapshot:e};return r.queue=a,Ki(Hi.bind(null,i,a,t),[t]),i.flags|=2048,qi(9,Vi.bind(null,i,a,n,e),void 0,null),n},useId:function(){var t=Di(),e=Xa.identifierPrefix;if(Gn){var n=On;e=":"+e+"R"+(n=(Nn&~(1<<32-xe(Nn)-1)).toString(32)+n),0<(n=Ci++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=Pi++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},mr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Ji,useImperativeHandle:er,useInsertionEffect:$i,useLayoutEffect:Qi,useMemo:rr,useReducer:Oi,useRef:Zi,useState:function(){return Oi(Ni)},useDebugValue:nr,useDeferredValue:function(t){var e=Oi(Ni),n=e[0],i=e[1];return Ji(function(){var e=bi.transition;bi.transition={};try{i(t)}finally{bi.transition=e}},[t]),n},useTransition:function(){return[Oi(Ni)[0],zi().memoizedState]},useMutableSource:Bi,useSyncExternalStore:Ui,useId:or,unstable_isNewReconciler:!1},gr={readContext:hn,useCallback:ir,useContext:hn,useEffect:Ji,useImperativeHandle:er,useInsertionEffect:$i,useLayoutEffect:Qi,useMemo:rr,useReducer:Fi,useRef:Zi,useState:function(){return Fi(Ni)},useDebugValue:nr,useDeferredValue:function(t){var e=Fi(Ni),n=e[0],i=e[1];return Ji(function(){var e=bi.transition;bi.transition={};try{i(t)}finally{bi.transition=e}},[t]),n},useTransition:function(){return[Fi(Ni)[0],zi().memoizedState]},useMutableSource:Bi,useSyncExternalStore:Ui,useId:or,unstable_isNewReconciler:!1};function yr(t,e){try{var n="",i=e;do{n+=Qe(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:t,source:e,stack:r}}function vr(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var _r,xr,br,wr,Sr="function"===typeof WeakMap?WeakMap:Map;function Mr(t,e,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){uo||(uo=!0,ho=i),vr(0,e)},n}function Tr(t,e,n){(n=gn(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"===typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){vr(0,e)}}var a=t.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){vr(0,e),"function"!==typeof i&&(null===po?po=new Set([this]):po.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function Er(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new Sr;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=qo.bind(null,t,e,n),e.then(t,t))}function Ar(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function Cr(t,e,n,i,r){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=gn(-1,1)).tag=2,yn(n,e))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}function Pr(t){t.flags|=4}function Ir(t,e){if(null!==t&&t.child===e.child)return!0;if(0!==(16&e.flags))return!1;for(t=e.child;null!==t;){if(0!==(12854&t.flags)||0!==(12854&t.subtreeFlags))return!1;t=t.sibling}return!0}if(X)_r=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)B(t,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},xr=function(){},br=function(t,e,n,i,r){if((t=t.memoizedProps)!==i){var a=e.stateNode,o=hi(li.current);n=j(a,n,t,i,r,o),(e.updateQueue=n)&&Pr(e)}},wr=function(t,e,n,i){n!==i&&Pr(e)};else if(Y){_r=function(t,e,n,i){for(var r=e.child;null!==r;){if(5===r.tag){var a=r.stateNode;n&&i&&(a=Rt(a,r.type,r.memoizedProps,r)),B(t,a)}else if(6===r.tag)a=r.stateNode,n&&i&&(a=kt(a,r.memoizedProps,r)),B(t,a);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(a=r.child)&&(a.return=r),_r(t,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};var Rr=function(t,e,n,i){for(var r=e.child;null!==r;){if(5===r.tag){var a=r.stateNode;n&&i&&(a=Rt(a,r.type,r.memoizedProps,r)),Ct(t,a)}else if(6===r.tag)a=r.stateNode,n&&i&&(a=kt(a,r.memoizedProps,r)),Ct(t,a);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(a=r.child)&&(a.return=r),Rr(t,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};xr=function(t,e){var n=e.stateNode;if(!Ir(t,e)){t=n.containerInfo;var i=At(t);Rr(i,e,!1,!1),n.pendingChildren=i,Pr(e),Pt(t,i)}},br=function(t,e,n,i,r){var a=t.stateNode,o=t.memoizedProps;if((t=Ir(t,e))&&o===i)e.stateNode=a;else{var s=e.stateNode,l=hi(li.current),c=null;o!==i&&(c=j(s,n,o,i,r,l)),t&&null===c?e.stateNode=a:(a=Et(a,c,n,o,i,e,t,s),U(a,n,i,r,l)&&Pr(e),e.stateNode=a,t?Pr(e):_r(a,e,!1,!1))}},wr=function(t,e,n,i){n!==i?(t=hi(ui.current),n=hi(li.current),e.stateNode=H(i,t,n,e),Pr(e)):e.stateNode=t.stateNode}}else xr=function(){},br=function(){},wr=function(){};function kr(t,e){if(!Gn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Lr(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Dr(t,e,n){var i=e.pendingProps;switch(jn(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lr(e),null;case 1:case 17:return fe(e.type)&&me(),Lr(e),null;case 3:return i=e.stateNode,pi(),se(he),se(ue),_i(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||($n(e)?Pr(e):null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==qn&&(Co(qn),qn=null))),xr(t,e),Lr(e),null;case 5:mi(e),n=hi(ui.current);var r=e.type;if(null!==t&&null!=e.stateNode)br(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(o(166));return Lr(e),null}if(t=hi(li.current),$n(e)){if(!K)throw Error(o(175));t=Ht(e.stateNode,e.type,e.memoizedProps,n,t,e,!Wn),e.updateQueue=t,null!==t&&Pr(e)}else{var a=F(r,i,n,t,e);_r(a,e,!1,!1),e.stateNode=a,U(a,r,i,n,t)&&Pr(e)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Lr(e),null;case 6:if(t&&null!=e.stateNode)wr(t,e,t.memoizedProps,i);else{if("string"!==typeof i&&null===e.stateNode)throw Error(o(166));if(t=hi(ui.current),n=hi(li.current),$n(e)){if(!K)throw Error(o(176));if(t=e.stateNode,i=e.memoizedProps,(n=Gt(t,i,e,!Wn))&&null!==(r=Vn))switch(a=0!==(1&r.mode),r.tag){case 3:$t(r.stateNode.containerInfo,t,i,a);break;case 5:Qt(r.type,r.memoizedProps,r.stateNode,t,i,a)}n&&Pr(e)}else e.stateNode=H(i,t,n,e)}return Lr(e),null;case 13:if(se(gi),i=e.memoizedState,Gn&&null!==Hn&&0!==(1&e.mode)&&0===(128&e.flags)){for(t=Hn;t;)t=Bt(t);return Qn(),e.flags|=98560,e}if(null!==i&&null!==i.dehydrated){if(i=$n(e),null===t){if(!i)throw Error(o(318));if(!K)throw Error(o(344));if(!(t=null!==(t=e.memoizedState)?t.dehydrated:null))throw Error(o(317));Wt(t,e)}else Qn(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;return Lr(e),null}return null!==qn&&(Co(qn),qn=null),0!==(128&e.flags)?(e.lanes=n,e):(i=null!==i,n=!1,null===t?$n(e):n=null!==t.memoizedState,i&&!n&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&gi.current)?0===Qa&&(Qa=3):No())),null!==e.updateQueue&&(e.flags|=4),Lr(e),null);case 4:return pi(),xr(t,e),null===t&&$(e.stateNode.containerInfo),Lr(e),null;case 10:return ln(e.type._context),Lr(e),null;case 19:if(se(gi),null===(r=e.memoizedState))return Lr(e),null;if(i=0!==(128&e.flags),null===(a=r.rendering))if(i)kr(r,!1);else{if(0!==Qa||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(a=yi(t))){for(e.flags|=128,kr(r,!1),null!==(t=a.updateQueue)&&(e.updateQueue=t,e.flags|=4),e.subtreeFlags=0,t=n,i=e.child;null!==i;)r=t,(n=i).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,r=a.dependencies,n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),i=i.sibling;return le(gi,1&gi.current|2),e.child}t=t.sibling}null!==r.tail&&Fe()>so&&(e.flags|=128,i=!0,kr(r,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=yi(a))){if(e.flags|=128,i=!0,null!==(t=t.updateQueue)&&(e.updateQueue=t,e.flags|=4),kr(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!Gn)return Lr(e),null}else 2*Fe()-r.renderingStartTime>so&&1073741824!==n&&(e.flags|=128,i=!0,kr(r,!1),e.lanes=4194304);r.isBackwards?(a.sibling=e.child,e.child=a):(null!==(t=r.last)?t.sibling=a:e.child=a,r.last=a)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Fe(),e.sibling=null,t=gi.current,le(gi,i?1&t|2:1&t),e):(Lr(e),null);case 22:case 23:return ko(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&0!==(1&e.mode)?0!==(1073741824&Ja)&&(Lr(e),X&&6&e.subtreeFlags&&(e.flags|=8192)):Lr(e),null;case 24:case 25:return null}throw Error(o(156,e.tag))}var zr=s.ReactCurrentOwner,Nr=!1;function Or(t,e,n,i){e.child=null===t?oi(e,null,n,i):ai(e,t.child,n,i)}function Fr(t,e,n,i,r){n=n.render;var a=e.ref;return un(e,r),i=ki(t,e,n,i,a,r),n=Li(),null===t||Nr?(Gn&&n&&Un(e),e.flags|=1,Or(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ra(t,e,r))}function Br(t,e,n,i,r){if(null===t){var a=n.type;return"function"!==typeof a||Qo(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=es(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=a,Ur(t,e,a,i,r))}if(a=t.child,0===(t.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:$e)(o,i)&&t.ref===e.ref)return ra(t,e,r)}return e.flags|=1,(t=ts(a,i)).ref=e.ref,t.return=e,e.child=t}function Ur(t,e,n,i,r){if(null!==t&&$e(t.memoizedProps,i)&&t.ref===e.ref){if(Nr=!1,0===(t.lanes&r))return e.lanes=t.lanes,ra(t,e,r);0!==(131072&t.flags)&&(Nr=!0)}return Hr(t,e,n,i,r)}function jr(t,e,n){var i=e.pendingProps,r=i.children,a=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null},le($a,Ja),Ja|=n;else{if(0===(1073741824&n))return t=null!==a?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null},e.updateQueue=null,le($a,Ja),Ja|=t,null;e.memoizedState={baseLanes:0,cachePool:null},i=null!==a?a.baseLanes:n,le($a,Ja),Ja|=i}else null!==a?(i=a.baseLanes|n,e.memoizedState=null):i=n,le($a,Ja),Ja|=i;return Or(t,e,r,n),e.child}function Vr(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Hr(t,e,n,i,r){var a=fe(n)?de:ue.current;return a=pe(e,a),un(e,r),n=ki(t,e,n,i,a,r),i=Li(),null===t||Nr?(Gn&&i&&Un(e),e.flags|=1,Or(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ra(t,e,r))}function Gr(t,e,n,i,r){if(fe(n)){var a=!0;ve(e)}else a=!1;if(un(e,r),null===e.stateNode)null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),En(e,n,i),Cn(e,n,i,r),i=!0;else if(null===t){var o=e.stateNode,s=e.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=hn(c):c=pe(e,c=fe(n)?de:ue.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||l!==c)&&An(e,o,i,c),pn=!1;var d=e.memoizedState;o.state=d,xn(e,i,o,r),l=e.memoizedState,s!==i||d!==l||he.current||pn?("function"===typeof u&&(Sn(e,n,u,i),l=e.memoizedState),(s=pn||Tn(e,n,s,i,d,l,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(e.flags|=4194308)):("function"===typeof o.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=s):("function"===typeof o.componentDidMount&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,mn(t,e),s=e.memoizedProps,c=e.type===e.elementType?s:tn(e.type,s),o.props=c,h=e.pendingProps,d=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=hn(l):l=pe(e,l=fe(n)?de:ue.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||d!==l)&&An(e,o,i,l),pn=!1,d=e.memoizedState,o.state=d,xn(e,i,o,r);var f=e.memoizedState;s!==h||d!==f||he.current||pn?("function"===typeof p&&(Sn(e,n,p,i),f=e.memoizedState),(c=pn||Tn(e,n,c,i,d,f,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof o.componentDidUpdate&&(e.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=f),o.props=i,o.state=f,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Wr(t,e,n,i,a,r)}function Wr(t,e,n,i,r,a){Vr(t,e);var o=0!==(128&e.flags);if(!i&&!o)return r&&_e(e,n,!1),ra(t,e,a);i=e.stateNode,zr.current=e;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&o?(e.child=ai(e,t.child,null,a),e.child=ai(e,null,s,a)):Or(t,e,s,a),e.memoizedState=i.state,r&&_e(e,n,!0),e.child}function qr(t){var e=t.stateNode;e.pendingContext?ge(0,e.pendingContext,e.pendingContext!==e.context):e.context&&ge(0,e.context,!1),di(t,e.containerInfo)}function Zr(t,e,n,i,r){return Qn(),ti(r),e.flags|=256,Or(t,e,n,i),e.child}var Xr={dehydrated:null,treeContext:null,retryLane:0};function Yr(t){return{baseLanes:t,cachePool:null}}function Kr(t,e,n){var i,r=e.pendingProps,a=gi.current,s=!1,l=0!==(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&0!==(2&a)),i?(s=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(a|=1),le(gi,1&a),null===t)return Kn(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:Ot(t)?e.lanes=8:e.lanes=1073741824,null):(a=r.children,t=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=a):s=is(a,r,0,null),t=ns(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Yr(n),e.memoizedState=Xr,t):Jr(e,a));if(null!==(a=t.memoizedState)){if(null!==(i=a.dehydrated)){if(l)return 256&e.flags?(e.flags&=-257,ta(t,e,n,Error(o(422)))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(s=r.fallback,a=e.mode,r=is({mode:"visible",children:r.children},a,0,null),(s=ns(s,a,n,null)).flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,0!==(1&e.mode)&&ai(e,t.child,null,n),e.child.memoizedState=Yr(n),e.memoizedState=Xr,s);if(0===(1&e.mode))e=ta(t,e,n,null);else if(Ot(i))e=ta(t,e,n,Error(o(419)));else if(r=0!==(n&t.childLanes),Nr||r){if(null!==(r=Xa)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(r=0!==(s&(r.suspendedLanes|n))?0:s)&&r!==a.retryLane&&(a.retryLane=r,So(t,r,-1))}No(),e=ta(t,e,n,Error(o(421)))}else Nt(i)?(e.flags|=128,e.child=t.child,e=Xo.bind(null,t),Ft(i,e),e=null):(n=a.treeContext,K&&(Hn=Vt(i),Vn=e,Gn=!0,qn=null,Wn=!1,null!==n&&(Ln[Dn++]=Nn,Ln[Dn++]=On,Ln[Dn++]=zn,Nn=n.id,On=n.overflow,zn=e)),(e=Jr(e,e.pendingProps.children)).flags|=4096);return e}return s?(r=Qr(t,e,r.children,r.fallback,n),s=e.child,a=t.child.memoizedState,s.memoizedState=null===a?Yr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=t.childLanes&~n,e.memoizedState=Xr,r):(n=$r(t,e,r.children,n),e.memoizedState=null,n)}return s?(r=Qr(t,e,r.children,r.fallback,n),s=e.child,a=t.child.memoizedState,s.memoizedState=null===a?Yr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=t.childLanes&~n,e.memoizedState=Xr,r):(n=$r(t,e,r.children,n),e.memoizedState=null,n)}function Jr(t,e){return(e=is({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function $r(t,e,n,i){var r=t.child;return t=r.sibling,n=ts(r,{mode:"visible",children:n}),0===(1&e.mode)&&(n.lanes=i),n.return=e,n.sibling=null,null!==t&&(null===(i=e.deletions)?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n}function Qr(t,e,n,i,r){var a=e.mode,o=(t=t.child).sibling,s={mode:"hidden",children:n};return 0===(1&a)&&e.child!==t?((n=e.child).childLanes=0,n.pendingProps=s,e.deletions=null):(n=ts(t,s)).subtreeFlags=14680064&t.subtreeFlags,null!==o?i=ts(o,i):(i=ns(i,a,r,null)).flags|=2,i.return=e,n.return=e,n.sibling=i,e.child=n,i}function ta(t,e,n,i){return null!==i&&ti(i),ai(e,t.child,null,n),(t=Jr(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function ea(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),cn(t.return,e,n)}function na(t,e,n,i,r){var a=t.memoizedState;null===a?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function ia(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(Or(t,e,i.children,n),0!==(2&(i=gi.current)))i=1&i|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&ea(t,n,e);else if(19===t.tag)ea(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(le(gi,i),0===(1&e.mode))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===yi(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),na(e,!1,r,n,a);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===yi(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}na(e,!0,n,null,a);break;case"together":na(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ra(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),eo|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(o(153));if(null!==e.child){for(n=ts(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=ts(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function aa(t,e){switch(jn(e),e.tag){case 1:return fe(e.type)&&me(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return pi(),se(he),se(ue),_i(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return mi(e),null;case 13:if(se(gi),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(o(340));Qn()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return se(gi),null;case 4:return pi(),null;case 10:return ln(e.type._context),null;case 22:case 23:return ko(),null;default:return null}}var oa=!1,sa=!1,la="function"===typeof WeakSet?WeakSet:Set,ca=null;function ua(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Wo(t,e,i)}else n.current=null}function ha(t,e,n){try{n()}catch(i){Wo(t,e,i)}}var da=!1;function pa(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,void 0!==a&&ha(e,n,a)}r=r.next}while(r!==i)}}function fa(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function ma(t){var e=t.ref;if(null!==e){var n=t.stateNode;if(5===t.tag)t=L(n);else t=n;"function"===typeof e?e(t):e.current=t}}function ga(t,e,n){if(Ge&&"function"===typeof Ge.onCommitFiberUnmount)try{Ge.onCommitFiberUnmount(He,e)}catch(o){}switch(e.tag){case 0:case 11:case 14:case 15:if(null!==(t=e.updateQueue)&&null!==(t=t.lastEffect)){var i=t=t.next;do{var r=i,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&ha(e,n,a),i=i.next}while(i!==t)}break;case 1:if(ua(e,n),"function"===typeof(t=e.stateNode).componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(o){Wo(e,n,o)}break;case 5:ua(e,n);break;case 4:X?Ma(t,e,n):Y&&Y&&(e=e.stateNode.containerInfo,n=At(e),It(e,n))}}function ya(t,e,n){for(var i=e;;)if(ga(t,i,n),null===i.child||X&&4===i.tag){if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function va(t){var e=t.alternate;null!==e&&(t.alternate=null,va(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&tt(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _a(t){return 5===t.tag||3===t.tag||4===t.tag}function xa(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||_a(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ba(t){if(X){t:{for(var e=t.return;null!==e;){if(_a(e))break t;e=e.return}throw Error(o(160))}var n=e;switch(n.tag){case 5:e=n.stateNode,32&n.flags&&(xt(e),n.flags&=-33),Sa(t,n=xa(t),e);break;case 3:case 4:e=n.stateNode.containerInfo,wa(t,n=xa(t),e);break;default:throw Error(o(161))}}}function wa(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?yt(n,t,e):dt(n,t);else if(4!==i&&null!==(t=t.child))for(wa(t,e,n),t=t.sibling;null!==t;)wa(t,e,n),t=t.sibling}function Sa(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?gt(n,t,e):ht(n,t);else if(4!==i&&null!==(t=t.child))for(Sa(t,e,n),t=t.sibling;null!==t;)Sa(t,e,n),t=t.sibling}function Ma(t,e,n){for(var i,r,a=e,s=!1;;){if(!s){s=a.return;t:for(;;){if(null===s)throw Error(o(160));switch(i=s.stateNode,s.tag){case 5:r=!1;break t;case 3:case 4:i=i.containerInfo,r=!0;break t}s=s.return}s=!0}if(5===a.tag||6===a.tag)ya(t,a,n),r?_t(i,a.stateNode):vt(i,a.stateNode);else if(18===a.tag)r?Kt(i,a.stateNode):Yt(i,a.stateNode);else if(4===a.tag){if(null!==a.child){i=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(ga(t,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===e)break;for(;null===a.sibling;){if(null===a.return||a.return===e)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function Ta(t,e){if(X){switch(e.tag){case 0:case 11:case 14:case 15:return pa(3,e,e.return),fa(3,e),void pa(5,e,e.return);case 1:case 12:case 17:return;case 5:var n=e.stateNode;if(null!=n){var i=e.memoizedProps;t=null!==t?t.memoizedProps:i;var r=e.type,a=e.updateQueue;e.updateQueue=null,null!==a&&mt(n,a,r,t,i,e)}return;case 6:if(null===e.stateNode)throw Error(o(162));return n=e.memoizedProps,void pt(e.stateNode,null!==t?t.memoizedProps:n,n);case 3:return void(K&&null!==t&&t.memoizedState.isDehydrated&&Zt(e.stateNode.containerInfo));case 13:case 19:return void Ea(e)}throw Error(o(163))}switch(e.tag){case 0:case 11:case 14:case 15:return pa(3,e,e.return),fa(3,e),void pa(5,e,e.return);case 12:case 22:case 23:return;case 13:case 19:return void Ea(e);case 3:K&&null!==t&&t.memoizedState.isDehydrated&&Zt(e.stateNode.containerInfo)}t:if(Y){switch(e.tag){case 1:case 5:case 6:break t;case 3:case 4:e=e.stateNode,It(e.containerInfo,e.pendingChildren);break t}throw Error(o(163))}}function Ea(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new la),e.forEach(function(e){var i=Yo.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))})}}function Aa(t,e,n){ca=t,Ca(t,e,n)}function Ca(t,e,n){for(var i=0!==(1&t.mode);null!==ca;){var r=ca,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||oa;if(!o){var s=r.alternate,l=null!==s&&null!==s.memoizedState||sa;s=oa;var c=sa;if(oa=o,(sa=l)&&!c)for(ca=r;null!==ca;)l=(o=ca).child,22===o.tag&&null!==o.memoizedState?Ra(r):null!==l?(l.return=o,ca=l):Ra(r);for(;null!==a;)ca=a,Ca(a,e,n),a=a.sibling;ca=r,oa=s,sa=c}Pa(t)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,ca=a):Pa(t)}}function Pa(t){for(;null!==ca;){var e=ca;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:sa||fa(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!sa)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:tn(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;null!==a&&bn(e,a,i);break;case 3:var s=e.updateQueue;if(null!==s){if(n=null,null!==e.child)switch(e.child.tag){case 5:n=L(e.child.stateNode);break;case 1:n=e.child.stateNode}bn(e,s,n)}break;case 5:var l=e.stateNode;null===n&&4&e.flags&&ft(l,e.type,e.memoizedProps,e);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(K&&null===e.memoizedState){var c=e.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Xt(h)}}}break;default:throw Error(o(163))}sa||512&e.flags&&ma(e)}catch(d){Wo(e,e.return,d)}}if(e===t){ca=null;break}if(null!==(n=e.sibling)){n.return=e.return,ca=n;break}ca=e.return}}function Ia(t){for(;null!==ca;){var e=ca;if(e===t){ca=null;break}var n=e.sibling;if(null!==n){n.return=e.return,ca=n;break}ca=e.return}}function Ra(t){for(;null!==ca;){var e=ca;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fa(4,e)}catch(l){Wo(e,n,l)}break;case 1:var i=e.stateNode;if("function"===typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(l){Wo(e,r,l)}}var a=e.return;try{ma(e)}catch(l){Wo(e,a,l)}break;case 5:var o=e.return;try{ma(e)}catch(l){Wo(e,o,l)}}}catch(l){Wo(e,e.return,l)}if(e===t){ca=null;break}var s=e.sibling;if(null!==s){s.return=e.return,ca=s;break}ca=e.return}}var ka=0,La=1,Da=2,za=3,Na=4;if("function"===typeof Symbol&&Symbol.for){var Oa=Symbol.for;ka=Oa("selector.component"),La=Oa("selector.has_pseudo_class"),Da=Oa("selector.role"),za=Oa("selector.test_id"),Na=Oa("selector.text")}function Fa(t){var e=J(t);if(null!=e){if("string"!==typeof e.memoizedProps["data-testname"])throw Error(o(364));return e}if(null===(t=rt(t)))throw Error(o(362));return t.stateNode.current}function Ba(t,e){switch(e.$$typeof){case ka:if(t.type===e.value)return!0;break;case La:t:{e=e.value,t=[t,0];for(var n=0;n<t.length;){var i=t[n++],r=t[n++],a=e[r];if(5!==i.tag||!st(i)){for(;null!=a&&Ba(i,a);)a=e[++r];if(r===e.length){e=!0;break t}for(i=i.child;null!==i;)t.push(i,r),i=i.sibling}}e=!1}return e;case Da:if(5===t.tag&&lt(t.stateNode,e.value))return!0;break;case Na:if((5===t.tag||6===t.tag)&&(null!==(t=ot(t))&&0<=t.indexOf(e.value)))return!0;break;case za:if(5===t.tag&&("string"===typeof(t=t.memoizedProps["data-testname"])&&t.toLowerCase()===e.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Ua(t){switch(t.$$typeof){case ka:return"<"+(S(t.value)||"Unknown")+">";case La:return":has("+(Ua(t)||"")+")";case Da:return'[role="'+t.value+'"]';case Na:return'"'+t.value+'"';case za:return'[data-testname="'+t.value+'"]';default:throw Error(o(365))}}function ja(t,e){var n=[];t=[t,0];for(var i=0;i<t.length;){var r=t[i++],a=t[i++],o=e[a];if(5!==r.tag||!st(r)){for(;null!=o&&Ba(r,o);)o=e[++a];if(a===e.length)n.push(r);else for(r=r.child;null!==r;)t.push(r,a),r=r.sibling}}return n}function Va(t,e){if(!it)throw Error(o(363));t=ja(t=Fa(t),e),e=[],t=Array.from(t);for(var n=0;n<t.length;){var i=t[n++];if(5===i.tag)st(i)||e.push(i.stateNode);else for(i=i.child;null!==i;)t.push(i),i=i.sibling}return e}var Ha=Math.ceil,Ga=s.ReactCurrentDispatcher,Wa=s.ReactCurrentOwner,qa=s.ReactCurrentBatchConfig,Za=0,Xa=null,Ya=null,Ka=0,Ja=0,$a=oe(0),Qa=0,to=null,eo=0,no=0,io=0,ro=null,ao=null,oo=0,so=1/0;function lo(){so=Fe()+500}var co,uo=!1,ho=null,po=null,fo=!1,mo=null,go=0,yo=0,vo=null,_o=-1,xo=0;function bo(){return 0!==(6&Za)?Fe():-1!==_o?_o:_o=Fe()}function wo(t){return 0===(1&t.mode)?1:0!==(2&Za)&&0!==Ka?Ka&-Ka:null!==Je.transition?(0===xo&&(t=Se,0===(4194240&(Se<<=1))&&(Se=64),xo=t),xo):0!==(t=ke)?t:Q()}function So(t,e,n){if(50<yo)throw yo=0,vo=null,Error(o(185));var i=Mo(t,e);return null===i?null:(Ie(i,e,n),0!==(2&Za)&&i===Xa||(i===Xa&&(0===(2&Za)&&(no|=e),4===Qa&&Po(i,Ka)),To(i,n),1===e&&0===Za&&0===(1&t.mode)&&(lo(),Ze&&Ke())),i)}function Mo(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}function To(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-xe(a),s=1<<o,l=r[o];-1===l?0!==(s&n)&&0===(s&i)||(r[o]=Ae(s,e)):l<=e&&(t.expiredLanes|=s),a&=~s}}(t,e);var i=Ee(t,t===Xa?Ka:0);if(0===i)null!==n&&ze(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&ze(n),1===e)0===t.tag?function(t){Ze=!0,Ye(t)}(Io.bind(null,t)):Ye(Io.bind(null,t)),et?nt(function(){0===Za&&Ke()}):De(Be,Ke),n=null;else{switch(Le(i)){case 1:n=Be;break;case 4:n=Ue;break;case 16:default:n=je;break;case 536870912:n=Ve}n=Ko(n,Eo.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Eo(t,e){if(_o=-1,xo=0,0!==(6&Za))throw Error(o(327));var n=t.callbackNode;if(Ho()&&t.callbackNode!==n)return null;var i=Ee(t,t===Xa?Ka:0);if(0===i)return null;if(0!==(30&i)||0!==(i&t.expiredLanes)||e)e=Oo(t,i);else{e=i;var r=Za;Za|=2;var a=zo();for(Xa===t&&Ka===e||(lo(),Lo(t,e));;)try{Bo();break}catch(l){Do(t,l)}on(),Ga.current=a,Za=r,null!==Ya?e=0:(Xa=null,Ka=0,e=Qa)}if(0!==e){if(2===e&&(0!==(r=Ce(t))&&(i=r,e=Ao(t,r))),1===e)throw n=to,Lo(t,0),Po(t,i),To(t,Fe()),n;if(6===e)Po(t,i);else{if(r=t.current.alternate,0===(30&i)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!We(a(),r))return!1}catch(s){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)&&(2===(e=Oo(t,i))&&(0!==(a=Ce(t))&&(i=a,e=Ao(t,a))),1===e))throw n=to,Lo(t,0),Po(t,i),To(t,Fe()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(o(345));case 2:case 5:Vo(t,ao);break;case 3:if(Po(t,i),(130023424&i)===i&&10<(e=oo+500-Fe())){if(0!==Ee(t,0))break;if(((r=t.suspendedLanes)&i)!==i){bo(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=G(Vo.bind(null,t,ao),e);break}Vo(t,ao);break;case 4:if(Po(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var s=31-xe(i);a=1<<s,(s=e[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Fe()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ha(i/1960))-i)){t.timeoutHandle=G(Vo.bind(null,t,ao),i);break}Vo(t,ao);break;default:throw Error(o(329))}}}return To(t,Fe()),t.callbackNode===n?Eo.bind(null,t):null}function Ao(t,e){var n=ro;return t.current.memoizedState.isDehydrated&&(Lo(t,e).flags|=256),2!==(t=Oo(t,e))&&(e=ao,ao=n,null!==e&&Co(e)),t}function Co(t){null===ao?ao=t:ao.push.apply(ao,t)}function Po(t,e){for(e&=~io,e&=~no,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-xe(e),i=1<<n;t[n]=-1,e&=~i}}function Io(t){if(0!==(6&Za))throw Error(o(327));Ho();var e=Ee(t,0);if(0===(1&e))return To(t,Fe()),null;var n=Oo(t,e);if(0!==t.tag&&2===n){var i=Ce(t);0!==i&&(e=i,n=Ao(t,i))}if(1===n)throw n=to,Lo(t,0),Po(t,e),To(t,Fe()),n;if(6===n)throw Error(o(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Vo(t,ao),To(t,Fe()),null}function Ro(t){null!==mo&&0===mo.tag&&0===(6&Za)&&Ho();var e=Za;Za|=1;var n=qa.transition,i=ke;try{if(qa.transition=null,ke=1,t)return t()}finally{ke=i,qa.transition=n,0===(6&(Za=e))&&Ke()}}function ko(){Ja=$a.current,se($a)}function Lo(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==q&&(t.timeoutHandle=q,W(n)),null!==Ya)for(n=Ya.return;null!==n;){var i=n;switch(jn(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&me();break;case 3:pi(),se(he),se(ue),_i();break;case 5:mi(i);break;case 4:pi();break;case 13:case 19:se(gi);break;case 10:ln(i.type._context);break;case 22:case 23:ko()}n=n.return}if(Xa=t,Ya=t=ts(t.current,null),Ka=Ja=e,Qa=0,to=null,io=no=eo=0,ao=ro=null,null!==dn){for(e=0;e<dn.length;e++)if(null!==(i=(n=dn[e]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}dn=null}return t}function Do(t,e){for(;;){var n=Ya;try{if(on(),xi.current=pr,Ei){for(var i=Si.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}Ei=!1}if(wi=0,Ti=Mi=Si=null,Ai=!1,Ci=0,Wa.current=null,null===n||null===n.return){Qa=1,to=e,Ya=null;break}t:{var a=t,s=n.return,l=n,c=e;if(e=Ka,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=Ar(s);if(null!==f){f.flags&=-257,Cr(f,s,l,0,e),1&f.mode&&Er(a,u,e),c=u;var m=(e=f).updateQueue;if(null===m){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break t}if(0===(1&e)){Er(a,u,e),No();break t}c=Error(o(426))}else if(Gn&&1&l.mode){var y=Ar(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),Cr(y,s,l,0,e),ti(c);break t}}a=c,4!==Qa&&(Qa=2),null===ro?ro=[a]:ro.push(a),c=yr(c,l),l=s;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e,_n(l,Mr(0,c,e));break t;case 1:a=c;var v=l.type,_=l.stateNode;if(0===(128&l.flags)&&("function"===typeof v.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===po||!po.has(_)))){l.flags|=65536,e&=-e,l.lanes|=e,_n(l,Tr(l,a,e));break t}}l=l.return}while(null!==l)}jo(n)}catch(x){e=x,Ya===n&&null!==n&&(Ya=n=n.return);continue}break}}function zo(){var t=Ga.current;return Ga.current=pr,null===t?pr:t}function No(){0!==Qa&&3!==Qa&&2!==Qa||(Qa=4),null===Xa||0===(268435455&eo)&&0===(268435455&no)||Po(Xa,Ka)}function Oo(t,e){var n=Za;Za|=2;var i=zo();for(Xa===t&&Ka===e||Lo(t,e);;)try{Fo();break}catch(r){Do(t,r)}if(on(),Za=n,Ga.current=i,null!==Ya)throw Error(o(261));return Xa=null,Ka=0,Qa}function Fo(){for(;null!==Ya;)Uo(Ya)}function Bo(){for(;null!==Ya&&!Ne();)Uo(Ya)}function Uo(t){var e=co(t.alternate,t,Ja);t.memoizedProps=t.pendingProps,null===e?jo(t):Ya=e,Wa.current=null}function jo(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=Dr(n,e,Ja)))return void(Ya=n)}else{if(null!==(n=aa(n,e)))return n.flags&=32767,void(Ya=n);if(null===t)return Qa=6,void(Ya=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Ya=e);Ya=e=t}while(null!==e);0===Qa&&(Qa=5)}function Vo(t,e){var n=ke,i=qa.transition;try{qa.transition=null,ke=1,function(t,e,n){do{Ho()}while(null!==mo);if(0!==(6&Za))throw Error(o(327));var i=t.finishedWork,r=t.finishedLanes;if(null===i)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(o(177));t.callbackNode=null,t.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-xe(n),a=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~a}}(t,a),t===Xa&&(Ya=Xa=null,Ka=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||fo||(fo=!0,Ko(je,function(){return Ho(),null})),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=qa.transition,qa.transition=null;var s=ke;ke=1;var l=Za;Za|=4,Wa.current=null,function(t,e){for(N(t.containerInfo),ca=e;null!==ca;)if(e=(t=ca).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,ca=e;else for(;null!==ca;){t=ca;try{var n=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var i=n.memoizedProps,r=n.memoizedState,a=t.stateNode,s=a.getSnapshotBeforeUpdate(t.elementType===t.type?i:tn(t.type,i),r);a.__reactInternalSnapshotBeforeUpdate=s}break;case 3:X&&Tt(t.stateNode.containerInfo);break;default:throw Error(o(163))}}catch(l){Wo(t,t.return,l)}if(null!==(e=t.sibling)){e.return=t.return,ca=e;break}ca=t.return}n=da,da=!1}(t,i),function(t,e){for(ca=e;null!==ca;){var n=(e=ca).deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=t;X?Ma(a,r,e):ya(a,r,e);var o=r.alternate;null!==o&&(o.return=null),r.return=null}catch(b){Wo(r,e,b)}}if(n=e.child,0!==(12854&e.subtreeFlags)&&null!==n)n.return=e,ca=n;else for(;null!==ca;){e=ca;try{var s=e.flags;if(32&s&&X&&xt(e.stateNode),512&s){var l=e.alternate;if(null!==l){var c=l.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&s)switch(e.tag){case 13:if(null!==e.memoizedState){var u=e.alternate;null!==u&&null!==u.memoizedState||(oo=Fe())}break;case 22:var h=null!==e.memoizedState,d=e.alternate,p=null!==d&&null!==d.memoizedState;if(n=e,X)t:if(i=n,r=h,a=null,X)for(var f=i;;){if(5===f.tag){if(null===a){a=f;var m=f.stateNode;r?bt(m):St(f.stateNode,f.memoizedProps)}}else if(6===f.tag){if(null===a){var g=f.stateNode;r?wt(g):Mt(g,f.memoizedProps)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===i)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===i)break;for(;null===f.sibling;){if(null===f.return||f.return===i)break t;a===f&&(a=null),f=f.return}a===f&&(a=null),f.sibling.return=f.return,f=f.sibling}if(h&&!p&&0!==(1&n.mode)){ca=n;for(var y=n.child;null!==y;){for(n=ca=y;null!==ca;){var v=(i=ca).child;switch(i.tag){case 0:case 11:case 14:case 15:pa(4,i,i.return);break;case 1:ua(i,i.return);var _=i.stateNode;if("function"===typeof _.componentWillUnmount){var x=i.return;try{_.props=i.memoizedProps,_.state=i.memoizedState,_.componentWillUnmount()}catch(b){Wo(i,x,b)}}break;case 5:ua(i,i.return);break;case 22:if(null!==i.memoizedState){Ia(n);continue}}null!==v?(v.return=i,ca=v):Ia(n)}y=y.sibling}}}switch(4102&s){case 2:ba(e),e.flags&=-3;break;case 6:ba(e),e.flags&=-3,Ta(e.alternate,e);break;case 4096:e.flags&=-4097;break;case 4100:e.flags&=-4097,Ta(e.alternate,e);break;case 4:Ta(e.alternate,e)}}catch(b){Wo(e,e.return,b)}if(null!==(n=e.sibling)){n.return=e.return,ca=n;break}ca=e.return}}}(t,i),O(t.containerInfo),t.current=i,Aa(i,t,r),Oe(),Za=l,ke=s,qa.transition=a}else t.current=i;if(fo&&(fo=!1,mo=t,go=r),a=t.pendingLanes,0===a&&(po=null),function(t){if(Ge&&"function"===typeof Ge.onCommitFiberRoot)try{Ge.onCommitFiberRoot(He,t,void 0,128===(128&t.current.flags))}catch(e){}}(i.stateNode),To(t,Fe()),null!==e)for(n=t.onRecoverableError,i=0;i<e.length;i++)n(e[i]);if(uo)throw uo=!1,t=ho,ho=null,t;0!==(1&go)&&0!==t.tag&&Ho(),a=t.pendingLanes,0!==(1&a)?t===vo?yo++:(yo=0,vo=t):yo=0,Ke()}(t,e,n)}finally{qa.transition=i,ke=n}return null}function Ho(){if(null!==mo){var t=Le(go),e=qa.transition,n=ke;try{if(qa.transition=null,ke=16>t?16:t,null===mo)var i=!1;else{if(t=mo,mo=null,go=0,0!==(6&Za))throw Error(o(331));var r=Za;for(Za|=4,ca=t.current;null!==ca;){var a=ca,s=a.child;if(0!==(16&ca.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(ca=u;null!==ca;){var h=ca;switch(h.tag){case 0:case 11:case 15:pa(8,h,a)}var d=h.child;if(null!==d)d.return=h,ca=d;else for(;null!==ca;){var p=(h=ca).sibling,f=h.return;if(va(h),h===u){ca=null;break}if(null!==p){p.return=f,ca=p;break}ca=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}ca=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,ca=s;else t:for(;null!==ca;){if(0!==(2048&(a=ca).flags))switch(a.tag){case 0:case 11:case 15:pa(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,ca=v;break t}ca=a.return}}var _=t.current;for(ca=_;null!==ca;){var x=(s=ca).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,ca=x;else t:for(s=_;null!==ca;){if(0!==(2048&(l=ca).flags))try{switch(l.tag){case 0:case 11:case 15:fa(9,l)}}catch(w){Wo(l,l.return,w)}if(l===s){ca=null;break t}var b=l.sibling;if(null!==b){b.return=l.return,ca=b;break t}ca=l.return}}if(Za=r,Ke(),Ge&&"function"===typeof Ge.onPostCommitFiberRoot)try{Ge.onPostCommitFiberRoot(He,t)}catch(w){}i=!0}return i}finally{ke=n,qa.transition=e}}return!1}function Go(t,e,n){yn(t,e=Mr(0,e=yr(n,e),1)),e=bo(),null!==(t=Mo(t,1))&&(Ie(t,1,e),To(t,e))}function Wo(t,e,n){if(3===t.tag)Go(t,t,n);else for(;null!==e;){if(3===e.tag){Go(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===po||!po.has(i))){yn(e,t=Tr(e,t=yr(n,t),1)),t=bo(),null!==(e=Mo(e,1))&&(Ie(e,1,t),To(e,t));break}}e=e.return}}function qo(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=bo(),t.pingedLanes|=t.suspendedLanes&n,Xa===t&&(Ka&n)===n&&(4===Qa||3===Qa&&(130023424&Ka)===Ka&&500>Fe()-oo?Lo(t,0):io|=n),To(t,e)}function Zo(t,e){0===e&&(0===(1&t.mode)?e=1:(e=Me,0===(130023424&(Me<<=1))&&(Me=4194304)));var n=bo();null!==(t=Mo(t,e))&&(Ie(t,e,n),To(t,n))}function Xo(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Zo(t,n)}function Yo(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(e),Zo(t,n)}function Ko(t,e){return De(t,e)}function Jo(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $o(t,e,n,i){return new Jo(t,e,n,i)}function Qo(t){return!(!(t=t.prototype)||!t.isReactComponent)}function ts(t,e){var n=t.alternate;return null===n?((n=$o(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function es(t,e,n,i,r,a){var s=2;if(i=t,"function"===typeof t)Qo(t)&&(s=1);else if("string"===typeof t)s=5;else t:switch(t){case u:return ns(n.children,r,a,e);case h:s=8,r|=8;break;case d:return(t=$o(12,n,e,2|r)).elementType=d,t.lanes=a,t;case g:return(t=$o(13,n,e,r)).elementType=g,t.lanes=a,t;case y:return(t=$o(19,n,e,r)).elementType=y,t.lanes=a,t;case x:return is(n,r,a,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case p:s=10;break t;case f:s=9;break t;case m:s=11;break t;case v:s=14;break t;case _:s=16,i=null;break t}throw Error(o(130,null==t?t:typeof t,""))}return(e=$o(s,n,e,r)).elementType=t,e.type=i,e.lanes=a,e}function ns(t,e,n,i){return(t=$o(7,t,i,e)).lanes=n,t}function is(t,e,n,i){return(t=$o(22,t,i,e)).elementType=x,t.lanes=n,t.stateNode={},t}function rs(t,e,n){return(t=$o(6,t,null,e)).lanes=n,t}function as(t,e,n){return(e=$o(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function os(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=q,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pe(0),this.expirationTimes=Pe(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pe(0),this.identifierPrefix=i,this.onRecoverableError=r,K&&(this.mutableSourceEagerHydrationData=null)}function ss(t,e,n,i,r,a,o,s,l){return t=new os(t,e,n,s,l),1===e?(e=1,!0===a&&(e|=8)):e=0,a=$o(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null},fn(a),t}function ls(t){if(!t)return ce;t:{if(T(t=t._reactInternals)!==t||1!==t.tag)throw Error(o(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(fe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(o(171))}if(1===t.tag){var n=t.type;if(fe(n))return ye(t,n,e)}return e}function cs(t){var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(o(188));throw t=Object.keys(t).join(","),Error(o(268,t))}return null===(t=C(e))?null:t.stateNode}function us(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function hs(t,e){us(t,e),(t=t.alternate)&&us(t,e)}function ds(t){return null===(t=C(t))?null:t.stateNode}function ps(){return null}return co=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||he.current)Nr=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return Nr=!1,function(t,e,n){switch(e.tag){case 3:qr(e),Qn();break;case 5:fi(e);break;case 1:fe(e.type)&&ve(e);break;case 4:di(e,e.stateNode.containerInfo);break;case 10:sn(0,e.type._context,e.memoizedProps.value);break;case 13:var i=e.memoizedState;if(null!==i)return null!==i.dehydrated?(le(gi,1&gi.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Kr(t,e,n):(le(gi,1&gi.current),null!==(t=ra(t,e,n))?t.sibling:null);le(gi,1&gi.current);break;case 19:if(i=0!==(n&e.childLanes),0!==(128&t.flags)){if(i)return ia(t,e,n);e.flags|=128}var r=e.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),le(gi,gi.current),i)break;return null;case 22:case 23:return e.lanes=0,jr(t,e,n)}return ra(t,e,n)}(t,e,n);Nr=0!==(131072&t.flags)}else Nr=!1,Gn&&0!==(1048576&e.flags)&&Bn(e,kn,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps;var r=pe(e,ue.current);un(e,n),r=ki(null,e,i,t,r,n);var a=Li();return e.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,fe(i)?(a=!0,ve(e)):a=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,fn(e),r.updater=Mn,e.stateNode=r,r._reactInternals=e,Cn(e,i,t,n),e=Wr(null,e,i,!0,a,n)):(e.tag=0,Gn&&a&&Un(e),Or(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"===typeof t)return Qo(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===m)return 11;if(t===v)return 14}return 2}(i),t=tn(i,t),r){case 0:e=Hr(null,e,i,t,n);break t;case 1:e=Gr(null,e,i,t,n);break t;case 11:e=Fr(null,e,i,t,n);break t;case 14:e=Br(null,e,i,tn(i.type,t),n);break t}throw Error(o(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,Hr(t,e,i,r=e.elementType===i?r:tn(i,r),n);case 1:return i=e.type,r=e.pendingProps,Gr(t,e,i,r=e.elementType===i?r:tn(i,r),n);case 3:t:{if(qr(e),null===t)throw Error(o(387));i=e.pendingProps,r=(a=e.memoizedState).element,mn(t,e),xn(e,i,null,n);var s=e.memoizedState;if(i=s.element,K&&a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,transitions:s.transitions},e.updateQueue.baseState=a,e.memoizedState=a,256&e.flags){e=Zr(t,e,i,n,r=Error(o(423)));break t}if(i!==r){e=Zr(t,e,i,n,r=Error(o(424)));break t}for(K&&(Hn=jt(e.stateNode.containerInfo),Vn=e,Gn=!0,qn=null,Wn=!1),n=oi(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Qn(),i===r){e=ra(t,e,n);break t}Or(t,e,i,n)}e=e.child}return e;case 5:return fi(e),null===t&&Kn(e),i=e.type,r=e.pendingProps,a=null!==t?t.memoizedProps:null,s=r.children,V(i,r)?s=null:null!==a&&V(i,a)&&(e.flags|=32),Vr(t,e),Or(t,e,s,n),e.child;case 6:return null===t&&Kn(e),null;case 13:return Kr(t,e,n);case 4:return di(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=ai(e,null,i,n):Or(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,Fr(t,e,i,r=e.elementType===i?r:tn(i,r),n);case 7:return Or(t,e,e.pendingProps,n),e.child;case 8:case 12:return Or(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,a=e.memoizedProps,sn(0,i,s=r.value),null!==a)if(We(a.value,s)){if(a.children===r.children&&!he.current){e=ra(t,e,n);break t}}else for(null!==(a=e.child)&&(a.return=e);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===a.tag){(c=gn(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),cn(a.return,n,e),l.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===e.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),cn(s,n,e),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===e){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}Or(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,un(e,n),i=i(r=hn(r)),e.flags|=1,Or(t,e,i,n),e.child;case 14:return r=tn(i=e.type,e.pendingProps),Br(t,e,i,r=tn(i.type,r),n);case 15:return Ur(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:tn(i,r),null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,fe(i)?(t=!0,ve(e)):t=!1,un(e,n),En(e,i,r),Cn(e,i,r,n),Wr(null,e,i,!0,t,n);case 19:return ia(t,e,n);case 22:return jr(t,e,n)}throw Error(o(156,e.tag))},e.attemptContinuousHydration=function(t){13===t.tag&&(So(t,134217728,bo()),hs(t,134217728))},e.attemptHydrationAtCurrentPriority=function(t){if(13===t.tag){var e=bo(),n=wo(t);So(t,n,e),hs(t,n)}},e.attemptSynchronousHydration=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Te(e.pendingLanes);0!==n&&(Re(e,1|n),To(e,Fe()),0===(6&Za)&&(lo(),Ke()))}break;case 13:var i=bo();Ro(function(){return So(t,1,i)}),hs(t,1)}},e.batchedUpdates=function(t,e){var n=Za;Za|=1;try{return t(e)}finally{0===(Za=n)&&(lo(),Ze&&Ke())}},e.createComponentSelector=function(t){return{$$typeof:ka,value:t}},e.createContainer=function(t,e,n,i,r,a,o){return ss(t,e,!1,null,0,i,0,a,o)},e.createHasPseudoClassSelector=function(t){return{$$typeof:La,value:t}},e.createHydrationContainer=function(t,e,n,i,r,a,o,s,l){return(t=ss(n,i,!0,t,0,a,0,s,l)).context=ls(null),n=t.current,(a=gn(i=bo(),r=wo(n))).callback=void 0!==e&&null!==e?e:null,yn(n,a),t.current.lanes=r,Ie(t,r,i),To(t,i),t},e.createPortal=function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}},e.createRoleSelector=function(t){return{$$typeof:Da,value:t}},e.createTestNameSelector=function(t){return{$$typeof:za,value:t}},e.createTextSelector=function(t){return{$$typeof:Na,value:t}},e.deferredUpdates=function(t){var e=ke,n=qa.transition;try{return qa.transition=null,ke=16,t()}finally{ke=e,qa.transition=n}},e.discreteUpdates=function(t,e,n,i,r){var a=ke,o=qa.transition;try{return qa.transition=null,ke=1,t(e,n,i,r)}finally{ke=a,qa.transition=o,0===Za&&lo()}},e.findAllNodes=Va,e.findBoundingRects=function(t,e){if(!it)throw Error(o(363));e=Va(t,e),t=[];for(var n=0;n<e.length;n++)t.push(at(e[n]));for(e=t.length-1;0<e;e--)for(var i=(n=t[e]).x,r=i+n.width,a=n.y,s=a+n.height,l=e-1;0<=l;l--)if(e!==l){var c=t[l],u=c.x,h=u+c.width,d=c.y,p=d+c.height;if(i>=u&&a>=d&&r<=h&&s<=p){t.splice(e,1);break}if(!(i!==u||n.width!==c.width||p<a||d>s)){d>a&&(c.height+=d-a,c.y=a),p<s&&(c.height=s-d),t.splice(e,1);break}if(!(a!==d||n.height!==c.height||h<i||u>r)){u>i&&(c.width+=u-i,c.x=i),h<r&&(c.width=r-u),t.splice(e,1);break}}return t},e.findHostInstance=cs,e.findHostInstanceWithNoPortals=function(t){return null===(t=null!==(t=A(t))?I(t):null)?null:t.stateNode},e.findHostInstanceWithWarning=function(t){return cs(t)},e.flushControlled=function(t){var e=Za;Za|=1;var n=qa.transition,i=ke;try{qa.transition=null,ke=1,t()}finally{ke=i,qa.transition=n,0===(Za=e)&&(lo(),Ke())}},e.flushPassiveEffects=Ho,e.flushSync=Ro,e.focusWithin=function(t,e){if(!it)throw Error(o(363));for(e=ja(t=Fa(t),e),e=Array.from(e),t=0;t<e.length;){var n=e[t++];if(!st(n)){if(5===n.tag&&ct(n.stateNode))return!0;for(n=n.child;null!==n;)e.push(n),n=n.sibling}}return!1},e.getCurrentUpdatePriority=function(){return ke},e.getFindAllNodesFailureDescription=function(t,e){if(!it)throw Error(o(363));var n=0,i=[];t=[Fa(t),0];for(var r=0;r<t.length;){var a=t[r++],s=t[r++],l=e[s];if((5!==a.tag||!st(a))&&(Ba(a,l)&&(i.push(Ua(l)),++s>n&&(n=s)),s<e.length))for(a=a.child;null!==a;)t.push(a,s),a=a.sibling}if(n<e.length){for(t=[];n<e.length;n++)t.push(Ua(e[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+t.join(" > ")}return null},e.getPublicRootInstance=function(t){return(t=t.current).child?5===t.child.tag?L(t.child.stateNode):t.child.stateNode:null},e.injectIntoDevTools=function(t){if(t={bundleType:t.bundleType,version:t.version,rendererPackageName:t.rendererPackageName,rendererConfig:t.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:ds,findFiberByHostInstance:t.findFiberByHostInstance||ps,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)t=!1;else{var e=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(e.isDisabled||!e.supportsFiber)t=!0;else{try{He=e.inject(t),Ge=e}catch(n){}t=!!e.checkDCE}}return t},e.isAlreadyRendering=function(){return!1},e.observeVisibleRects=function(t,e,n,i){if(!it)throw Error(o(363));t=Va(t,e);var r=ut(t,n,i).disconnect;return{disconnect:function(){r()}}},e.registerMutableSourceForHydration=function(t,e){var n=e._getVersion;n=n(e._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[e,n]:t.mutableSourceEagerHydrationData.push(e,n)},e.runWithPriority=function(t,e){var n=ke;try{return ke=t,e()}finally{ke=n}},e.shouldError=function(){return null},e.shouldSuspend=function(){return!1},e.updateContainer=function(t,e,n,i){var r=e.current,a=bo(),o=wo(r);return n=ls(n),null===e.context?e.context=n:e.pendingContext=n,(e=gn(a,o)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),yn(r,e),null!==(t=So(r,o,a))&&vn(t,r,o),o},e}},654:(t,e,n)=>{"use strict";var i=n(950),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(t,e,n){var i,a={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(u=e.ref),e)o.call(e,i)&&!l.hasOwnProperty(i)&&(a[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps)void 0===a[i]&&(a[i]=e[i]);return{$$typeof:r,type:t,key:c,ref:u,props:a,_owner:s.current}}e.Fragment=a,e.jsx=c,e.jsxs=c},693:(t,e,n)=>{var i=n(736);t.exports=function(t,e,n){return(e=i(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.__esModule=!0,t.exports.default=t.exports},736:(t,e,n)=>{var i=n(738).default,r=n(45);t.exports=function(t){var e=r(t,"string");return"symbol"==i(e)?e:e+""},t.exports.__esModule=!0,t.exports.default=t.exports},738:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},761:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<a(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=t[s],c=s+1,u=t[c];if(0>a(l,n))c<r&&0>a(u,l)?(t[i]=u,t[c]=n,i=c):(t[i]=l,t[s]=n,i=s);else{if(!(c<r&&0>a(u,n)))break t;t[i]=u,t[c]=n,i=c}}}return e}function a(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function x(t){for(var e=i(u);null!==e;){if(null===e.callback)r(u);else{if(!(e.startTime<=t))break;r(u),e.sortIndex=e.expirationTime,n(c,e)}e=i(u)}}function b(t){if(g=!1,x(t),!m)if(null!==i(c))m=!0,L(w);else{var e=i(u);null!==e&&D(b,e.startTime-t)}}function w(t,n){m=!1,g&&(g=!1,v(E),E=-1),f=!0;var a=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||t&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?d.callback=s:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(b,h.startTime-n),l=!1}return l}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,E=-1,A=5,C=-1;function P(){return!(e.unstable_now()-C<A)}function I(){if(null!==T){var t=e.unstable_now();C=t;var n=!0;try{n=T(!0,t)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(I)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,k=R.port2;R.port1.onmessage=I,S=function(){k.postMessage(null)}}else S=function(){y(I,0)};function L(t){T=t,M||(M=!0,S())}function D(t,n){E=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,L(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return i(c)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,r,a){var o=e.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,t){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(t.sortIndex=a,n(u,t),null===i(c)&&t===i(u)&&(g?(v(E),E=-1):g=!0,D(b,a-o))):(t.sortIndex=s,n(c,t),m||f||(m=!0,L(w))),t},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},878:(t,e,n)=>{"use strict";t.exports=n(153)},897:(t,e,n)=>{var i=n(693);function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}t.exports=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){i(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t},t.exports.__esModule=!0,t.exports.default=t.exports},950:(t,e,n)=>{"use strict";t.exports=n(49)},969:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<a(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,o=r>>>1;i<o;){var s=2*(i+1)-1,l=t[s],c=s+1,u=t[c];if(0>a(l,n))c<r&&0>a(u,l)?(t[i]=u,t[c]=n,i=c):(t[i]=l,t[s]=n,i=s);else{if(!(c<r&&0>a(u,n)))break t;t[i]=u,t[c]=n,i=c}}}return e}function a(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();e.unstable_now=function(){return s.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function x(t){for(var e=i(u);null!==e;){if(null===e.callback)r(u);else{if(!(e.startTime<=t))break;r(u),e.sortIndex=e.expirationTime,n(c,e)}e=i(u)}}function b(t){if(g=!1,x(t),!m)if(null!==i(c))m=!0,L(w);else{var e=i(u);null!==e&&D(b,e.startTime-t)}}function w(t,n){m=!1,g&&(g=!1,v(E),E=-1),f=!0;var a=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||t&&!P());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?d.callback=s:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&D(b,h.startTime-n),l=!1}return l}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,T=null,E=-1,A=5,C=-1;function P(){return!(e.unstable_now()-C<A)}function I(){if(null!==T){var t=e.unstable_now();C=t;var n=!0;try{n=T(!0,t)}finally{n?S():(M=!1,T=null)}}else M=!1}if("function"===typeof _)S=function(){_(I)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,k=R.port2;R.port1.onmessage=I,S=function(){k.postMessage(null)}}else S=function(){y(I,0)};function L(t){T=t,M||(M=!0,S())}function D(t,n){E=y(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,L(w))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return i(c)},e.unstable_next=function(t){switch(p){case 1:case 2:case 3:var e=3;break;default:e=p}var n=p;p=e;try{return t()}finally{p=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=p;p=t;try{return e()}finally{p=n}},e.unstable_scheduleCallback=function(t,r,a){var o=e.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,t){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(t.sortIndex=a,n(u,t),null===i(c)&&t===i(u)&&(g?(v(E),E=-1):g=!0,D(b,a-o))):(t.sortIndex=s,n(c,t),m||f||(m=!0,L(w))),t},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(t){var e=p;return function(){var n=p;p=e;try{return t.apply(this,arguments)}finally{p=n}}}},981:t=>{"use strict";var e,n="object"===typeof Reflect?Reflect:null,i=n&&"function"===typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var r=Number.isNaN||function(t){return t!==t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise(function(n,i){function r(n){t.removeListener(e,a),i(n)}function a(){"function"===typeof t.removeListener&&t.removeListener("error",r),n([].slice.call(arguments))}m(t,e,a,{once:!0}),"error"!==e&&function(t,e,n){"function"===typeof t.on&&m(t,"error",e,n)}(t,r,{once:!0})})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function c(t,e,n,i){var r,a,o,c;if(s(n),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),o=a[e]),void 0===o)o=a[e]=n,++t._eventsCount;else if("function"===typeof o?o=a[e]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=l(t))>0&&o.length>r&&!o.warned){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=o.length,c=u,console&&console.warn&&console.warn(c)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=u.bind(i);return r.listener=n,i.wrapFn=r,r}function d(t,e,n){var i=t._events;if(void 0===i)return[];var r=i[e];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):f(r,r.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function m(t,e,n,i){if("function"===typeof t.on)i.once?t.once(e,n):t.on(e,n);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function r(a){i.once&&t.removeEventListener(e,r),n(a)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!==typeof t||t<0||r(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||r(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=a[t];if(void 0===l)return!1;if("function"===typeof l)i(l,this,e);else{var c=l.length,u=f(l,c);for(n=0;n<c;++n)i(u[n],this,e)}return!0},a.prototype.addListener=function(t,e){return c(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return c(this,t,e,!0)},a.prototype.once=function(t,e){return s(e),this.on(t,h(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,h(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,i,r,a,o;if(s(e),void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0===--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!==typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,r),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,o||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},a.prototype.listeners=function(t){return d(this,t,!0)},a.prototype.rawListeners=function(t){return d(this,t,!1)},a.listenerCount=function(t,e){return"function"===typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var a=Object.create(null);n.r(a);var o={};t=t||[null,e({}),e([]),e(e)];for(var s=2&r&&i;("object"==typeof s||"function"==typeof s)&&!~t.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach(t=>o[t]=()=>i[t]);return o.default=()=>i,n.d(a,o),a}})(),n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};n.r(t),n.d(t,{ACESFilmicToneMapping:()=>ec,AddEquation:()=>xl,AddOperation:()=>Kl,AdditiveAnimationBlendMode:()=>Fu,AdditiveBlending:()=>gl,AgXToneMapping:()=>ic,AlphaFormat:()=>Bc,AlwaysCompare:()=>wh,AlwaysDepth:()=>jl,AlwaysStencilFunc:()=>fh,AmbientLight:()=>j_,AnimationAction:()=>kx,AnimationClip:()=>c_,AnimationLoader:()=>v_,AnimationMixer:()=>Dx,AnimationObjectGroup:()=>Rx,AnimationUtils:()=>Kv,ArcCurve:()=>xy,ArrayCamera:()=>lx,ArrowHelper:()=>zb,AttachedBindMode:()=>ac,Audio:()=>gx,AudioAnalyser:()=>wx,AudioContext:()=>nx,AudioListener:()=>mx,AudioLoader:()=>ix,AxesHelper:()=>Nb,BackSide:()=>dl,BasicDepthPacking:()=>Vu,BasicShadowMap:()=>sl,BatchedMesh:()=>Ig,Bone:()=>jm,BooleanKeyframeTrack:()=>n_,Box2:()=>Jx,Box3:()=>kd,Box3Helper:()=>Ib,BoxGeometry:()=>Vf,BoxHelper:()=>Pb,BufferAttribute:()=>hf,BufferGeometry:()=>Cf,BufferGeometryLoader:()=>X_,ByteType:()=>Ac,Cache:()=>h_,Camera:()=>Xf,CameraHelper:()=>Eb,CanvasTexture:()=>ry,CapsuleGeometry:()=>sy,CatmullRomCurve3:()=>Ey,CineonToneMapping:()=>tc,CircleGeometry:()=>ly,ClampToEdgeWrapping:()=>fc,Clock:()=>cx,Color:()=>Jp,ColorKeyframeTrack:()=>i_,ColorManagement:()=>fd,CompressedArrayTexture:()=>ny,CompressedCubeTexture:()=>iy,CompressedTexture:()=>ey,CompressedTextureLoader:()=>__,ConeGeometry:()=>uy,ConstantAlphaFactor:()=>Fl,ConstantColorFactor:()=>Nl,Controls:()=>Fb,CubeCamera:()=>tm,CubeReflectionMapping:()=>lc,CubeRefractionMapping:()=>cc,CubeTexture:()=>em,CubeTextureLoader:()=>w_,CubeUVReflectionMapping:()=>dc,CubicBezierCurve:()=>Iy,CubicBezierCurve3:()=>Ry,CubicInterpolant:()=>$v,CullFaceBack:()=>rl,CullFaceFront:()=>al,CullFaceFrontBack:()=>ol,CullFaceNone:()=>il,Curve:()=>vy,CurvePath:()=>Fy,CustomBlending:()=>_l,CustomToneMapping:()=>nc,CylinderGeometry:()=>cy,Cylindrical:()=>Xx,Data3DTexture:()=>Id,DataArrayTexture:()=>Cd,DataTexture:()=>Vm,DataTextureLoader:()=>S_,DataUtils:()=>sf,DecrementStencilOp:()=>ih,DecrementWrapStencilOp:()=>ah,DefaultLoadingManager:()=>p_,DepthFormat:()=>Vc,DepthStencilFormat:()=>Hc,DepthTexture:()=>ay,DetachedBindMode:()=>oc,DirectionalLight:()=>U_,DirectionalLightHelper:()=>Sb,DiscreteInterpolant:()=>t_,DodecahedronGeometry:()=>dy,DoubleSide:()=>pl,DstAlphaFactor:()=>Rl,DstColorFactor:()=>Ll,DynamicCopyUsage:()=>Ih,DynamicDrawUsage:()=>Mh,DynamicReadUsage:()=>Ah,EdgesGeometry:()=>yy,EllipseCurve:()=>_y,EqualCompare:()=>yh,EqualDepth:()=>Gl,EqualStencilFunc:()=>ch,EquirectangularReflectionMapping:()=>uc,EquirectangularRefractionMapping:()=>hc,Euler:()=>mp,EventDispatcher:()=>Bh,ExternalTexture:()=>oy,ExtrudeGeometry:()=>yv,FileLoader:()=>y_,Float16BufferAttribute:()=>_f,Float32BufferAttribute:()=>xf,FloatType:()=>kc,Fog:()=>sm,FogExp2:()=>om,FramebufferTexture:()=>ty,FrontSide:()=>hl,Frustum:()=>lg,FrustumArray:()=>hg,GLBufferAttribute:()=>Ux,GLSL1:()=>kh,GLSL3:()=>Lh,GreaterCompare:()=>_h,GreaterDepth:()=>ql,GreaterEqualCompare:()=>bh,GreaterEqualDepth:()=>Wl,GreaterEqualStencilFunc:()=>ph,GreaterStencilFunc:()=>hh,GridHelper:()=>vb,Group:()=>im,HalfFloatType:()=>Lc,HemisphereLight:()=>E_,HemisphereLightHelper:()=>yb,IcosahedronGeometry:()=>_v,ImageBitmapLoader:()=>tx,ImageLoader:()=>b_,ImageUtils:()=>vd,IncrementStencilOp:()=>nh,IncrementWrapStencilOp:()=>rh,InstancedBufferAttribute:()=>qm,InstancedBufferGeometry:()=>Z_,InstancedInterleavedBuffer:()=>Bx,InstancedMesh:()=>tg,Int16BufferAttribute:()=>mf,Int32BufferAttribute:()=>yf,Int8BufferAttribute:()=>df,IntType:()=>Ic,InterleavedBuffer:()=>cm,InterleavedBufferAttribute:()=>hm,Interpolant:()=>Jv,InterpolateDiscrete:()=>Ru,InterpolateLinear:()=>ku,InterpolateSmooth:()=>Lu,InterpolationSamplingMode:()=>Fh,InterpolationSamplingType:()=>Oh,InvertStencilOp:()=>oh,KeepStencilOp:()=>th,KeyframeTrack:()=>e_,LOD:()=>Im,LatheGeometry:()=>xv,Layers:()=>gp,LessCompare:()=>gh,LessDepth:()=>Vl,LessEqualCompare:()=>vh,LessEqualDepth:()=>Hl,LessEqualStencilFunc:()=>uh,LessStencilFunc:()=>lh,Light:()=>T_,LightProbe:()=>G_,Line:()=>Bg,Line3:()=>ab,LineBasicMaterial:()=>Rg,LineCurve:()=>ky,LineCurve3:()=>Ly,LineDashedMaterial:()=>Gv,LineLoop:()=>Gg,LineSegments:()=>Hg,LinearFilter:()=>bc,LinearInterpolant:()=>Qv,LinearMipMapLinearFilter:()=>Tc,LinearMipMapNearestFilter:()=>Sc,LinearMipmapLinearFilter:()=>Mc,LinearMipmapNearestFilter:()=>wc,LinearSRGBColorSpace:()=>Ku,LinearToneMapping:()=>$l,LinearTransfer:()=>Ju,Loader:()=>f_,LoaderUtils:()=>q_,LoadingManager:()=>d_,LoopOnce:()=>Cu,LoopPingPong:()=>Iu,LoopRepeat:()=>Pu,MOUSE:()=>el,Material:()=>tf,MaterialLoader:()=>W_,MathUtils:()=>Kh,Matrix2:()=>Yx,Matrix3:()=>nd,Matrix4:()=>ap,MaxEquation:()=>Ml,Mesh:()=>Uf,MeshBasicMaterial:()=>ef,MeshDepthMaterial:()=>jv,MeshDistanceMaterial:()=>Vv,MeshLambertMaterial:()=>Uv,MeshMatcapMaterial:()=>Hv,MeshNormalMaterial:()=>Bv,MeshPhongMaterial:()=>Ov,MeshPhysicalMaterial:()=>Nv,MeshStandardMaterial:()=>zv,MeshToonMaterial:()=>Fv,MinEquation:()=>Sl,MirroredRepeatWrapping:()=>mc,MixOperation:()=>Yl,MultiplyBlending:()=>vl,MultiplyOperation:()=>Xl,NearestFilter:()=>gc,NearestMipMapLinearFilter:()=>xc,NearestMipMapNearestFilter:()=>vc,NearestMipmapLinearFilter:()=>_c,NearestMipmapNearestFilter:()=>yc,NeutralToneMapping:()=>rc,NeverCompare:()=>mh,NeverDepth:()=>Ul,NeverStencilFunc:()=>sh,NoBlending:()=>fl,NoColorSpace:()=>Xu,NoToneMapping:()=>Jl,NormalAnimationBlendMode:()=>Ou,NormalBlending:()=>ml,NotEqualCompare:()=>xh,NotEqualDepth:()=>Zl,NotEqualStencilFunc:()=>dh,NumberKeyframeTrack:()=>r_,Object3D:()=>kp,ObjectLoader:()=>Y_,ObjectSpaceNormalMap:()=>Zu,OctahedronGeometry:()=>bv,OneFactor:()=>El,OneMinusConstantAlphaFactor:()=>Bl,OneMinusConstantColorFactor:()=>Ol,OneMinusDstAlphaFactor:()=>kl,OneMinusDstColorFactor:()=>Dl,OneMinusSrcAlphaFactor:()=>Il,OneMinusSrcColorFactor:()=>Cl,OrthographicCamera:()=>F_,PCFShadowMap:()=>ll,PCFSoftShadowMap:()=>cl,PMREMGenerator:()=>pw,Path:()=>By,PerspectiveCamera:()=>$f,Plane:()=>rg,PlaneGeometry:()=>wv,PlaneHelper:()=>Rb,PointLight:()=>O_,PointLightHelper:()=>pb,Points:()=>Kg,PointsMaterial:()=>Wg,PolarGridHelper:()=>_b,PolyhedronGeometry:()=>hy,PositionalAudio:()=>bx,PropertyBinding:()=>Ix,PropertyMixer:()=>Sx,QuadraticBezierCurve:()=>Dy,QuadraticBezierCurve3:()=>zy,Quaternion:()=>$h,QuaternionKeyframeTrack:()=>o_,QuaternionLinearInterpolant:()=>a_,RED_GREEN_RGTC2_Format:()=>Eu,RED_RGTC1_Format:()=>Mu,REVISION:()=>tl,RGBADepthPacking:()=>Hu,RGBAFormat:()=>jc,RGBAIntegerFormat:()=>Yc,RGBA_ASTC_10x10_Format:()=>vu,RGBA_ASTC_10x5_Format:()=>mu,RGBA_ASTC_10x6_Format:()=>gu,RGBA_ASTC_10x8_Format:()=>yu,RGBA_ASTC_12x10_Format:()=>_u,RGBA_ASTC_12x12_Format:()=>xu,RGBA_ASTC_4x4_Format:()=>su,RGBA_ASTC_5x4_Format:()=>lu,RGBA_ASTC_5x5_Format:()=>cu,RGBA_ASTC_6x5_Format:()=>uu,RGBA_ASTC_6x6_Format:()=>hu,RGBA_ASTC_8x5_Format:()=>du,RGBA_ASTC_8x6_Format:()=>pu,RGBA_ASTC_8x8_Format:()=>fu,RGBA_BPTC_Format:()=>bu,RGBA_ETC2_EAC_Format:()=>ou,RGBA_PVRTC_2BPPV1_Format:()=>iu,RGBA_PVRTC_4BPPV1_Format:()=>nu,RGBA_S3TC_DXT1_Format:()=>Jc,RGBA_S3TC_DXT3_Format:()=>$c,RGBA_S3TC_DXT5_Format:()=>Qc,RGBDepthPacking:()=>Gu,RGBFormat:()=>Uc,RGBIntegerFormat:()=>Xc,RGB_BPTC_SIGNED_Format:()=>wu,RGB_BPTC_UNSIGNED_Format:()=>Su,RGB_ETC1_Format:()=>ru,RGB_ETC2_Format:()=>au,RGB_PVRTC_2BPPV1_Format:()=>eu,RGB_PVRTC_4BPPV1_Format:()=>tu,RGB_S3TC_DXT1_Format:()=>Kc,RGDepthPacking:()=>Wu,RGFormat:()=>qc,RGIntegerFormat:()=>Zc,RawShaderMaterial:()=>Dv,Ray:()=>rp,Raycaster:()=>Vx,RectAreaLight:()=>V_,RedFormat:()=>Gc,RedIntegerFormat:()=>Wc,ReinhardToneMapping:()=>Ql,RenderTarget:()=>Ed,RenderTarget3D:()=>zx,RepeatWrapping:()=>pc,ReplaceStencilOp:()=>eh,ReverseSubtractEquation:()=>wl,RingGeometry:()=>Sv,SIGNED_RED_GREEN_RGTC2_Format:()=>Au,SIGNED_RED_RGTC1_Format:()=>Tu,SRGBColorSpace:()=>Yu,SRGBTransfer:()=>$u,Scene:()=>lm,ShaderChunk:()=>Hb,ShaderLib:()=>Wb,ShaderMaterial:()=>Zf,ShadowMaterial:()=>Lv,Shape:()=>Uy,ShapeGeometry:()=>Mv,ShapePath:()=>Ob,ShapeUtils:()=>fv,ShortType:()=>Cc,Skeleton:()=>Wm,SkeletonHelper:()=>hb,SkinnedMesh:()=>Um,Source:()=>xd,Sphere:()=>Kd,SphereGeometry:()=>Tv,Spherical:()=>Zx,SphericalHarmonics3:()=>H_,SplineCurve:()=>Ny,SpotLight:()=>k_,SpotLightHelper:()=>sb,Sprite:()=>Em,SpriteMaterial:()=>dm,SrcAlphaFactor:()=>Pl,SrcAlphaSaturateFactor:()=>zl,SrcColorFactor:()=>Al,StaticCopyUsage:()=>Ph,StaticDrawUsage:()=>Sh,StaticReadUsage:()=>Eh,StereoCamera:()=>sx,StreamCopyUsage:()=>Rh,StreamDrawUsage:()=>Th,StreamReadUsage:()=>Ch,StringKeyframeTrack:()=>s_,SubtractEquation:()=>bl,SubtractiveBlending:()=>yl,TOUCH:()=>nl,TangentSpaceNormalMap:()=>qu,TetrahedronGeometry:()=>Ev,Texture:()=>Md,TextureLoader:()=>M_,TextureUtils:()=>Ub,Timer:()=>Wx,TimestampQuery:()=>Nh,TorusGeometry:()=>Av,TorusKnotGeometry:()=>Cv,Triangle:()=>qp,TriangleFanDrawMode:()=>ju,TriangleStripDrawMode:()=>Uu,TrianglesDrawMode:()=>Bu,TubeGeometry:()=>Pv,UVMapping:()=>sc,Uint16BufferAttribute:()=>gf,Uint32BufferAttribute:()=>vf,Uint8BufferAttribute:()=>pf,Uint8ClampedBufferAttribute:()=>ff,Uniform:()=>Nx,UniformsGroup:()=>Fx,UniformsLib:()=>Gb,UniformsUtils:()=>qf,UnsignedByteType:()=>Ec,UnsignedInt101111Type:()=>Fc,UnsignedInt248Type:()=>Nc,UnsignedInt5999Type:()=>Oc,UnsignedIntType:()=>Rc,UnsignedShort4444Type:()=>Dc,UnsignedShort5551Type:()=>zc,UnsignedShortType:()=>Pc,VSMShadowMap:()=>ul,Vector2:()=>Jh,Vector3:()=>Qh,Vector4:()=>Td,VectorKeyframeTrack:()=>l_,VideoFrameTexture:()=>Qg,VideoTexture:()=>$g,WebGL3DRenderTarget:()=>Rd,WebGLArrayRenderTarget:()=>Pd,WebGLCoordinateSystem:()=>Dh,WebGLCubeRenderTarget:()=>nm,WebGLRenderTarget:()=>Ad,WebGLRenderer:()=>wM,WebGLUtils:()=>mM,WebGPUCoordinateSystem:()=>zh,WebXRController:()=>am,WireframeGeometry:()=>Iv,WrapAroundEnding:()=>Nu,ZeroCurvatureEnding:()=>Du,ZeroFactor:()=>Tl,ZeroSlopeEnding:()=>zu,ZeroStencilOp:()=>Qu,createCanvasElement:()=>ld});var e,i=n(950),r=n.t(i,2),a=n(352),o=n(119),s=n.t(o,2);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},l.apply(this,arguments)}!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(e||(e={}));const c="popstate";function u(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}function h(t,e){if(!t){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(n){}}}function d(t,e){return{usr:t.state,key:t.key,idx:e}}function p(t,e,n,i){return void 0===n&&(n=null),l({pathname:"string"===typeof t?t:t.pathname,search:"",hash:""},"string"===typeof e?m(e):e,{state:n,key:e&&e.key||i||Math.random().toString(36).substr(2,8)})}function f(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&"?"!==n&&(e+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(e+="#"===i.charAt(0)?i:"#"+i),e}function m(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function g(t,n,i,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:o=!1}=r,s=a.history,h=e.Pop,m=null,g=y();function y(){return(s.state||{idx:null}).idx}function v(){h=e.Pop;let t=y(),n=null==t?null:t-g;g=t,m&&m({action:h,location:x.location,delta:n})}function _(t){let e="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof t?t:f(t);return n=n.replace(/ $/,"%20"),u(e,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,e)}null==g&&(g=0,s.replaceState(l({},s.state,{idx:g}),""));let x={get action(){return h},get location(){return t(a,s)},listen(t){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(c,v),m=t,()=>{a.removeEventListener(c,v),m=null}},createHref:t=>n(a,t),createURL:_,encodeLocation(t){let e=_(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,n){h=e.Push;let r=p(x.location,t,n);i&&i(r,t),g=y()+1;let l=d(r,g),c=x.createHref(r);try{s.pushState(l,"",c)}catch(dE){if(dE instanceof DOMException&&"DataCloneError"===dE.name)throw dE;a.location.assign(c)}o&&m&&m({action:h,location:x.location,delta:1})},replace:function(t,n){h=e.Replace;let r=p(x.location,t,n);i&&i(r,t),g=y();let a=d(r,g),l=x.createHref(r);s.replaceState(a,"",l),o&&m&&m({action:h,location:x.location,delta:0})},go:t=>s.go(t)};return x}var y;!function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(y||(y={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function v(t,e,n){return void 0===n&&(n="/"),_(t,e,n,!1)}function _(t,e,n,i){let r=L(("string"===typeof e?m(e):e).pathname||"/",n);if(null==r)return null;let a=x(t);!function(t){t.sort((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){let n=t.length===e.length&&t.slice(0,-1).every((t,n)=>t===e[n]);return n?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map(t=>t.childrenIndex),e.routesMeta.map(t=>t.childrenIndex)))}(a);let o=null;for(let s=0;null==o&&s<a.length;++s){let t=k(r);o=I(a[s],t,i)}return o}function x(t,e,n,i){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(t,r,a)=>{let o={relativePath:void 0===a?t.path||"":a,caseSensitive:!0===t.caseSensitive,childrenIndex:r,route:t};o.relativePath.startsWith("/")&&(u(o.relativePath.startsWith(i),'Absolute route path "'+o.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(i.length));let s=F([i,o.relativePath]),l=n.concat(o);t.children&&t.children.length>0&&(u(!0!==t.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),x(t.children,e,l,s)),(null!=t.path||t.index)&&e.push({path:s,score:P(s,t.index),routesMeta:l})};return t.forEach((t,e)=>{var n;if(""!==t.path&&null!=(n=t.path)&&n.includes("?"))for(let i of b(t.path))r(t,e,i);else r(t,e)}),e}function b(t){let e=t.split("/");if(0===e.length)return[];let[n,...i]=e,r=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===i.length)return r?[a,""]:[a];let o=b(i.join("/")),s=[];return s.push(...o.map(t=>""===t?a:[a,t].join("/"))),r&&s.push(...o),s.map(e=>t.startsWith("/")&&""===e?"/":e)}const w=/^:[\w-]+$/,S=3,M=2,T=1,E=10,A=-2,C=t=>"*"===t;function P(t,e){let n=t.split("/"),i=n.length;return n.some(C)&&(i+=A),e&&(i+=M),n.filter(t=>!C(t)).reduce((t,e)=>t+(w.test(e)?S:""===e?T:E),i)}function I(t,e,n){void 0===n&&(n=!1);let{routesMeta:i}=t,r={},a="/",o=[];for(let s=0;s<i.length;++s){let t=i[s],l=s===i.length-1,c="/"===a?e:e.slice(a.length)||"/",u=R({path:t.relativePath,caseSensitive:t.caseSensitive,end:l},c),h=t.route;if(!u&&l&&n&&!i[i.length-1].route.index&&(u=R({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},c)),!u)return null;Object.assign(r,u.params),o.push({params:r,pathname:F([a,u.pathname]),pathnameBase:B(F([a,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(a=F([a,u.pathnameBase]))}return o}function R(t,e){"string"===typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=function(t,e,n){void 0===e&&(e=!1);void 0===n&&(n=!0);h("*"===t||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were "'+t.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+t.replace(/\*$/,"/*")+'".');let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(t,e,n)=>(i.push({paramName:e,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));t.endsWith("*")?(i.push({paramName:"*"}),r+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==t&&"/"!==t&&(r+="(?:(?=\\/|$))");let a=new RegExp(r,e?void 0:"i");return[a,i]}(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let a=r[0],o=a.replace(/(.)\/+$/,"$1"),s=r.slice(1),l=i.reduce((t,e,n)=>{let{paramName:i,isOptional:r}=e;if("*"===i){let t=s[n]||"";o=a.slice(0,a.length-t.length).replace(/(.)\/+$/,"$1")}const l=s[n];return t[i]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),t},{});return{params:l,pathname:a,pathnameBase:o,pattern:t}}function k(t){try{return t.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(dE){return h(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+dE+")."),t}}function L(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&"/"!==i?null:t.slice(n)||"/"}function D(t,e,n,i){return"Cannot include a '"+t+"' character in a manually specified `to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function z(t){return t.filter((t,e)=>0===e||t.route.path&&t.route.path.length>0)}function N(t,e){let n=z(t);return e?n.map((t,e)=>e===n.length-1?t.pathname:t.pathnameBase):n.map(t=>t.pathnameBase)}function O(t,e,n,i){let r;void 0===i&&(i=!1),"string"===typeof t?r=m(t):(r=l({},t),u(!r.pathname||!r.pathname.includes("?"),D("?","pathname","search",r)),u(!r.pathname||!r.pathname.includes("#"),D("#","pathname","hash",r)),u(!r.search||!r.search.includes("#"),D("#","search","hash",r)));let a,o=""===t||""===r.pathname,s=o?"/":r.pathname;if(null==s)a=n;else{let t=e.length-1;if(!i&&s.startsWith("..")){let e=s.split("/");for(;".."===e[0];)e.shift(),t-=1;r.pathname=e.join("/")}a=t>=0?e[t]:"/"}let c=function(t,e){void 0===e&&(e="/");let{pathname:n,search:i="",hash:r=""}="string"===typeof t?m(t):t,a=n?n.startsWith("/")?n:function(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(t=>{".."===t?n.length>1&&n.pop():"."!==t&&n.push(t)}),n.length>1?n.join("/"):"/"}(n,e):e;return{pathname:a,search:U(i),hash:j(r)}}(r,a),h=s&&"/"!==s&&s.endsWith("/"),d=(o||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!h&&!d||(c.pathname+="/"),c}const F=t=>t.join("/").replace(/\/\/+/g,"/"),B=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),U=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",j=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"";Error;function V(t){return null!=t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"boolean"===typeof t.internal&&"data"in t}const H=["post","put","patch","delete"],G=(new Set(H),["get",...H]);new Set(G),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function W(){return W=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},W.apply(this,arguments)}const q=i.createContext(null);const Z=i.createContext(null);const X=i.createContext(null);const Y=i.createContext(null);const K=i.createContext({outlet:null,matches:[],isDataRoute:!1});const J=i.createContext(null);function $(){return null!=i.useContext(Y)}function Q(){return $()||u(!1),i.useContext(Y).location}function tt(t){i.useContext(X).static||i.useLayoutEffect(t)}function et(){let{isDataRoute:t}=i.useContext(K);return t?function(){let{router:t}=ht(ct.UseNavigateStable),e=pt(ut.UseNavigateStable),n=i.useRef(!1);tt(()=>{n.current=!0});let r=i.useCallback(function(i,r){void 0===r&&(r={}),n.current&&("number"===typeof i?t.navigate(i):t.navigate(i,W({fromRouteId:e},r)))},[t,e]);return r}():function(){$()||u(!1);let t=i.useContext(q),{basename:e,future:n,navigator:r}=i.useContext(X),{matches:a}=i.useContext(K),{pathname:o}=Q(),s=JSON.stringify(N(a,n.v7_relativeSplatPath)),l=i.useRef(!1);tt(()=>{l.current=!0});let c=i.useCallback(function(n,i){if(void 0===i&&(i={}),!l.current)return;if("number"===typeof n)return void r.go(n);let a=O(n,JSON.parse(s),o,"path"===i.relative);null==t&&"/"!==e&&(a.pathname="/"===a.pathname?e:F([e,a.pathname])),(i.replace?r.replace:r.push)(a,i.state,i)},[e,r,s,o,t]);return c}()}function nt(t,e){let{relative:n}=void 0===e?{}:e,{future:r}=i.useContext(X),{matches:a}=i.useContext(K),{pathname:o}=Q(),s=JSON.stringify(N(a,r.v7_relativeSplatPath));return i.useMemo(()=>O(t,JSON.parse(s),o,"path"===n),[t,s,o,n])}function it(t,n,r,a){$()||u(!1);let{navigator:o}=i.useContext(X),{matches:s}=i.useContext(K),l=s[s.length-1],c=l?l.params:{},h=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let d,p=Q();if(n){var f;let t="string"===typeof n?m(n):n;"/"===h||(null==(f=t.pathname)?void 0:f.startsWith(h))||u(!1),d=t}else d=p;let g=d.pathname||"/",y=g;if("/"!==h){let t=h.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(t.length).join("/")}let _=v(t,{pathname:y});let x=lt(_&&_.map(t=>Object.assign({},t,{params:Object.assign({},c,t.params),pathname:F([h,o.encodeLocation?o.encodeLocation(t.pathname).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?h:F([h,o.encodeLocation?o.encodeLocation(t.pathnameBase).pathname:t.pathnameBase])})),s,r,a);return n&&x?i.createElement(Y.Provider,{value:{location:W({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:e.Pop}},x):x}function rt(){let t=function(){var t;let e=i.useContext(J),n=dt(ut.UseRouteError),r=pt(ut.UseRouteError);if(void 0!==e)return e;return null==(t=n.errors)?void 0:t[r]}(),e=V(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r};return i.createElement(i.Fragment,null,i.createElement("h2",null,"Unexpected Application Error!"),i.createElement("h3",{style:{fontStyle:"italic"}},e),n?i.createElement("pre",{style:a},n):null,null)}const at=i.createElement(rt,null);class ot extends i.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return void 0!==this.state.error?i.createElement(K.Provider,{value:this.props.routeContext},i.createElement(J.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function st(t){let{routeContext:e,match:n,children:r}=t,a=i.useContext(q);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),i.createElement(K.Provider,{value:e},r)}function lt(t,e,n,r){var a;if(void 0===e&&(e=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==t){var o;if(!n)return null;if(n.errors)t=n.matches;else{if(!(null!=(o=r)&&o.v7_partialHydration&&0===e.length&&!n.initialized&&n.matches.length>0))return null;t=n.matches}}let s=t,l=null==(a=n)?void 0:a.errors;if(null!=l){let t=s.findIndex(t=>t.route.id&&void 0!==(null==l?void 0:l[t.route.id]));t>=0||u(!1),s=s.slice(0,Math.min(s.length,t+1))}let c=!1,h=-1;if(n&&r&&r.v7_partialHydration)for(let i=0;i<s.length;i++){let t=s[i];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(h=i),t.route.id){let{loaderData:e,errors:i}=n,r=t.route.loader&&void 0===e[t.route.id]&&(!i||void 0===i[t.route.id]);if(t.route.lazy||r){c=!0,s=h>=0?s.slice(0,h+1):[s[0]];break}}}return s.reduceRight((t,r,a)=>{let o,u=!1,d=null,p=null;var f;n&&(o=l&&r.route.id?l[r.route.id]:void 0,d=r.route.errorElement||at,c&&(h<0&&0===a?(f="route-fallback",!1||ft[f]||(ft[f]=!0),u=!0,p=null):h===a&&(u=!0,p=r.route.hydrateFallbackElement||null)));let m=e.concat(s.slice(0,a+1)),g=()=>{let e;return e=o?d:u?p:r.route.Component?i.createElement(r.route.Component,null):r.route.element?r.route.element:t,i.createElement(st,{match:r,routeContext:{outlet:t,matches:m,isDataRoute:null!=n},children:e})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===a)?i.createElement(ot,{location:n.location,revalidation:n.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var ct=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(ct||{}),ut=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ut||{});function ht(t){let e=i.useContext(q);return e||u(!1),e}function dt(t){let e=i.useContext(Z);return e||u(!1),e}function pt(t){let e=function(){let t=i.useContext(K);return t||u(!1),t}(),n=e.matches[e.matches.length-1];return n.route.id||u(!1),n.route.id}const ft={};function mt(t,e){null==t||t.v7_startTransition,void 0===(null==t?void 0:t.v7_relativeSplatPath)&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}r.startTransition;function gt(t){u(!1)}function yt(t){let{basename:n="/",children:r=null,location:a,navigationType:o=e.Pop,navigator:s,static:l=!1,future:c}=t;$()&&u(!1);let h=n.replace(/^\/*/,"/"),d=i.useMemo(()=>({basename:h,navigator:s,static:l,future:W({v7_relativeSplatPath:!1},c)}),[h,c,s,l]);"string"===typeof a&&(a=m(a));let{pathname:p="/",search:f="",hash:g="",state:y=null,key:v="default"}=a,_=i.useMemo(()=>{let t=L(p,h);return null==t?null:{location:{pathname:t,search:f,hash:g,state:y,key:v},navigationType:o}},[h,p,f,g,y,v,o]);return null==_?null:i.createElement(X.Provider,{value:d},i.createElement(Y.Provider,{children:r,value:_}))}function vt(t){let{children:e,location:n}=t;return it(_t(e),n)}new Promise(()=>{});i.Component;function _t(t,e){void 0===e&&(e=[]);let n=[];return i.Children.forEach(t,(t,r)=>{if(!i.isValidElement(t))return;let a=[...e,r];if(t.type===i.Fragment)return void n.push.apply(n,_t(t.props.children,a));t.type!==gt&&u(!1),t.props.index&&t.props.children&&u(!1);let o={id:t.props.id||a.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(o.children=_t(t.props.children,a)),n.push(o)}),n}function xt(){return xt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},xt.apply(this,arguments)}function bt(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const wt=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(HH){}new Map;const St=r.startTransition;s.flushSync,r.useId;function Mt(t){let{basename:e,children:n,future:r,window:a}=t,o=i.useRef();var s;null==o.current&&(o.current=(void 0===(s={window:a,v5Compat:!0})&&(s={}),g(function(t,e){let{pathname:n,search:i,hash:r}=t.location;return p("",{pathname:n,search:i,hash:r},e.state&&e.state.usr||null,e.state&&e.state.key||"default")},function(t,e){return"string"===typeof e?e:f(e)},null,s)));let l=o.current,[c,u]=i.useState({action:l.action,location:l.location}),{v7_startTransition:h}=r||{},d=i.useCallback(t=>{h&&St?St(()=>u(t)):u(t)},[u,h]);return i.useLayoutEffect(()=>l.listen(d),[l,d]),i.useEffect(()=>mt(r),[r]),i.createElement(yt,{basename:e,children:n,location:c.location,navigationType:c.action,navigator:l,future:r})}const Tt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Et=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,At=i.forwardRef(function(t,e){let n,{onClick:r,relative:a,reloadDocument:o,replace:s,state:l,target:c,to:h,preventScrollReset:d,viewTransition:p}=t,m=bt(t,wt),{basename:g}=i.useContext(X),y=!1;if("string"===typeof h&&Et.test(h)&&(n=h,Tt))try{let t=new URL(window.location.href),e=h.startsWith("//")?new URL(t.protocol+h):new URL(h),n=L(e.pathname,g);e.origin===t.origin&&null!=n?h=n+e.search+e.hash:y=!0}catch(HH){}let v=function(t,e){let{relative:n}=void 0===e?{}:e;$()||u(!1);let{basename:r,navigator:a}=i.useContext(X),{hash:o,pathname:s,search:l}=nt(t,{relative:n}),c=s;return"/"!==r&&(c="/"===s?r:F([r,s])),a.createHref({pathname:c,search:l,hash:o})}(h,{relative:a}),_=function(t,e){let{target:n,replace:r,state:a,preventScrollReset:o,relative:s,viewTransition:l}=void 0===e?{}:e,c=et(),u=Q(),h=nt(t,{relative:s});return i.useCallback(e=>{if(function(t,e){return 0===t.button&&(!e||"_self"===e)&&!function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}(t)}(e,n)){e.preventDefault();let n=void 0!==r?r:f(u)===f(h);c(t,{replace:n,state:a,preventScrollReset:o,relative:s,viewTransition:l})}},[u,c,h,r,a,n,t,o,s,l])}(h,{replace:s,state:l,target:c,preventScrollReset:d,relative:a,viewTransition:p});return i.createElement("a",xt({},m,{href:n||v,onClick:y||o?r:function(t){r&&r(t),t.defaultPrevented||_(t)},ref:e,target:c}))});var Ct,Pt;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Ct||(Ct={})),function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"}(Pt||(Pt={}));function It(t){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(t)}function Rt(t){var e=function(t,e){if("object"!=It(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=It(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==It(e)?e:e+""}function kt(t,e,n){return(e=Rt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Dt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lt(Object(n),!0).forEach(function(e){kt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var zt=n(414);const Nt=(0,i.createContext)(),Ot={asteroidData:[],selectedAsteroid:null,simulationParams:{diameter:250,velocity:19.3,angle:45,location:"Ocean (Pacific)",coordinates:{lat:0,lng:180}},simulationResults:null,threatLevel:"Medium",isLoading:!1,error:null,userPreferences:{units:"metric",notifications:!0}};function Ft(t,e){switch(e.type){case"SET_LOADING":return Dt(Dt({},t),{},{isLoading:e.payload});case"SET_ERROR":return Dt(Dt({},t),{},{error:e.payload,isLoading:!1});case"SET_ASTEROID_DATA":return Dt(Dt({},t),{},{asteroidData:e.payload,isLoading:!1});case"SELECT_ASTEROID":return Dt(Dt({},t),{},{selectedAsteroid:e.payload});case"UPDATE_SIMULATION_PARAMS":return Dt(Dt({},t),{},{simulationParams:Dt(Dt({},t.simulationParams),e.payload)});case"SET_SIMULATION_RESULTS":return Dt(Dt({},t),{},{simulationResults:e.payload});case"SET_THREAT_LEVEL":return Dt(Dt({},t),{},{threatLevel:e.payload});case"UPDATE_USER_PREFERENCES":return Dt(Dt({},t),{},{userPreferences:Dt(Dt({},t.userPreferences),e.payload)});case"CLEAR_ERROR":return Dt(Dt({},t),{},{error:null});default:return t}}function Bt(t){let{children:e}=t;const[n,r]=(0,i.useReducer)(Ft,Ot);return(0,i.useEffect)(()=>{const t=localStorage.getItem("meteorMadnessPreferences");if(t)try{const e=JSON.parse(t);r({type:"UPDATE_USER_PREFERENCES",payload:e})}catch(dE){console.error("Error loading user preferences:",dE)}},[]),(0,i.useEffect)(()=>{localStorage.setItem("meteorMadnessPreferences",JSON.stringify(n.userPreferences))},[n.userPreferences]),(0,zt.jsx)(Nt.Provider,{value:{state:n,dispatch:r},children:e})}function Ut(){const t=(0,i.useContext)(Nt);if(!t)throw new Error("useAppContext must be used within an AppProvider");return t}const jt=function(){const t=Q(),[e,n]=(0,i.useState)(!1);return(0,zt.jsx)("nav",{className:"navigation",children:(0,zt.jsxs)("div",{className:"nav-container",children:[(0,zt.jsxs)(At,{to:"/",className:"nav-logo",children:[(0,zt.jsx)("div",{className:"logo-icon",children:(0,zt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,zt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"})]}),(0,zt.jsx)("div",{className:"nav-menu ".concat(e?"nav-menu--open":""),children:[{path:"/",label:"Home"},{path:"/story",label:"Story Mode"},{path:"/dashboard",label:"Dashboard"},{path:"/results",label:"Results"}].map(e=>(0,zt.jsx)(At,{to:e.path,className:"nav-link ".concat(t.pathname===e.path?"nav-link--active":""),onClick:()=>n(!1),children:e.label},e.path))}),(0,zt.jsx)("div",{className:"nav-actions",children:(0,zt.jsx)("button",{className:"nav-btn nav-btn--primary",children:"Explore Impact"})}),(0,zt.jsxs)("button",{className:"nav-toggle",onClick:()=>n(!e),"aria-label":"Toggle navigation menu",children:[(0,zt.jsx)("span",{}),(0,zt.jsx)("span",{}),(0,zt.jsx)("span",{})]})]})})},Vt=(0,i.createContext)({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),Ht=(0,i.createContext)({}),Gt=(0,i.createContext)(null),Wt="undefined"!==typeof document,qt=Wt?i.useLayoutEffect:i.useEffect,Zt=(0,i.createContext)({strict:!1}),Xt=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),Yt="data-"+Xt("framerAppearId");function Kt(t){return t&&"object"===typeof t&&Object.prototype.hasOwnProperty.call(t,"current")}function Jt(t){return"string"===typeof t||Array.isArray(t)}function $t(t){return null!==t&&"object"===typeof t&&"function"===typeof t.start}const Qt=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],te=["initial",...Qt];function ee(t){return $t(t.animate)||te.some(e=>Jt(t[e]))}function ne(t){return Boolean(ee(t)||t.variants)}function ie(t){const{initial:e,animate:n}=function(t,e){if(ee(t)){const{initial:e,animate:n}=t;return{initial:!1===e||Jt(e)?e:void 0,animate:Jt(n)?n:void 0}}return!1!==t.inherit?e:{}}(t,(0,i.useContext)(Ht));return(0,i.useMemo)(()=>({initial:e,animate:n}),[re(e),re(n)])}function re(t){return Array.isArray(t)?t.join(" "):t}const ae={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},oe={};for(const n in ae)oe[n]={isEnabled:t=>ae[n].some(e=>!!t[e])};const se=(0,i.createContext)({}),le=(0,i.createContext)({}),ce=Symbol.for("motionComponentSymbol");function ue(t){let{preloadedFeatures:e,createVisualElement:n,useRender:r,useVisualState:a,Component:o}=t;e&&function(t){for(const e in t)oe[e]=Dt(Dt({},oe[e]),t[e])}(e);const s=(0,i.forwardRef)(function(t,s){let l;const c=Dt(Dt(Dt({},(0,i.useContext)(Vt)),t),{},{layoutId:he(t)}),{isStatic:u}=c,h=ie(t),d=a(t,u);if(!u&&Wt){h.visualElement=function(t,e,n,r){const{visualElement:a}=(0,i.useContext)(Ht),o=(0,i.useContext)(Zt),s=(0,i.useContext)(Gt),l=(0,i.useContext)(Vt).reducedMotion,c=(0,i.useRef)();r=r||o.renderer,!c.current&&r&&(c.current=r(t,{visualState:e,parent:a,props:n,presenceContext:s,blockInitialAnimation:!!s&&!1===s.initial,reducedMotionConfig:l}));const u=c.current;(0,i.useInsertionEffect)(()=>{u&&u.update(n,s)});const h=(0,i.useRef)(Boolean(n[Yt]&&!window.HandoffComplete));return qt(()=>{u&&(u.render(),h.current&&u.animationState&&u.animationState.animateChanges())}),(0,i.useEffect)(()=>{u&&(u.updateFeatures(),!h.current&&u.animationState&&u.animationState.animateChanges(),h.current&&(h.current=!1,window.HandoffComplete=!0))}),u}(o,d,c,n);const t=(0,i.useContext)(le),r=(0,i.useContext)(Zt).strict;h.visualElement&&(l=h.visualElement.loadFeatures(c,r,e,t))}return i.createElement(Ht.Provider,{value:h},l&&h.visualElement?i.createElement(l,Dt({visualElement:h.visualElement},c)):null,r(o,t,function(t,e,n){return(0,i.useCallback)(i=>{i&&t.mount&&t.mount(i),e&&(i?e.mount(i):e.unmount()),n&&("function"===typeof n?n(i):Kt(n)&&(n.current=i))},[e])}(d,h.visualElement,s),d,u,h.visualElement))});return s[ce]=o,s}function he(t){let{layoutId:e}=t;const n=(0,i.useContext)(se).id;return n&&void 0!==e?n+"-"+e:e}function de(t){function e(e){return ue(t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}if("undefined"===typeof Proxy)return e;const n=new Map;return new Proxy(e,{get:(t,i)=>(n.has(i)||n.set(i,e(i)),n.get(i))})}const pe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function fe(t){return"string"===typeof t&&!t.includes("-")&&!!(pe.indexOf(t)>-1||/[A-Z]/.test(t))}const me={};const ge=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],ye=new Set(ge);function ve(t,e){let{layout:n,layoutId:i}=e;return ye.has(t)||t.startsWith("origin")||(n||void 0!==i)&&(!!me[t]||"opacity"===t)}const _e=t=>Boolean(t&&t.getVelocity),xe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},be=ge.length;const we=t=>e=>"string"===typeof e&&e.startsWith(t),Se=we("--"),Me=we("var(--"),Te=(t,e)=>e&&"number"===typeof t?e.transform(t):t,Ee=(t,e,n)=>Math.min(Math.max(n,t),e),Ae={test:t=>"number"===typeof t,parse:parseFloat,transform:t=>t},Ce=Dt(Dt({},Ae),{},{transform:t=>Ee(0,1,t)}),Pe=Dt(Dt({},Ae),{},{default:1}),Ie=t=>Math.round(1e5*t)/1e5,Re=/(-)?([\d]*\.?[\d])+/g,ke=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Le=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function De(t){return"string"===typeof t}const ze=t=>({test:e=>De(e)&&e.endsWith(t)&&1===e.split(" ").length,parse:parseFloat,transform:e=>"".concat(e).concat(t)}),Ne=ze("deg"),Oe=ze("%"),Fe=ze("px"),Be=ze("vh"),Ue=ze("vw"),je=Dt(Dt({},Oe),{},{parse:t=>Oe.parse(t)/100,transform:t=>Oe.transform(100*t)}),Ve=Dt(Dt({},Ae),{},{transform:Math.round}),He={borderWidth:Fe,borderTopWidth:Fe,borderRightWidth:Fe,borderBottomWidth:Fe,borderLeftWidth:Fe,borderRadius:Fe,radius:Fe,borderTopLeftRadius:Fe,borderTopRightRadius:Fe,borderBottomRightRadius:Fe,borderBottomLeftRadius:Fe,width:Fe,maxWidth:Fe,height:Fe,maxHeight:Fe,size:Fe,top:Fe,right:Fe,bottom:Fe,left:Fe,padding:Fe,paddingTop:Fe,paddingRight:Fe,paddingBottom:Fe,paddingLeft:Fe,margin:Fe,marginTop:Fe,marginRight:Fe,marginBottom:Fe,marginLeft:Fe,rotate:Ne,rotateX:Ne,rotateY:Ne,rotateZ:Ne,scale:Pe,scaleX:Pe,scaleY:Pe,scaleZ:Pe,skew:Ne,skewX:Ne,skewY:Ne,distance:Fe,translateX:Fe,translateY:Fe,translateZ:Fe,x:Fe,y:Fe,z:Fe,perspective:Fe,transformPerspective:Fe,opacity:Ce,originX:je,originY:je,originZ:Fe,zIndex:Ve,fillOpacity:Ce,strokeOpacity:Ce,numOctaves:Ve};function Ge(t,e,n,i){const{style:r,vars:a,transform:o,transformOrigin:s}=t;let l=!1,c=!1,u=!0;for(const h in e){const t=e[h];if(Se(h)){a[h]=t;continue}const n=He[h],i=Te(t,n);if(ye.has(h)){if(l=!0,o[h]=i,!u)continue;t!==(n.default||0)&&(u=!1)}else h.startsWith("origin")?(c=!0,s[h]=i):r[h]=i}if(e.transform||(l||i?r.transform=function(t,e,n,i){let{enableHardwareAcceleration:r=!0,allowTransformNone:a=!0}=e,o="";for(let s=0;s<be;s++){const e=ge[s];void 0!==t[e]&&(o+="".concat(xe[e]||e,"(").concat(t[e],") "))}return r&&!t.z&&(o+="translateZ(0)"),o=o.trim(),i?o=i(t,n?"":o):a&&n&&(o="none"),o}(t.transform,n,u,i):r.transform&&(r.transform="none")),c){const{originX:t="50%",originY:e="50%",originZ:n=0}=s;r.transformOrigin="".concat(t," ").concat(e," ").concat(n)}}const We=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function qe(t,e,n){for(const i in e)_e(e[i])||ve(i,n)||(t[i]=e[i])}function Ze(t,e,n){const r={};return qe(r,t.style||{},t),Object.assign(r,function(t,e,n){let{transformTemplate:r}=t;return(0,i.useMemo)(()=>{const t={style:{},transform:{},transformOrigin:{},vars:{}};return Ge(t,e,{enableHardwareAcceleration:!n},r),Object.assign({},t.vars,t.style)},[e])}(t,e,n)),t.transformValues?t.transformValues(r):r}function Xe(t,e,n){const i={},r=Ze(t,e,n);return t.drag&&!1!==t.dragListener&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===t.drag?"none":"pan-".concat("x"===t.drag?"y":"x")),void 0===t.tabIndex&&(t.onTap||t.onTapStart||t.whileTap)&&(i.tabIndex=0),i.style=r,i}const Ye=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ke(t){return t.startsWith("while")||t.startsWith("drag")&&"draggable"!==t||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Ye.has(t)}let Je=t=>!Ke(t);try{($e=require("@emotion/is-prop-valid").default)&&(Je=t=>t.startsWith("on")?!Ke(t):$e(t))}catch(tE){}var $e;function Qe(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(-1!==e.indexOf(i))continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function tn(t,e,n){return"string"===typeof t?t:Fe.transform(e+n*t)}const en={offset:"stroke-dashoffset",array:"stroke-dasharray"},nn={offset:"strokeDashoffset",array:"strokeDasharray"};const rn=["attrX","attrY","attrScale","originX","originY","pathLength","pathSpacing","pathOffset"];function an(t,e,n,i,r){let{attrX:a,attrY:o,attrScale:s,originX:l,originY:c,pathLength:u,pathSpacing:h=1,pathOffset:d=0}=e;if(Ge(t,Qe(e,rn),n,r),i)return void(t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox));t.attrs=t.style,t.style={};const{attrs:p,style:f,dimensions:m}=t;p.transform&&(m&&(f.transform=p.transform),delete p.transform),m&&(void 0!==l||void 0!==c||f.transform)&&(f.transformOrigin=function(t,e,n){const i=tn(e,t.x,t.width),r=tn(n,t.y,t.height);return"".concat(i," ").concat(r)}(m,void 0!==l?l:.5,void 0!==c?c:.5)),void 0!==a&&(p.x=a),void 0!==o&&(p.y=o),void 0!==s&&(p.scale=s),void 0!==u&&function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.pathLength=1;const a=r?en:nn;t[a.offset]=Fe.transform(-i);const o=Fe.transform(e),s=Fe.transform(n);t[a.array]="".concat(o," ").concat(s)}(p,u,h,d,!1)}const on=()=>Dt(Dt({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}}),sn=t=>"string"===typeof t&&"svg"===t.toLowerCase();function ln(t,e,n,r){const a=(0,i.useMemo)(()=>{const n=on();return an(n,e,{enableHardwareAcceleration:!1},sn(r),t.transformTemplate),Dt(Dt({},n.attrs),{},{style:Dt({},n.style)})},[e]);if(t.style){const e={};qe(e,t.style,t),a.style=Dt(Dt({},e),a.style)}return a}function cn(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(e,n,r,a,o)=>{let{latestValues:s}=a;const l=(fe(e)?ln:Xe)(n,s,o,e),c=function(t,e,n){const i={};for(const r in t)"values"===r&&"object"===typeof t.values||(Je(r)||!0===n&&Ke(r)||!e&&!Ke(r)||t.draggable&&r.startsWith("onDrag"))&&(i[r]=t[r]);return i}(n,"string"===typeof e,t),u=Dt(Dt(Dt({},c),l),{},{ref:r}),{children:h}=n,d=(0,i.useMemo)(()=>_e(h)?h.get():h,[h]);return(0,i.createElement)(e,Dt(Dt({},u),{},{children:d}))}}function un(t,e,n,i){let{style:r,vars:a}=e;Object.assign(t.style,r,i&&i.getProjectionStyles(n));for(const o in a)t.style.setProperty(o,a[o])}const hn=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function dn(t,e,n,i){un(t,e,void 0,i);for(const r in e.attrs)t.setAttribute(hn.has(r)?r:Xt(r),e.attrs[r])}function pn(t,e){const{style:n}=t,i={};for(const r in n)(_e(n[r])||e.style&&_e(e.style[r])||ve(r,t))&&(i[r]=n[r]);return i}function fn(t,e){const n=pn(t,e);for(const i in t)if(_e(t[i])||_e(e[i])){n[-1!==ge.indexOf(i)?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i]=t[i]}return n}function mn(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return"function"===typeof e&&(e=e(void 0!==n?n:t.custom,i,r)),"string"===typeof e&&(e=t.variants&&t.variants[e]),"function"===typeof e&&(e=e(void 0!==n?n:t.custom,i,r)),e}const gn=t=>Array.isArray(t),yn=t=>gn(t)?t[t.length-1]||0:t;function vn(t){const e=_e(t)?t.get():t;return(t=>Boolean(t&&"object"===typeof t&&t.mix&&t.toValue))(e)?e.toValue():e}const _n=["transitionEnd","transition"];const xn=t=>(e,n)=>{const r=(0,i.useContext)(Ht),a=(0,i.useContext)(Gt),o=()=>function(t,e,n,i){let{scrapeMotionValuesFromProps:r,createRenderState:a,onMount:o}=t;const s={latestValues:bn(e,n,i,r),renderState:a()};return o&&(s.mount=t=>o(e,t,s)),s}(t,e,r,a);return n?o():function(t){const e=(0,i.useRef)(null);return null===e.current&&(e.current=t()),e.current}(o)};function bn(t,e,n,i){const r={},a=i(t,{});for(const d in a)r[d]=vn(a[d]);let{initial:o,animate:s}=t;const l=ee(t),c=ne(t);e&&c&&!l&&!1!==t.inherit&&(void 0===o&&(o=e.initial),void 0===s&&(s=e.animate));let u=!!n&&!1===n.initial;u=u||!1===o;const h=u?s:o;if(h&&"boolean"!==typeof h&&!$t(h)){(Array.isArray(h)?h:[h]).forEach(e=>{const n=mn(t,e);if(!n)return;const{transitionEnd:i,transition:a}=n,o=Qe(n,_n);for(const t in o){let e=o[t];if(Array.isArray(e)){e=e[u?e.length-1:0]}null!==e&&(r[t]=e)}for(const t in i)r[t]=i[t]})}return r}const wn=t=>t;class Sn{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const e=this.order.indexOf(t);-1!==e&&(this.order.splice(e,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}const Mn=["prepare","read","update","preRender","render","postRender"];const{schedule:Tn,cancel:En,state:An,steps:Cn}=function(t,e){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},a=Mn.reduce((t,e)=>(t[e]=function(t){let e=new Sn,n=new Sn,i=0,r=!1,a=!1;const o=new WeakSet,s={schedule:function(t){const a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r,s=a?e:n;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&o.add(t),s.add(t)&&a&&r&&(i=e.order.length),t},cancel:t=>{n.remove(t),o.delete(t)},process:l=>{if(r)a=!0;else{if(r=!0,[e,n]=[n,e],n.clear(),i=e.order.length,i)for(let n=0;n<i;n++){const i=e.order[n];i(l),o.has(i)&&(s.schedule(i),t())}r=!1,a&&(a=!1,s.process(l))}}};return s}(()=>n=!0),t),{}),o=t=>a[t].process(r),s=()=>{const a=performance.now();n=!1,r.delta=i?1e3/60:Math.max(Math.min(a-r.timestamp,40),1),r.timestamp=a,r.isProcessing=!0,Mn.forEach(o),r.isProcessing=!1,n&&e&&(i=!1,t(s))},l=Mn.reduce((e,o)=>{const l=a[o];return e[o]=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,i=!0,r.isProcessing||t(s)),l.schedule(e,a,o)},e},{});return{schedule:l,cancel:t=>Mn.forEach(e=>a[e].cancel(t)),state:r,steps:a}}("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:wn,!0),Pn={useVisualState:xn({scrapeMotionValuesFromProps:fn,createRenderState:on,onMount:(t,e,n)=>{let{renderState:i,latestValues:r}=n;Tn.read(()=>{try{i.dimensions="function"===typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(HH){i.dimensions={x:0,y:0,width:0,height:0}}}),Tn.render(()=>{an(i,r,{enableHardwareAcceleration:!1},sn(e.tagName),t.transformTemplate),dn(e,i)})}})},In={useVisualState:xn({scrapeMotionValuesFromProps:pn,createRenderState:We})};function Rn(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n)}const kn=t=>"mouse"===t.pointerType?"number"!==typeof t.button||t.button<=0:!1!==t.isPrimary;function Ln(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"page";return{point:{x:t[e+"X"],y:t[e+"Y"]}}}function Dn(t,e,n,i){return Rn(t,e,(t=>e=>kn(e)&&t(e,Ln(e)))(n),i)}const zn=(t,e)=>n=>e(t(n)),Nn=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(zn)};function On(t){let e=null;return()=>{const n=()=>{e=null};return null===e&&(e=t,n)}}const Fn=On("dragHorizontal"),Bn=On("dragVertical");function Un(t){let e=!1;if("y"===t)e=Bn();else if("x"===t)e=Fn();else{const t=Fn(),n=Bn();t&&n?e=()=>{t(),n()}:(t&&t(),n&&n())}return e}function jn(){const t=Un(!0);return!t||(t(),!1)}class Vn{constructor(t){this.isMounted=!1,this.node=t}update(){}}function Hn(t,e){const n="pointer"+(e?"enter":"leave"),i="onHover"+(e?"Start":"End");return Dn(t.current,n,(n,r)=>{if("touch"===n.pointerType||jn())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e),a[i]&&Tn.update(()=>a[i](n,r))},{passive:!t.getProps()[i]})}const Gn=(t,e)=>!!e&&(t===e||Gn(t,e.parentElement));function Wn(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,Ln(n))}const qn=["root"],Zn=new WeakMap,Xn=new WeakMap,Yn=t=>{const e=Zn.get(t.target);e&&e(t)},Kn=t=>{t.forEach(Yn)};function Jn(t,e,n){const i=function(t){let{root:e}=t,n=Qe(t,qn);const i=e||document;Xn.has(i)||Xn.set(i,{});const r=Xn.get(i),a=JSON.stringify(n);return r[a]||(r[a]=new IntersectionObserver(Kn,Dt({root:e},n))),r[a]}(e);return Zn.set(t,n),i.observe(t),()=>{Zn.delete(t),i.unobserve(t)}}const $n={some:0,all:1};const Qn={inView:{Feature:class extends Vn{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:e,margin:n,amount:i="some",once:r}=t,a={root:e?e.current:void 0,rootMargin:n,threshold:"number"===typeof i?i:$n[i]};return Jn(this.node.current,a,t=>{const{isIntersecting:e}=t;if(this.isInView===e)return;if(this.isInView=e,r&&!e&&this.hasEnteredView)return;e&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",e);const{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),a=e?n:i;a&&a(t)})}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:t,prevProps:e}=this.node,n=["amount","margin","root"].some(function(t){let{viewport:e={}}=t,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=>e[t]!==n[t]}(t,e));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends Vn{constructor(){super(...arguments),this.removeStartListeners=wn,this.removeEndListeners=wn,this.removeAccessibleListeners=wn,this.startPointerPress=(t,e)=>{if(this.isPressing)return;this.removeEndListeners();const n=this.node.getProps(),i=Dn(window,"pointerup",(t,e)=>{if(!this.checkPressEnd())return;const{onTap:n,onTapCancel:i,globalTapTarget:r}=this.node.getProps();Tn.update(()=>{r||Gn(this.node.current,t.target)?n&&n(t,e):i&&i(t,e)})},{passive:!(n.onTap||n.onPointerUp)}),r=Dn(window,"pointercancel",(t,e)=>this.cancelPress(t,e),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=Nn(i,r),this.startPress(t,e)},this.startAccessiblePress=()=>{const t=Rn(this.node.current,"keydown",t=>{if("Enter"!==t.key||this.isPressing)return;this.removeEndListeners(),this.removeEndListeners=Rn(this.node.current,"keyup",t=>{"Enter"===t.key&&this.checkPressEnd()&&Wn("up",(t,e)=>{const{onTap:n}=this.node.getProps();n&&Tn.update(()=>n(t,e))})}),Wn("down",(t,e)=>{this.startPress(t,e)})}),e=Rn(this.node.current,"blur",()=>{this.isPressing&&Wn("cancel",(t,e)=>this.cancelPress(t,e))});this.removeAccessibleListeners=Nn(t,e)}}startPress(t,e){this.isPressing=!0;const{onTapStart:n,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),n&&Tn.update(()=>n(t,e))}checkPressEnd(){this.removeEndListeners(),this.isPressing=!1;return this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!jn()}cancelPress(t,e){if(!this.checkPressEnd())return;const{onTapCancel:n}=this.node.getProps();n&&Tn.update(()=>n(t,e))}mount(){const t=this.node.getProps(),e=Dn(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),n=Rn(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Nn(e,n)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}},focus:{Feature:class extends Vn{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch(HH){t=!0}t&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Nn(Rn(this.node.current,"focus",()=>this.onFocus()),Rn(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}},hover:{Feature:class extends Vn{mount(){this.unmount=Nn(Hn(this.node,!0),Hn(this.node,!1))}unmount(){}}}};function ti(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function ei(t,e,n){const i=t.getProps();return mn(i,e,void 0!==n?n:i.custom,function(t){const e={};return t.values.forEach((t,n)=>e[n]=t.get()),e}(t),function(t){const e={};return t.values.forEach((t,n)=>e[n]=t.getVelocity()),e}(t))}let ni=wn,ii=wn;const ri=t=>1e3*t,ai=t=>t/1e3,oi=!1,si=t=>Array.isArray(t)&&"number"===typeof t[0];function li(t){return Boolean(!t||"string"===typeof t&&ui[t]||si(t)||Array.isArray(t)&&t.every(li))}const ci=t=>{let[e,n,i,r]=t;return"cubic-bezier(".concat(e,", ").concat(n,", ").concat(i,", ").concat(r,")")},ui={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ci([0,.65,.55,1]),circOut:ci([.55,0,1,.45]),backIn:ci([.31,.01,.66,-.59]),backOut:ci([.33,1.53,.69,.99])};function hi(t){if(t)return si(t)?ci(t):Array.isArray(t)?t.map(hi):ui[t]}const di=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t;function pi(t,e,n,i){if(t===e&&n===i)return wn;const r=e=>function(t,e,n,i,r){let a,o,s=0;do{o=e+(n-e)/2,a=di(o,i,r)-t,a>0?n=o:e=o}while(Math.abs(a)>1e-7&&++s<12);return o}(e,0,1,t,n);return t=>0===t||1===t?t:di(r(t),e,i)}const fi=pi(.42,0,1,1),mi=pi(0,0,.58,1),gi=pi(.42,0,.58,1),yi=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,vi=t=>e=>1-t(1-e),_i=t=>1-Math.sin(Math.acos(t)),xi=vi(_i),bi=yi(_i),wi=pi(.33,1.53,.69,.99),Si=vi(wi),Mi=yi(Si),Ti={linear:wn,easeIn:fi,easeInOut:gi,easeOut:mi,circIn:_i,circInOut:bi,circOut:xi,backIn:Si,backInOut:Mi,backOut:wi,anticipate:t=>(t*=2)<1?.5*Si(t):.5*(2-Math.pow(2,-10*(t-1)))},Ei=t=>{if(Array.isArray(t)){ii(4===t.length,"Cubic bezier arrays must contain four numerical values.");const[e,n,i,r]=t;return pi(e,n,i,r)}return"string"===typeof t?(ii(void 0!==Ti[t],"Invalid easing type '".concat(t,"'")),Ti[t]):t},Ai=(t,e)=>n=>Boolean(De(n)&&Le.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),Ci=(t,e,n)=>i=>{if(!De(i))return i;const[r,a,o,s]=i.match(Re);return{[t]:parseFloat(r),[e]:parseFloat(a),[n]:parseFloat(o),alpha:void 0!==s?parseFloat(s):1}},Pi=Dt(Dt({},Ae),{},{transform:t=>Math.round((t=>Ee(0,255,t))(t))}),Ii={test:Ai("rgb","red"),parse:Ci("red","green","blue"),transform:t=>{let{red:e,green:n,blue:i,alpha:r=1}=t;return"rgba("+Pi.transform(e)+", "+Pi.transform(n)+", "+Pi.transform(i)+", "+Ie(Ce.transform(r))+")"}};const Ri={test:Ai("#"),parse:function(t){let e="",n="",i="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),i=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),i=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,i+=i,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Ii.transform},ki={test:Ai("hsl","hue"),parse:Ci("hue","saturation","lightness"),transform:t=>{let{hue:e,saturation:n,lightness:i,alpha:r=1}=t;return"hsla("+Math.round(e)+", "+Oe.transform(Ie(n))+", "+Oe.transform(Ie(i))+", "+Ie(Ce.transform(r))+")"}},Li={test:t=>Ii.test(t)||Ri.test(t)||ki.test(t),parse:t=>Ii.test(t)?Ii.parse(t):ki.test(t)?ki.parse(t):Ri.parse(t),transform:t=>De(t)?t:t.hasOwnProperty("red")?Ii.transform(t):ki.transform(t)},Di=(t,e,n)=>-n*t+n*e+t;function zi(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}const Ni=(t,e,n)=>{const i=t*t;return Math.sqrt(Math.max(0,n*(e*e-i)+i))},Oi=[Ri,Ii,ki];function Fi(t){const e=(t=>Oi.find(e=>e.test(t)))(t);ii(Boolean(e),"'".concat(t,"' is not an animatable color. Use the equivalent color code instead."));let n=e.parse(t);return e===ki&&(n=function(t){let{hue:e,saturation:n,lightness:i,alpha:r}=t;e/=360,n/=100,i/=100;let a=0,o=0,s=0;if(n){const t=i<.5?i*(1+n):i+n-i*n,r=2*i-t;a=zi(r,t,e+1/3),o=zi(r,t,e),s=zi(r,t,e-1/3)}else a=o=s=i;return{red:Math.round(255*a),green:Math.round(255*o),blue:Math.round(255*s),alpha:r}}(n)),n}const Bi=(t,e)=>{const n=Fi(t),i=Fi(e),r=Dt({},n);return t=>(r.red=Ni(n.red,i.red,t),r.green=Ni(n.green,i.green,t),r.blue=Ni(n.blue,i.blue,t),r.alpha=Di(n.alpha,i.alpha,t),Ii.transform(r))};const Ui={regex:/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,countKey:"Vars",token:"${v}",parse:wn},ji={regex:ke,countKey:"Colors",token:"${c}",parse:Li.parse},Vi={regex:Re,countKey:"Numbers",token:"${n}",parse:Ae.parse};function Hi(t,e){let{regex:n,countKey:i,token:r,parse:a}=e;const o=t.tokenised.match(n);o&&(t["num"+i]=o.length,t.tokenised=t.tokenised.replace(n,r),t.values.push(...o.map(a)))}function Gi(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&Hi(n,Ui),Hi(n,ji),Hi(n,Vi),n}function Wi(t){return Gi(t).values}function qi(t){const{values:e,numColors:n,numVars:i,tokenised:r}=Gi(t),a=e.length;return t=>{let e=r;for(let r=0;r<a;r++)e=r<i?e.replace(Ui.token,t[r]):r<i+n?e.replace(ji.token,Li.transform(t[r])):e.replace(Vi.token,Ie(t[r]));return e}}const Zi=t=>"number"===typeof t?0:t;const Xi={test:function(t){var e,n;return isNaN(t)&&De(t)&&((null===(e=t.match(Re))||void 0===e?void 0:e.length)||0)+((null===(n=t.match(ke))||void 0===n?void 0:n.length)||0)>0},parse:Wi,createTransformer:qi,getAnimatableNone:function(t){const e=Wi(t);return qi(t)(e.map(Zi))}},Yi=(t,e)=>n=>"".concat(n>0?e:t);function Ki(t,e){return"number"===typeof t?n=>Di(t,e,n):Li.test(t)?Bi(t,e):t.startsWith("var(")?Yi(t,e):Qi(t,e)}const Ji=(t,e)=>{const n=[...t],i=n.length,r=t.map((t,n)=>Ki(t,e[n]));return t=>{for(let e=0;e<i;e++)n[e]=r[e](t);return n}},$i=(t,e)=>{const n=Dt(Dt({},t),e),i={};for(const r in n)void 0!==t[r]&&void 0!==e[r]&&(i[r]=Ki(t[r],e[r]));return t=>{for(const e in i)n[e]=i[e](t);return n}},Qi=(t,e)=>{const n=Xi.createTransformer(e),i=Gi(t),r=Gi(e);return i.numVars===r.numVars&&i.numColors===r.numColors&&i.numNumbers>=r.numNumbers?Nn(Ji(i.values,r.values),n):(ni(!0,"Complex values '".concat(t,"' and '").concat(e,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.")),Yi(t,e))},tr=(t,e,n)=>{const i=e-t;return 0===i?1:(n-t)/i},er=(t,e)=>n=>Di(t,e,n);function nr(t,e,n){const i=[],r=n||function(t){return"number"===typeof t?er:"string"===typeof t?Li.test(t)?Bi:Qi:Array.isArray(t)?Ji:"object"===typeof t?$i:er}(t[0]),a=t.length-1;for(let o=0;o<a;o++){let n=r(t[o],t[o+1]);if(e){const t=Array.isArray(e)?e[o]||wn:e;n=Nn(t,n)}i.push(n)}return i}function ir(t,e){let{clamp:n=!0,ease:i,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=t.length;if(ii(a===e.length,"Both input and output ranges must be the same length"),1===a)return()=>e[0];t[0]>t[a-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=nr(e,i,r),s=o.length,l=e=>{let n=0;if(s>1)for(;n<t.length-2&&!(e<t[n+1]);n++);const i=tr(t[n],t[n+1],e);return o[n](i)};return n?e=>l(Ee(t[0],t[a-1],e)):l}function rr(t){const e=[0];return function(t,e){const n=t[t.length-1];for(let i=1;i<=e;i++){const r=tr(0,e,i);t.push(Di(n,1,r))}}(e,t.length-1),e}function ar(t){let{duration:e=300,keyframes:n,times:i,ease:r="easeInOut"}=t;const a=(t=>Array.isArray(t)&&"number"!==typeof t[0])(r)?r.map(Ei):Ei(r),o={done:!1,value:n[0]},s=function(t,e){return t.map(t=>t*e)}(i&&i.length===n.length?i:rr(n),e),l=ir(s,n,{ease:Array.isArray(a)?a:(c=n,u=a,c.map(()=>u||gi).splice(0,c.length-1))});var c,u;return{calculatedDuration:e,next:t=>(o.value=l(t),o.done=t>=e,o)}}function or(t,e){return e?t*(1e3/e):0}function sr(t,e,n){const i=Math.max(e-5,0);return or(n-t(i),e-i)}const lr=.001;function cr(t){let e,n,{duration:i=800,bounce:r=.25,velocity:a=0,mass:o=1}=t;ni(i<=ri(10),"Spring duration must be 10 seconds or less");let s=1-r;s=Ee(.05,1,s),i=Ee(.01,10,ai(i)),s<1?(e=t=>{const e=t*s,n=e*i,r=e-a,o=hr(t,s),l=Math.exp(-n);return lr-r/o*l},n=t=>{const n=t*s*i,r=n*a+a,o=Math.pow(s,2)*Math.pow(t,2)*i,l=Math.exp(-n),c=hr(Math.pow(t,2),s);return(-e(t)+lr>0?-1:1)*((r-o)*l)/c}):(e=t=>Math.exp(-t*i)*((t-a)*i+1)-.001,n=t=>Math.exp(-t*i)*(i*i*(a-t)));const l=function(t,e,n){let i=n;for(let r=1;r<ur;r++)i-=t(i)/e(i);return i}(e,n,5/i);if(i=ri(i),isNaN(l))return{stiffness:100,damping:10,duration:i};{const t=Math.pow(l,2)*o;return{stiffness:t,damping:2*s*Math.sqrt(o*t),duration:i}}}const ur=12;function hr(t,e){return t*Math.sqrt(1-e*e)}const dr=["keyframes","restDelta","restSpeed"],pr=["duration","bounce"],fr=["stiffness","damping","mass"];function mr(t,e){return e.some(e=>void 0!==t[e])}function gr(t){let{keyframes:e,restDelta:n,restSpeed:i}=t,r=Qe(t,dr);const a=e[0],o=e[e.length-1],s={done:!1,value:a},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:p}=function(t){let e=Dt({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},t);if(!mr(t,fr)&&mr(t,pr)){const n=cr(t);e=Dt(Dt(Dt({},e),n),{},{mass:1}),e.isResolvedFromDuration=!0}return e}(Dt(Dt({},r),{},{velocity:-ai(r.velocity||0)})),f=d||0,m=c/(2*Math.sqrt(l*u)),g=o-a,y=ai(Math.sqrt(l/u)),v=Math.abs(g)<5;let _;if(i||(i=v?.01:2),n||(n=v?.005:.5),m<1){const t=hr(y,m);_=e=>{const n=Math.exp(-m*y*e);return o-n*((f+m*y*g)/t*Math.sin(t*e)+g*Math.cos(t*e))}}else if(1===m)_=t=>o-Math.exp(-y*t)*(g+(f+y*g)*t);else{const t=y*Math.sqrt(m*m-1);_=e=>{const n=Math.exp(-m*y*e),i=Math.min(t*e,300);return o-n*((f+m*y*g)*Math.sinh(i)+t*g*Math.cosh(i))/t}}return{calculatedDuration:p&&h||null,next:t=>{const e=_(t);if(p)s.done=t>=h;else{let r=f;0!==t&&(r=m<1?sr(_,t,e):0);const a=Math.abs(r)<=i,l=Math.abs(o-e)<=n;s.done=a&&l}return s.value=s.done?o:e,s}}}function yr(t){let{keyframes:e,velocity:n=0,power:i=.8,timeConstant:r=325,bounceDamping:a=10,bounceStiffness:o=500,modifyTarget:s,min:l,max:c,restDelta:u=.5,restSpeed:h}=t;const d=e[0],p={done:!1,value:d},f=t=>void 0===l?c:void 0===c||Math.abs(l-t)<Math.abs(c-t)?l:c;let m=i*n;const g=d+m,y=void 0===s?g:s(g);y!==g&&(m=y-d);const v=t=>-m*Math.exp(-t/r),_=t=>y+v(t),x=t=>{const e=v(t),n=_(t);p.done=Math.abs(e)<=u,p.value=p.done?y:n};let b,w;const S=t=>{(t=>void 0!==l&&t<l||void 0!==c&&t>c)(p.value)&&(b=t,w=gr({keyframes:[p.value,f(p.value)],velocity:sr(_,t,p.value),damping:a,stiffness:o,restDelta:u,restSpeed:h}))};return S(0),{calculatedDuration:null,next:t=>{let e=!1;return w||void 0!==b||(e=!0,x(t),S(t)),void 0!==b&&t>b?w.next(t-b):(!e&&x(t),p)}}}const vr=t=>{const e=e=>{let{timestamp:n}=e;return t(n)};return{start:()=>Tn.update(e,!0),stop:()=>En(e),now:()=>An.isProcessing?An.timestamp:performance.now()}};function _r(t){let e=0;let n=t.next(e);for(;!n.done&&e<2e4;)e+=50,n=t.next(e);return e>=2e4?1/0:e}const xr=["autoplay","delay","driver","keyframes","type","repeat","repeatDelay","repeatType","onPlay","onStop","onComplete","onUpdate"],br={decay:yr,inertia:yr,tween:ar,keyframes:ar,spring:gr};function wr(t){let e,n,{autoplay:i=!0,delay:r=0,driver:a=vr,keyframes:o,type:s="keyframes",repeat:l=0,repeatDelay:c=0,repeatType:u="loop",onPlay:h,onStop:d,onComplete:p,onUpdate:f}=t,m=Qe(t,xr),g=1,y=!1;const v=()=>{n=new Promise(t=>{e=t})};let _;v();const x=br[s]||ar;let b;x!==ar&&"number"!==typeof o[0]&&(b=ir([0,100],o,{clamp:!1}),o=[0,100]);const w=x(Dt(Dt({},m),{},{keyframes:o}));let S;"mirror"===u&&(S=x(Dt(Dt({},m),{},{keyframes:[...o].reverse(),velocity:-(m.velocity||0)})));let M="idle",T=null,E=null,A=null;null===w.calculatedDuration&&l&&(w.calculatedDuration=_r(w));const{calculatedDuration:C}=w;let P=1/0,I=1/0;null!==C&&(P=C+c,I=P*(l+1)-c);let R=0;const k=t=>{if(null===E)return;g>0&&(E=Math.min(E,t)),g<0&&(E=Math.min(t-I/g,E)),R=null!==T?T:Math.round(t-E)*g;const e=R-r*(g>=0?1:-1),n=g>=0?e<0:e>I;R=Math.max(e,0),"finished"===M&&null===T&&(R=I);let i=R,a=w;if(l){const t=Math.min(R,I)/P;let e=Math.floor(t),n=t%1;!n&&t>=1&&(n=1),1===n&&e--,e=Math.min(e,l+1);Boolean(e%2)&&("reverse"===u?(n=1-n,c&&(n-=c/P)):"mirror"===u&&(a=S)),i=Ee(0,1,n)*P}const s=n?{done:!1,value:o[0]}:a.next(i);b&&(s.value=b(s.value));let{done:h}=s;n||null===C||(h=g>=0?R>=I:R<=0);const d=null===T&&("finished"===M||"running"===M&&h);return f&&f(s.value),d&&z(),s},L=()=>{_&&_.stop(),_=void 0},D=()=>{M="idle",L(),e(),v(),E=A=null},z=()=>{M="finished",p&&p(),L(),e()},N=()=>{if(y)return;_||(_=a(k));const t=_.now();h&&h(),null!==T?E=t-T:E&&"finished"!==M||(E=t),"finished"===M&&v(),A=E,T=null,M="running",_.start()};i&&N();const O={then:(t,e)=>n.then(t,e),get time(){return ai(R)},set time(t){t=ri(t),R=t,null===T&&_&&0!==g?E=_.now()-t/g:T=t},get duration(){const t=null===w.calculatedDuration?_r(w):w.calculatedDuration;return ai(t)},get speed(){return g},set speed(t){t!==g&&_&&(g=t,O.time=ai(R))},get state(){return M},play:N,pause:()=>{M="paused",T=R},stop:()=>{y=!0,"idle"!==M&&(M="idle",d&&d(),D())},cancel:()=>{null!==A&&k(A),D()},complete:()=>{M="finished"},sample:t=>(E=0,k(t))};return O}const Sr=["onUpdate","onComplete"],Mr=function(t){let e;return()=>(void 0===e&&(e=t()),e)}(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Tr=new Set(["opacity","clipPath","filter","transform","backgroundColor"]);function Er(t,e,n){let{onUpdate:i,onComplete:r}=n,a=Qe(n,Sr);if(!(Mr()&&Tr.has(e)&&!a.repeatDelay&&"mirror"!==a.repeatType&&0!==a.damping&&"inertia"!==a.type))return!1;let o,s,l=!1,c=!1;const u=()=>{s=new Promise(t=>{o=t})};u();let{keyframes:h,duration:d=300,ease:p,times:f}=a;if(((t,e)=>"spring"===e.type||"backgroundColor"===t||!li(e.ease))(e,a)){const t=wr(Dt(Dt({},a),{},{repeat:0,delay:0}));let e={done:!1,value:h[0]};const n=[];let i=0;for(;!e.done&&i<2e4;)e=t.sample(i),n.push(e.value),i+=10;f=void 0,h=n,d=i-10,p="linear"}const m=function(t,e,n){let{delay:i=0,duration:r,repeat:a=0,repeatType:o="loop",ease:s,times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[e]:n};l&&(c.offset=l);const u=hi(s);return Array.isArray(u)&&(c.easing=u),t.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"})}(t.owner.current,e,h,Dt(Dt({},a),{},{duration:d,ease:p,times:f})),g=()=>{c=!1,m.cancel()},y=()=>{c=!0,Tn.update(g),o(),u()};m.onfinish=()=>{c||(t.set(function(t,e){let{repeat:n,repeatType:i="loop"}=e;return t[n&&"loop"!==i&&n%2===1?0:t.length-1]}(h,a)),r&&r(),y())};const v={then:(t,e)=>s.then(t,e),attachTimeline:t=>(m.timeline=t,m.onfinish=null,wn),get time(){return ai(m.currentTime||0)},set time(t){m.currentTime=ri(t)},get speed(){return m.playbackRate},set speed(t){m.playbackRate=t},get duration(){return ai(d)},play:()=>{l||(m.play(),En(g))},pause:()=>m.pause(),stop:()=>{if(l=!0,"idle"===m.playState)return;const{currentTime:e}=m;if(e){const n=wr(Dt(Dt({},a),{},{autoplay:!1}));t.setWithVelocity(n.sample(e-10).value,n.sample(e).value,10)}y()},complete:()=>{c||m.finish()},cancel:y};return v}const Ar={type:"spring",stiffness:500,damping:25,restSpeed:10},Cr={type:"keyframes",duration:.8},Pr={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ir=(t,e)=>{let{keyframes:n}=e;return n.length>2?Cr:ye.has(t)?t.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:Ar:Pr},Rr=(t,e)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!Xi.test(e)&&"0"!==e||e.startsWith("url("))),kr=new Set(["brightness","contrast","saturate","opacity"]);function Lr(t){const[e,n]=t.slice(0,-1).split("(");if("drop-shadow"===e)return t;const[i]=n.match(Re)||[];if(!i)return t;const r=n.replace(i,"");let a=kr.has(e)?1:0;return i!==n&&(a*=100),e+"("+a+r+")"}const Dr=/([a-z-]*)\(.*?\)/g,zr=Dt(Dt({},Xi),{},{getAnimatableNone:t=>{const e=t.match(Dr);return e?e.map(Lr).join(" "):t}}),Nr=Dt(Dt({},He),{},{color:Li,backgroundColor:Li,outlineColor:Li,fill:Li,stroke:Li,borderColor:Li,borderTopColor:Li,borderRightColor:Li,borderBottomColor:Li,borderLeftColor:Li,filter:zr,WebkitFilter:zr}),Or=t=>Nr[t];function Fr(t,e){let n=Or(t);return n!==zr&&(n=Xi),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const Br=t=>/^0[^.\s]+$/.test(t);function Ur(t){return"number"===typeof t?0===t:null!==t?"none"===t||"0"===t||Br(t):void 0}const jr=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];function Vr(t,e){return t[e]||t.default||t}const Hr=!1,Gr=function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r=>{const a=Vr(i,t)||{},o=a.delay||i.delay||0;let{elapsed:s=0}=i;s-=ri(o);const l=function(t,e,n,i){const r=Rr(e,n);let a;a=Array.isArray(n)?[...n]:[null,n];const o=void 0!==i.from?i.from:t.get();let s;const l=[];for(let c=0;c<a.length;c++)null===a[c]&&(a[c]=0===c?o:a[c-1]),Ur(a[c])&&l.push(c),"string"===typeof a[c]&&"none"!==a[c]&&"0"!==a[c]&&(s=a[c]);if(r&&l.length&&s)for(let c=0;c<l.length;c++)a[l[c]]=Fr(e,s);return a}(e,t,n,a),c=l[0],u=l[l.length-1],h=Rr(t,c),d=Rr(t,u);ni(h===d,"You are trying to animate ".concat(t,' from "').concat(c,'" to "').concat(u,'". ').concat(c," is not an animatable value - to enable this animation set ").concat(c," to a value animatable to ").concat(u," via the `style` property."));let p=Dt(Dt({keyframes:l,velocity:e.getVelocity(),ease:"easeOut"},a),{},{delay:-s,onUpdate:t=>{e.set(t),a.onUpdate&&a.onUpdate(t)},onComplete:()=>{r(),a.onComplete&&a.onComplete()}});if(function(t){let{when:e,delay:n,delayChildren:i,staggerChildren:r,staggerDirection:a,repeat:o,repeatType:s,repeatDelay:l,from:c,elapsed:u}=t,h=Qe(t,jr);return!!Object.keys(h).length}(a)||(p=Dt(Dt({},p),Ir(t,p))),p.duration&&(p.duration=ri(p.duration)),p.repeatDelay&&(p.repeatDelay=ri(p.repeatDelay)),!h||!d||oi||!1===a.type||Hr)return function(t){let{keyframes:e,delay:n,onUpdate:i,onComplete:r}=t;const a=()=>(i&&i(e[e.length-1]),r&&r(),{time:0,speed:1,duration:0,play:wn,pause:wn,stop:wn,then:t=>(t(),Promise.resolve()),cancel:wn,complete:wn});return n?wr({keyframes:[0,1],duration:0,delay:n,onComplete:a}):a()}(oi?Dt(Dt({},p),{},{delay:0}):p);if(!i.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const n=Er(e,t,p);if(n)return n}return wr(p)}};function Wr(t){return Boolean(_e(t)&&t.add)}const qr=t=>/^\-?\d*\.?\d+$/.test(t);function Zr(t,e){-1===t.indexOf(e)&&t.push(e)}function Xr(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Yr{constructor(){this.subscriptions=[]}add(t){return Zr(this.subscriptions,t),()=>Xr(this.subscriptions,t)}notify(t,e,n){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](t,e,n);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(t,e,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Kr={current:void 0};class Jr{constructor(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.prev=e.current,e.current=t;const{delta:i,timestamp:r}=An;e.lastUpdated!==r&&(e.timeDelta=i,e.lastUpdated=r,Tn.postRender(e.scheduleVelocityCheck)),e.prev!==e.current&&e.events.change&&e.events.change.notify(e.current),e.events.velocityChange&&e.events.velocityChange.notify(e.getVelocity()),n&&e.events.renderRequest&&e.events.renderRequest.notify(e.current)},this.scheduleVelocityCheck=()=>Tn.postRender(this.velocityCheck),this.velocityCheck=t=>{let{timestamp:e}=t;e!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=(i=this.current,!isNaN(parseFloat(i))),this.owner=n.owner}onChange(t){return this.on("change",t)}on(t,e){this.events[t]||(this.events[t]=new Yr);const n=this.events[t].add(e);return"change"===t?()=>{n(),Tn.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t,e)}setWithVelocity(t,e,n){this.set(e),this.prev=t,this.timeDelta=n}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Kr.current&&Kr.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?or(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function $r(t,e){return new Jr(t,e)}const Qr=t=>e=>e.test(t),ta=[Ae,Fe,Oe,Ne,Ue,Be,{test:t=>"auto"===t,parse:t=>t}],ea=t=>ta.find(Qr(t)),na=[...ta,Li,Xi],ia=t=>na.find(Qr(t)),ra=["transitionEnd","transition"];function aa(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,$r(n))}function oa(t,e){const n=ei(t,e);let i=n?t.makeTargetAnimatable(n,!1):{},{transitionEnd:r={},transition:a={}}=i,o=Qe(i,ra);o=Dt(Dt({},o),r);for(const s in o){aa(t,s,yn(o[s]))}}function sa(t,e){if(!e)return;return(e[t]||e.default||e).from}const la=["transition","transitionEnd"];function ca(t,e){let{protectedKeys:n,needsAnimating:i}=t;const r=n.hasOwnProperty(e)&&!0!==i[e];return i[e]=!1,r}function ua(t,e){const n=t.get();if(!Array.isArray(e))return n!==e;for(let i=0;i<e.length;i++)if(e[i]!==n)return!0}function ha(t,e){let{delay:n=0,transitionOverride:i,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.makeTargetAnimatable(e),{transition:o=t.getDefaultTransition(),transitionEnd:s}=a,l=Qe(a,la);const c=t.getValue("willChange");i&&(o=i);const u=[],h=r&&t.animationState&&t.animationState.getState()[r];for(const d in l){const e=t.getValue(d),i=l[d];if(!e||void 0===i||h&&ca(h,d))continue;const r=Dt({delay:n,elapsed:0},Vr(o||{},d));if(window.HandoffAppearAnimations){const n=t.getProps()[Yt];if(n){const t=window.HandoffAppearAnimations(n,d,e,Tn);null!==t&&(r.elapsed=t,r.isHandoff=!0)}}let a=!r.isHandoff&&!ua(e,i);if("spring"===r.type&&(e.getVelocity()||r.velocity)&&(a=!1),e.animation&&(a=!1),a)continue;e.start(Gr(d,e,i,t.shouldReduceMotion&&ye.has(d)?{type:!1}:r));const s=e.animation;Wr(c)&&(c.add(d),s.then(()=>c.remove(d))),u.push(s)}return s&&Promise.all(u).then(()=>{s&&oa(t,s)}),u}function da(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=ei(t,e,n.custom);let{transition:r=t.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(r=n.transitionOverride);const a=i?()=>Promise.all(ha(t,i,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:a=0,staggerChildren:o,staggerDirection:s}=r;return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5?arguments[5]:void 0;const o=[],s=(t.variantChildren.size-1)*i,l=1===r?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i}:function(){return s-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i};return Array.from(t.variantChildren).sort(pa).forEach((t,i)=>{t.notify("AnimationStart",e),o.push(da(t,e,Dt(Dt({},a),{},{delay:n+l(i)})).then(()=>t.notify("AnimationComplete",e)))}),Promise.all(o)}(t,e,a+i,o,s,n)}:()=>Promise.resolve(),{when:s}=r;if(s){const[t,e]="beforeChildren"===s?[a,o]:[o,a];return t().then(()=>e())}return Promise.all([a(),o(n.delay)])}function pa(t,e){return t.sortNodePosition(e)}const fa=["transition","transitionEnd"],ma=[...Qt].reverse(),ga=Qt.length;function ya(t){return e=>Promise.all(e.map(e=>{let{animation:n,options:i}=e;return function(t,e){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t.notify("AnimationStart",e),Array.isArray(e)){const r=e.map(e=>da(t,e,i));n=Promise.all(r)}else if("string"===typeof e)n=da(t,e,i);else{const r="function"===typeof e?ei(t,e,i.custom):e;n=Promise.all(ha(t,r,i))}return n.then(()=>t.notify("AnimationComplete",e))}(t,n,i)}))}function va(t){let e=ya(t);const n={animate:xa(!0),whileInView:xa(),whileHover:xa(),whileTap:xa(),whileDrag:xa(),whileFocus:xa(),exit:xa()};let i=!0;const r=(e,n)=>{const i=ei(t,n);if(i){const{transition:t,transitionEnd:n}=i,r=Qe(i,fa);e=Dt(Dt(Dt({},e),r),n)}return e};function a(a,o){const s=t.getProps(),l=t.getVariantContext(!0)||{},c=[],u=new Set;let h={},d=1/0;for(let e=0;e<ga;e++){const p=ma[e],f=n[p],m=void 0!==s[p]?s[p]:l[p],g=Jt(m),y=p===o?f.isActive:null;!1===y&&(d=e);let v=m===l[p]&&m!==s[p]&&g;if(v&&i&&t.manuallyAnimateOnMount&&(v=!1),f.protectedKeys=Dt({},h),!f.isActive&&null===y||!m&&!f.prevProp||$t(m)||"boolean"===typeof m)continue;let _=_a(f.prevProp,m)||p===o&&f.isActive&&!v&&g||e>d&&g,x=!1;const b=Array.isArray(m)?m:[m];let w=b.reduce(r,{});!1===y&&(w={});const{prevResolvedValues:S={}}=f,M=Dt(Dt({},S),w),T=t=>{_=!0,u.has(t)&&(x=!0,u.delete(t)),f.needsAnimating[t]=!0};for(const t in M){const e=w[t],n=S[t];if(h.hasOwnProperty(t))continue;let i=!1;i=gn(e)&&gn(n)?!ti(e,n):e!==n,i?void 0!==e?T(t):u.add(t):void 0!==e&&u.has(t)?T(t):f.protectedKeys[t]=!0}f.prevProp=m,f.prevResolvedValues=w,f.isActive&&(h=Dt(Dt({},h),w)),i&&t.blockInitialAnimation&&(_=!1),!_||v&&!x||c.push(...b.map(t=>({animation:t,options:Dt({type:p},a)})))}if(u.size){const e={};u.forEach(n=>{const i=t.getBaseTarget(n);void 0!==i&&(e[n]=i)}),c.push({animation:e})}let p=Boolean(c.length);return!i||!1!==s.initial&&s.initial!==s.animate||t.manuallyAnimateOnMount||(p=!1),i=!1,p?e(c):Promise.resolve()}return{animateChanges:a,setActive:function(e,i,r){var o;if(n[e].isActive===i)return Promise.resolve();null===(o=t.variantChildren)||void 0===o||o.forEach(t=>{var n;return null===(n=t.animationState)||void 0===n?void 0:n.setActive(e,i)}),n[e].isActive=i;const s=a(r,e);for(const t in n)n[t].protectedKeys={};return s},setAnimateFunction:function(n){e=n(t)},getState:()=>n}}function _a(t,e){return"string"===typeof e?e!==t:!!Array.isArray(e)&&!ti(e,t)}function xa(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}let ba=0;const wa={animation:{Feature:class extends Vn{constructor(t){super(t),t.animationState||(t.animationState=va(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),$t(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:e}=this.node.prevProps||{};t!==e&&this.updateAnimationControlsSubscription()}unmount(){}}},exit:{Feature:class extends Vn{constructor(){super(...arguments),this.id=ba++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:e,custom:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const r=this.node.animationState.setActive("exit",!t,{custom:null!==n&&void 0!==n?n:this.node.getProps().custom});e&&!t&&r.then(()=>e(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}}},Sa=(t,e)=>Math.abs(t-e);class Ma{constructor(t,e){let{transformPagePoint:n,contextWindow:i,dragSnapToOrigin:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const t=Aa(this.lastMoveEventInfo,this.history),e=null!==this.startEvent,n=function(t,e){const n=Sa(t.x,e.x),i=Sa(t.y,e.y);return Math.sqrt(n**2+i**2)}(t.offset,{x:0,y:0})>=3;if(!e&&!n)return;const{point:i}=t,{timestamp:r}=An;this.history.push(Dt(Dt({},i),{},{timestamp:r}));const{onStart:a,onMove:o}=this.handlers;e||(a&&a(this.lastMoveEvent,t),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,t)},this.handlePointerMove=(t,e)=>{this.lastMoveEvent=t,this.lastMoveEventInfo=Ta(e,this.transformPagePoint),Tn.update(this.updatePoint,!0)},this.handlePointerUp=(t,e)=>{this.end();const{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=Aa("pointercancel"===t.type?this.lastMoveEventInfo:Ta(e,this.transformPagePoint),this.history);this.startEvent&&n&&n(t,a),i&&i(t,a)},!kn(t))return;this.dragSnapToOrigin=r,this.handlers=e,this.transformPagePoint=n,this.contextWindow=i||window;const a=Ta(Ln(t),this.transformPagePoint),{point:o}=a,{timestamp:s}=An;this.history=[Dt(Dt({},o),{},{timestamp:s})];const{onSessionStart:l}=e;l&&l(t,Aa(a,this.history)),this.removeListeners=Nn(Dn(this.contextWindow,"pointermove",this.handlePointerMove),Dn(this.contextWindow,"pointerup",this.handlePointerUp),Dn(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),En(this.updatePoint)}}function Ta(t,e){return e?{point:e(t.point)}:t}function Ea(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Aa(t,e){let{point:n}=t;return{point:n,delta:Ea(n,Pa(e)),offset:Ea(n,Ca(e)),velocity:Ia(e,.1)}}function Ca(t){return t[0]}function Pa(t){return t[t.length-1]}function Ia(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,i=null;const r=Pa(t);for(;n>=0&&(i=t[n],!(r.timestamp-i.timestamp>ri(e)));)n--;if(!i)return{x:0,y:0};const a=ai(r.timestamp-i.timestamp);if(0===a)return{x:0,y:0};const o={x:(r.x-i.x)/a,y:(r.y-i.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Ra(t){return t.max-t.min}function ka(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return Math.abs(t-e)<=n}function La(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;t.origin=i,t.originPoint=Di(e.min,e.max,t.origin),t.scale=Ra(n)/Ra(e),(ka(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Di(n.min,n.max,t.origin)-t.originPoint,(ka(t.translate)||isNaN(t.translate))&&(t.translate=0)}function Da(t,e,n,i){La(t.x,e.x,n.x,i?i.originX:void 0),La(t.y,e.y,n.y,i?i.originY:void 0)}function za(t,e,n){t.min=n.min+e.min,t.max=t.min+Ra(e)}function Na(t,e,n){t.min=e.min-n.min,t.max=t.min+Ra(e)}function Oa(t,e,n){Na(t.x,e.x,n.x),Na(t.y,e.y,n.y)}function Fa(t,e,n){return{min:void 0!==e?t.min+e:void 0,max:void 0!==n?t.max+n-(t.max-t.min):void 0}}function Ba(t,e){let n=e.min-t.min,i=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,i]=[i,n]),{min:n,max:i}}const Ua=.35;function ja(t,e,n){return{min:Va(t,e),max:Va(t,n)}}function Va(t,e){return"number"===typeof t?t:t[e]||0}const Ha=()=>({x:{min:0,max:0},y:{min:0,max:0}});function Ga(t){return[t("x"),t("y")]}function Wa(t){let{top:e,left:n,right:i,bottom:r}=t;return{x:{min:n,max:i},y:{min:e,max:r}}}function qa(t){return void 0===t||1===t}function Za(t){let{scale:e,scaleX:n,scaleY:i}=t;return!qa(e)||!qa(n)||!qa(i)}function Xa(t){return Za(t)||Ya(t)||t.z||t.rotate||t.rotateX||t.rotateY}function Ya(t){return Ka(t.x)||Ka(t.y)}function Ka(t){return t&&"0%"!==t}function Ja(t,e,n){return n+e*(t-n)}function $a(t,e,n,i,r){return void 0!==r&&(t=Ja(t,r,i)),Ja(t,n,i)+e}function Qa(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;t.min=$a(t.min,e,n,i,r),t.max=$a(t.max,e,n,i,r)}function to(t,e){let{x:n,y:i}=e;Qa(t.x,n.translate,n.scale,n.originPoint),Qa(t.y,i.translate,i.scale,i.originPoint)}function eo(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function no(t,e){t.min=t.min+e,t.max=t.max+e}function io(t,e,n){let[i,r,a]=n;const o=void 0!==e[a]?e[a]:.5,s=Di(t.min,t.max,o);Qa(t,e[i],e[r],s,e.scale)}const ro=["x","scaleX","originX"],ao=["y","scaleY","originY"];function oo(t,e){io(t.x,e,ro),io(t.y,e,ao)}function so(t,e){return Wa(function(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),i=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(t.getBoundingClientRect(),e))}const lo=t=>{let{current:e}=t;return e?e.ownerDocument.defaultView:null},co=new WeakMap;class uo{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=t}start(t){let{snapToCursor:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Ma(t,{onSessionStart:t=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),e&&this.snapToCursor(Ln(t,"page").point)},onStart:(t,e)=>{const{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=Un(n),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ga(t=>{let e=this.getAxisMotionValue(t).get()||0;if(Oe.test(e)){const{projection:n}=this.visualElement;if(n&&n.layout){const i=n.layout.layoutBox[t];if(i){e=Ra(i)*(parseFloat(e)/100)}}}this.originPoint[t]=e}),r&&Tn.update(()=>r(t,e),!1,!0);const{animationState:a}=this.visualElement;a&&a.setActive("whileDrag",!0)},onMove:(t,e)=>{const{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:a}=this.getProps();if(!n&&!this.openGlobalLock)return;const{offset:o}=e;if(i&&null===this.currentDirection)return this.currentDirection=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x");return n}(o),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",e.point,o),this.updateAxis("y",e.point,o),this.visualElement.render(),a&&a(t,e)},onSessionEnd:(t,e)=>this.stop(t,e),resumeAnimation:()=>Ga(t=>{var e;return"paused"===this.getAnimationState(t)&&(null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.play())})},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:lo(this.visualElement)})}stop(t,e){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:i}=e;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Tn.update(()=>r(t,e))}cancel(){this.isDragging=!1;const{projection:t,animationState:e}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),e&&e.setActive("whileDrag",!1)}updateAxis(t,e,n){const{drag:i}=this.getProps();if(!n||!ho(t,i,this.currentDirection))return;const r=this.getAxisMotionValue(t);let a=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(a=function(t,e,n){let{min:i,max:r}=e;return void 0!==i&&t<i?t=n?Di(i,t,n.min):Math.max(t,i):void 0!==r&&t>r&&(t=n?Di(r,t,n.max):Math.min(t,r)),t}(a,this.constraints[t],this.elastic[t])),r.set(a)}resolveConstraints(){var t;const{dragConstraints:e,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(t=this.visualElement.projection)||void 0===t?void 0:t.layout,r=this.constraints;e&&Kt(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!e||!i)&&function(t,e){let{top:n,left:i,bottom:r,right:a}=e;return{x:Fa(t.x,i,a),y:Fa(t.y,n,r)}}(i.layoutBox,e),this.elastic=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ua;return!1===t?t=0:!0===t&&(t=Ua),{x:ja(t,"left","right"),y:ja(t,"top","bottom")}}(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Ga(t=>{this.getAxisMotionValue(t)&&(this.constraints[t]=function(t,e){const n={};return void 0!==e.min&&(n.min=e.min-t.min),void 0!==e.max&&(n.max=e.max-t.min),n}(i.layoutBox[t],this.constraints[t]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:e}=this.getProps();if(!t||!Kt(t))return!1;const n=t.current;ii(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(t,e,n){const i=so(t,n),{scroll:r}=e;return r&&(no(i.x,r.offset.x),no(i.y,r.offset.y)),i}(n,i.root,this.visualElement.getTransformPagePoint());let a=function(t,e){return{x:Ba(t.x,e.x),y:Ba(t.y,e.y)}}(i.layout.layoutBox,r);if(e){const t=e(function(t){let{x:e,y:n}=t;return{top:n.min,right:e.max,bottom:n.max,left:e.min}}(a));this.hasMutatedConstraints=!!t,t&&(a=Wa(t))}return a}startAnimation(t){const{drag:e,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},l=Ga(o=>{if(!ho(o,e,this.currentDirection))return;let l=s&&s[o]||{};a&&(l={min:0,max:0});const c=i?200:1e6,u=i?40:1e7,h=Dt(Dt({type:"inertia",velocity:n?t[o]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10},r),l);return this.startAxisValueAnimation(o,h)});return Promise.all(l).then(o)}startAxisValueAnimation(t,e){const n=this.getAxisMotionValue(t);return n.start(Gr(t,n,0,e))}stopAnimation(){Ga(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ga(t=>{var e;return null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.pause()})}getAnimationState(t){var e;return null===(e=this.getAxisMotionValue(t).animation)||void 0===e?void 0:e.state}getAxisMotionValue(t){const e="_drag"+t.toUpperCase(),n=this.visualElement.getProps(),i=n[e];return i||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){Ga(e=>{const{drag:n}=this.getProps();if(!ho(e,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(e);if(i&&i.layout){const{min:n,max:a}=i.layout.layoutBox[e];r.set(t[e]-Di(n,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:e}=this.getProps(),{projection:n}=this.visualElement;if(!Kt(e)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Ga(t=>{const e=this.getAxisMotionValue(t);if(e){const n=e.get();i[t]=function(t,e){let n=.5;const i=Ra(t),r=Ra(e);return r>i?n=tr(e.min,e.max-i,t.min):i>r&&(n=tr(t.min,t.max-r,e.min)),Ee(0,1,n)}({min:n,max:n},this.constraints[t])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),Ga(e=>{if(!ho(e,t,null))return;const n=this.getAxisMotionValue(e),{min:r,max:a}=this.constraints[e];n.set(Di(r,a,i[e]))})}addListeners(){if(!this.visualElement.current)return;co.set(this.visualElement,this);const t=Dn(this.visualElement.current,"pointerdown",t=>{const{drag:e,dragListener:n=!0}=this.getProps();e&&n&&this.start(t)}),e=()=>{const{dragConstraints:t}=this.getProps();Kt(t)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",e);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),e();const r=Rn(window,"resize",()=>this.scalePositionWithinConstraints()),a=n.addEventListener("didUpdate",t=>{let{delta:e,hasLayoutChanged:n}=t;this.isDragging&&n&&(Ga(t=>{const n=this.getAxisMotionValue(t);n&&(this.originPoint[t]+=e[t].translate,n.set(n.get()+e[t].translate))}),this.visualElement.render())});return()=>{r(),t(),i(),a&&a()}}getProps(){const t=this.visualElement.getProps(),{drag:e=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=Ua,dragMomentum:o=!0}=t;return Dt(Dt({},t),{},{drag:e,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:o})}}function ho(t,e,n){return(!0===e||e===t)&&(null===n||n===t)}const po=t=>(e,n)=>{t&&Tn.update(()=>t(e,n))};const fo={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function mo(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const go={correct:(t,e)=>{if(!e.target)return t;if("string"===typeof t){if(!Fe.test(t))return t;t=parseFloat(t)}const n=mo(t,e.target.x),i=mo(t,e.target.y);return"".concat(n,"% ").concat(i,"%")}},yo={correct:(t,e)=>{let{treeScale:n,projectionDelta:i}=e;const r=t,a=Xi.parse(t);if(a.length>5)return r;const o=Xi.createTransformer(t),s="number"!==typeof a[0]?1:0,l=i.x.scale*n.x,c=i.y.scale*n.y;a[0+s]/=l,a[1+s]/=c;const u=Di(l,c,.5);return"number"===typeof a[2+s]&&(a[2+s]/=u),"number"===typeof a[3+s]&&(a[3+s]/=u),o(a)}};class vo extends i.Component{componentDidMount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=t;var a;a=xo,Object.assign(me,a),r&&(e.group&&e.group.add(r),n&&n.register&&i&&n.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions(Dt(Dt({},r.options),{},{onExitComplete:()=>this.safeToRemove()}))),fo.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:e,visualElement:n,drag:i,isPresent:r}=this.props,a=n.projection;return a?(a.isPresent=r,i||t.layoutDependency!==e||void 0===e?a.willUpdate():this.safeToRemove(),t.isPresent!==r&&(r?a.promote():a.relegate()||Tn.postRender(()=>{const t=a.getStack();t&&t.members.length||this.safeToRemove()})),null):null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:e,switchLayoutGroup:n}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),e&&e.group&&e.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function _o(t){const[e,n]=function(){const t=(0,i.useContext)(Gt);if(null===t)return[!0,null];const{isPresent:e,onExitComplete:n,register:r}=t,a=(0,i.useId)();return(0,i.useEffect)(()=>r(a),[]),!e&&n?[!1,()=>n&&n(a)]:[!0]}(),r=(0,i.useContext)(se);return i.createElement(vo,Dt(Dt({},t),{},{layoutGroup:r,switchLayoutGroup:(0,i.useContext)(le),isPresent:e,safeToRemove:n}))}const xo={borderRadius:Dt(Dt({},go),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:go,borderTopRightRadius:go,borderBottomLeftRadius:go,borderBottomRightRadius:go,boxShadow:yo},bo=["TopLeft","TopRight","BottomLeft","BottomRight"],wo=bo.length,So=t=>"string"===typeof t?parseFloat(t):t,Mo=t=>"number"===typeof t||Fe.test(t);function To(t,e){return void 0!==t[e]?t[e]:t.borderRadius}const Eo=Co(0,.5,xi),Ao=Co(.5,.95,wn);function Co(t,e,n){return i=>i<t?0:i>e?1:n(tr(t,e,i))}function Po(t,e){t.min=e.min,t.max=e.max}function Io(t,e){Po(t.x,e.x),Po(t.y,e.y)}function Ro(t,e,n,i,r){return t=Ja(t-=e,1/n,i),void 0!==r&&(t=Ja(t,1/r,i)),t}function ko(t,e,n,i,r){let[a,o,s]=n;!function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t;Oe.test(e)&&(e=parseFloat(e),e=Di(o.min,o.max,e/100)-o.min);if("number"!==typeof e)return;let s=Di(a.min,a.max,i);t===a&&(s-=e),t.min=Ro(t.min,e,n,s,r),t.max=Ro(t.max,e,n,s,r)}(t,e[a],e[o],e[s],e.scale,i,r)}const Lo=["x","scaleX","originX"],Do=["y","scaleY","originY"];function zo(t,e,n,i){ko(t.x,e,Lo,n?n.x:void 0,i?i.x:void 0),ko(t.y,e,Do,n?n.y:void 0,i?i.y:void 0)}function No(t){return 0===t.translate&&1===t.scale}function Oo(t){return No(t.x)&&No(t.y)}function Fo(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function Bo(t){return Ra(t.x)/Ra(t.y)}class Uo{constructor(){this.members=[]}add(t){Zr(this.members,t),t.scheduleRender()}remove(t){if(Xr(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(t){const e=this.members.findIndex(e=>t===e);if(0===e)return!1;let n;for(let i=e;i>=0;i--){const t=this.members[i];if(!1!==t.isPresent){n=t;break}}return!!n&&(this.promote(n),!0)}promote(t,e){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,e&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:e,resumingFrom:n}=t;e.onExitComplete&&e.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function jo(t,e,n){let i="";const r=t.x.translate/e.x,a=t.y.translate/e.y;if((r||a)&&(i="translate3d(".concat(r,"px, ").concat(a,"px, 0) ")),1===e.x&&1===e.y||(i+="scale(".concat(1/e.x,", ").concat(1/e.y,") ")),n){const{rotate:t,rotateX:e,rotateY:r}=n;t&&(i+="rotate(".concat(t,"deg) ")),e&&(i+="rotateX(".concat(e,"deg) ")),r&&(i+="rotateY(".concat(r,"deg) "))}const o=t.x.scale*e.x,s=t.y.scale*e.y;return 1===o&&1===s||(i+="scale(".concat(o,", ").concat(s,")")),i||"none"}const Vo=(t,e)=>t.depth-e.depth;class Ho{constructor(){this.children=[],this.isDirty=!1}add(t){Zr(this.children,t),this.isDirty=!0}remove(t){Xr(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Vo),this.isDirty=!1,this.children.forEach(t)}}const Go=["","X","Y","Z"],Wo={visibility:"hidden"};let qo=0;const Zo={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Xo(t){let{attachResizeListener:e,defaultParent:n,measureScroll:i,checkIsScrollRoot:r,resetTransform:a}=t;return class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=qo++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Zo.totalNodes=Zo.resolvedTargetDeltas=Zo.recalculatedProjection=0,this.nodes.forEach(Jo),this.nodes.forEach(rs),this.nodes.forEach(as),this.nodes.forEach($o),function(t){window.MotionDebug&&window.MotionDebug.record(t)}(Zo)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=t,this.root=e?e.root||e:this,this.path=e?[...e.path,e]:[],this.parent=e,this.depth=e?e.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new Ho)}addEventListener(t,e){return this.eventHandlers.has(t)||this.eventHandlers.set(t,new Yr),this.eventHandlers.get(t).add(e)}notifyListeners(t){const e=this.eventHandlers.get(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e&&e.notify(...i)}hasListeners(t){return this.eventHandlers.has(t)}mount(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var i;this.isSVG=(i=t)instanceof SVGElement&&"svg"!==i.tagName,this.instance=t;const{layoutId:r,layout:a,visualElement:o}=this.options;if(o&&!o.current&&o.mount(t),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(a||r)&&(this.isLayoutDirty=!0),e){let n;const i=()=>this.root.updateBlockedByResize=!1;e(t,()=>{this.root.updateBlockedByResize=!0,n&&n(),n=function(t,e){const n=performance.now(),i=r=>{let{timestamp:a}=r;const o=a-n;o>=e&&(En(i),t(o-e))};return Tn.read(i,!0),()=>En(i)}(i,250),fo.hasAnimatedSinceResize&&(fo.hasAnimatedSinceResize=!1,this.nodes.forEach(is))})}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&o&&(r||a)&&this.addEventListener("didUpdate",t=>{let{delta:e,hasLayoutChanged:n,hasRelativeTargetChanged:i,layout:r}=t;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const a=this.options.transition||o.getDefaultTransition()||hs,{onLayoutAnimationStart:s,onLayoutAnimationComplete:l}=o.getProps(),c=!this.targetLayout||!Fo(this.targetLayout,r)||i,u=!n&&i;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||u||n&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(e,u);const t=Dt(Dt({},Vr(a,"layout")),{},{onPlay:s,onComplete:l});(o.shouldReduceMotion||this.options.layoutRoot)&&(t.delay=0,t.type=!1),this.startAnimation(t)}else n||is(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const t=this.getStack();t&&t.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,En(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(os),this.animationId++)}getTransformTemplate(){const{visualElement:t}=this.options;return t&&t.getProps().transformTemplate}willUpdate(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const t=this.path[r];t.shouldResetTransform=!0,t.updateScroll("snapshot"),t.options.layoutRoot&&t.willUpdate(!1)}const{layoutId:e,layout:n}=this.options;if(void 0===e&&!n)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),t&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(ts);this.isUpdating||this.nodes.forEach(es),this.isUpdating=!1,this.nodes.forEach(ns),this.nodes.forEach(Yo),this.nodes.forEach(Ko),this.clearAllSnapshots();const t=performance.now();An.delta=Ee(0,1e3/60,t-An.timestamp),An.timestamp=t,An.isProcessing=!0,Cn.update.process(An),Cn.preRender.process(An),Cn.render.process(An),An.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Qo),this.sharedNodes.forEach(ss)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Tn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Tn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure())}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const t=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:e}=this.options;e&&e.notify("LayoutMeasure",this.layout.layoutBox,t?t.layoutBox:void 0)}updateScroll(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",e=Boolean(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===t&&(e=!1),e&&(this.scroll={animationId:this.root.animationId,phase:t,isRoot:r(this.instance),offset:i(this.instance)})}resetTransform(){if(!a)return;const t=this.isLayoutDirty||this.shouldResetTransform,e=this.projectionDelta&&!Oo(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,r=i!==this.prevTransformTemplateValue;t&&(e||Xa(this.latestValues)||r)&&(a(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const e=this.measurePageBox();let n=this.removeElementScroll(e);var i;return t&&(n=this.removeTransform(n)),fs((i=n).x),fs(i.y),{animationId:this.root.animationId,measuredBox:e,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const e=t.measureViewportBox(),{scroll:n}=this.root;return n&&(no(e.x,n.offset.x),no(e.y,n.offset.y)),e}removeElementScroll(t){const e={x:{min:0,max:0},y:{min:0,max:0}};Io(e,t);for(let n=0;n<this.path.length;n++){const i=this.path[n],{scroll:r,options:a}=i;if(i!==this.root&&r&&a.layoutScroll){if(r.isRoot){Io(e,t);const{scroll:n}=this.root;n&&(no(e.x,-n.offset.x),no(e.y,-n.offset.y))}no(e.x,r.offset.x),no(e.y,r.offset.y)}}return e}applyTransform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};Io(n,t);for(let i=0;i<this.path.length;i++){const t=this.path[i];!e&&t.options.layoutScroll&&t.scroll&&t!==t.root&&oo(n,{x:-t.scroll.offset.x,y:-t.scroll.offset.y}),Xa(t.latestValues)&&oo(n,t.latestValues)}return Xa(this.latestValues)&&oo(n,this.latestValues),n}removeTransform(t){const e={x:{min:0,max:0},y:{min:0,max:0}};Io(e,t);for(let n=0;n<this.path.length;n++){const t=this.path[n];if(!t.instance)continue;if(!Xa(t.latestValues))continue;Za(t.latestValues)&&t.updateSnapshot();const i=Ha();Io(i,t.measurePageBox()),zo(e,t.latestValues,t.snapshot?t.snapshot.layoutBox:void 0,i)}return Xa(this.latestValues)&&zo(e,this.latestValues),e}setTargetDelta(t){this.targetDelta=t,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(t){this.options=Dt(Dt(Dt({},this.options),t),{},{crossfade:void 0===t.crossfade||t.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==An.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==n;if(!(t||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty)||this.attemptToResolveRelativeTarget))return;const{layout:r,layoutId:a}=this.options;if(this.layout&&(r||a)){if(this.resolvedRelativeTargetAt=An.timestamp,!this.targetDelta&&!this.relativeTarget){const t=this.getClosestProjectingParent();t&&t.layout&&1!==this.animationProgress?(this.relativeParent=t,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Oa(this.relativeTargetOrigin,this.layout.layoutBox,t.layout.layoutBox),Io(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,s,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,s=this.relativeTarget,l=this.relativeParent.target,za(o.x,s.x,l.x),za(o.y,s.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Io(this.target,this.layout.layoutBox),to(this.target,this.targetDelta)):Io(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const t=this.getClosestProjectingParent();t&&Boolean(t.resumingFrom)===Boolean(this.resumingFrom)&&!t.options.layoutScroll&&t.target&&1!==this.animationProgress?(this.relativeParent=t,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},Oa(this.relativeTargetOrigin,this.target,t.target),Io(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Zo.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Za(this.parent.latestValues)&&!Ya(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var t;const e=this.getLead(),n=Boolean(this.resumingFrom)||this!==e;let i=!0;if((this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty))&&(i=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===An.timestamp&&(i=!1),i)return;const{layout:r,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!a)return;Io(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,s=this.treeScale.y;!function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length;if(!r)return;let a,o;e.x=e.y=1;for(let s=0;s<r;s++){a=n[s],o=a.projectionDelta;const r=a.instance;r&&r.style&&"contents"===r.style.display||(i&&a.options.layoutScroll&&a.scroll&&a!==a.root&&oo(t,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,to(t,o)),i&&Xa(a.latestValues)&&oo(t,a.latestValues))}e.x=eo(e.x),e.y=eo(e.y)}(this.layoutCorrected,this.treeScale,this.path,n),!e.layout||e.target||1===this.treeScale.x&&1===this.treeScale.y||(e.target=e.layout.layoutBox);const{target:l}=e;if(!l)return void(this.projectionTransform&&(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionTransform="none",this.scheduleRender()));this.projectionDelta||(this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}});const c=this.projectionTransform;Da(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.projectionTransform=jo(this.projectionDelta,this.treeScale),this.projectionTransform===c&&this.treeScale.x===o&&this.treeScale.y===s||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Zo.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.options.scheduleRender&&this.options.scheduleRender(),t){const t=this.getStack();t&&t.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,i=n?n.latestValues:{},r=Dt({},this.latestValues),a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!e;const o={x:{min:0,max:0},y:{min:0,max:0}},s=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(s&&!c&&!0===this.options.crossfade&&!this.path.some(us));let h;this.animationProgress=0,this.mixTargetDelta=e=>{const n=e/1e3;ls(a.x,t.x,n),ls(a.y,t.y,n),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Oa(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(t,e,n,i){cs(t.x,e.x,n.x,i),cs(t.y,e.y,n.y,i)}(this.relativeTarget,this.relativeTargetOrigin,o,n),h&&function(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}(this.relativeTarget,h)&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Io(h,this.relativeTarget)),s&&(this.animationValues=r,function(t,e,n,i,r,a){r?(t.opacity=Di(0,void 0!==n.opacity?n.opacity:1,Eo(i)),t.opacityExit=Di(void 0!==e.opacity?e.opacity:1,0,Ao(i))):a&&(t.opacity=Di(void 0!==e.opacity?e.opacity:1,void 0!==n.opacity?n.opacity:1,i));for(let o=0;o<wo;o++){const r="border".concat(bo[o],"Radius");let a=To(e,r),s=To(n,r);void 0===a&&void 0===s||(a||(a=0),s||(s=0),0===a||0===s||Mo(a)===Mo(s)?(t[r]=Math.max(Di(So(a),So(s),i),0),(Oe.test(s)||Oe.test(a))&&(t[r]+="%")):t[r]=s)}(e.rotate||n.rotate)&&(t.rotate=Di(e.rotate||0,n.rotate||0,i))}(r,i,this.latestValues,n,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(t){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(En(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Tn.update(()=>{fo.hasAnimatedSinceResize=!0,this.currentAnimation=function(t,e,n){const i=_e(t)?t:$r(t);return i.start(Gr("",i,e,n)),i.animation}(0,1e3,Dt(Dt({},t),{},{onUpdate:e=>{this.mixTargetDelta(e),t.onUpdate&&t.onUpdate(e)},onComplete:()=>{t.onComplete&&t.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const t=this.getStack();t&&t.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const t=this.getLead();let{targetWithTransforms:e,target:n,layout:i,latestValues:r}=t;if(e&&n&&i){if(this!==t&&this.layout&&i&&ms(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const e=Ra(this.layout.layoutBox.x);n.x.min=t.target.x.min,n.x.max=n.x.min+e;const i=Ra(this.layout.layoutBox.y);n.y.min=t.target.y.min,n.y.max=n.y.min+i}Io(e,n),oo(e,r),Da(this.projectionDeltaWithTransform,this.layoutCorrected,e,r)}}registerSharedNode(t,e){this.sharedNodes.has(t)||this.sharedNodes.set(t,new Uo);this.sharedNodes.get(t).add(e);const n=e.options.initialPromotionConfig;e.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(e):void 0})}isLead(){const t=this.getStack();return!t||t.lead===this}getLead(){var t;const{layoutId:e}=this.options;return e&&(null===(t=this.getStack())||void 0===t?void 0:t.lead)||this}getPrevLead(){var t;const{layoutId:e}=this.options;return e?null===(t=this.getStack())||void 0===t?void 0:t.prevLead:void 0}getStack(){const{layoutId:t}=this.options;if(t)return this.root.sharedNodes.get(t)}promote(){let{needsReset:t,transition:e,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this.getStack();i&&i.promote(this,n),t&&(this.projectionDelta=void 0,this.needsReset=!0),e&&this.setOptions({transition:e})}relegate(){const t=this.getStack();return!!t&&t.relegate(this)}resetRotation(){const{visualElement:t}=this.options;if(!t)return;let e=!1;const{latestValues:n}=t;if((n.rotate||n.rotateX||n.rotateY||n.rotateZ)&&(e=!0),!e)return;const i={};for(let r=0;r<Go.length;r++){const e="rotate"+Go[r];n[e]&&(i[e]=n[e],t.setStaticValue(e,0))}t.render();for(const r in i)t.setStaticValue(r,i[r]);t.scheduleRender()}getProjectionStyles(t){var e,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Wo;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=vn(null===t||void 0===t?void 0:t.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const a=this.getLead();if(!this.projectionDelta||!this.layout||!a.target){const e={};return this.options.layoutId&&(e.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,e.pointerEvents=vn(null===t||void 0===t?void 0:t.pointerEvents)||""),this.hasProjected&&!Xa(this.latestValues)&&(e.transform=r?r({},""):"none",this.hasProjected=!1),e}const o=a.animationValues||a.latestValues;this.applyTransformsToTarget(),i.transform=jo(this.projectionDeltaWithTransform,this.treeScale,o),r&&(i.transform=r(o,i.transform));const{x:s,y:l}=this.projectionDelta;i.transformOrigin="".concat(100*s.origin,"% ").concat(100*l.origin,"% 0"),a.animationValues?i.opacity=a===this?null!==(n=null!==(e=o.opacity)&&void 0!==e?e:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:o.opacityExit:i.opacity=a===this?void 0!==o.opacity?o.opacity:"":void 0!==o.opacityExit?o.opacityExit:0;for(const c in me){if(void 0===o[c])continue;const{correct:t,applyTo:e}=me[c],n="none"===i.transform?o[c]:t(o[c],a);if(e){const t=e.length;for(let r=0;r<t;r++)i[e[r]]=n}else i[c]=n}return this.options.layoutId&&(i.pointerEvents=a===this?vn(null===t||void 0===t?void 0:t.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(t=>{var e;return null===(e=t.currentAnimation)||void 0===e?void 0:e.stop()}),this.root.nodes.forEach(ts),this.root.sharedNodes.clear()}}}function Yo(t){t.updateLayout()}function Ko(t){var e;const n=(null===(e=t.resumeFrom)||void 0===e?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:e,measuredBox:i}=t.layout,{animationType:r}=t.options,a=n.source!==t.layout.source;"size"===r?Ga(t=>{const i=a?n.measuredBox[t]:n.layoutBox[t],r=Ra(i);i.min=e[t].min,i.max=i.min+r}):ms(r,n.layoutBox,e)&&Ga(i=>{const r=a?n.measuredBox[i]:n.layoutBox[i],o=Ra(e[i]);r.max=r.min+o,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[i].max=t.relativeTarget[i].min+o)});const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};Da(o,e,n.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?Da(s,t.applyTransform(i,!0),n.measuredBox):Da(s,e,n.layoutBox);const l=!Oo(o);let c=!1;if(!t.resumeFrom){const i=t.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:a}=i;if(r&&a){const o={x:{min:0,max:0},y:{min:0,max:0}};Oa(o,n.layoutBox,r.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};Oa(s,e,a.layoutBox),Fo(o,s)||(c=!0),i.options.layoutRoot&&(t.relativeTarget=s,t.relativeTargetOrigin=o,t.relativeParent=i)}}}t.notifyListeners("didUpdate",{layout:e,snapshot:n,delta:s,layoutDelta:o,hasLayoutChanged:l,hasRelativeTargetChanged:c})}else if(t.isLead()){const{onExitComplete:e}=t.options;e&&e()}t.options.transition=void 0}function Jo(t){Zo.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=Boolean(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function $o(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Qo(t){t.clearSnapshot()}function ts(t){t.clearMeasurements()}function es(t){t.isLayoutDirty=!1}function ns(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function is(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function rs(t){t.resolveTargetDelta()}function as(t){t.calcProjection()}function os(t){t.resetRotation()}function ss(t){t.removeLeadSnapshot()}function ls(t,e,n){t.translate=Di(e.translate,0,n),t.scale=Di(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function cs(t,e,n,i){t.min=Di(e.min,n.min,i),t.max=Di(e.max,n.max,i)}function us(t){return t.animationValues&&void 0!==t.animationValues.opacityExit}const hs={duration:.45,ease:[.4,0,.1,1]},ds=t=>"undefined"!==typeof navigator&&navigator.userAgent.toLowerCase().includes(t),ps=ds("applewebkit/")&&!ds("chrome/")?Math.round:wn;function fs(t){t.min=ps(t.min),t.max=ps(t.max)}function ms(t,e,n){return"position"===t||"preserve-aspect"===t&&!ka(Bo(e),Bo(n),.2)}const gs=Xo({attachResizeListener:(t,e)=>Rn(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ys={current:void 0},vs=Xo({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!ys.current){const t=new gs({});t.mount(window),t.setOptions({layoutScroll:!0}),ys.current=t}return ys.current},resetTransform:(t,e)=>{t.style.transform=void 0!==e?e:"none"},checkIsScrollRoot:t=>Boolean("fixed"===window.getComputedStyle(t).position)}),_s={pan:{Feature:class extends Vn{constructor(){super(...arguments),this.removePointerDownListener=wn}onPointerDown(t){this.session=new Ma(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:lo(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:e,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:po(t),onStart:po(e),onMove:n,onEnd:(t,e)=>{delete this.session,i&&Tn.update(()=>i(t,e))}}}mount(){this.removePointerDownListener=Dn(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends Vn{constructor(t){super(t),this.removeGroupControls=wn,this.removeListeners=wn,this.controls=new uo(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||wn}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:vs,MeasureLayout:_o}};const xs=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function bs(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;ii(n<=4,'Max CSS variable fallback depth detected in property "'.concat(t,'". This may indicate a circular fallback dependency.'));const[i,r]=function(t){const e=xs.exec(t);if(!e)return[,];const[,n,i]=e;return[n,i]}(t);if(!i)return;const a=window.getComputedStyle(e).getPropertyValue(i);if(a){const t=a.trim();return qr(t)?parseFloat(t):t}return Me(r)?bs(r,e,n+1):r}function ws(t,e,n){let i=Object.assign({},(function(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(e),e));const r=t.current;if(!(r instanceof Element))return{target:i,transitionEnd:n};n&&(n=Dt({},n)),t.values.forEach(t=>{const e=t.get();if(!Me(e))return;const n=bs(e,r);n&&t.set(n)});for(const a in i){const t=i[a];if(!Me(t))continue;const e=bs(t,r);e&&(i[a]=e,n||(n={}),void 0===n[a]&&(n[a]=t))}return{target:i,transitionEnd:n}}const Ss=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Ms=t=>Ss.has(t),Ts=t=>t===Ae||t===Fe,Es=(t,e)=>parseFloat(t.split(", ")[e]),As=(t,e)=>(n,i)=>{let{transform:r}=i;if("none"===r||!r)return 0;const a=r.match(/^matrix3d\((.+)\)$/);if(a)return Es(a[1],e);{const e=r.match(/^matrix\((.+)\)$/);return e?Es(e[1],t):0}},Cs=new Set(["x","y","z"]),Ps=ge.filter(t=>!Cs.has(t));const Is={width:(t,e)=>{let{x:n}=t,{paddingLeft:i="0",paddingRight:r="0"}=e;return n.max-n.min-parseFloat(i)-parseFloat(r)},height:(t,e)=>{let{y:n}=t,{paddingTop:i="0",paddingBottom:r="0"}=e;return n.max-n.min-parseFloat(i)-parseFloat(r)},top:(t,e)=>{let{top:n}=e;return parseFloat(n)},left:(t,e)=>{let{left:n}=e;return parseFloat(n)},bottom:(t,e)=>{let{y:n}=t,{top:i}=e;return parseFloat(i)+(n.max-n.min)},right:(t,e)=>{let{x:n}=t,{left:i}=e;return parseFloat(i)+(n.max-n.min)},x:As(4,13),y:As(5,14)};Is.translateX=Is.x,Is.translateY=Is.y;const Rs=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Dt({},e),i=Dt({},i);const r=Object.keys(e).filter(Ms);let a=[],o=!1;const s=[];if(r.forEach(r=>{const l=t.getValue(r);if(!t.hasValue(r))return;let c=n[r],u=ea(c);const h=e[r];let d;if(gn(h)){const t=h.length,e=null===h[0]?1:0;c=h[e],u=ea(c);for(let n=e;n<t&&null!==h[n];n++)d?ii(ea(h[n])===d,"All keyframes must be of the same type"):(d=ea(h[n]),ii(d===u||Ts(u)&&Ts(d),"Keyframes must be of the same dimension as the current value"))}else d=ea(h);if(u!==d)if(Ts(u)&&Ts(d)){const t=l.get();"string"===typeof t&&l.set(parseFloat(t)),"string"===typeof h?e[r]=parseFloat(h):Array.isArray(h)&&d===Fe&&(e[r]=h.map(parseFloat))}else(null===u||void 0===u?void 0:u.transform)&&(null===d||void 0===d?void 0:d.transform)&&(0===c||0===h)?0===c?l.set(d.transform(c)):e[r]=u.transform(h):(o||(a=function(t){const e=[];return Ps.forEach(n=>{const i=t.getValue(n);void 0!==i&&(e.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}(t),o=!0),s.push(r),i[r]=void 0!==i[r]?i[r]:e[r],l.jump(h))}),s.length){const n=s.indexOf("height")>=0?window.pageYOffset:null,r=((t,e,n)=>{const i=e.measureViewportBox(),r=e.current,a=getComputedStyle(r),{display:o}=a,s={};"none"===o&&e.setStaticValue("display",t.display||"block"),n.forEach(t=>{s[t]=Is[t](i,a)}),e.render();const l=e.measureViewportBox();return n.forEach(n=>{const i=e.getValue(n);i&&i.jump(s[n]),t[n]=Is[n](l,a)}),t})(e,t,s);return a.length&&a.forEach(e=>{let[n,i]=e;t.getValue(n).set(i)}),t.render(),Wt&&null!==n&&window.scrollTo({top:n}),{target:r,transitionEnd:i}}return{target:e,transitionEnd:i}};function ks(t,e,n,i){return(t=>Object.keys(t).some(Ms))(e)?Rs(t,e,n,i):{target:e,transitionEnd:i}}const Ls={current:null},Ds={current:!1};const zs=new WeakMap,Ns=["willChange"],Os=["children"],Fs=Object.keys(oe),Bs=Fs.length,Us=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],js=te.length;class Vs{constructor(t){let{parent:e,props:n,presenceContext:i,reducedMotionConfig:r,visualState:a}=t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Tn.render(this.render,!1,!0);const{latestValues:s,renderState:l}=a;this.latestValues=s,this.baseTarget=Dt({},s),this.initialValues=n.initial?Dt({},s):{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.isControllingVariants=ee(n),this.isVariantNode=ne(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(e&&e.current);const c=this.scrapeMotionValuesFromProps(n,{}),{willChange:u}=c,h=Qe(c,Ns);for(const d in h){const t=h[d];void 0!==s[d]&&_e(t)&&(t.set(s[d],!1),Wr(u)&&u.add(d))}}scrapeMotionValuesFromProps(t,e){return{}}mount(t){this.current=t,zs.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,e)=>this.bindToMotionValue(e,t)),Ds.current||function(){if(Ds.current=!0,Wt)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Ls.current=t.matches;t.addListener(e),e()}else Ls.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Ls.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){zs.delete(this.current),this.projection&&this.projection.unmount(),En(this.notifyUpdate),En(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,e){const n=ye.has(t),i=e.on("change",e=>{this.latestValues[t]=e,this.props.onUpdate&&Tn.update(this.notifyUpdate,!1,!0),n&&this.projection&&(this.projection.isTransformDirty=!0)}),r=e.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{i(),r()})}sortNodePosition(t){return this.current&&this.sortInstanceNodePosition&&this.type===t.type?this.sortInstanceNodePosition(this.current,t.current):0}loadFeatures(t,e,n,i){let r,a,{children:o}=t,s=Qe(t,Os);for(let l=0;l<Bs;l++){const t=Fs[l],{isEnabled:e,Feature:n,ProjectionNode:i,MeasureLayout:o}=oe[t];i&&(r=i),e(s)&&(!this.features[t]&&n&&(this.features[t]=new n(this)),o&&(a=o))}if(("html"===this.type||"svg"===this.type)&&!this.projection&&r){this.projection=new r(this.latestValues,this.parent&&this.parent.projection);const{layoutId:t,layout:e,drag:n,dragConstraints:a,layoutScroll:o,layoutRoot:l}=s;this.projection.setOptions({layoutId:t,layout:e,alwaysMeasureLayout:Boolean(n)||a&&Kt(a),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:"string"===typeof e?e:"both",initialPromotionConfig:i,layoutScroll:o,layoutRoot:l})}return a}updateFeatures(){for(const t in this.features){const e=this.features[t];e.isMounted?e.update():(e.mount(),e.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,e){this.latestValues[t]=e}makeTargetAnimatable(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.makeTargetAnimatableFromInstance(t,this.props,e)}update(t,e){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=e;for(let n=0;n<Us.length;n++){const e=Us[n];this.propEventSubscriptions[e]&&(this.propEventSubscriptions[e](),delete this.propEventSubscriptions[e]);const i=t["on"+e];i&&(this.propEventSubscriptions[e]=this.on(e,i))}this.prevMotionValues=function(t,e,n){const{willChange:i}=e;for(const r in e){const a=e[r],o=n[r];if(_e(a))t.addValue(r,a),Wr(i)&&i.add(r);else if(_e(o))t.addValue(r,$r(a,{owner:t})),Wr(i)&&i.remove(r);else if(o!==a)if(t.hasValue(r)){const e=t.getValue(r);!e.hasAnimated&&e.set(a)}else{const e=t.getStaticValue(r);t.addValue(r,$r(void 0!==e?e:a,{owner:t}))}}for(const r in n)void 0===e[r]&&t.removeValue(r);return e}(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const t=this.parent&&this.parent.getVariantContext()||{};return void 0!==this.props.initial&&(t.initial=this.props.initial),t}const t={};for(let e=0;e<js;e++){const n=te[e],i=this.props[n];(Jt(i)||!1===i)&&(t[n]=i)}return t}addVariantChild(t){const e=this.getClosestVariantNode();if(e)return e.variantChildren&&e.variantChildren.add(t),()=>e.variantChildren.delete(t)}addValue(t,e){e!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,e)),this.values.set(t,e),this.latestValues[t]=e.get()}removeValue(t){this.values.delete(t);const e=this.valueSubscriptions.get(t);e&&(e(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,e){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return void 0===n&&void 0!==e&&(n=$r(e,{owner:this}),this.addValue(t,n)),n}readValue(t){var e;return void 0===this.latestValues[t]&&this.current?null!==(e=this.getBaseTargetFromProps(this.props,t))&&void 0!==e?e:this.readValueFromInstance(this.current,t,this.options):this.latestValues[t]}setBaseTarget(t,e){this.baseTarget[t]=e}getBaseTarget(t){var e;const{initial:n}=this.props,i="string"===typeof n||"object"===typeof n?null===(e=mn(this.props,n))||void 0===e?void 0:e[t]:void 0;if(n&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,t);return void 0===r||_e(r)?void 0!==this.initialValues[t]&&void 0===i?void 0:this.baseTarget[t]:r}on(t,e){return this.events[t]||(this.events[t]=new Yr),this.events[t].add(e)}notify(t){if(this.events[t]){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.events[t].notify(...n)}}}const Hs=["transition","transitionEnd"];class Gs extends Vs{sortInstanceNodePosition(t,e){return 2&t.compareDocumentPosition(e)?1:-1}getBaseTargetFromProps(t,e){return t.style?t.style[e]:void 0}removeValueFromRenderState(t,e){let{vars:n,style:i}=e;delete n[t],delete i[t]}makeTargetAnimatableFromInstance(t,e,n){let{transition:i,transitionEnd:r}=t,a=Qe(t,Hs),{transformValues:o}=e,s=function(t,e,n){const i={};for(const r in t){const t=sa(r,e);if(void 0!==t)i[r]=t;else{const t=n.getValue(r);t&&(i[r]=t.get())}}return i}(a,i||{},this);if(o&&(r&&(r=o(r)),a&&(a=o(a)),s&&(s=o(s))),n){!function(t,e,n){var i,r;const a=Object.keys(e).filter(e=>!t.hasValue(e)),o=a.length;if(o)for(let s=0;s<o;s++){const o=a[s],l=e[o];let c=null;Array.isArray(l)&&(c=l[0]),null===c&&(c=null!==(r=null!==(i=n[o])&&void 0!==i?i:t.readValue(o))&&void 0!==r?r:e[o]),void 0!==c&&null!==c&&("string"===typeof c&&(qr(c)||Br(c))?c=parseFloat(c):!ia(c)&&Xi.test(l)&&(c=Fr(o,l)),t.addValue(o,$r(c,{owner:t})),void 0===n[o]&&(n[o]=c),null!==c&&t.setBaseTarget(o,c))}}(this,a,s);const t=((t,e,n,i)=>{const r=ws(t,e,i);return ks(t,e=r.target,n,i=r.transitionEnd)})(this,a,s,r);r=t.transitionEnd,a=t.target}return Dt({transition:i,transitionEnd:r},a)}}class Ws extends Gs{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,e){if(ye.has(e)){const t=Or(e);return t&&t.default||0}{const i=(n=t,window.getComputedStyle(n)),r=(Se(e)?i.getPropertyValue(e):i[e])||0;return"string"===typeof r?r.trim():r}var n}measureInstanceViewportBox(t,e){let{transformPagePoint:n}=e;return so(t,n)}build(t,e,n,i){Ge(t,e,n,i.transformTemplate)}scrapeMotionValuesFromProps(t,e){return pn(t,e)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;_e(t)&&(this.childSubscription=t.on("change",t=>{this.current&&(this.current.textContent="".concat(t))}))}renderInstance(t,e,n,i){un(t,e,n,i)}}class qs extends Gs{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,e){return t[e]}readValueFromInstance(t,e){if(ye.has(e)){const t=Or(e);return t&&t.default||0}return e=hn.has(e)?e:Xt(e),t.getAttribute(e)}measureInstanceViewportBox(){return{x:{min:0,max:0},y:{min:0,max:0}}}scrapeMotionValuesFromProps(t,e){return fn(t,e)}build(t,e,n,i){an(t,e,n,this.isSVGTag,i.transformTemplate)}renderInstance(t,e,n,i){dn(t,e,0,i)}mount(t){this.isSVGTag=sn(t.tagName),super.mount(t)}}const Zs=(t,e)=>fe(t)?new qs(e,{enableHardwareAcceleration:!1}):new Ws(e,{enableHardwareAcceleration:!0}),Xs={layout:{ProjectionNode:vs,MeasureLayout:_o}},Ys=Dt(Dt(Dt(Dt({},wa),Qn),_s),Xs),Ks=de((t,e)=>function(t,e,n,i){let{forwardMotionProps:r=!1}=e;return Dt(Dt({},fe(t)?Pn:In),{},{preloadedFeatures:n,useRender:cn(r),createVisualElement:i,Component:t})}(t,e,Ys,Zs));const Js=function(){return(0,zt.jsxs)("div",{className:"story-mode-preview",children:[(0,zt.jsxs)("div",{className:"story-header",children:[(0,zt.jsxs)("h2",{className:"story-title",children:[(0,zt.jsx)("span",{className:"story-mode-label",children:"Story Mode:"}),"Journey of an Asteroid"]}),(0,zt.jsx)("p",{className:"story-description",children:"Follow the path of an asteroid from deep space to Earth impact in our immersive scroll-based storytelling experience. Witness the journey through scientifically accurate simulations."})]}),(0,zt.jsxs)("div",{className:"story-features",children:[(0,zt.jsxs)("div",{className:"feature-grid",children:[(0,zt.jsxs)(Ks.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"feature-icon",children:(0,zt.jsx)("span",{className:"icon-number",children:"1"})}),(0,zt.jsx)("h4",{children:"Detection"}),(0,zt.jsx)("p",{children:"Discover how astronomers detect and track potentially hazardous asteroids."})]}),(0,zt.jsxs)(Ks.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"feature-icon",children:(0,zt.jsx)("span",{className:"icon-number",children:"2"})}),(0,zt.jsx)("h4",{children:"Trajectory"}),(0,zt.jsx)("p",{children:"Follow the asteroid's path through space using gravitational physics models."})]}),(0,zt.jsxs)(Ks.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"feature-icon",children:(0,zt.jsx)("span",{className:"icon-number",children:"3"})}),(0,zt.jsx)("h4",{children:"Approach"}),(0,zt.jsx)("p",{children:"Experience the final approach as the asteroid enters Earth's atmosphere."})]}),(0,zt.jsxs)(Ks.div,{className:"feature-item",whileHover:{scale:1.05},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"feature-icon",children:(0,zt.jsx)("span",{className:"icon-number",children:"4"})}),(0,zt.jsx)("h4",{children:"Impact"}),(0,zt.jsx)("p",{children:"Witness the moment of impact and its immediate consequences on Earth."})]})]}),(0,zt.jsx)("div",{className:"story-preview-visual",children:(0,zt.jsxs)("div",{className:"preview-container",children:[(0,zt.jsxs)("div",{className:"preview-step active",children:[(0,zt.jsx)("h4",{children:"Step 2: Trajectory"}),(0,zt.jsx)("p",{children:"The asteroid is put on a collision with prehchts using gravitational models."})]}),(0,zt.jsxs)("div",{className:"preview-earth",children:[(0,zt.jsx)("div",{className:"earth-globe"}),(0,zt.jsx)("div",{className:"asteroid-trail"})]})]})})]}),(0,zt.jsx)("div",{className:"story-action",children:(0,zt.jsx)(At,{to:"/story",className:"btn btn--primary btn--large",children:"Start Story Mode"})})]})};const $s=function(){return(0,zt.jsxs)("div",{className:"research-dashboard",children:[(0,zt.jsxs)("div",{className:"dashboard-header",children:[(0,zt.jsxs)("h2",{className:"dashboard-title",children:["Powerful Research ",(0,zt.jsx)("span",{className:"text-gradient",children:"Dashboard"})]}),(0,zt.jsx)("p",{className:"dashboard-description",children:"Access professional tools to simulate asteroid impacts with scientific accuracy. Analyze results and generate comprehensive reports."})]}),(0,zt.jsxs)("div",{className:"dashboard-grid",children:[(0,zt.jsxs)(Ks.div,{className:"dashboard-card",whileHover:{scale:1.02},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"card-icon card-icon--blue",children:(0,zt.jsx)("span",{children:"\u25b6"})}),(0,zt.jsx)("h3",{children:"Run Simulation"}),(0,zt.jsx)("p",{children:"Set asteroid parameters like size, velocity, angle, and impact location to run scientifically accurate simulations."}),(0,zt.jsxs)(At,{to:"/dashboard",className:"card-action",children:["Start Dashboard",(0,zt.jsx)("span",{className:"arrow",children:"\u2192"})]})]}),(0,zt.jsxs)(Ks.div,{className:"dashboard-card",whileHover:{scale:1.02},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"card-icon card-icon--purple",children:(0,zt.jsx)("span",{children:"\ud83d\udcca"})}),(0,zt.jsx)("h3",{children:"View Results"}),(0,zt.jsx)("p",{children:"Explore detailed impact results including blast radius, energy released, and effective population loss scenarios."}),(0,zt.jsxs)(At,{to:"/results",className:"card-action",children:["See Results",(0,zt.jsx)("span",{className:"arrow",children:"\u2192"})]})]}),(0,zt.jsxs)(Ks.div,{className:"dashboard-card",whileHover:{scale:1.02},transition:{duration:.3},children:[(0,zt.jsx)("div",{className:"card-icon card-icon--orange",children:(0,zt.jsx)("span",{children:"\ud83d\udce5"})}),(0,zt.jsx)("h3",{children:"Download Report"}),(0,zt.jsx)("p",{children:"Generate comprehensive reports with charts, graphs, and scientific data for research and educational purposes."}),(0,zt.jsxs)("button",{className:"card-action",children:["Generate Report",(0,zt.jsx)("span",{className:"arrow",children:"\u2192"})]})]})]}),(0,zt.jsxs)("div",{className:"dashboard-stats",children:[(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("div",{className:"stat-number",children:"12.1 Mt"}),(0,zt.jsx)("div",{className:"stat-label",children:"Energy Released"}),(0,zt.jsx)("div",{className:"stat-bar stat-bar--blue"})]}),(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("div",{className:"stat-number",children:"243.2 km"}),(0,zt.jsx)("div",{className:"stat-label",children:"Blast Radius"}),(0,zt.jsx)("div",{className:"stat-bar stat-bar--purple"})]}),(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("div",{className:"stat-number",children:"320K"}),(0,zt.jsx)("div",{className:"stat-label",children:"Population Affected"}),(0,zt.jsx)("div",{className:"stat-bar stat-bar--orange"})]}),(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("div",{className:"stat-number",children:"86.3 m"}),(0,zt.jsx)("div",{className:"stat-label",children:"Tsunami Height"}),(0,zt.jsx)("div",{className:"stat-bar stat-bar--blue"})]})]})]})};function Qs(t){let{open:e,onClose:n,videoId:r}=t;const a=(0,i.useRef)(null),s=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(e){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[e]),(0,i.useEffect)(()=>{if(!e)return;const t=t=>{"Escape"===t.key&&n()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,n]);if(!e)return null;const l="https://drive.google.com/file/d/".concat(r,"/preview");return(0,o.createPortal)((0,zt.jsx)("div",{className:"trailer-modal__overlay",ref:a,onClick:t=>{t.target===a.current&&n()},role:"dialog","aria-modal":"true","aria-label":"Watch trailer",children:(0,zt.jsxs)("div",{className:"trailer-modal__content",ref:s,children:[(0,zt.jsx)("button",{className:"trailer-modal__close","aria-label":"Close trailer",onClick:n,children:"\xd7"}),(0,zt.jsx)("div",{className:"trailer-modal__video",children:(0,zt.jsx)("iframe",{src:l,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Movie Trailer"},e?"open":"closed")})]})}),document.body)}const tl="180",el={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},nl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},il=0,rl=1,al=2,ol=3,sl=0,ll=1,cl=2,ul=3,hl=0,dl=1,pl=2,fl=0,ml=1,gl=2,yl=3,vl=4,_l=5,xl=100,bl=101,wl=102,Sl=103,Ml=104,Tl=200,El=201,Al=202,Cl=203,Pl=204,Il=205,Rl=206,kl=207,Ll=208,Dl=209,zl=210,Nl=211,Ol=212,Fl=213,Bl=214,Ul=0,jl=1,Vl=2,Hl=3,Gl=4,Wl=5,ql=6,Zl=7,Xl=0,Yl=1,Kl=2,Jl=0,$l=1,Ql=2,tc=3,ec=4,nc=5,ic=6,rc=7,ac="attached",oc="detached",sc=300,lc=301,cc=302,uc=303,hc=304,dc=306,pc=1e3,fc=1001,mc=1002,gc=1003,yc=1004,vc=1004,_c=1005,xc=1005,bc=1006,wc=1007,Sc=1007,Mc=1008,Tc=1008,Ec=1009,Ac=1010,Cc=1011,Pc=1012,Ic=1013,Rc=1014,kc=1015,Lc=1016,Dc=1017,zc=1018,Nc=1020,Oc=35902,Fc=35899,Bc=1021,Uc=1022,jc=1023,Vc=1026,Hc=1027,Gc=1028,Wc=1029,qc=1030,Zc=1031,Xc=1032,Yc=1033,Kc=33776,Jc=33777,$c=33778,Qc=33779,tu=35840,eu=35841,nu=35842,iu=35843,ru=36196,au=37492,ou=37496,su=37808,lu=37809,cu=37810,uu=37811,hu=37812,du=37813,pu=37814,fu=37815,mu=37816,gu=37817,yu=37818,vu=37819,_u=37820,xu=37821,bu=36492,wu=36494,Su=36495,Mu=36283,Tu=36284,Eu=36285,Au=36286,Cu=2200,Pu=2201,Iu=2202,Ru=2300,ku=2301,Lu=2302,Du=2400,zu=2401,Nu=2402,Ou=2500,Fu=2501,Bu=0,Uu=1,ju=2,Vu=3200,Hu=3201,Gu=3202,Wu=3203,qu=0,Zu=1,Xu="",Yu="srgb",Ku="srgb-linear",Ju="linear",$u="srgb",Qu=0,th=7680,eh=7681,nh=7682,ih=7683,rh=34055,ah=34056,oh=5386,sh=512,lh=513,ch=514,uh=515,hh=516,dh=517,ph=518,fh=519,mh=512,gh=513,yh=514,vh=515,_h=516,xh=517,bh=518,wh=519,Sh=35044,Mh=35048,Th=35040,Eh=35045,Ah=35049,Ch=35041,Ph=35046,Ih=35050,Rh=35042,kh="100",Lh="300 es",Dh=2e3,zh=2001,Nh={COMPUTE:"compute",RENDER:"render"},Oh={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},Fh={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class Bh{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return void 0!==n&&(void 0!==n[t]&&-1!==n[t].indexOf(e))}removeEventListener(t,e){const n=this._listeners;if(void 0===n)return;const i=n[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const n=e[t.type];if(void 0!==n){t.target=this;const e=n.slice(0);for(let n=0,i=e.length;n<i;n++)e[n].call(this,t);t.target=null}}}const Uh=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let jh=1234567;const Vh=Math.PI/180,Hh=180/Math.PI;function Gh(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Uh[255&t]+Uh[t>>8&255]+Uh[t>>16&255]+Uh[t>>24&255]+"-"+Uh[255&e]+Uh[e>>8&255]+"-"+Uh[e>>16&15|64]+Uh[e>>24&255]+"-"+Uh[63&n|128]+Uh[n>>8&255]+"-"+Uh[n>>16&255]+Uh[n>>24&255]+Uh[255&i]+Uh[i>>8&255]+Uh[i>>16&255]+Uh[i>>24&255]).toLowerCase()}function Wh(t,e,n){return Math.max(e,Math.min(n,t))}function qh(t,e){return(t%e+e)%e}function Zh(t,e,n){return(1-n)*t+n*e}function Xh(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Yh(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Kh={DEG2RAD:Vh,RAD2DEG:Hh,generateUUID:Gh,clamp:Wh,euclideanModulo:qh,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Zh,damp:function(t,e,n,i){return Zh(t,e,1-Math.exp(-n*i))},pingpong:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.abs(qh(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(jh=t);let e=jh+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Vh},radToDeg:function(t){return t*Hh},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),c=a((e+i)/2),u=o((e+i)/2),h=a((e-i)/2),d=o((e-i)/2),p=a((i-e)/2),f=o((i-e)/2);switch(r){case"XYX":t.set(s*u,l*h,l*d,s*c);break;case"YZY":t.set(l*d,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*d,s*u,s*c);break;case"XZX":t.set(s*u,l*f,l*p,s*c);break;case"YXY":t.set(l*p,s*u,l*f,s*c);break;case"ZYZ":t.set(l*f,l*p,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Yh,denormalize:Xh};class Jh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Jh.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Wh(this.x,t.x,e.x),this.y=Wh(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=Wh(this.x,t,e),this.y=Wh(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Wh(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Wh(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*n-a*i+t.x,this.y=r*i+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $h{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,a,o){let s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===o)return t[e+0]=s,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===o)return t[e+0]=h,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(u!==f||s!==h||l!==d||c!==p){let t=1-o;const e=s*h+l*d+c*p+u*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,e*n);t=Math.sin(t*a)/r,o=Math.sin(o*a)/r}const r=o*n;if(s=s*t+h*r,l=l*t+d*r,c=c*t+p*r,u=u*t+f*r,t===1-o){const t=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=t,l*=t,c*=t,u*=t}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,r,a){const o=n[i],s=n[i+1],l=n[i+2],c=n[i+3],u=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return t[e]=o*p+c*u+s*d-l*h,t[e+1]=s*p+c*h+l*u-o*d,t[e+2]=l*p+c*d+o*h-s*u,t[e+3]=c*p-o*u-s*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=t._x,i=t._y,r=t._z,a=t._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=s(n/2),d=s(i/2),p=s(r/2);switch(a){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],a=e[1],o=e[5],s=e[9],l=e[2],c=e[6],u=e[10],h=n+o+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-s)*t,this._y=(r-l)*t,this._z=(a-i)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(c-s)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(r+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(r-l)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(s+c)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(a-i)/t,this._x=(r+l)/t,this._y=(s+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-8?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Wh(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,a=t._w,o=e._x,s=e._y,l=e._z,c=e._w;return this._x=n*c+a*o+i*l-r*s,this._y=i*c+a*s+r*o-n*l,this._z=r*c+a*l+n*s-i*o,this._w=a*c-n*o-i*s-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,a=this._w;let o=a*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const s=1-o*o;if(s<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Qh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Qh.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ed.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ed.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,a=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z,s=t.w,l=2*(a*i-o*n),c=2*(o*e-r*i),u=2*(r*n-a*e);return this.x=e+s*l+a*u-o*c,this.y=n+s*c+o*l-r*u,this.z=i+s*u+r*c-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Wh(this.x,t.x,e.x),this.y=Wh(this.y,t.y,e.y),this.z=Wh(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=Wh(this.x,t,e),this.y=Wh(this.y,t,e),this.z=Wh(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Wh(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,a=e.x,o=e.y,s=e.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return td.copy(this).projectOnVector(t),this.sub(td)}reflect(t){return this.sub(td.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Wh(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const td=new Qh,ed=new $h;class nd{constructor(t,e,n,i,r,a,o,s,l){nd.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,a,o,s,l)}set(t,e,n,i,r,a,o,s,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=r,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],y=i[1],v=i[4],_=i[7],x=i[2],b=i[5],w=i[8];return r[0]=a*f+o*y+s*x,r[3]=a*m+o*v+s*b,r[6]=a*g+o*_+s*w,r[1]=l*f+c*y+u*x,r[4]=l*m+c*v+u*b,r[7]=l*g+c*_+u*w,r[2]=h*f+d*y+p*x,r[5]=h*m+d*v+p*b,r[8]=h*g+d*_+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8];return e*a*c-e*o*l-n*r*c+n*o*s+i*r*l-i*a*s}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=c*a-o*l,h=o*s-c*r,d=l*r-a*s,p=e*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=u*f,t[1]=(i*l-c*n)*f,t[2]=(o*n-i*a)*f,t[3]=h*f,t[4]=(c*e-i*s)*f,t[5]=(i*r-o*e)*f,t[6]=d*f,t[7]=(n*s-l*e)*f,t[8]=(a*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,a,o){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+t,-i*l,i*s,-i*(-l*a+s*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(id.makeScale(t,e)),this}rotate(t){return this.premultiply(id.makeRotation(-t)),this}translate(t,e){return this.premultiply(id.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const id=new nd;function rd(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const ad={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function od(t,e){return new ad[t](e)}function sd(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function ld(){const t=sd("canvas");return t.style.display="block",t}const cd={};function ud(t){t in cd||(cd[t]=!0,console.warn(t))}const hd=(new nd).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),dd=(new nd).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function pd(){const t={enabled:!0,workingColorSpace:Ku,spaces:{},convert:function(t,e,n){return!1!==this.enabled&&e!==n&&e&&n?(this.spaces[e].transfer===$u&&(t.r=md(t.r),t.g=md(t.g),t.b=md(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===$u&&(t.r=gd(t.r),t.g=gd(t.g),t.b=gd(t.b)),t):t},workingToColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},colorSpaceToWorking:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Xu?Ju:this.spaces[t].transfer},getToneMappingMode:function(t){return this.spaces[t].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[t].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(e,n){return ud("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(e,n)},toWorkingColorSpace:function(e,n){return ud("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(e,n)}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return t.define({[Ku]:{primaries:e,whitePoint:i,transfer:Ju,toXYZ:hd,fromXYZ:dd,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Yu},outputColorSpaceConfig:{drawingBufferColorSpace:Yu}},[Yu]:{primaries:e,whitePoint:i,transfer:$u,toXYZ:hd,fromXYZ:dd,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Yu}}}),t}const fd=pd();function md(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function gd(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let yd;class vd{static getDataURL(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(t.src))return t.src;if("undefined"===typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===yd&&(yd=sd("canvas")),yd.width=t.width,yd.height=t.height;const n=yd.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=yd}return e.toDataURL(n)}static sRGBToLinear(t){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const e=sd("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*md(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*md(e[t]/255)):e[t]=md(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let _d=0;class xd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:_d++}),this.uuid=Gh(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return"undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):null!==e?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(bd(i[e].image)):t.push(bd(i[e]))}else t=bd(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function bd(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?vd.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let wd=0;const Sd=new Qh;class Md extends Bh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Md.DEFAULT_IMAGE,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Md.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fc,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fc,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bc,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Mc,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:jc,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Ec,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Md.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Xu;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wd++}),this.uuid=Gh(),this.name="",this.source=new xd(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Jh(0,0),this.repeat=new Jh(1,1),this.center=new Jh(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nd,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Sd).x}get height(){return this.source.getSize(Sd).y}get depth(){return this.source.getSize(Sd).z}get image(){return this.source.data}set image(t){void 0===t&&(t=null),this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Texture.setValues(): parameter '".concat(e,"' has value of undefined."));continue}const i=this[e];void 0!==i?i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[e]=n:console.warn("THREE.Texture.setValues(): property '".concat(e,"' does not exist."))}}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==sc)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case pc:t.x=t.x-Math.floor(t.x);break;case fc:t.x=t.x<0?0:1;break;case mc:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case pc:t.y=t.y-Math.floor(t.y);break;case fc:t.y=t.y<0?0:1;break;case mc:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Md.DEFAULT_IMAGE=null,Md.DEFAULT_MAPPING=sc,Md.DEFAULT_ANISOTROPY=1;class Td{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Td.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*e+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*e+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*e+a[7]*n+a[11]*i+a[15]*r,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const a=.01,o=.1,s=t.elements,l=s[0],c=s[4],u=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(p-m)<a){if(Math.abs(c+h)<o&&Math.abs(u+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,s=(d+1)/2,y=(g+1)/2,v=(c+h)/4,_=(u+f)/4,x=(p+m)/4;return t>s&&t>y?t<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=v/n,r=_/n):s>y?s<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=v/i,r=x/i):y<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(y),n=_/r,i=x/r),this.set(n,i,r,e),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Wh(this.x,t.x,e.x),this.y=Wh(this.y,t.y,e.y),this.z=Wh(this.z,t.z,e.z),this.w=Wh(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=Wh(this.x,t,e),this.y=Wh(this.y,t,e),this.z=Wh(this.z,t,e),this.w=Wh(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Wh(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ed extends Bh{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bc,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=n.depth,this.scissor=new Td(0,0,t,e),this.scissorTest=!1,this.viewport=new Td(0,0,t,e);const i={width:t,height:e,depth:n.depth},r=new Md(i);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=r.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e={minFilter:bc,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==t.mapping&&(e.mapping=t.mapping),void 0!==t.wrapS&&(e.wrapS=t.wrapS),void 0!==t.wrapT&&(e.wrapT=t.wrapT),void 0!==t.wrapR&&(e.wrapR=t.wrapR),void 0!==t.magFilter&&(e.magFilter=t.magFilter),void 0!==t.minFilter&&(e.minFilter=t.minFilter),void 0!==t.format&&(e.format=t.format),void 0!==t.type&&(e.type=t.type),void 0!==t.anisotropy&&(e.anisotropy=t.anisotropy),void 0!==t.colorSpace&&(e.colorSpace=t.colorSpace),void 0!==t.flipY&&(e.flipY=t.flipY),void 0!==t.generateMipmaps&&(e.generateMipmaps=t.generateMipmaps),void 0!==t.internalFormat&&(e.internalFormat=t.internalFormat);for(let n=0;n<this.textures.length;n++){this.textures[n].setValues(e)}}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==t&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const n=Object.assign({},t.textures[e].image);this.textures[e].source=new xd(n)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ad extends Ed{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Cd extends Md{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=gc,this.minFilter=gc,this.wrapR=fc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Pd extends Ad{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,e,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Cd(null,t,e,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Id extends Md{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=gc,this.minFilter=gc,this.wrapR=fc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Rd extends Ad{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,e,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Id(null,t,e,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class kd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh(1/0,1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Dd.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Dd.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Dd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Dd):Dd.fromBufferAttribute(i,e),Dd.applyMatrix4(t.matrixWorld),this.expandByPoint(Dd);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),zd.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),zd.copy(n.boundingBox)),zd.applyMatrix4(t.matrixWorld),this.union(zd)}const i=t.children;for(let r=0,a=i.length;r<a;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Dd),Dd.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Vd),Hd.subVectors(this.max,Vd),Nd.subVectors(t.a,Vd),Od.subVectors(t.b,Vd),Fd.subVectors(t.c,Vd),Bd.subVectors(Od,Nd),Ud.subVectors(Fd,Od),jd.subVectors(Nd,Fd);let e=[0,-Bd.z,Bd.y,0,-Ud.z,Ud.y,0,-jd.z,jd.y,Bd.z,0,-Bd.x,Ud.z,0,-Ud.x,jd.z,0,-jd.x,-Bd.y,Bd.x,0,-Ud.y,Ud.x,0,-jd.y,jd.x,0];return!!qd(e,Nd,Od,Fd,Hd)&&(e=[1,0,0,0,1,0,0,0,1],!!qd(e,Nd,Od,Fd,Hd)&&(Gd.crossVectors(Bd,Ud),e=[Gd.x,Gd.y,Gd.z],qd(e,Nd,Od,Fd,Hd)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Dd).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Dd).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Ld[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ld[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ld[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ld[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ld[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ld[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ld[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ld[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ld)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const Ld=[new Qh,new Qh,new Qh,new Qh,new Qh,new Qh,new Qh,new Qh],Dd=new Qh,zd=new kd,Nd=new Qh,Od=new Qh,Fd=new Qh,Bd=new Qh,Ud=new Qh,jd=new Qh,Vd=new Qh,Hd=new Qh,Gd=new Qh,Wd=new Qh;function qd(t,e,n,i,r){for(let a=0,o=t.length-3;a<=o;a+=3){Wd.fromArray(t,a);const o=r.x*Math.abs(Wd.x)+r.y*Math.abs(Wd.y)+r.z*Math.abs(Wd.z),s=e.dot(Wd),l=n.dot(Wd),c=i.dot(Wd);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const Zd=new kd,Xd=new Qh,Yd=new Qh;class Kd{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):Zd.setFromPoints(t).getCenter(n);let i=0;for(let r=0,a=t.length;r<a;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Xd.subVectors(t,this.center);const e=Xd.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(Xd,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Yd.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Xd.copy(t.center).add(Yd)),this.expandByPoint(Xd.copy(t.center).sub(Yd))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const Jd=new Qh,$d=new Qh,Qd=new Qh,tp=new Qh,ep=new Qh,np=new Qh,ip=new Qh;class rp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh(0,0,-1);this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Jd)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Jd.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Jd.copy(this.origin).addScaledVector(this.direction,e),Jd.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){$d.copy(t).add(e).multiplyScalar(.5),Qd.copy(e).sub(t).normalize(),tp.copy(this.origin).sub($d);const r=.5*t.distanceTo(e),a=-this.direction.dot(Qd),o=tp.dot(this.direction),s=-tp.dot(Qd),l=tp.lengthSq(),c=Math.abs(1-a*a);let u,h,d,p;if(c>0)if(u=a*s-o,h=a*o-s,p=r*c,u>=0)if(h>=-p)if(h<=p){const t=1/c;u*=t,h*=t,d=u*(u+a*h+2*o)+h*(a*u+h+2*s)+l}else h=r,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;else h=-r,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;else h<=-p?(u=Math.max(0,-(-a*r+o)),h=u>0?-r:Math.min(Math.max(-r,-s),r),d=-u*u+h*(h+2*s)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-s),r),d=h*(h+2*s)+l):(u=Math.max(0,-(a*r+o)),h=u>0?r:Math.min(Math.max(-r,-s),r),d=-u*u+h*(h+2*s)+l);else h=a>0?-r:r,u=Math.max(0,-(a*h+o)),d=-u*u+h*(h+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy($d).addScaledVector(Qd,h),d}intersectSphere(t,e){Jd.subVectors(t.center,this.origin);const n=Jd.dot(this.direction),i=Jd.dot(Jd)-n*n,r=t.radius*t.radius;if(i>r)return null;const a=Math.sqrt(r-i),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,e):this.at(o,e)}intersectsSphere(t){return!(t.radius<0)&&this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),c>=0?(r=(t.min.y-h.y)*c,a=(t.max.y-h.y)*c):(r=(t.max.y-h.y)*c,a=(t.min.y-h.y)*c),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),u>=0?(o=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,Jd)}intersectTriangle(t,e,n,i,r){ep.subVectors(e,t),np.subVectors(n,t),ip.crossVectors(ep,np);let a,o=this.direction.dot(ip);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}tp.subVectors(this.origin,t);const s=a*this.direction.dot(np.crossVectors(tp,np));if(s<0)return null;const l=a*this.direction.dot(ep.cross(tp));if(l<0)return null;if(s+l>o)return null;const c=-a*tp.dot(ip);return c<0?null:this.at(c/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ap{constructor(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m){ap.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m)}set(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ap).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/op.setFromMatrixColumn(t,0).length(),r=1/op.setFromMatrixColumn(t,1).length(),a=1/op.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=a*c,n=a*u,i=o*c,r=o*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-o*s,e[2]=r-t*l,e[6]=i+n*l,e[10]=a*s}else if("YXZ"===t.order){const t=s*c,n=s*u,i=l*c,r=l*u;e[0]=t+r*o,e[4]=i*o-n,e[8]=a*l,e[1]=a*u,e[5]=a*c,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=a*s}else if("ZXY"===t.order){const t=s*c,n=s*u,i=l*c,r=l*u;e[0]=t-r*o,e[4]=-a*u,e[8]=i+n*o,e[1]=n+i*o,e[5]=a*c,e[9]=r-t*o,e[2]=-a*l,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){const t=a*c,n=a*u,i=o*c,r=o*u;e[0]=s*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=s*u,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){const t=a*s,n=a*l,i=o*s,r=o*l;e[0]=s*c,e[4]=r-t*u,e[8]=i*u+n,e[1]=u,e[5]=a*c,e[9]=-o*c,e[2]=-l*c,e[6]=n*u+i,e[10]=t-r*u}else if("XZY"===t.order){const t=a*s,n=a*l,i=o*s,r=o*l;e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=t*u+r,e[5]=a*c,e[9]=n*u-i,e[2]=i*u-n,e[6]=o*c,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(lp,t,cp)}lookAt(t,e,n){const i=this.elements;return dp.subVectors(t,e),0===dp.lengthSq()&&(dp.z=1),dp.normalize(),up.crossVectors(n,dp),0===up.lengthSq()&&(1===Math.abs(n.z)?dp.x+=1e-4:dp.z+=1e-4,dp.normalize(),up.crossVectors(n,dp)),up.normalize(),hp.crossVectors(dp,up),i[0]=up.x,i[4]=hp.x,i[8]=dp.x,i[1]=up.y,i[5]=hp.y,i[9]=dp.y,i[2]=up.z,i[6]=hp.z,i[10]=dp.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],x=n[15],b=i[0],w=i[4],S=i[8],M=i[12],T=i[1],E=i[5],A=i[9],C=i[13],P=i[2],I=i[6],R=i[10],k=i[14],L=i[3],D=i[7],z=i[11],N=i[15];return r[0]=a*b+o*T+s*P+l*L,r[4]=a*w+o*E+s*I+l*D,r[8]=a*S+o*A+s*R+l*z,r[12]=a*M+o*C+s*k+l*N,r[1]=c*b+u*T+h*P+d*L,r[5]=c*w+u*E+h*I+d*D,r[9]=c*S+u*A+h*R+d*z,r[13]=c*M+u*C+h*k+d*N,r[2]=p*b+f*T+m*P+g*L,r[6]=p*w+f*E+m*I+g*D,r[10]=p*S+f*A+m*R+g*z,r[14]=p*M+f*C+m*k+g*N,r[3]=y*b+v*T+_*P+x*L,r[7]=y*w+v*E+_*I+x*D,r[11]=y*S+v*A+_*R+x*z,r[15]=y*M+v*C+_*k+x*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],a=t[1],o=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+r*s*u-i*l*u-r*o*h+n*l*h+i*o*d-n*s*d)+t[7]*(+e*s*d-e*l*h+r*a*h-i*a*d+i*l*c-r*s*c)+t[11]*(+e*l*u-e*o*d-r*a*u+n*a*d+r*o*c-n*l*c)+t[15]*(-i*o*c-e*s*u+e*o*h+i*a*u-n*a*h+n*s*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],y=u*m*l-f*h*l+f*s*d-o*m*d-u*s*g+o*h*g,v=p*h*l-c*m*l-p*s*d+a*m*d+c*s*g-a*h*g,_=c*f*l-p*u*l+p*o*d-a*f*d-c*o*g+a*u*g,x=p*u*s-c*f*s-p*o*h+a*f*h+c*o*m-a*u*m,b=e*y+n*v+i*_+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=y*w,t[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*w,t[2]=(o*m*r-f*s*r+f*i*l-n*m*l-o*i*g+n*s*g)*w,t[3]=(u*s*r-o*h*r-u*i*l+n*h*l+o*i*d-n*s*d)*w,t[4]=v*w,t[5]=(c*m*r-p*h*r+p*i*d-e*m*d-c*i*g+e*h*g)*w,t[6]=(p*s*r-a*m*r-p*i*l+e*m*l+a*i*g-e*s*g)*w,t[7]=(a*h*r-c*s*r+c*i*l-e*h*l-a*i*d+e*s*d)*w,t[8]=_*w,t[9]=(p*u*r-c*f*r-p*n*d+e*f*d+c*n*g-e*u*g)*w,t[10]=(a*f*r-p*o*r+p*n*l-e*f*l-a*n*g+e*o*g)*w,t[11]=(c*o*r-a*u*r-c*n*l+e*u*l+a*n*d-e*o*d)*w,t[12]=x*w,t[13]=(c*f*i-p*u*i+p*n*h-e*f*h-c*n*m+e*u*m)*w,t[14]=(p*o*i-a*f*i-p*n*s+e*f*s+a*n*m-e*o*m)*w,t[15]=(a*u*i-c*o*i+c*n*s-e*u*s-a*n*h+e*o*h)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,a=t.x,o=t.y,s=t.z,l=r*a,c=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,c*o+n,c*s-i*a,0,l*s-i*o,c*s+i*a,r*s*s+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,a){return this.set(1,n,r,0,t,1,a,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,a=e._y,o=e._z,s=e._w,l=r+r,c=a+a,u=o+o,h=r*l,d=r*c,p=r*u,f=a*c,m=a*u,g=o*u,y=s*l,v=s*c,_=s*u,x=n.x,b=n.y,w=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+_)*x,i[2]=(p-v)*x,i[3]=0,i[4]=(d-_)*b,i[5]=(1-(h+g))*b,i[6]=(m+y)*b,i[7]=0,i[8]=(p+v)*w,i[9]=(m-y)*w,i[10]=(1-(h+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=op.set(i[0],i[1],i[2]).length();const a=op.set(i[4],i[5],i[6]).length(),o=op.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],sp.copy(this);const s=1/r,l=1/a,c=1/o;return sp.elements[0]*=s,sp.elements[1]*=s,sp.elements[2]*=s,sp.elements[4]*=l,sp.elements[5]*=l,sp.elements[6]*=l,sp.elements[8]*=c,sp.elements[9]*=c,sp.elements[10]*=c,e.setFromRotationMatrix(sp),n.x=r,n.y=a,n.z=o,this}makePerspective(t,e,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Dh,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2*r/(e-t),u=2*r/(n-i),h=(e+t)/(e-t),d=(n+i)/(n-i);let p,f;if(s)p=r/(a-r),f=a*r/(a-r);else if(o===Dh)p=-(a+r)/(a-r),f=-2*a*r/(a-r);else{if(o!==zh)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-a/(a-r),f=-a*r/(a-r)}return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Dh,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2/(e-t),u=2/(n-i),h=-(e+t)/(e-t),d=-(n+i)/(n-i);let p,f;if(s)p=1/(a-r),f=a/(a-r);else if(o===Dh)p=-2/(a-r),f=-(a+r)/(a-r);else{if(o!==zh)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=-1/(a-r),f=-r/(a-r)}return l[0]=c,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const op=new Qh,sp=new ap,lp=new Qh(0,0,0),cp=new Qh(1,1,1),up=new Qh,hp=new Qh,dp=new Qh,pp=new ap,fp=new $h;class mp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mp.DEFAULT_ORDER;this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=t.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(Wh(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Wh(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Wh(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Wh(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Wh(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Wh(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return pp.makeRotationFromQuaternion(t),this.setFromRotationMatrix(pp,e,n)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return fp.setFromEuler(this),this.setFromQuaternion(fp,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}mp.DEFAULT_ORDER="XYZ";class gp{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}}let yp=0;const vp=new Qh,_p=new $h,xp=new ap,bp=new Qh,wp=new Qh,Sp=new Qh,Mp=new $h,Tp=new Qh(1,0,0),Ep=new Qh(0,1,0),Ap=new Qh(0,0,1),Cp={type:"added"},Pp={type:"removed"},Ip={type:"childadded",child:null},Rp={type:"childremoved",child:null};class kp extends Bh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:yp++}),this.uuid=Gh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kp.DEFAULT_UP.clone();const t=new Qh,e=new mp,n=new $h,i=new Qh(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ap},normalMatrix:{value:new nd}}),this.matrix=new ap,this.matrixWorld=new ap,this.matrixAutoUpdate=kp.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=kp.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new gp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return _p.setFromAxisAngle(t,e),this.quaternion.multiply(_p),this}rotateOnWorldAxis(t,e){return _p.setFromAxisAngle(t,e),this.quaternion.premultiply(_p),this}rotateX(t){return this.rotateOnAxis(Tp,t)}rotateY(t){return this.rotateOnAxis(Ep,t)}rotateZ(t){return this.rotateOnAxis(Ap,t)}translateOnAxis(t,e){return vp.copy(t).applyQuaternion(this.quaternion),this.position.add(vp.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Tp,t)}translateY(t){return this.translateOnAxis(Ep,t)}translateZ(t){return this.translateOnAxis(Ap,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(xp.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?bp.copy(t):bp.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),wp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xp.lookAt(wp,bp,this.up):xp.lookAt(bp,wp,this.up),this.quaternion.setFromRotationMatrix(xp),i&&(xp.extractRotation(i.matrixWorld),_p.setFromRotationMatrix(xp),this.quaternion.premultiply(_p.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Cp),Ip.child=t,this.dispatchEvent(Ip),Ip.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Pp),Rp.child=t,this.dispatchEvent(Rp),Rp.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),xp.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),xp.multiply(t.parent.matrixWorld)),t.applyMatrix4(xp),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Cp),Ip.child=t,this.dispatchEvent(Ip),Ip.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[t]===e&&n.push(this);const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wp,t,Sp),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wp,Mp,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"===typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(t=>Dt(Dt({},t),{},{boundingBox:t.boundingBox?t.boundingBox.toJSON():void 0,boundingSphere:t.boundingSphere?t.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(t=>Dt({},t)),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(t),i.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=a(t.geometries),i=a(t.materials),r=a(t.textures),o=a(t.images),s=a(t.shapes),l=a(t.skeletons),c=a(t.animations),u=a(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function a(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let n=0;n<t.children.length;n++){const e=t.children[n];this.add(e.clone())}return this}}kp.DEFAULT_UP=new Qh(0,1,0),kp.DEFAULT_MATRIX_AUTO_UPDATE=!0,kp.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Lp=new Qh,Dp=new Qh,zp=new Qh,Np=new Qh,Op=new Qh,Fp=new Qh,Bp=new Qh,Up=new Qh,jp=new Qh,Vp=new Qh,Hp=new Td,Gp=new Td,Wp=new Td;class qp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Qh;this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Lp.subVectors(t,e),i.cross(Lp);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Lp.subVectors(i,e),Dp.subVectors(n,e),zp.subVectors(t,e);const a=Lp.dot(Lp),o=Lp.dot(Dp),s=Lp.dot(zp),l=Dp.dot(Dp),c=Dp.dot(zp),u=a*l-o*o;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*s-o*c)*h,p=(a*c-o*s)*h;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,Np)&&(Np.x>=0&&Np.y>=0&&Np.x+Np.y<=1)}static getInterpolation(t,e,n,i,r,a,o,s){return null===this.getBarycoord(t,e,n,i,Np)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(r,Np.x),s.addScaledVector(a,Np.y),s.addScaledVector(o,Np.z),s)}static getInterpolatedAttribute(t,e,n,i,r,a){return Hp.setScalar(0),Gp.setScalar(0),Wp.setScalar(0),Hp.fromBufferAttribute(t,e),Gp.fromBufferAttribute(t,n),Wp.fromBufferAttribute(t,i),a.setScalar(0),a.addScaledVector(Hp,r.x),a.addScaledVector(Gp,r.y),a.addScaledVector(Wp,r.z),a}static isFrontFacing(t,e,n,i){return Lp.subVectors(n,e),Dp.subVectors(t,e),Lp.cross(Dp).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Lp.subVectors(this.c,this.b),Dp.subVectors(this.a,this.b),.5*Lp.cross(Dp).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return qp.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return qp.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,r){return qp.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return qp.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return qp.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let a,o;Op.subVectors(i,n),Fp.subVectors(r,n),Up.subVectors(t,n);const s=Op.dot(Up),l=Fp.dot(Up);if(s<=0&&l<=0)return e.copy(n);jp.subVectors(t,i);const c=Op.dot(jp),u=Fp.dot(jp);if(c>=0&&u<=c)return e.copy(i);const h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return a=s/(s-c),e.copy(n).addScaledVector(Op,a);Vp.subVectors(t,r);const d=Op.dot(Vp),p=Fp.dot(Vp);if(p>=0&&d<=p)return e.copy(r);const f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(n).addScaledVector(Fp,o);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Bp.subVectors(r,i),o=(u-c)/(u-c+(d-p)),e.copy(i).addScaledVector(Bp,o);const g=1/(m+f+h);return a=f*g,o=h*g,e.copy(n).addScaledVector(Op,a).addScaledVector(Fp,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Zp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xp={h:0,s:0,l:0},Yp={h:0,s:0,l:0};function Kp(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class Jp{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yu;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,fd.colorSpaceToWorking(this,e),this}setRGB(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fd.workingColorSpace;return this.r=t,this.g=e,this.b=n,fd.colorSpaceToWorking(this,i),this}setHSL(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fd.workingColorSpace;if(t=qh(t,1),e=Wh(e,0,1),n=Wh(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Kp(r,i,t+1/3),this.g=Kp(r,i,t),this.b=Kp(r,i,t-1/3)}return fd.colorSpaceToWorking(this,i),this}setStyle(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yu;function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}if(e=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const a=e[1],o=e[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=e[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yu;const n=Zp[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=md(t.r),this.g=md(t.g),this.b=md(t.b),this}copyLinearToSRGB(t){return this.r=gd(t.r),this.g=gd(t.g),this.b=gd(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yu;return fd.workingToColorSpace($p.copy(this),t),65536*Math.round(Wh(255*$p.r,0,255))+256*Math.round(Wh(255*$p.g,0,255))+Math.round(Wh(255*$p.b,0,255))}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yu;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fd.workingColorSpace;fd.workingToColorSpace($p.copy(this),e);const n=$p.r,i=$p.g,r=$p.b,a=Math.max(n,i,r),o=Math.min(n,i,r);let s,l;const c=(o+a)/2;if(o===a)s=0,l=0;else{const t=a-o;switch(l=c<=.5?t/(a+o):t/(2-a-o),a){case n:s=(i-r)/t+(i<r?6:0);break;case i:s=(r-n)/t+2;break;case r:s=(n-i)/t+4}s/=6}return t.h=s,t.s=l,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fd.workingColorSpace;return fd.workingToColorSpace($p.copy(this),e),t.r=$p.r,t.g=$p.g,t.b=$p.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yu;fd.workingToColorSpace($p.copy(this),t);const e=$p.r,n=$p.g,i=$p.b;return t!==Yu?"color(".concat(t," ").concat(e.toFixed(3)," ").concat(n.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*e),",").concat(Math.round(255*n),",").concat(Math.round(255*i),")")}offsetHSL(t,e,n){return this.getHSL(Xp),this.setHSL(Xp.h+t,Xp.s+e,Xp.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Xp),t.getHSL(Yp);const n=Zh(Xp.h,Yp.h,e),i=Zh(Xp.s,Yp.s,e),r=Zh(Xp.l,Yp.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const $p=new Jp;Jp.NAMES=Zp;let Qp=0;class tf extends Bh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Qp++}),this.uuid=Gh(),this.name="",this.type="Material",this.blending=ml,this.side=hl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Pl,this.blendDst=Il,this.blendEquation=xl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Jp(0,0,0),this.blendAlpha=0,this.depthFunc=Hl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=th,this.stencilZFail=th,this.stencilZPass=th,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!==t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: parameter '".concat(e,"' has value of undefined."));continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE.Material: '".concat(e,"' is not a property of THREE.").concat(this.type,"."))}}toJSON(t){const e=void 0===t||"string"===typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ml&&(n.blending=this.blending),this.side!==hl&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Pl&&(n.blendSrc=this.blendSrc),this.blendDst!==Il&&(n.blendDst=this.blendDst),this.blendEquation!==xl&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Hl&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==fh&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==th&&(n.stencilFail=this.stencilFail),this.stencilZFail!==th&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==th&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class ef extends tf{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Jp(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mp,this.combine=Xl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const nf=rf();function rf(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const t=l-127;t<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):t<-14?(i[l]=1024>>-t-14,i[256|l]=1024>>-t-14|32768,r[l]=-t-1,r[256|l]=-t-1):t<=15?(i[l]=t+15<<10,i[256|l]=t+15<<10|32768,r[l]=13,r[256|l]=13):t<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let t=l<<13,e=0;for(;0===(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,a[l]=t|e}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(s[l]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:a,exponentTable:o,offsetTable:s}}function af(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Wh(t,-65504,65504),nf.floatView[0]=t;const e=nf.uint32View[0],n=e>>23&511;return nf.baseTable[n]+((8388607&e)>>nf.shiftTable[n])}function of(t){const e=t>>10;return nf.uint32View[0]=nf.mantissaTable[nf.offsetTable[e]+(1023&t)]+nf.exponentTable[e],nf.floatView[0]}class sf{static toHalfFloat(t){return af(t)}static fromHalfFloat(t){return of(t)}}const lf=new Qh,cf=new Jh;let uf=0;class hf{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:uf++}),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=Sh,this.updateRanges=[],this.gpuType=kc,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)cf.fromBufferAttribute(this,e),cf.applyMatrix3(t),this.setXY(e,cf.x,cf.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)lf.fromBufferAttribute(this,e),lf.applyMatrix3(t),this.setXYZ(e,lf.x,lf.y,lf.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)lf.fromBufferAttribute(this,e),lf.applyMatrix4(t),this.setXYZ(e,lf.x,lf.y,lf.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)lf.fromBufferAttribute(this,e),lf.applyNormalMatrix(t),this.setXYZ(e,lf.x,lf.y,lf.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)lf.fromBufferAttribute(this,e),lf.transformDirection(t),this.setXYZ(e,lf.x,lf.y,lf.z);return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Xh(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Yh(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Xh(e,this.array)),e}setX(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Xh(e,this.array)),e}setY(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Xh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Xh(e,this.array)),e}setW(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array),i=Yh(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array),i=Yh(i,this.array),r=Yh(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==Sh&&(t.usage=this.usage),t}}class df extends hf{constructor(t,e,n){super(new Int8Array(t),e,n)}}class pf extends hf{constructor(t,e,n){super(new Uint8Array(t),e,n)}}class ff extends hf{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}}class mf extends hf{constructor(t,e,n){super(new Int16Array(t),e,n)}}class gf extends hf{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class yf extends hf{constructor(t,e,n){super(new Int32Array(t),e,n)}}class vf extends hf{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class _f extends hf{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=of(this.array[t*this.itemSize]);return this.normalized&&(e=Xh(e,this.array)),e}setX(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize]=af(e),this}getY(t){let e=of(this.array[t*this.itemSize+1]);return this.normalized&&(e=Xh(e,this.array)),e}setY(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize+1]=af(e),this}getZ(t){let e=of(this.array[t*this.itemSize+2]);return this.normalized&&(e=Xh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize+2]=af(e),this}getW(t){let e=of(this.array[t*this.itemSize+3]);return this.normalized&&(e=Xh(e,this.array)),e}setW(t,e){return this.normalized&&(e=Yh(e,this.array)),this.array[t*this.itemSize+3]=af(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array)),this.array[t+0]=af(e),this.array[t+1]=af(n),this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array),i=Yh(i,this.array)),this.array[t+0]=af(e),this.array[t+1]=af(n),this.array[t+2]=af(i),this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array),i=Yh(i,this.array),r=Yh(r,this.array)),this.array[t+0]=af(e),this.array[t+1]=af(n),this.array[t+2]=af(i),this.array[t+3]=af(r),this}}class xf extends hf{constructor(t,e,n){super(new Float32Array(t),e,n)}}let bf=0;const wf=new ap,Sf=new kp,Mf=new Qh,Tf=new kd,Ef=new kd,Af=new Qh;class Cf extends Bh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bf++}),this.uuid=Gh(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(rd(t)?vf:gf)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new nd).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return wf.makeRotationFromQuaternion(t),this.applyMatrix4(wf),this}rotateX(t){return wf.makeRotationX(t),this.applyMatrix4(wf),this}rotateY(t){return wf.makeRotationY(t),this.applyMatrix4(wf),this}rotateZ(t){return wf.makeRotationZ(t),this.applyMatrix4(wf),this}translate(t,e,n){return wf.makeTranslation(t,e,n),this.applyMatrix4(wf),this}scale(t,e,n){return wf.makeScale(t,e,n),this.applyMatrix4(wf),this}lookAt(t){return Sf.lookAt(t),Sf.updateMatrix(),this.applyMatrix4(Sf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mf).negate(),this.translate(Mf.x,Mf.y,Mf.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new xf(e,3))}else{const n=Math.min(t.length,e.count);for(let i=0;i<n;i++){const n=t[i];e.setXYZ(i,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new kd);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Qh(-1/0,-1/0,-1/0),new Qh(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const t=e[n];Tf.setFromBufferAttribute(t),this.morphTargetsRelative?(Af.addVectors(this.boundingBox.min,Tf.min),this.boundingBox.expandByPoint(Af),Af.addVectors(this.boundingBox.max,Tf.max),this.boundingBox.expandByPoint(Af)):(this.boundingBox.expandByPoint(Tf.min),this.boundingBox.expandByPoint(Tf.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Kd);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Qh,1/0);if(t){const n=this.boundingSphere.center;if(Tf.setFromBufferAttribute(t),e)for(let t=0,r=e.length;t<r;t++){const n=e[t];Ef.setFromBufferAttribute(n),this.morphTargetsRelative?(Af.addVectors(Tf.min,Ef.min),Tf.expandByPoint(Af),Af.addVectors(Tf.max,Ef.max),Tf.expandByPoint(Af)):(Tf.expandByPoint(Ef.min),Tf.expandByPoint(Ef.max))}Tf.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Af.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Af));if(e)for(let r=0,a=e.length;r<a;r++){const a=e[r],o=this.morphTargetsRelative;for(let e=0,r=a.count;e<r;e++)Af.fromBufferAttribute(a,e),o&&(Mf.fromBufferAttribute(t,e),Af.add(Mf)),i=Math.max(i,n.distanceToSquared(Af))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,i=e.normal,r=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new hf(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let S=0;S<n.count;S++)o[S]=new Qh,s[S]=new Qh;const l=new Qh,c=new Qh,u=new Qh,h=new Jh,d=new Jh,p=new Jh,f=new Qh,m=new Qh;function g(t,e,i){l.fromBufferAttribute(n,t),c.fromBufferAttribute(n,e),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,t),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const a=1/(d.x*p.y-p.x*d.y);isFinite(a)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(a),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(a),o[t].add(f),o[e].add(f),o[i].add(f),s[t].add(m),s[e].add(m),s[i].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let S=0,M=y.length;S<M;++S){const e=y[S],n=e.start;for(let i=n,r=n+e.count;i<r;i+=3)g(t.getX(i+0),t.getX(i+1),t.getX(i+2))}const v=new Qh,_=new Qh,x=new Qh,b=new Qh;function w(t){x.fromBufferAttribute(i,t),b.copy(x);const e=o[t];v.copy(e),v.sub(x.multiplyScalar(x.dot(e))).normalize(),_.crossVectors(b,e);const n=_.dot(s[t])<0?-1:1;a.setXYZW(t,v.x,v.y,v.z,n)}for(let S=0,M=y.length;S<M;++S){const e=y[S],n=e.start;for(let i=n,r=n+e.count;i<r;i+=3)w(t.getX(i+0)),w(t.getX(i+1)),w(t.getX(i+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new hf(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new Qh,r=new Qh,a=new Qh,o=new Qh,s=new Qh,l=new Qh,c=new Qh,u=new Qh;if(t)for(let h=0,d=t.count;h<d;h+=3){const d=t.getX(h+0),p=t.getX(h+1),f=t.getX(h+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),a.fromBufferAttribute(e,f),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),s.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,h=e.count;t<h;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),a.fromBufferAttribute(e,t+2),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Af.fromBufferAttribute(t,e),Af.normalize(),t.setXYZ(e,Af.x,Af.y,Af.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,a=new n.constructor(e.length*i);let o=0,s=0;for(let l=0,c=e.length;l<c;l++){o=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*i;for(let t=0;t<i;t++)a[s++]=n[o++]}return new hf(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Cf,n=this.index.array,i=this.attributes;for(const o in i){const r=t(i[o],n);e.setAttribute(o,r)}const r=this.morphAttributes;for(const o in r){const i=[],a=r[o];for(let e=0,r=a.length;e<r;e++){const r=t(a[e],n);i.push(r)}e.morphAttributes[o]=i}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const t=a[o];e.addGroup(t.start,t.count,t.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const s in n){const e=n[s];t.data.attributes[s]=e.toJSON(t.data)}const i={};let r=!1;for(const s in this.morphAttributes){const e=this.morphAttributes[s],n=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];n.push(r.toJSON(t.data))}n.length>0&&(i[s]=n,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere=o.toJSON()),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone());const i=t.attributes;for(const l in i){const t=i[l];this.setAttribute(l,t.clone(e))}const r=t.morphAttributes;for(const l in r){const t=[],n=r[l];for(let i=0,r=n.length;i<r;i++)t.push(n[i].clone(e));this.morphAttributes[l]=t}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,c=a.length;l<c;l++){const t=a[l];this.addGroup(t.start,t.count,t.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=t.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Pf=new ap,If=new rp,Rf=new Kd,kf=new Qh,Lf=new Qh,Df=new Qh,zf=new Qh,Nf=new Qh,Of=new Qh,Ff=new Qh,Bf=new Qh;class Uf extends kp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ef;super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(r&&o){Of.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=o[n],s=r[n];0!==i&&(Nf.fromBufferAttribute(s,t),a?Of.addScaledVector(Nf,i):Of.addScaledVector(Nf.sub(e),i))}e.add(Of)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Rf.copy(n.boundingSphere),Rf.applyMatrix4(r),If.copy(t.ray).recast(t.near),!1===Rf.containsPoint(If.origin)){if(null===If.intersectSphere(Rf,kf))return;if(If.origin.distanceToSquared(kf)>(t.far-t.near)**2)return}Pf.copy(r).invert(),If.copy(t.ray).applyMatrix4(Pf),null!==n.boundingBox&&!1===If.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,If)}}_computeIntersections(t,e,n){let i;const r=this.geometry,a=this.material,o=r.index,s=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const r=h[p],s=a[r.materialIndex];for(let a=Math.max(r.start,d.start),h=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));a<h;a+=3){i=jf(this,s,t,n,l,c,u,o.getX(a),o.getX(a+1),o.getX(a+2)),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);r<s;r+=3){i=jf(this,a,t,n,l,c,u,o.getX(r),o.getX(r+1),o.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}else if(void 0!==s)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const r=h[p],o=a[r.materialIndex];for(let a=Math.max(r.start,d.start),h=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));a<h;a+=3){i=jf(this,o,t,n,l,c,u,a,a+1,a+2),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);r<o;r+=3){i=jf(this,a,t,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}}}function jf(t,e,n,i,r,a,o,s,l,c){t.getVertexPosition(s,Lf),t.getVertexPosition(l,Df),t.getVertexPosition(c,zf);const u=function(t,e,n,i,r,a,o,s){let l;if(l=e.side===dl?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,e.side===hl,s),null===l)return null;Bf.copy(s),Bf.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Bf);return c<n.near||c>n.far?null:{distance:c,point:Bf.clone(),object:t}}(t,e,n,i,Lf,Df,zf,Ff);if(u){const t=new Qh;qp.getBarycoord(Ff,Lf,Df,zf,t),r&&(u.uv=qp.getInterpolatedAttribute(r,s,l,c,t,new Jh)),a&&(u.uv1=qp.getInterpolatedAttribute(a,s,l,c,t,new Jh)),o&&(u.normal=qp.getInterpolatedAttribute(o,s,l,c,t,new Qh),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const e={a:s,b:l,c:c,normal:new Qh,materialIndex:0};qp.getNormal(Lf,Df,zf,e.normal),u.face=e,u.barycoord=t}return u}class Vf extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const o=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const s=[],l=[],c=[],u=[];let h=0,d=0;function p(t,e,n,i,r,a,p,f,m,g,y){const v=a/m,_=p/g,x=a/2,b=p/2,w=f/2,S=m+1,M=g+1;let T=0,E=0;const A=new Qh;for(let o=0;o<M;o++){const a=o*_-b;for(let s=0;s<S;s++){const h=s*v-x;A[t]=h*i,A[e]=a*r,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(s/m),u.push(1-o/g),T+=1}}for(let o=0;o<g;o++)for(let t=0;t<m;t++){const e=h+t+S*o,n=h+t+S*(o+1),i=h+(t+1)+S*(o+1),r=h+(t+1)+S*o;s.push(e,n,r),s.push(n,i,r),E+=6}o.addGroup(d,E,y),d+=E,h+=T}p("z","y","x",-1,-1,n,e,t,a,r,0),p("z","y","x",1,-1,n,e,-t,a,r,1),p("x","z","y",1,1,t,n,e,i,a,2),p("x","z","y",1,-1,t,n,-e,i,a,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new xf(l,3)),this.setAttribute("normal",new xf(c,3)),this.setAttribute("uv",new xf(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Vf(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Hf(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Gf(t){const e={};for(let n=0;n<t.length;n++){const i=Hf(t[n]);for(const t in i)e[t]=i[t]}return e}function Wf(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:fd.workingColorSpace}const qf={clone:Hf,merge:Gf};class Zf extends tf{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Hf(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class Xf extends kp{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ap,this.projectionMatrix=new ap,this.projectionMatrixInverse=new ap,this.coordinateSystem=Dh,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Yf=new Qh,Kf=new Jh,Jf=new Jh;class $f extends Xf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Hh*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Vh*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Hh*Math.atan(Math.tan(.5*Vh*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Yf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Yf.x,Yf.y).multiplyScalar(-t/Yf.z),Yf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Yf.x,Yf.y).multiplyScalar(-t/Yf.z)}getViewSize(t,e){return this.getViewBounds(t,Kf,Jf),e.subVectors(Jf,Kf)}setViewOffset(t,e,n,i,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Vh*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const t=a.fullWidth,o=a.fullHeight;r+=a.offsetX*i/t,e-=a.offsetY*n/o,i*=a.width/t,n*=a.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Qf=-90;class tm extends kp{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new $f(Qf,1,t,e);i.layers=this.layers,this.add(i);const r=new $f(Qf,1,t,e);r.layers=this.layers,this.add(r);const a=new $f(Qf,1,t,e);a.layers=this.layers,this.add(a);const o=new $f(Qf,1,t,e);o.layers=this.layers,this.add(o);const s=new $f(Qf,1,t,e);s.layers=this.layers,this.add(s);const l=new $f(Qf,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,a,o,s]=e;for(const l of e)this.remove(l);if(t===Dh)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(t!==zh)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,a,o,s,l,c]=this.children,u=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,a),t.setRenderTarget(n,2,i),t.render(e,o),t.setRenderTarget(n,3,i),t.render(e,s),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,i),t.render(e,c),t.setRenderTarget(u,h,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class em extends Md{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:lc,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0,arguments.length>9?arguments[9]:void 0),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class nm extends Ad{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new em(i),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Vf(5,5,5),o=new Zf({name:"CubemapFromEquirect",uniforms:Hf(n),vertexShader:i,fragmentShader:r,side:dl,blending:fl});o.uniforms.tEquirect.value=e;const s=new Uf(a,o),l=e.minFilter;e.minFilter===Mc&&(e.minFilter=bc);return new tm(1,10,this).update(t,s),e.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,i);t.setRenderTarget(r)}}class im extends kp{constructor(){super(),this.isGroup=!0,this.type="Group"}}const rm={type:"move"};class am{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new im,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new im,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Qh,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Qh),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new im,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Qh,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Qh),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){a=!0;for(const a of t.hand.values()){const t=e.getJointPose(a,n),i=this._getHandJoint(l,a);null!==t&&(i.matrix.fromArray(t.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=t.radius),i.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(rm)))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new im;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class om{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new Jp(t),this.density=e}clone(){return new om(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class sm{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Jp(t),this.near=e,this.far=n}clone(){return new sm(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class lm extends kp{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new mp,this.environmentIntensity=1,this.environmentRotation=new mp,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class cm{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Sh,this.updateRanges=[],this.version=0,this.uuid=Gh()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Gh()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Gh()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const um=new Qh;class hm{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)um.fromBufferAttribute(this,e),um.applyMatrix4(t),this.setXYZ(e,um.x,um.y,um.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)um.fromBufferAttribute(this,e),um.applyNormalMatrix(t),this.setXYZ(e,um.x,um.y,um.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)um.fromBufferAttribute(this,e),um.transformDirection(t),this.setXYZ(e,um.x,um.y,um.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Xh(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Yh(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=Yh(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Yh(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Yh(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Yh(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Xh(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Xh(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Xh(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Xh(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array),i=Yh(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Yh(e,this.array),n=Yh(n,this.array),i=Yh(i,this.array),r=Yh(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new hf(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new hm(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class dm extends tf{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Jp(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let pm;const fm=new Qh,mm=new Qh,gm=new Qh,ym=new Jh,vm=new Jh,_m=new ap,xm=new Qh,bm=new Qh,wm=new Qh,Sm=new Jh,Mm=new Jh,Tm=new Jh;class Em extends kp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dm;if(super(),this.isSprite=!0,this.type="Sprite",void 0===pm){pm=new Cf;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new cm(t,5);pm.setIndex([0,1,2,0,2,3]),pm.setAttribute("position",new hm(e,3,0,!1)),pm.setAttribute("uv",new hm(e,2,3,!1))}this.geometry=pm,this.material=t,this.center=new Jh(.5,.5),this.count=1}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),mm.setFromMatrixScale(this.matrixWorld),_m.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),gm.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&mm.multiplyScalar(-gm.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const a=this.center;Am(xm.set(-.5,-.5,0),gm,a,mm,i,r),Am(bm.set(.5,-.5,0),gm,a,mm,i,r),Am(wm.set(.5,.5,0),gm,a,mm,i,r),Sm.set(0,0),Mm.set(1,0),Tm.set(1,1);let o=t.ray.intersectTriangle(xm,bm,wm,!1,fm);if(null===o&&(Am(bm.set(-.5,.5,0),gm,a,mm,i,r),Mm.set(0,1),o=t.ray.intersectTriangle(xm,wm,bm,!1,fm),null===o))return;const s=t.ray.origin.distanceTo(fm);s<t.near||s>t.far||e.push({distance:s,point:fm.clone(),uv:qp.getInterpolation(fm,xm,bm,wm,Sm,Mm,Tm,new Jh),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Am(t,e,n,i,r,a){ym.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(vm.x=a*ym.x-r*ym.y,vm.y=r*ym.x+a*ym.y):vm.copy(ym),t.copy(e),t.x+=vm.x,t.y+=vm.y,t.applyMatrix4(_m)}const Cm=new Qh,Pm=new Qh;class Im extends kp{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let n=0,i=e.length;n<i;n++){const t=e[n];this.addLevel(t.object.clone(),t.distance,t.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e=Math.abs(e);const i=this.levels;let r;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}removeLevel(t){const e=this.levels;for(let n=0;n<e.length;n++)if(e[n].distance===t){const t=e.splice(n,1);return this.remove(t[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i;n++){let i=e[n].distance;if(e[n].object.visible&&(i-=i*e[n].hysteresis),t<i)break}return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Cm.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Cm);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Cm.setFromMatrixPosition(t.matrixWorld),Pm.setFromMatrixPosition(this.matrixWorld);const n=Cm.distanceTo(Pm)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r;i++){let t=e[i].distance;if(e[i].object.visible&&(t-=t*e[i].hysteresis),!(n>=t))break;e[i-1].object.visible=!1,e[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const t=n[i];e.object.levels.push({object:t.object.uuid,distance:t.distance,hysteresis:t.hysteresis})}return e}}const Rm=new Qh,km=new Td,Lm=new Td,Dm=new Qh,zm=new ap,Nm=new Qh,Om=new Kd,Fm=new ap,Bm=new rp;class Um extends Uf{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ac,this.bindMatrix=new ap,this.bindMatrixInverse=new ap,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new kd),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,Nm),this.boundingBox.expandByPoint(Nm)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Kd),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,Nm),this.boundingSphere.expandByPoint(Nm)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Om.copy(this.boundingSphere),Om.applyMatrix4(i),!1!==t.ray.intersectsSphere(Om)&&(Fm.copy(i).invert(),Bm.copy(t.ray).applyMatrix4(Fm),null!==this.boundingBox&&!1===Bm.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,Bm)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Td,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===ac?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===oc?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;km.fromBufferAttribute(i.attributes.skinIndex,t),Lm.fromBufferAttribute(i.attributes.skinWeight,t),Rm.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const t=Lm.getComponent(r);if(0!==t){const i=km.getComponent(r);zm.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),e.addScaledVector(Dm.copy(Rm).applyMatrix4(zm),t)}}return e.applyMatrix4(this.bindMatrixInverse)}}class jm extends kp{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Vm extends Md{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:gc,arguments.length>9&&void 0!==arguments[9]?arguments[9]:gc,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Hm=new ap,Gm=new ap;class Wm{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Gh(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ap)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new ap;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,a=t.length;r<a;r++){const i=t[r]?t[r].matrixWorld:Gm;Hm.multiplyMatrices(i,e[r]),Hm.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new Wm(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Vm(e,t,t,jc,kc);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new jm),this.bones.push(r),this.boneInverses.push((new ap).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const a=n[i];t.boneInverses.push(a.toArray())}return t}}class qm extends hf{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Zm=new ap,Xm=new ap,Ym=[],Km=new kd,Jm=new ap,$m=new Uf,Qm=new Kd;class tg extends Uf{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new qm(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Jm)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new kd),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Zm),Km.copy(t.boundingBox).applyMatrix4(Zm),this.boundingBox.union(Km)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Kd),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Zm),Qm.copy(t.boundingSphere).applyMatrix4(Zm),this.boundingSphere.union(Qm)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,r=t*(n.length+1)+1;for(let a=0;a<n.length;a++)n[a]=i[r+a]}raycast(t,e){const n=this.matrixWorld,i=this.count;if($m.geometry=this.geometry,$m.material=this.material,void 0!==$m.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Qm.copy(this.boundingSphere),Qm.applyMatrix4(n),!1!==t.ray.intersectsSphere(Qm)))for(let r=0;r<i;r++){this.getMatrixAt(r,Zm),Xm.multiplyMatrices(n,Zm),$m.matrixWorld=Xm,$m.raycast(t,Ym);for(let t=0,n=Ym.length;t<n;t++){const n=Ym[t];n.instanceId=r,n.object=this,e.push(n)}Ym.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new qm(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new Vm(new Float32Array(i*this.count),i,this.count,Gc,kc));const r=this.morphTexture.source.data.data;let a=0;for(let l=0;l<n.length;l++)a+=n[l];const o=this.geometry.morphTargetsRelative?1:1-a,s=i*t;r[s]=o,r.set(n,s+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const eg=new Qh,ng=new Qh,ig=new nd;class rg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh(1,0,0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=eg.subVectors(n,e).cross(ng.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(eg),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ig.getNormalMatrix(t),i=this.coplanarPoint(eg).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ag=new Kd,og=new Jh(.5,.5),sg=new Qh;class lg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rg,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rg,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rg,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new rg,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new rg,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new rg;this.planes=[t,e,n,i,r,a]}set(t,e,n,i,r,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dh,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.planes,r=t.elements,a=r[0],o=r[1],s=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],p=r[8],f=r[9],m=r[10],g=r[11],y=r[12],v=r[13],_=r[14],x=r[15];if(i[0].setComponents(l-a,d-c,g-p,x-y).normalize(),i[1].setComponents(l+a,d+c,g+p,x+y).normalize(),i[2].setComponents(l+o,d+u,g+f,x+v).normalize(),i[3].setComponents(l-o,d-u,g-f,x-v).normalize(),n)i[4].setComponents(s,h,m,_).normalize(),i[5].setComponents(l-s,d-h,g-m,x-_).normalize();else if(i[4].setComponents(l-s,d-h,g-m,x-_).normalize(),e===Dh)i[5].setComponents(l+s,d+h,g+m,x+_).normalize();else{if(e!==zh)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(s,h,m,_).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),ag.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),ag.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(ag)}intersectsSprite(t){ag.center.set(0,0,0);const e=og.distanceTo(t.center);return ag.radius=.7071067811865476+e,ag.applyMatrix4(t.matrixWorld),this.intersectsSphere(ag)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++){if(e[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(sg.x=i.normal.x>0?t.max.x:t.min.x,sg.y=i.normal.y>0?t.max.y:t.min.y,sg.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(sg)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const cg=new ap,ug=new lg;class hg{constructor(){this.coordinateSystem=Dh}intersectsObject(t,e){if(!e.isArrayCamera||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(cg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ug.setFromProjectionMatrix(cg,i.coordinateSystem,i.reversedDepth),ug.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(cg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ug.setFromProjectionMatrix(cg,i.coordinateSystem,i.reversedDepth),ug.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(cg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ug.setFromProjectionMatrix(cg,i.coordinateSystem,i.reversedDepth),ug.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(cg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ug.setFromProjectionMatrix(cg,i.coordinateSystem,i.reversedDepth),ug.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||0===e.cameras.length)return!1;for(let n=0;n<e.cameras.length;n++){const i=e.cameras[n];if(cg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),ug.setFromProjectionMatrix(cg,i.coordinateSystem,i.reversedDepth),ug.containsPoint(t))return!0}return!1}clone(){return new hg}}function dg(t,e){return t-e}function pg(t,e){return t.z-e.z}function fg(t,e){return e.z-t.z}class mg{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,n,i){const r=this.pool,a=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const o=r[this.index];a.push(o),this.index++,o.start=t,o.count=e,o.z=n,o.index=i}reset(){this.list.length=0,this.index=0}}const gg=new ap,yg=new Jp(1,1,1),vg=new lg,_g=new hg,xg=new kd,bg=new Kd,wg=new Qh,Sg=new Qh,Mg=new Qh,Tg=new mg,Eg=new Uf,Ag=[];function Cg(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let a=0;a<r;a++)for(let r=0;r<i;r++)e.setComponent(a+n,r,t.getComponent(a,r))}else e.array.set(t.array,n*i);e.needsUpdate=!0}function Pg(t,e){if(t.constructor!==e.constructor){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++)e[i]=t[i]}else{const n=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,n))}}class Ig extends Uf{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*e,i=arguments.length>3?arguments[3]:void 0;super(new Cf,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let t=Math.sqrt(4*this._maxInstanceCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new Vm(e,t,t,jc,kc);this._matricesTexture=n}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),n=new Vm(e,t,t,Wc,Rc);this._indirectTexture=n}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),n=new Vm(e,t,t,jc,kc);n.colorSpace=fd.workingColorSpace,this._colorsTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const r=t.getAttribute(i),{array:a,itemSize:o,normalized:s}=r,l=new a.constructor(n*o),c=new hf(l,o,s);e.setAttribute(i,c)}if(null!==t.getIndex()){const t=n>65535?new Uint32Array(i):new Uint16Array(i);e.setIndex(new hf(t,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(!t.hasAttribute(n))throw new Error('THREE.BatchedMesh: Added geometry missing "'.concat(n,'". All geometries must have consistent attributes.'));const i=t.getAttribute(n),r=e.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error("THREE.BatchedMesh: Invalid instanceId ".concat(t,". Instance is either out of range or has been deleted."))}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error("THREE.BatchedMesh: Invalid geometryId ".concat(t,". Geometry is either out of range or has been deleted."))}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new kd);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let n=0,i=e.length;n<i;n++){if(!1===e[n].active)continue;const i=e[n].geometryIndex;this.getMatrixAt(n,gg),this.getBoundingBoxAt(i,xg).applyMatrix4(gg),t.union(xg)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Kd);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let n=0,i=e.length;n<i;n++){if(!1===e[n].active)continue;const i=e[n].geometryIndex;this.getMatrixAt(n,gg),this.getBoundingSphereAt(i,bg).applyMatrix4(gg),t.union(bg)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const e={visible:!0,active:!0,geometryIndex:t};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(dg),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=e):(n=this._instanceInfo.length,this._instanceInfo.push(e));const i=this._matricesTexture;gg.identity().toArray(i.image.data,16*n),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(yg.toArray(r.image.data,4*n),r.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(t),this._validateGeometry(t);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===e?t.getAttribute("position").count:e;const a=t.getIndex();if(null!==a&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===n?a.count:n),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(dg),o=this._availableGeometryIds.shift(),r[o]=i):(o=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(o,t),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,o}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),a=e.getIndex(),o=this._geometryInfo[t];if(i&&a.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const s=o.vertexStart,l=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const c in n.attributes){const t=e.getAttribute(c),i=n.getAttribute(c);Cg(t,i,s);const r=t.itemSize;for(let e=t.count,n=l;e<n;e++){const t=s+e;for(let e=0;e<r;e++)i.setComponent(t,e,0)}i.needsUpdate=!0,i.addUpdateRange(s*r,l*r)}if(i){const t=o.indexStart,n=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let e=0;e<a.count;e++)r.setX(t+e,s+a.getX(e));for(let e=a.count,i=n;e<i;e++)r.setX(t+e,s);r.needsUpdate=!0,r.addUpdateRange(t,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,null!==e.boundingBox&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,null!==e.boundingSphere&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||!1===e[t].active)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===t&&this.deleteInstance(i);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const n=this._geometryInfo,i=n.map((t,e)=>e).sort((t,e)=>n[t].vertexStart-n[e].vertexStart),r=this.geometry;for(let a=0,o=n.length;a<o;a++){const o=i[a],s=n[o];if(!1!==s.active){if(null!==r.index){if(s.indexStart!==e){const{indexStart:n,vertexStart:i,reservedIndexCount:a}=s,o=r.index,l=o.array,c=t-i;for(let t=n;t<n+a;t++)l[t]=l[t]+c;o.array.copyWithin(e,n,n+a),o.addUpdateRange(e,a),s.indexStart=e}e+=s.reservedIndexCount}if(s.vertexStart!==t){const{vertexStart:e,reservedVertexCount:n}=s,i=r.attributes;for(const r in i){const a=i[r],{array:o,itemSize:s}=a;o.copyWithin(t*s,e*s,(e+n)*s),a.addUpdateRange(t*s,n*s)}s.vertexStart=t}t+=s.reservedVertexCount,s.start=r.index?s.indexStart:s.vertexStart,this._nextIndexStart=r.index?s.indexStart+s.reservedIndexCount:0,this._nextVertexStart=s.vertexStart+s.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[t];if(null===i.boundingBox){const t=new kd,e=n.index,r=n.attributes.position;for(let n=i.start,a=i.start+i.count;n<a;n++){let i=n;e&&(i=e.getX(i)),t.expandByPoint(wg.fromBufferAttribute(r,i))}i.boundingBox=t}return e.copy(i.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[t];if(null===i.boundingSphere){const e=new Kd;this.getBoundingBoxAt(t,xg),xg.getCenter(e.center);const r=n.index,a=n.attributes.position;let o=0;for(let t=i.start,n=i.start+i.count;t<n;t++){let n=t;r&&(n=r.getX(n)),wg.fromBufferAttribute(a,n),o=Math.max(o,e.center.distanceToSquared(wg))}e.radius=Math.sqrt(o),i.boundingSphere=e}return e.copy(i.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const n=this._matricesTexture,i=this._matricesTexture.image.data;return e.toArray(i,16*t),n.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,16*t)}setColorAt(t,e){return this.validateInstanceId(t),null===this._colorsTexture&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,4*t),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,4*t)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e||(this._instanceInfo[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(t);const n=this._geometryInfo[t];return e.vertexStart=n.vertexStart,e.vertexCount=n.vertexCount,e.reservedVertexCount=n.reservedVertexCount,e.indexStart=n.indexStart,e.indexCount=n.indexCount,e.reservedIndexCount=n.reservedIndexCount,e.start=n.start,e.count=n.count,e}setInstanceCount(t){const e=this._availableInstanceIds,n=this._instanceInfo;for(e.sort(dg);e[e.length-1]===n.length-1;)n.pop(),e.pop();if(t<n.length)throw new Error("BatchedMesh: Instance ids outside the range ".concat(t," are being used. Cannot shrink instance count."));const i=new Int32Array(t),r=new Int32Array(t);Pg(this._multiDrawCounts,i),Pg(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=t;const a=this._indirectTexture,o=this._matricesTexture,s=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Pg(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Pg(o.image.data,this._matricesTexture.image.data),s&&(s.dispose(),this._initColorsTexture(),Pg(s.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const n=[...this._geometryInfo].filter(t=>t.active);if(Math.max(...n.map(t=>t.vertexStart+t.reservedVertexCount))>t)throw new Error("BatchedMesh: Geometry vertex values are being used outside the range ".concat(e,". Cannot shrink further."));if(this.geometry.index){if(Math.max(...n.map(t=>t.indexStart+t.reservedIndexCount))>e)throw new Error("BatchedMesh: Geometry index values are being used outside the range ".concat(e,". Cannot shrink further."))}const i=this.geometry;i.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Cf,this._initializeGeometry(i));const r=this.geometry;i.index&&Pg(i.index.array,r.index.array);for(const a in i.attributes)Pg(i.attributes[a].array,r.attributes[a].array)}raycast(t,e){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,a=this.geometry;Eg.material=this.material,Eg.geometry.index=a.index,Eg.geometry.attributes=a.attributes,null===Eg.geometry.boundingBox&&(Eg.geometry.boundingBox=new kd),null===Eg.geometry.boundingSphere&&(Eg.geometry.boundingSphere=new Kd);for(let o=0,s=n.length;o<s;o++){if(!n[o].visible||!n[o].active)continue;const a=n[o].geometryIndex,s=i[a];Eg.geometry.setDrawRange(s.start,s.count),this.getMatrixAt(o,Eg.matrixWorld).premultiply(r),this.getBoundingBoxAt(a,Eg.geometry.boundingBox),this.getBoundingSphereAt(a,Eg.geometry.boundingSphere),Eg.raycast(t,Ag);for(let t=0,n=Ag.length;t<n;t++){const n=Ag[t];n.object=this,n.batchId=o,e.push(n)}Ag.length=0}Eg.material=null,Eg.geometry.index=null,Eg.geometry.attributes={},Eg.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(t=>Dt(Dt({},t),{},{boundingBox:null!==t.boundingBox?t.boundingBox.clone():null,boundingSphere:null!==t.boundingSphere?t.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(t=>Dt({},t)),this._availableInstanceIds=t._availableInstanceIds.slice(),this._availableGeometryIds=t._availableGeometryIds.slice(),this._nextIndexStart=t._nextIndexStart,this._nextVertexStart=t._nextVertexStart,this._geometryCount=t._geometryCount,this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._indirectTexture=t._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(t,e,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),o=null===a?1:a.array.BYTES_PER_ELEMENT,s=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data,f=n.isArrayCamera?_g:vg;h&&!n.isArrayCamera&&(gg.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),vg.setFromProjectionMatrix(gg,n.coordinateSystem,n.reversedDepth));let m=0;if(this.sortObjects){gg.copy(this.matrixWorld).invert(),wg.setFromMatrixPosition(n.matrixWorld).applyMatrix4(gg),Sg.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(gg);for(let i=0,r=s.length;i<r;i++)if(s[i].visible&&s[i].active){const t=s[i].geometryIndex;this.getMatrixAt(i,gg),this.getBoundingSphereAt(t,bg).applyMatrix4(gg);let e=!1;if(h&&(e=!f.intersectsSphere(bg,n)),!e){const e=u[t],n=Mg.subVectors(bg.center,wg).dot(Sg);Tg.push(e.start,e.count,n,i)}}const t=Tg.list,e=this.customSort;null===e?t.sort(r.transparent?fg:pg):e.call(this,t,n);for(let n=0,i=t.length;n<i;n++){const e=t[n];l[m]=e.start*o,c[m]=e.count,p[m]=e.index,m++}Tg.reset()}else for(let g=0,y=s.length;g<y;g++)if(s[g].visible&&s[g].active){const t=s[g].geometryIndex;let e=!1;if(h&&(this.getMatrixAt(g,gg),this.getBoundingSphereAt(t,bg).applyMatrix4(gg),e=!f.intersectsSphere(bg,n)),!e){const e=u[t];l[m]=e.start*o,c[m]=e.count,p[m]=g,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(t,e,n,i,r,a){this.onBeforeRender(t,null,i,r,a)}}class Rg extends tf{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Jp(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const kg=new Qh,Lg=new Qh,Dg=new ap,zg=new rp,Ng=new Kd,Og=new Qh,Fg=new Qh;class Bg extends kp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rg;super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)kg.fromBufferAttribute(e,t-1),Lg.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=kg.distanceTo(Lg);t.setAttribute("lineDistance",new xf(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ng.copy(n.boundingSphere),Ng.applyMatrix4(i),Ng.radius+=r,!1===t.ray.intersectsSphere(Ng))return;Dg.copy(i).invert(),zg.copy(t.ray).applyMatrix4(Dg);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,a.start),i=Math.min(c.count,a.start+a.count);for(let r=n,a=i-1;r<a;r+=l){const n=c.getX(r),i=c.getX(r+1),a=Ug(this,t,zg,s,n,i,r);a&&e.push(a)}if(this.isLineLoop){const r=c.getX(i-1),a=c.getX(n),o=Ug(this,t,zg,s,r,a,i-1);o&&e.push(o)}}else{const n=Math.max(0,a.start),i=Math.min(u.count,a.start+a.count);for(let r=n,a=i-1;r<a;r+=l){const n=Ug(this,t,zg,s,r,r+1,r);n&&e.push(n)}if(this.isLineLoop){const r=Ug(this,t,zg,s,i-1,n,i-1);r&&e.push(r)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Ug(t,e,n,i,r,a,o){const s=t.geometry.attributes.position;kg.fromBufferAttribute(s,r),Lg.fromBufferAttribute(s,a);if(n.distanceSqToSegment(kg,Lg,Og,Fg)>i)return;Og.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(Og);return l<e.near||l>e.far?void 0:{distance:l,point:Fg.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}const jg=new Qh,Vg=new Qh;class Hg extends Bg{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)jg.fromBufferAttribute(e,t),Vg.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+jg.distanceTo(Vg);t.setAttribute("lineDistance",new xf(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Gg extends Bg{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Wg extends tf{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Jp(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const qg=new ap,Zg=new rp,Xg=new Kd,Yg=new Qh;class Kg extends kp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cf,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wg;super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xg.copy(n.boundingSphere),Xg.applyMatrix4(i),Xg.radius+=r,!1===t.ray.intersectsSphere(Xg))return;qg.copy(i).invert(),Zg.copy(t.ray).applyMatrix4(qg);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,a.start),r=Math.min(l.count,a.start+a.count);n<r;n++){const r=l.getX(n);Yg.fromBufferAttribute(c,r),Jg(Yg,r,s,i,t,e,this)}}else{for(let n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);n<r;n++)Yg.fromBufferAttribute(c,n),Jg(Yg,n,s,i,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Jg(t,e,n,i,r,a,o){const s=Zg.distanceSqToPoint(t);if(s<n){const n=new Qh;Zg.closestPointToPoint(t,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class $g extends Md{constructor(t,e,n,i){super(t,e,n,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:bc,arguments.length>5&&void 0!==arguments[5]?arguments[5]:bc,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8?arguments[8]:void 0),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const r=this;"requestVideoFrameCallback"in t&&(this._requestVideoFrameCallbackId=t.requestVideoFrameCallback(function e(){r.needsUpdate=!0,r._requestVideoFrameCallbackId=t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class Qg extends $g{constructor(t,e,n,i,r,a,o,s){super({},t,e,n,i,r,a,o,s),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(t){this.image=t,this.needsUpdate=!0}}class ty extends Md{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=gc,this.minFilter=gc,this.generateMipmaps=!1,this.needsUpdate=!0}}class ey extends Md{constructor(t,e,n,i,r,a,o,s,l,c,u,h){super(null,a,o,s,l,c,i,r,u,h),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class ny extends ey{constructor(t,e,n,i,r,a){super(t,e,n,r,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=fc,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class iy extends ey{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,lc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class ry extends Md{constructor(t,e,n,i,r,a,o,s,l){super(t,e,n,i,r,a,o,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ay extends Md{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Rc,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:gc,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:gc,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Vc,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;if(c!==Vc&&c!==Hc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:t,height:e,depth:u},i,r,a,o,s,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new xd(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}class oy extends Md{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.sourceTexture=t,this.isExternalTexture=!0}copy(t){return super.copy(t),this.sourceTexture=t.sourceTexture,this}}class sy extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:n,radialSegments:i,heightSegments:r},e=Math.max(0,e),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),r=Math.max(1,Math.floor(r));const a=[],o=[],s=[],l=[],c=e/2,u=Math.PI/2*t,h=e,d=2*u+h,p=2*n+r,f=i+1,m=new Qh,g=new Qh;for(let y=0;y<=p;y++){let v=0,_=0,x=0,b=0;if(y<=n){const e=y/n,i=e*Math.PI/2;_=-c-t*Math.cos(i),x=t*Math.sin(i),b=-t*Math.cos(i),v=e*u}else if(y<=n+r){const i=(y-n)/r;_=i*e-c,x=t,b=0,v=u+i*h}else{const e=(y-n-r)/n,i=e*Math.PI/2;_=c+t*Math.sin(i),x=t*Math.cos(i),b=t*Math.sin(i),v=u+h+e*u}const w=Math.max(0,Math.min(1,v/d));let S=0;0===y?S=.5/i:y===p&&(S=-.5/i);for(let t=0;t<=i;t++){const e=t/i,n=e*Math.PI*2,r=Math.sin(n),a=Math.cos(n);g.x=-x*a,g.y=_,g.z=x*r,o.push(g.x,g.y,g.z),m.set(-x*a,b,x*r),m.normalize(),s.push(m.x,m.y,m.z),l.push(e+S,w)}if(y>0){const t=(y-1)*f;for(let e=0;e<i;e++){const n=t+e,i=t+e+1,r=y*f+e,o=y*f+e+1;a.push(n,i,r),a.push(i,o,r)}}}this.setIndex(a),this.setAttribute("position",new xf(o,3)),this.setAttribute("normal",new xf(s,3)),this.setAttribute("uv",new xf(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new sy(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class ly extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],a=[],o=[],s=[],l=new Qh,c=new Jh;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let u=0,h=3;u<=e;u++,h+=3){const r=n+u/e*i;l.x=t*Math.cos(r),l.y=t*Math.sin(r),a.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(a[h]/t+1)/2,c.y=(a[h+1]/t+1)/2,s.push(c.x,c.y)}for(let u=1;u<=e;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new xf(a,3)),this.setAttribute("normal",new xf(o,3)),this.setAttribute("uv",new xf(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ly(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class cy extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const r=p,a=new Jh,f=new Qh;let y=0;const v=!0===n?t:e,_=!0===n?1:-1;for(let t=1;t<=i;t++)u.push(0,m*_,0),h.push(0,_,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=i;t++){const e=t/i*s+o,n=Math.cos(e),r=Math.sin(e);f.x=v*r,f.y=m*_,f.z=v*n,u.push(f.x,f.y,f.z),h.push(0,_,0),a.x=.5*n+.5,a.y=.5*r*_+.5,d.push(a.x,a.y),p++}for(let t=0;t<i;t++){const e=r+t,i=x+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const a=new Qh,y=new Qh;let v=0;const _=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,v=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*s+o,l=Math.sin(r),f=Math.cos(r);y.x=v*l,y.y=-g*n+m,y.z=v*f,u.push(y.x,y.y,y.z),a.set(l,_,f).normalize(),h.push(a.x,a.y,a.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let n=0;n<i;n++)for(let i=0;i<r;i++){const a=f[i][n],o=f[i+1][n],s=f[i+1][n+1],l=f[i][n+1];(t>0||0!==i)&&(c.push(a,o,l),v+=3),(e>0||i!==r-1)&&(c.push(o,s,l),v+=3)}l.addGroup(g,v,0),g+=v}(),!1===a&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new xf(u,3)),this.setAttribute("normal",new xf(h,3)),this.setAttribute("uv",new xf(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new cy(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class uy extends cy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,t,e,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(t){return new uy(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class hy extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],a=[];function o(t,e,n,i){const r=i+1,a=[];for(let o=0;o<=r;o++){a[o]=[];const i=t.clone().lerp(n,o/r),s=e.clone().lerp(n,o/r),l=r-o;for(let t=0;t<=l;t++)a[o][t]=0===t&&o===r?i:i.clone().lerp(s,t/l)}for(let o=0;o<r;o++)for(let t=0;t<2*(r-o)-1;t++){const e=Math.floor(t/2);t%2===0?(s(a[o][e+1]),s(a[o+1][e]),s(a[o][e])):(s(a[o][e+1]),s(a[o+1][e+1]),s(a[o+1][e]))}}function s(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(a[e]=t.x-1),0===n.x&&0===n.z&&(a[e]=i/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){const n=new Qh,i=new Qh,r=new Qh;for(let a=0;a<e.length;a+=3)l(e[a+0],n),l(e[a+1],i),l(e[a+2],r),o(n,i,r,t)}(i),function(t){const e=new Qh;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new Qh;for(let e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];const n=u(t)/2/Math.PI+.5,i=h(t)/Math.PI+.5;a.push(n,1-i)}(function(){const t=new Qh,e=new Qh,n=new Qh,i=new Qh,o=new Jh,s=new Jh,l=new Jh;for(let h=0,d=0;h<r.length;h+=9,d+=6){t.set(r[h+0],r[h+1],r[h+2]),e.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=u(i);c(o,d+0,t,p),c(s,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<a.length;t+=6){const e=a[t+0],n=a[t+2],i=a[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(a[t+0]+=1),n<.2&&(a[t+2]+=1),i<.2&&(a[t+4]+=1))}}()}(),this.setAttribute("position",new xf(r,3)),this.setAttribute("normal",new xf(r.slice(),3)),this.setAttribute("uv",new xf(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new hy(t.vertices,t.indices,t.radius,t.details)}}class dy extends hy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new dy(t.radius,t.detail)}}const py=new Qh,fy=new Qh,my=new Qh,gy=new qp;class yy extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(Vh*e),a=t.getIndex(),o=t.getAttribute("position"),s=a?a.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let t=0;t<s;t+=3){a?(l[0]=a.getX(t),l[1]=a.getX(t+1),l[2]=a.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:n,c:s}=gy;if(e.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),s.fromBufferAttribute(o,l[2]),gy.getNormal(my),u[0]="".concat(Math.round(e.x*i),",").concat(Math.round(e.y*i),",").concat(Math.round(e.z*i)),u[1]="".concat(Math.round(n.x*i),",").concat(Math.round(n.y*i),",").concat(Math.round(n.z*i)),u[2]="".concat(Math.round(s.x*i),",").concat(Math.round(s.y*i),",").concat(Math.round(s.z*i)),u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=u[t],i=u[e],a=gy[c[t]],o=gy[c[e]],s="".concat(n,"_").concat(i),p="".concat(i,"_").concat(n);p in h&&h[p]?(my.dot(h[p].normal)<=r&&(d.push(a.x,a.y,a.z),d.push(o.x,o.y,o.z)),h[p]=null):s in h||(h[s]={index0:l[t],index1:l[e],normal:my.clone()})}}for(const t in h)if(h[t]){const{index0:e,index1:n}=h[t];py.fromBufferAttribute(o,e),fy.fromBufferAttribute(o,n),d.push(py.x,py.y,py.z),d.push(fy.x,fy.y,fy.z)}this.setAttribute("position",new xf(d,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class vy{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getLengths();let i=0;const r=n.length;let a;a=e||t*n[r-1];let o,s=0,l=r-1;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),o=n[i]-a,o<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===a)return i/(r-1);const c=n[i];return(i+(a-c)/(n[i+1]-c))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const a=this.getPoint(i),o=this.getPoint(r),s=e||(a.isVector2?new Jh:new Qh);return s.copy(o).sub(a).normalize(),s}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new Qh,i=[],r=[],a=[],o=new Qh,s=new ap;for(let d=0;d<=t;d++){const e=d/t;i[d]=this.getTangentAt(e,new Qh)}r[0]=new Qh,a[0]=new Qh;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(let d=1;d<=t;d++){if(r[d]=r[d-1].clone(),a[d]=a[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Wh(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(s.makeRotationAxis(o,t))}a[d].crossVectors(i[d],r[d])}if(!0===e){let e=Math.acos(Wh(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(s.makeRotationAxis(i[n],e*n)),a[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class _y extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const r=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);const a=this.aStartAngle+t*i;let o=this.aX+this.xRadius*Math.cos(a),s=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=s-this.aY;o=n*t-i*e+this.aX,s=n*e+i*t+this.aY}return e.set(o,s)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class xy extends _y{constructor(t,e,n,i,r,a){super(t,e,n,n,i,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function by(){let t=0,e=0,n=0,i=0;function r(r,a,o,s){t=r,e=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(t,e,n,i,a){r(e,n,a*(n-t),a*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,a,o,s){let l=(e-t)/a-(n-t)/(a+o)+(n-e)/o,c=(n-e)/o-(i-e)/(o+s)+(i-n)/s;l*=o,c*=o,r(e,n,l,c)},calc:function(r){const a=r*r;return t+e*r+n*a+i*(a*r)}}}const wy=new Qh,Sy=new by,My=new by,Ty=new by;class Ey extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh,n=this.points,i=n.length,r=(i-(this.closed?0:1))*t;let a,o,s=Math.floor(r),l=r-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/i)+1)*i:0===l&&s===i-1&&(s=i-2,l=1),this.closed||s>0?a=n[(s-1)%i]:(wy.subVectors(n[0],n[1]).add(n[0]),a=wy);const c=n[s%i],u=n[(s+1)%i];if(this.closed||s+2<i?o=n[(s+2)%i]:(wy.subVectors(n[i-1],n[i-2]).add(n[i-1]),o=wy),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),n=Math.pow(c.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),Sy.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,n,i),My.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,n,i),Ty.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(Sy.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),My.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),Ty.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return e.set(Sy.calc(l),My.calc(l),Ty.calc(l)),e}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Qh).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ay(t,e,n,i,r){const a=.5*(i-e),o=.5*(r-n),s=t*t;return(2*n-2*i+a+o)*(t*s)+(-3*n+3*i-2*a-o)*s+a*t+n}function Cy(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Py(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class Iy extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Jh,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Jh;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return e.set(Py(t,n.x,i.x,r.x,a.x),Py(t,n.y,i.y,r.y,a.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Ry extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Qh,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Qh;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return e.set(Py(t,n.x,i.x,r.x,a.x),Py(t,n.y,i.y,r.y,a.y),Py(t,n.z,i.z,r.z,a.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class ky extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh).subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ly extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh;return 1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh).subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Dy extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Jh;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=this.v0,i=this.v1,r=this.v2;return e.set(Cy(t,n.x,i.x,r.x),Cy(t,n.y,i.y,r.y)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class zy extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Qh;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh,n=this.v0,i=this.v1,r=this.v2;return e.set(Cy(t,n.x,i.x,r.x),Cy(t,n.y,i.y,r.y),Cy(t,n.z,i.z,r.z)),e}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ny extends vy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh,n=this.points,i=(n.length-1)*t,r=Math.floor(i),a=i-r,o=n[0===r?r:r-1],s=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return e.set(Ay(a,o.x,s.x,l.x,c.x),Ay(a,o.y,s.y,l.y,c.y)),e}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Jh).fromArray(n))}return this}}var Oy=Object.freeze({__proto__:null,ArcCurve:xy,CatmullRomCurve3:Ey,CubicBezierCurve:Iy,CubicBezierCurve3:Ry,EllipseCurve:_y,LineCurve:ky,LineCurve3:Ly,QuadraticBezierCurve:Dy,QuadraticBezierCurve3:zy,SplineCurve:Ny});class Fy extends vy{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Oy[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,a=this.curves[r],o=a.getLength(),s=0===o?0:1-t/o;return a.getPointAt(s,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const a=r[i],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o);for(let t=0;t<s.length;t++){const i=s[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Oy[n.type]).fromJSON(n))}return this}}class By extends Fy{constructor(t){super(),this.type="Path",this.currentPoint=new Jh,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new ky(this.currentPoint.clone(),new Jh(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new Dy(this.currentPoint.clone(),new Jh(t,e),new Jh(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,a){const o=new Iy(this.currentPoint.clone(),new Jh(t,e),new Jh(n,i),new Jh(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new Ny(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+o,e+s,n,i,r,a),this}absarc(t,e,n,i,r,a){return this.absellipse(t,e,n,n,i,r,a),this}ellipse(t,e,n,i,r,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,a,o,s),this}absellipse(t,e,n,i,r,a,o,s){const l=new _y(t,e,n,i,r,a,o,s);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Uy extends By{constructor(t){super(t),this.uuid=Gh(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new By).fromJSON(n))}return this}}function jy(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=e&&e.length,r=i?e[0]*n:t.length;let a=Vy(t,0,r,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(i&&(a=function(t,e,n,i){const r=[];for(let a=0,o=e.length;a<o;a++){const n=Vy(t,e[a]*i,a<o-1?e[a+1]*i:t.length,i,!1);n===n.next&&(n.steiner=!0),r.push(Qy(n))}r.sort(Yy);for(let a=0;a<r.length;a++)n=Ky(r[a],n);return n}(t,e,a,n)),t.length>80*n){s=1/0,l=1/0;let e=-1/0,i=-1/0;for(let a=n;a<r;a+=n){const n=t[a],r=t[a+1];n<s&&(s=n),r<l&&(l=r),n>e&&(e=n),r>i&&(i=r)}c=Math.max(e-s,i-l),c=0!==c?32767/c:0}return Gy(a,o,n,s,l,c,0),o}function Vy(t,e,n,i,r){let a;if(r===function(t,e,n,i){let r=0;for(let a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(let o=e;o<n;o+=i)a=uv(o/i|0,t[o],t[o+1],a);else for(let o=n-i;o>=e;o-=i)a=uv(o/i|0,t[o],t[o+1],a);return a&&rv(a,a.next)&&(hv(a),a=a.next),a}function Hy(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!rv(i,i.next)&&0!==iv(i.prev,i,i.next))i=i.next;else{if(hv(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function Gy(t,e,n,i,r,a,o){if(!t)return;!o&&a&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=$y(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n=1;do{let i,r=t;t=null;let a=null;for(e=0;r;){e++;let o=r,s=0;for(let t=0;t<n&&(s++,o=o.nextZ,o);t++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||r.z<=o.z)?(i=r,r=r.nextZ,s--):(i=o,o=o.nextZ,l--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=o}a.nextZ=null,n*=2}while(e>1)}(r)}(t,i,r,a);let s=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(a?qy(t,i,r,a):Wy(t))e.push(l.i,t.i,c.i),hv(t),t=c.next,s=c.next;else if((t=c)===s){o?1===o?Gy(t=Zy(Hy(t),e),e,n,i,r,a,2):2===o&&Xy(t,e,n,i,r,a):Gy(Hy(t),e,n,i,r,a,1);break}}}function Wy(t){const e=t.prev,n=t,i=t.next;if(iv(e,n,i)>=0)return!1;const r=e.x,a=n.x,o=i.x,s=e.y,l=n.y,c=i.y,u=Math.min(r,a,o),h=Math.min(s,l,c),d=Math.max(r,a,o),p=Math.max(s,l,c);let f=i.next;for(;f!==e;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&ev(r,s,a,l,o,c,f.x,f.y)&&iv(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function qy(t,e,n,i){const r=t.prev,a=t,o=t.next;if(iv(r,a,o)>=0)return!1;const s=r.x,l=a.x,c=o.x,u=r.y,h=a.y,d=o.y,p=Math.min(s,l,c),f=Math.min(u,h,d),m=Math.max(s,l,c),g=Math.max(u,h,d),y=$y(p,f,e,n,i),v=$y(m,g,e,n,i);let _=t.prevZ,x=t.nextZ;for(;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&ev(s,u,l,h,c,d,_.x,_.y)&&iv(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&ev(s,u,l,h,c,d,x.x,x.y)&&iv(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==r&&_!==o&&ev(s,u,l,h,c,d,_.x,_.y)&&iv(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==o&&ev(s,u,l,h,c,d,x.x,x.y)&&iv(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Zy(t,e){let n=t;do{const i=n.prev,r=n.next.next;!rv(i,r)&&av(i,n,n.next,r)&&lv(i,r)&&lv(r,i)&&(e.push(i.i,n.i,r.i),hv(n),hv(n.next),n=t=r),n=n.next}while(n!==t);return Hy(n)}function Xy(t,e,n,i,r,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&nv(o,t)){let s=cv(o,t);return o=Hy(o,o.next),s=Hy(s,s.next),Gy(o,e,n,i,r,a,0),void Gy(s,e,n,i,r,a,0)}t=t.next}o=o.next}while(o!==t)}function Yy(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function Ky(t,e){const n=function(t,e){let n=e;const i=t.x,r=t.y;let a,o=-1/0;if(rv(t,n))return n;do{if(rv(t,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o&&(o=t,a=n.x<n.next.x?n:n.next,t===i))return a}n=n.next}while(n!==e);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(i>=n.x&&n.x>=l&&i!==n.x&&tv(r<c?i:o,r,l,c,r<c?o:i,r,n.x,n.y)){const e=Math.abs(r-n.y)/(i-n.x);lv(n,t)&&(e<u||e===u&&(n.x>a.x||n.x===a.x&&Jy(a,n)))&&(a=n,u=e)}n=n.next}while(n!==s);return a}(t,e);if(!n)return e;const i=cv(n,t);return Hy(i,i.next),Hy(n,n.next)}function Jy(t,e){return iv(t.prev,t,e.prev)<0&&iv(e.next,t,t.next)<0}function $y(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Qy(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function tv(t,e,n,i,r,a,o,s){return(r-o)*(e-s)>=(t-o)*(a-s)&&(t-o)*(i-s)>=(n-o)*(e-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function ev(t,e,n,i,r,a,o,s){return!(t===o&&e===s)&&tv(t,e,n,i,r,a,o,s)}function nv(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&av(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(lv(t,e)&&lv(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(iv(t.prev,t,e.prev)||iv(t,e.prev,e))||rv(t,e)&&iv(t.prev,t,t.next)>0&&iv(e.prev,e,e.next)>0)}function iv(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function rv(t,e){return t.x===e.x&&t.y===e.y}function av(t,e,n,i){const r=sv(iv(t,e,n)),a=sv(iv(t,e,i)),o=sv(iv(n,i,t)),s=sv(iv(n,i,e));return r!==a&&o!==s||(!(0!==r||!ov(t,n,e))||(!(0!==a||!ov(t,i,e))||(!(0!==o||!ov(n,t,i))||!(0!==s||!ov(n,e,i)))))}function ov(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function sv(t){return t>0?1:t<0?-1:0}function lv(t,e){return iv(t.prev,t,t.next)<0?iv(t,e,t.next)>=0&&iv(t,t.prev,e)>=0:iv(t,e,t.prev)<0||iv(t,t.next,e)<0}function cv(t,e){const n=dv(t.i,t.x,t.y),i=dv(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function uv(t,e,n,i){const r=dv(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function hv(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function dv(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class pv{static triangulate(t,e){return jy(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:2)}}class fv{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return fv.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];mv(t),gv(n,t);let a=t.length;e.forEach(mv);for(let s=0;s<e.length;s++)i.push(a),a+=e[s].length,gv(n,e[s]);const o=pv.triangulate(n,i);for(let s=0;s<o.length;s+=3)r.push(o.slice(s,s+3));return r}}function mv(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function gv(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class yv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uy([new Jh(.5,.5),new Jh(-.5,.5),new Jh(-.5,-.5),new Jh(.5,-.5)]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let o=0,s=t.length;o<s;o++){a(t[o])}function a(t){const a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,h=void 0!==e.bevelSize?e.bevelSize:u-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:vv;let g,y,v,_,x,b=!1;f&&(g=f.getSpacedPoints(s),b=!0,c=!1,y=f.computeFrenetFrames(s,!1),v=new Qh,_=new Qh,x=new Qh),c||(p=0,u=0,h=0,d=0);const w=t.extractPoints(o);let S=w.shape;const M=w.holes;if(!fv.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];fv.isClockWise(e)&&(M[t]=e.reverse())}}function T(t){const e=1e-10*1e-10;let n=t[0];for(let i=1;i<=t.length;i++){const r=i%t.length,a=t[r],o=a.x-n.x,s=a.y-n.y,l=o*o+s*s,c=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(n.x),Math.abs(n.y));l<=e*c*c?(t.splice(r,1),i--):n=a}}T(S),M.forEach(T);const E=M.length,A=S;for(let e=0;e<E;e++){const t=M[e];S=S.concat(t)}function C(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n)}const P=S.length;function I(t,e,n){let i,r,a;const o=t.x-e.x,s=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=o*o+s*s,h=o*c-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=e.x-s/h,f=e.y+o/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(o*c-s*l);i=p+o*m-t.x,r=f+s*m-t.y;const g=i*i+r*r;if(g<=2)return new Jh(i,r);a=Math.sqrt(g/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(s)===Math.sign(c)&&(t=!0),t?(i=-s,r=o,a=Math.sqrt(u)):(i=o,r=s,a=Math.sqrt(u/2))}return new Jh(i/a,r/a)}const R=[];for(let e=0,n=A.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),R[e]=I(A[e],A[i],A[r]);const k=[];let L,D,z=R.concat();for(let e=0,n=E;e<n;e++){const t=M[e];L=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[e]=I(t[e],t[i],t[r]);k.push(L),z=z.concat(L)}if(0===p)D=fv.triangulateShape(A,M);else{const t=[],e=[];for(let n=0;n<p;n++){const i=n/p,r=u*Math.cos(i*Math.PI/2),a=h*Math.sin(i*Math.PI/2)+d;for(let e=0,n=A.length;e<n;e++){const n=C(A[e],R[e],a);B(n.x,n.y,-r),0===i&&t.push(n)}for(let t=0,n=E;t<n;t++){const n=M[t];L=k[t];const o=[];for(let t=0,e=n.length;t<e;t++){const e=C(n[t],L[t],a);B(e.x,e.y,-r),0===i&&o.push(e)}0===i&&e.push(o)}}D=fv.triangulateShape(t,e)}const N=D.length,O=h+d;for(let e=0;e<P;e++){const t=c?C(S[e],z[e],O):S[e];b?(_.copy(y.normals[0]).multiplyScalar(t.x),v.copy(y.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(_).add(v),B(x.x,x.y,x.z)):B(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<P;t++){const n=c?C(S[t],z[t],O):S[t];b?(_.copy(y.normals[e]).multiplyScalar(n.x),v.copy(y.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(_).add(v),B(x.x,x.y,x.z)):B(n.x,n.y,l/s*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,r=A.length;e<r;e++){const t=C(A[e],R[e],i);B(t.x,t.y,l+n)}for(let e=0,r=M.length;e<r;e++){const t=M[e];L=k[e];for(let e=0,r=t.length;e<r;e++){const r=C(t[e],L[e],i);b?B(r.x,r.y+g[s-1].y,g[s-1].x+n):B(r.x,r.y,l+n)}}}function F(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=s+2*p;t<n;t++){const n=P*t,a=P*(t+1);j(e+i+n,e+r+n,e+r+a,e+i+a)}}}function B(t,e,n){a.push(t),a.push(e),a.push(n)}function U(t,e,r){V(t),V(e),V(r);const a=i.length/3,o=m.generateTopUV(n,i,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[2])}function j(t,e,r,a){V(t),V(e),V(a),V(e),V(r),V(a);const o=i.length/3,s=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[3]),H(s[1]),H(s[2]),H(s[3])}function V(t){i.push(a[3*t+0]),i.push(a[3*t+1]),i.push(a[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=P*t;for(let n=0;n<N;n++){const t=D[n];U(t[2]+e,t[1]+e,t[0]+e)}t=s+2*p,e=P*t;for(let n=0;n<N;n++){const t=D[n];U(t[0]+e,t[1]+e,t[2]+e)}}else{for(let t=0;t<N;t++){const e=D[t];U(e[2],e[1],e[0])}for(let t=0;t<N;t++){const e=D[t];U(e[0]+P*s,e[1]+P*s,e[2]+P*s)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;F(A,e),e+=A.length;for(let n=0,i=M.length;n<i;n++){const t=M[n];F(t,e),e+=t.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new xf(i,3)),this.setAttribute("uv",new xf(r,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const e=t[i];n.shapes.push(e.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let r=0,a=t.shapes.length;r<a;r++){const i=e[t.shapes[r]];n.push(i)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Oy[i.type]).fromJSON(i)),new yv(n,t.options)}}const vv={generateTopUV:function(t,e,n,i,r){const a=e[3*n],o=e[3*n+1],s=e[3*i],l=e[3*i+1],c=e[3*r],u=e[3*r+1];return[new Jh(a,o),new Jh(s,l),new Jh(c,u)]},generateSideWallUV:function(t,e,n,i,r,a){const o=e[3*n],s=e[3*n+1],l=e[3*n+2],c=e[3*i],u=e[3*i+1],h=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*a],g=e[3*a+1],y=e[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new Jh(o,1-l),new Jh(c,1-h),new Jh(d,1-f),new Jh(m,1-y)]:[new Jh(s,1-l),new Jh(u,1-h),new Jh(p,1-f),new Jh(g,1-y)]}};class _v extends hy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new _v(t.radius,t.detail)}}class xv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Jh(0,-.5),new Jh(.5,0),new Jh(0,.5)],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=Wh(i,0,2*Math.PI);const r=[],a=[],o=[],s=[],l=[],c=1/e,u=new Qh,h=new Jh,d=new Qh,p=new Qh,f=new Qh;let m=0,g=0;for(let y=0;y<=t.length-1;y++)switch(y){case 0:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),s.push(d.x,d.y,d.z);break;case t.length-1:s.push(f.x,f.y,f.z);break;default:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),s.push(d.x,d.y,d.z),f.copy(p)}for(let y=0;y<=e;y++){const r=n+y*c*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=t.length-1;n++){u.x=t[n].x*d,u.y=t[n].y,u.z=t[n].x*p,a.push(u.x,u.y,u.z),h.x=y/e,h.y=n/(t.length-1),o.push(h.x,h.y);const i=s[3*n+0]*d,r=s[3*n+1],c=s[3*n+0]*p;l.push(i,r,c)}}for(let y=0;y<e;y++)for(let e=0;e<t.length-1;e++){const n=e+y*t.length,i=n,a=n+t.length,o=n+t.length+1,s=n+1;r.push(i,a,s),r.push(o,s,a)}this.setIndex(r),this.setAttribute("position",new xf(a,3)),this.setAttribute("uv",new xf(o,2)),this.setAttribute("normal",new xf(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new xv(t.points,t.segments,t.phiStart,t.phiLength)}}class bv extends hy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new bv(t.radius,t.detail)}}class wv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,a=e/2,o=Math.floor(n),s=Math.floor(i),l=o+1,c=s+1,u=t/o,h=e/s,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const t=g*h-a;for(let e=0;e<l;e++){const n=e*u-r;p.push(n,-t,0),f.push(0,0,1),m.push(e/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let t=0;t<o;t++){const e=t+l*g,n=t+l*(g+1),i=t+1+l*(g+1),r=t+1+l*g;d.push(e,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new xf(p,3)),this.setAttribute("normal",new xf(f,3)),this.setAttribute("uv",new xf(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wv(t.width,t.height,t.widthSegments,t.heightSegments)}}class Sv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const o=[],s=[],l=[],c=[];let u=t;const h=(e-t)/i,d=new Qh,p=new Jh;for(let f=0;f<=i;f++){for(let t=0;t<=n;t++){const i=r+t/n*a;d.x=u*Math.cos(i),d.y=u*Math.sin(i),s.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}u+=h}for(let f=0;f<i;f++){const t=f*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,a=i+n+1,s=i+n+2,l=i+1;o.push(r,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new xf(s,3)),this.setAttribute("normal",new xf(l,3)),this.setAttribute("uv",new xf(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Sv(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Mv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uy([new Jh(0,.5),new Jh(-.5,-.5),new Jh(.5,-.5)]),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],a=[];let o=0,s=0;if(!1===Array.isArray(t))l(t);else for(let c=0;c<t.length;c++)l(t[c]),this.addGroup(o,s,c),o+=s,s=0;function l(t){const o=i.length/3,l=t.extractPoints(e);let c=l.shape;const u=l.holes;!1===fv.isClockWise(c)&&(c=c.reverse());for(let e=0,n=u.length;e<n;e++){const t=u[e];!0===fv.isClockWise(t)&&(u[e]=t.reverse())}const h=fv.triangulateShape(c,u);for(let e=0,n=u.length;e<n;e++){const t=u[e];c=c.concat(t)}for(let e=0,n=c.length;e<n;e++){const t=c[e];i.push(t.x,t.y,0),r.push(0,0,1),a.push(t.x,t.y)}for(let e=0,i=h.length;e<i;e++){const t=h[e],i=t[0]+o,r=t[1]+o,a=t[2]+o;n.push(i,r,a),s+=3}}this.setIndex(n),this.setAttribute("position",new xf(i,3)),this.setAttribute("normal",new xf(r,3)),this.setAttribute("uv",new xf(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Mv(n,t.curveSegments)}}class Tv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new Qh,h=new Qh,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],y=g/n;let v=0;0===g&&0===a?v=.5/e:g===n&&s===Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const s=n/e;u.x=-t*Math.cos(i+s*r)*Math.sin(a+y*o),u.y=t*Math.cos(a+y*o),u.z=t*Math.sin(i+s*r)*Math.sin(a+y*o),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(s+v,1-y),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let t=0;t<e;t++){const e=c[g][t+1],i=c[g][t],r=c[g+1][t],o=c[g+1][t+1];(0!==g||a>0)&&d.push(e,i,o),(g!==n-1||s<Math.PI)&&d.push(i,r,o)}this.setIndex(d),this.setAttribute("position",new xf(p,3)),this.setAttribute("normal",new xf(f,3)),this.setAttribute("uv",new xf(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Tv(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ev extends hy{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ev(t.radius,t.detail)}}class Av extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],s=[],l=[],c=new Qh,u=new Qh,h=new Qh;for(let d=0;d<=n;d++)for(let a=0;a<=i;a++){const p=a/i*r,f=d/n*Math.PI*2;u.x=(t+e*Math.cos(f))*Math.cos(p),u.y=(t+e*Math.cos(f))*Math.sin(p),u.z=e*Math.sin(f),o.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),s.push(h.x,h.y,h.z),l.push(a/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let t=1;t<=i;t++){const e=(i+1)*d+t-1,n=(i+1)*(d-1)+t-1,r=(i+1)*(d-1)+t,o=(i+1)*d+t;a.push(e,n,o),a.push(n,r,o)}this.setIndex(a),this.setAttribute("position",new xf(o,3)),this.setAttribute("normal",new xf(s,3)),this.setAttribute("uv",new xf(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Av(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Cv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:a},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],l=[],c=[],u=new Qh,h=new Qh,d=new Qh,p=new Qh,f=new Qh,m=new Qh,g=new Qh;for(let v=0;v<=n;++v){const o=v/n*r*Math.PI*2;y(o,r,a,t,d),y(o+.01,r,a,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,a=-e*Math.cos(r),o=e*Math.sin(r);u.x=d.x+(a*g.x+o*f.x),u.y=d.y+(a*g.y+o*f.y),u.z=d.z+(a*g.z+o*f.z),s.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(v/n),c.push(t/i)}}for(let v=1;v<=n;v++)for(let t=1;t<=i;t++){const e=(i+1)*(v-1)+(t-1),n=(i+1)*v+(t-1),r=(i+1)*v+t,a=(i+1)*(v-1)+t;o.push(e,n,a),o.push(n,r,a)}function y(t,e,n,i,r){const a=Math.cos(t),o=Math.sin(t),s=n/e*t,l=Math.cos(s);r.x=i*(2+l)*.5*a,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(s)*.5}this.setIndex(o),this.setAttribute("position",new xf(s,3)),this.setAttribute("normal",new xf(l,3)),this.setAttribute("uv",new xf(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Cv(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Pv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zy(new Qh(-1,-1,0),new Qh(-1,1,0),new Qh(1,1,0)),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const a=t.computeFrenetFrames(e,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new Qh,s=new Qh,l=new Jh;let c=new Qh;const u=[],h=[],d=[],p=[];function f(r){c=t.getPointAt(r/e,c);const l=a.normals[r],d=a.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),a=-Math.cos(e);s.x=a*l.x+r*d.x,s.y=a*l.y+r*d.y,s.z=a*l.z+r*d.z,s.normalize(),h.push(s.x,s.y,s.z),o.x=c.x+n*s.x,o.y=c.y+n*s.y,o.z=c.z+n*s.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)l.x=t/e,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),a=(i+1)*t+e,o=(i+1)*(t-1)+e;p.push(n,r,o),p.push(r,a,o)}}()}(),this.setIndex(p),this.setAttribute("position",new xf(u,3)),this.setAttribute("normal",new xf(h,3)),this.setAttribute("uv",new xf(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Pv((new Oy[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Iv extends Cf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new Qh,r=new Qh;if(null!==t.index){const a=t.attributes.position,o=t.index;let s=t.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,l=s.length;t<l;++t){const l=s[t],c=l.start;for(let t=c,s=c+l.count;t<s;t+=3)for(let l=0;l<3;l++){const s=o.getX(t+l),c=o.getX(t+(l+1)%3);i.fromBufferAttribute(a,s),r.fromBufferAttribute(a,c),!0===Rv(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const a=t.attributes.position;for(let t=0,o=a.count/3;t<o;t++)for(let s=0;s<3;s++){const o=3*t+s,l=3*t+(s+1)%3;i.fromBufferAttribute(a,o),r.fromBufferAttribute(a,l),!0===Rv(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new xf(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function Rv(t,e,n){const i="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z),r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z);return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var kv=Object.freeze({__proto__:null,BoxGeometry:Vf,CapsuleGeometry:sy,CircleGeometry:ly,ConeGeometry:uy,CylinderGeometry:cy,DodecahedronGeometry:dy,EdgesGeometry:yy,ExtrudeGeometry:yv,IcosahedronGeometry:_v,LatheGeometry:xv,OctahedronGeometry:bv,PlaneGeometry:wv,PolyhedronGeometry:hy,RingGeometry:Sv,ShapeGeometry:Mv,SphereGeometry:Tv,TetrahedronGeometry:Ev,TorusGeometry:Av,TorusKnotGeometry:Cv,TubeGeometry:Pv,WireframeGeometry:Iv});class Lv extends tf{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Jp(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Dv extends Zf{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class zv extends tf{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Jp(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qu,this.normalScale=new Jh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mp,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Nv extends zv{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Jh(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Wh(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Jp(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Jp(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Jp(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!==t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!==t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!==t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!==t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!==t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!==t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Ov extends tf{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Jp(16777215),this.specular=new Jp(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qu,this.normalScale=new Jh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mp,this.combine=Xl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Fv extends tf{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Jp(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qu,this.normalScale=new Jh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Bv extends tf{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qu,this.normalScale=new Jh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Uv extends tf{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Jp(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Jp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qu,this.normalScale=new Jh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new mp,this.combine=Xl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class jv extends tf{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Vu,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Vv extends tf{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}class Hv extends tf{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Jp(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qu,this.normalScale=new Jh(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Gv extends Rg{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Wv(t,e){return t&&t.constructor!==e?"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function qv(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zv(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(function(e,n){return t[e]-t[n]}),n}function Xv(t,e,n){const i=t.length,r=new t.constructor(i);for(let a=0,o=0;o!==i;++a){const i=n[a]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r}function Yv(t,e,n,i){let r=1,a=t[0];for(;void 0!==a&&void 0===a[i];)a=t[r++];if(void 0===a)return;let o=a[i];if(void 0!==o)if(Array.isArray(o))do{o=a[i],void 0!==o&&(e.push(a.time),n.push(...o)),a=t[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[i],void 0!==o&&(e.push(a.time),o.toArray(n,n.length)),a=t[r++]}while(void 0!==a);else do{o=a[i],void 0!==o&&(e.push(a.time),n.push(o)),a=t[r++]}while(void 0!==a)}class Kv{static convertArray(t,e){return Wv(t,e)}static isTypedArray(t){return qv(t)}static getKeyframeOrder(t){return Zv(t)}static sortedArray(t,e,n){return Xv(t,e,n)}static flattenJSON(t,e,n,i){Yv(t,e,n,i)}static subclip(t,e,n,i){return function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const a=t.clone();a.name=e;const o=[];for(let l=0;l<a.tracks.length;++l){const t=a.tracks[l],e=t.getValueSize(),s=[],c=[];for(let a=0;a<t.times.length;++a){const o=t.times[a]*r;if(!(o<n||o>=i)){s.push(t.times[a]);for(let n=0;n<e;++n)c.push(t.values[a*e+n])}}0!==s.length&&(t.times=Wv(s,t.times.constructor),t.values=Wv(c,t.values.constructor),o.push(t))}a.tracks=o;let s=1/0;for(let l=0;l<a.tracks.length;++l)s>a.tracks[l].times[0]&&(s=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*s);return a.resetDuration(),a}(t,e,n,i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:30)}static makeClipAdditive(t){return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);const r=n.tracks.length,a=e/i;for(let o=0;o<r;++o){const e=n.tracks[o],i=e.ValueTypeName;if("bool"===i||"string"===i)continue;const r=t.tracks.find(function(t){return t.name===e.name&&t.ValueTypeName===i});if(void 0===r)continue;let s=0;const l=e.getValueSize();e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=e.times.length-1;let d;if(a<=e.times[0]){const t=s,n=l-s;d=e.values.slice(t,n)}else if(a>=e.times[h]){const t=h*l+s,n=t+l-s;d=e.values.slice(t,n)}else{const t=e.createInterpolant(),n=s,i=l-s;t.evaluate(a),d=t.resultBuffer.slice(n,i)}"quaternion"===i&&(new $h).fromArray(d).normalize().conjugate().toArray(d);const p=r.times.length;for(let t=0;t<p;++t){const e=t*u+c;if("quaternion"===i)$h.multiplyQuaternionsFlat(r.values,e,d,0,r.values,e);else{const t=u-2*c;for(let n=0;n<t;++n)r.values[e+n]-=d[n]}}}return t.blendMode=Fu,t}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:30)}}class Jv{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let a;n:{i:if(!(t<i)){for(let a=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=i,i=e[++n],t<i)break e}a=e.length;break n}if(!(t>=r)){const o=e[1];t<o&&(n=2,r=o);for(let a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(i=r,r=e[--n-1],t>=r)break e}a=n,n=0;break n}break t}for(;n<a;){const i=n+a>>>1;t<e[i]?a=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let a=0;a!==i;++a)e[a]=n[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class $v extends Jv{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Du,endingEnd:Du}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,a=t+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case zu:r=t,o=2*e-n;break;case Nu:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case zu:a=t,s=2*n-e;break;case Nu:a=1,s=n+i[1]-i[0];break;default:a=t-1,s=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(t,e,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let x=0;x!==o;++x)r[x]=g*a[c+x]+y*a[l+x]+v*a[s+x]+_*a[u+x];return r}}class Qv extends Jv{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,c=(n-e)/(i-e),u=1-c;for(let h=0;h!==o;++h)r[h]=a[l+h]*u+a[s+h]*c;return r}}class t_ extends Jv{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class e_{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Wv(e,this.TimeBufferType),this.values=Wv(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Wv(t.times,Array),values:Wv(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new t_(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Qv(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new $v(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Ru:e=this.InterpolantFactoryMethodDiscrete;break;case ku:e=this.InterpolantFactoryMethodLinear;break;case Lu:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ru;case this.InterpolantFactoryMethodLinear:return ku;case this.InterpolantFactoryMethodSmooth:return Lu}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,a=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==a&&n[a]>e;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);const t=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*t,a*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==r;o++){const e=n[o];if("number"===typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,e),t=!1;break}if(null!==a&&a>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,e,a),t=!1;break}a=e}if(void 0!==i&&qv(i))for(let o=0,s=i.length;o!==s;++o){const e=i[o];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,e),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Lu,r=t.length-1;let a=1;for(let o=1;o<r;++o){let r=!1;const s=t[o];if(s!==t[o+1]&&(1!==o||s!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,a=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[a+o]){r=!0;break}}}if(r){if(o!==a){t[a]=t[o];const i=o*n,r=a*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++a}}if(r>0){t[a]=t[r];for(let t=r*n,i=a*n,o=0;o!==n;++o)e[i+o]=e[t+o];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=e.slice(0,a*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}e_.prototype.ValueTypeName="",e_.prototype.TimeBufferType=Float32Array,e_.prototype.ValueBufferType=Float32Array,e_.prototype.DefaultInterpolation=ku;class n_ extends e_{constructor(t,e,n){super(t,e,n)}}n_.prototype.ValueTypeName="bool",n_.prototype.ValueBufferType=Array,n_.prototype.DefaultInterpolation=Ru,n_.prototype.InterpolantFactoryMethodLinear=void 0,n_.prototype.InterpolantFactoryMethodSmooth=void 0;class i_ extends e_{constructor(t,e,n,i){super(t,e,n,i)}}i_.prototype.ValueTypeName="color";class r_ extends e_{constructor(t,e,n,i){super(t,e,n,i)}}r_.prototype.ValueTypeName="number";class a_ extends Jv{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-e)/(i-e);let l=t*o;for(let c=l+o;l!==c;l+=4)$h.slerpFlat(r,0,a,l-o,a,l,s);return r}}class o_ extends e_{constructor(t,e,n,i){super(t,e,n,i)}InterpolantFactoryMethodLinear(t){return new a_(this.times,this.values,this.getValueSize(),t)}}o_.prototype.ValueTypeName="quaternion",o_.prototype.InterpolantFactoryMethodSmooth=void 0;class s_ extends e_{constructor(t,e,n){super(t,e,n)}}s_.prototype.ValueTypeName="string",s_.prototype.ValueBufferType=Array,s_.prototype.DefaultInterpolation=Ru,s_.prototype.InterpolantFactoryMethodLinear=void 0,s_.prototype.InterpolantFactoryMethodSmooth=void 0;class l_ extends e_{constructor(t,e,n,i){super(t,e,n,i)}}l_.prototype.ValueTypeName="vector";class c_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ou;this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Gh(),this.userData={},this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let a=0,o=n.length;a!==o;++a)e.push(u_(n[a]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r.userData=JSON.parse(t.userData||"{}"),r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode,userData:JSON.stringify(t.userData)};for(let r=0,a=n.length;r!==a;++r)e.push(e_.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,a=[];for(let o=0;o<r;o++){let t=[],s=[];t.push((o+r-1)%r,o,(o+1)%r),s.push(0,1,0);const l=Zv(t);t=Xv(t,1,l),s=Xv(s,1,l),i||0!==t[0]||(t.push(r),s.push(s[0])),a.push(new r_(".morphTargetInfluences["+e[o].name+"]",t,s).scale(1/n))}return new this(t,-1,a)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let o=0,s=t.length;o<s;o++){const e=t[o],n=e.name.match(r);if(n&&n.length>1){const t=n[1];let r=i[t];r||(i[t]=r=[]),r.push(e)}}const a=[];for(const o in i)a.push(this.CreateFromMorphTargetSequence(o,i[o],e,n));return a}static parseAnimation(t,e){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const a=[],o=[];Yv(n,a,o,i),0!==a.length&&r.push(new t(e,a,o))}},i=[],r=t.name||"default",a=t.fps||30,o=t.blendMode;let s=t.length||-1;const l=t.hierarchy||[];for(let c=0;c<l.length;c++){const t=l[c].keys;if(t&&0!==t.length)if(t[0].morphTargets){const e={};let n;for(n=0;n<t.length;n++)if(t[n].morphTargets)for(let i=0;i<t[n].morphTargets.length;i++)e[t[n].morphTargets[i]]=-1;for(const r in e){const e=[],a=[];for(let i=0;i!==t[n].morphTargets.length;++i){const i=t[n];e.push(i.time),a.push(i.morphTarget===r?1:0)}i.push(new r_(".morphTargetInfluence["+r+"]",e,a))}s=e.length*a}else{const r=".bones["+e[c].name+"]";n(l_,r+".position",t,"pos",i),n(o_,r+".quaternion",t,"rot",i),n(l_,r+".scale",t,"scl",i)}}if(0===i.length)return null;return new this(r,s,i,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let n=0;n<this.tracks.length;n++)t.push(this.tracks[n].clone());const e=new this.constructor(this.name,this.duration,t,this.blendMode);return e.userData=JSON.parse(JSON.stringify(this.userData)),e}toJSON(){return this.constructor.toJSON(this)}}function u_(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return r_;case"vector":case"vector2":case"vector3":case"vector4":return l_;case"color":return i_;case"quaternion":return o_;case"bool":case"boolean":return n_;case"string":return s_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];Yv(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const h_={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class d_{constructor(t,e,n){const i=this;let r,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.abortController=new AbortController,this.itemStart=function(t){s++,!1===a&&void 0!==i.onStart&&i.onStart(t,o,s),a=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,s),o===s&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const p_=new d_;class f_{constructor(t){this.manager=void 0!==t?t:p_,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}f_.DEFAULT_MATERIAL_NAME="__DEFAULT";const m_={};class g_ extends Error{constructor(t,e){super(t),this.response=e}}class y_ extends f_{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=h_.get("file:".concat(t));if(void 0!==r)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(void 0!==m_[t])return void m_[t].push({onLoad:e,onProgress:n,onError:i});m_[t]=[],m_[t].push({onLoad:e,onProgress:n,onError:i});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,s=this.responseType;fetch(a).then(e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=m_[t],i=e.body.getReader(),r=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),a=r?parseInt(r):0,o=0!==a;let s=0;const l=new ReadableStream({start(t){!function e(){i.read().then(i=>{let{done:r,value:l}=i;if(r)t.close();else{s+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(l),e()}},e=>{t.error(e)})}()}});return new Response(l)}throw new g_('fetch for "'.concat(e.url,'" responded with ').concat(e.status,": ").concat(e.statusText),e)}).then(t=>{switch(s){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then(t=>(new DOMParser).parseFromString(t,o));case"json":return t.json();default:if(""===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then(t=>i.decode(t))}}}).then(e=>{h_.add("file:".concat(t),e);const n=m_[t];delete m_[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}}).catch(e=>{const n=m_[t];if(void 0===n)throw this.manager.itemError(t),e;delete m_[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class v_ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new y_(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(HH){i?i(HH):console.error(HH),r.manager.itemError(t)}},n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=c_.parse(t[n]);e.push(i)}return e}}class __ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=[],o=new ey,s=new y_(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials);let l=0;function c(c){s.load(t[c],function(t){const n=r.parse(t,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=bc),o.image=a,o.format=n.format,o.needsUpdate=!0,e&&e(o))},n,i)}if(Array.isArray(t))for(let u=0,h=t.length;u<h;++u)c(u);else s.load(t,function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){a[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)a[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),a[e].format=n.format,a[e].width=n.width,a[e].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=bc),o.format=n.format,o.needsUpdate=!0,e&&e(o)},n,i);return o}}const x_=new WeakMap;class b_ extends f_{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=h_.get("image:".concat(t));if(void 0!==a){if(!0===a.complete)r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0);else{let t=x_.get(a);void 0===t&&(t=[],x_.set(a,t)),t.push({onLoad:e,onError:i})}return a}const o=sd("img");function s(){c(),e&&e(this);const n=x_.get(this)||[];for(let t=0;t<n.length;t++){const e=n[t];e.onLoad&&e.onLoad(this)}x_.delete(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),h_.remove("image:".concat(t));const n=x_.get(this)||[];for(let t=0;t<n.length;t++){const i=n[t];i.onError&&i.onError(e)}x_.delete(this),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),h_.add("image:".concat(t),o),r.manager.itemStart(t),o.src=t,o}}class w_ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=new em;r.colorSpace=Yu;const a=new b_(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(n){a.load(t[n],function(t){r.images[n]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let l=0;l<t.length;++l)s(l);return r}}class S_ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new Vm,o=new y_(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,function(t){let n;try{n=r.parse(t)}catch(dE){if(void 0===i)return void console.error(dE);i(dE)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:fc,a.wrapT=void 0!==n.wrapT?n.wrapT:fc,a.magFilter=void 0!==n.magFilter?n.magFilter:bc,a.minFilter=void 0!==n.minFilter?n.minFilter:bc,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Mc),1===n.mipmapCount&&(a.minFilter=bc),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,e&&e(a,n)},n,i),a}}class M_ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=new Md,a=new b_(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)},n,i),r}}class T_ extends kp{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Jp(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class E_ extends T_{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(kp.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Jp(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const A_=new ap,C_=new Qh,P_=new Qh;class I_{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Jh(512,512),this.mapType=Ec,this.map=null,this.mapPass=null,this.matrix=new ap,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new lg,this._frameExtents=new Jh(1,1),this._viewportCount=1,this._viewports=[new Td(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;C_.setFromMatrixPosition(t.matrixWorld),e.position.copy(C_),P_.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(P_),e.updateMatrixWorld(),A_.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(A_,e.coordinateSystem,e.reversedDepth),e.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(A_)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class R_ extends I_{constructor(){super(new $f(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,n=2*Hh*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class k_ extends T_{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(kp.DEFAULT_UP),this.updateMatrix(),this.target=new kp,this.distance=n,this.angle=i,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new R_}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const L_=new ap,D_=new Qh,z_=new Qh;class N_ extends I_{constructor(){super(new $f(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Jh(4,2),this._viewportCount=6,this._viewports=[new Td(2,1,1,1),new Td(0,1,1,1),new Td(3,1,1,1),new Td(1,1,1,1),new Td(3,0,1,1),new Td(1,0,1,1)],this._cubeDirections=[new Qh(1,0,0),new Qh(-1,0,0),new Qh(0,0,1),new Qh(0,0,-1),new Qh(0,1,0),new Qh(0,-1,0)],this._cubeUps=[new Qh(0,1,0),new Qh(0,1,0),new Qh(0,1,0),new Qh(0,1,0),new Qh(0,0,1),new Qh(0,0,-1)]}updateMatrices(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),D_.setFromMatrixPosition(t.matrixWorld),n.position.copy(D_),z_.copy(n.position),z_.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(z_),n.updateMatrixWorld(),i.makeTranslation(-D_.x,-D_.y,-D_.z),L_.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(L_,n.coordinateSystem,n.reversedDepth)}}class O_ extends T_{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new N_}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class F_ extends Xf{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,a=n+t,o=i+e,s=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,a=r+t*this.view.width,o-=e*this.view.offsetY,s=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class B_ extends I_{constructor(){super(new F_(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class U_ extends T_{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(kp.DEFAULT_UP),this.updateMatrix(),this.target=new kp,this.shadow=new B_}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class j_ extends T_{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class V_ extends T_{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class H_{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Qh)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*i),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*n),e.addScaledVector(a[4],n*i*1.092548),e.addScaledVector(a[5],i*r*1.092548),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],n*r*1.092548),e.addScaledVector(a[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*i),e.addScaledVector(a[2],1.023328*r),e.addScaledVector(a[3],1.023328*n),e.addScaledVector(a[4],.858086*n*i),e.addScaledVector(a[5],.858086*i*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],.858086*n*r),e.addScaledVector(a[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}class G_ extends T_{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new H_;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class W_ extends f_{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,a=new y_(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(HH){i?i(HH):console.error(HH),r.manager.itemError(t)}},n,i)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=this.createMaterialFromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Jp).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.dispersion&&(i.dispersion=t.dispersion),void 0!==t.iridescence&&(i.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(i.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.anisotropy&&(i.anisotropy=t.anisotropy),void 0!==t.anisotropyRotation&&(i.anisotropyRotation=t.anisotropyRotation),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.alphaHash&&(i.alphaHash=t.alphaHash),void 0!==t.depthFunc&&(i.depthFunc=t.depthFunc),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.blendSrc&&(i.blendSrc=t.blendSrc),void 0!==t.blendDst&&(i.blendDst=t.blendDst),void 0!==t.blendEquation&&(i.blendEquation=t.blendEquation),void 0!==t.blendSrcAlpha&&(i.blendSrcAlpha=t.blendSrcAlpha),void 0!==t.blendDstAlpha&&(i.blendDstAlpha=t.blendDstAlpha),void 0!==t.blendEquationAlpha&&(i.blendEquationAlpha=t.blendEquationAlpha),void 0!==t.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(t.blendColor),void 0!==t.blendAlpha&&(i.blendAlpha=t.blendAlpha),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),void 0!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.forceSinglePass&&(i.forceSinglePass=t.forceSinglePass),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"===typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const r in t.uniforms){const e=t.uniforms[r];switch(i.uniforms[r]={},e.type){case"t":i.uniforms[r].value=n(e.value);break;case"c":i.uniforms[r].value=(new Jp).setHex(e.value);break;case"v2":i.uniforms[r].value=(new Jh).fromArray(e.value);break;case"v3":i.uniforms[r].value=(new Qh).fromArray(e.value);break;case"v4":i.uniforms[r].value=(new Td).fromArray(e.value);break;case"m3":i.uniforms[r].value=(new nd).fromArray(e.value);break;case"m4":i.uniforms[r].value=(new ap).fromArray(e.value);break;default:i.uniforms[r].value=e.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(i.glslVersion=t.glslVersion),void 0!==t.extensions)for(const r in t.extensions)i.extensions[r]=t.extensions[r];if(void 0!==t.lights&&(i.lights=t.lights),void 0!==t.clipping&&(i.clipping=t.clipping),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Jh).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapRotation&&i.envMapRotation.fromArray(t.envMapRotation),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Jh).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(i.iridescenceMap=n(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.anisotropyMap&&(i.anisotropyMap=n(t.anisotropyMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}createMaterialFromType(t){return W_.createMaterialFromType(t)}static createMaterialFromType(t){return new{ShadowMaterial:Lv,SpriteMaterial:dm,RawShaderMaterial:Dv,ShaderMaterial:Zf,PointsMaterial:Wg,MeshPhysicalMaterial:Nv,MeshStandardMaterial:zv,MeshPhongMaterial:Ov,MeshToonMaterial:Fv,MeshNormalMaterial:Bv,MeshLambertMaterial:Uv,MeshDepthMaterial:jv,MeshDistanceMaterial:Vv,MeshBasicMaterial:ef,MeshMatcapMaterial:Hv,LineDashedMaterial:Gv,LineBasicMaterial:Rg,Material:tf}[t]}}class q_{static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Z_ extends Cf{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class X_ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new y_(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(n){try{e(r.parse(JSON.parse(n)))}catch(HH){i?i(HH):console.error(HH),r.manager.itemError(t)}},n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],a=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers,r=i[e],a=new Uint32Array(r).buffer;return n[e]=a,a}(t,r.buffer),o=od(r.type,a),s=new cm(o,r.stride);return s.uuid=r.uuid,e[i]=s,s}const r=t.isInstancedBufferGeometry?new Z_:new Cf,a=t.data.index;if(void 0!==a){const t=od(a.type,a.array);r.setIndex(new hf(t,1))}const o=t.data.attributes;for(const u in o){const e=o[u];let n;if(e.isInterleavedBufferAttribute){const r=i(t.data,e.data);n=new hm(r,e.itemSize,e.offset,e.normalized)}else{const t=od(e.type,e.array);n=new(e.isInstancedBufferAttribute?qm:hf)(t,e.itemSize,e.normalized)}void 0!==e.name&&(n.name=e.name),void 0!==e.usage&&n.setUsage(e.usage),r.setAttribute(u,n)}const s=t.data.morphAttributes;if(s)for(const u in s){const e=s[u],n=[];for(let r=0,a=e.length;r<a;r++){const a=e[r];let o;if(a.isInterleavedBufferAttribute){const e=i(t.data,a.data);o=new hm(e,a.itemSize,a.offset,a.normalized)}else{const t=od(a.type,a.array);o=new hf(t,a.itemSize,a.normalized)}void 0!==a.name&&(o.name=a.name),n.push(o)}r.morphAttributes[u]=n}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const t=l[u];r.addGroup(t.start,t.count,t.materialIndex)}const c=t.data.boundingSphere;return void 0!==c&&(r.boundingSphere=(new Kd).fromJSON(c)),t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}class Y_ extends f_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=""===this.path?q_.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new y_(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(n){let a=null;try{a=JSON.parse(n)}catch(dE){return void 0!==i&&i(dE),void console.error("THREE:ObjectLoader: Can't parse "+t+".",dE.message)}const o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+t)),void console.error("THREE.ObjectLoader: Can't load "+t);r.parse(a,e)},n,i)}async loadAsync(t,e){const n=""===this.path?q_.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const i=new y_(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(t,e),a=JSON.parse(r),o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(a)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),a=this.parseImages(t.images,function(){void 0!==e&&e(l)}),o=this.parseTextures(t.textures,a),s=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,r,s,o,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==e){let t=!1;for(const e in a)if(a[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,i,o,a,e),l=this.parseSkeletons(t.skeletons,s);return this.bindSkeletons(s,l),this.bindLightTargets(s),s}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new Uy).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse(function(t){t.isBone&&(i[t.uuid]=t)}),void 0!==t)for(let r=0,a=t.length;r<a;r++){const e=(new Wm).fromJSON(t[r],i);n[e.uuid]=e}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new X_;for(let r=0,a=t.length;r<a;r++){let a;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(o);break;default:o.type in kv?a=kv[o.type].fromJSON(o,e):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(o.type,'"'))}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new W_;r.setTextures(e);for(let e=0,a=t.length;e<a;e++){const a=t[e];void 0===n[a.uuid]&&(n[a.uuid]=r.parse(a)),i[a.uuid]=n[a.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=c_.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function a(t){if("string"===typeof t){const e=t;return function(t){return n.manager.itemStart(t),r.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:od(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new d_(e);r=new b_(n),r.setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const n=t[e],r=n.url;if(Array.isArray(r)){const t=[];for(let e=0,n=r.length;e<n;e++){const n=a(r[e]);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new Vm(n.data,n.width,n.height)))}i[n.uuid]=new xd(t)}else{const t=a(n.url);i[n.uuid]=new xd(t)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(t){if("string"===typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await i.loadAsync(r)}return t.data?{data:od(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new b_(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],a=i.url;if(Array.isArray(a)){const t=[];for(let e=0,n=a.length;e<n;e++){const n=a[e],i=await r(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Vm(i.data,i.width,i.height)))}n[i.uuid]=new xd(t)}else{const t=await r(i.url);n[i.uuid]=new xd(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"===typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,a=t.length;r<a;r++){const a=t[r];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const o=e[a.image],s=o.data;let l;Array.isArray(s)?(l=new em,6===s.length&&(l.needsUpdate=!0)):(l=s&&s.data?new Vm:new Md,s&&(l.needsUpdate=!0)),l.source=o,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=n(a.mapping,K_)),void 0!==a.channel&&(l.channel=a.channel),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=n(a.wrap[0],J_),l.wrapT=n(a.wrap[1],J_)),void 0!==a.format&&(l.format=a.format),void 0!==a.internalFormat&&(l.internalFormat=a.internalFormat),void 0!==a.type&&(l.type=a.type),void 0!==a.colorSpace&&(l.colorSpace=a.colorSpace),void 0!==a.minFilter&&(l.minFilter=n(a.minFilter,$_)),void 0!==a.magFilter&&(l.magFilter=n(a.magFilter,$_)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),void 0!==a.generateMipmaps&&(l.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(l.compareFunction=a.compareFunction),void 0!==a.userData&&(l.userData=a.userData),i[a.uuid]=l}return i}parseObject(t,e,n,i,r){let a,o,s;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function u(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":a=new lm,void 0!==t.background&&(Number.isInteger(t.background)?a.background=new Jp(t.background):a.background=u(t.background)),void 0!==t.environment&&(a.environment=u(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?a.fog=new sm(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(a.fog=new om(t.fog.color,t.fog.density)),""!==t.fog.name&&(a.fog.name=t.fog.name)),void 0!==t.backgroundBlurriness&&(a.backgroundBlurriness=t.backgroundBlurriness),void 0!==t.backgroundIntensity&&(a.backgroundIntensity=t.backgroundIntensity),void 0!==t.backgroundRotation&&a.backgroundRotation.fromArray(t.backgroundRotation),void 0!==t.environmentIntensity&&(a.environmentIntensity=t.environmentIntensity),void 0!==t.environmentRotation&&a.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":a=new $f(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(a.focus=t.focus),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.filmGauge&&(a.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(a.filmOffset=t.filmOffset),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new F_(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(a.zoom=t.zoom),void 0!==t.view&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new j_(t.color,t.intensity);break;case"DirectionalLight":a=new U_(t.color,t.intensity),a.target=t.target||"";break;case"PointLight":a=new O_(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new V_(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new k_(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay),a.target=t.target||"";break;case"HemisphereLight":a=new E_(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=(new G_).fromJSON(t);break;case"SkinnedMesh":o=l(t.geometry),s=c(t.material),a=new Um(o,s),void 0!==t.bindMode&&(a.bindMode=t.bindMode),void 0!==t.bindMatrix&&a.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(a.skeleton=t.skeleton);break;case"Mesh":o=l(t.geometry),s=c(t.material),a=new Uf(o,s);break;case"InstancedMesh":o=l(t.geometry),s=c(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;a=new tg(o,s,e),a.instanceMatrix=new qm(new Float32Array(n.array),16),void 0!==i&&(a.instanceColor=new qm(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":o=l(t.geometry),s=c(t.material),a=new Ig(t.maxInstanceCount,t.maxVertexCount,t.maxIndexCount,s),a.geometry=o,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._geometryInfo=t.geometryInfo.map(t=>{let e=null,n=null;return void 0!==t.boundingBox&&(e=(new kd).fromJSON(t.boundingBox)),void 0!==t.boundingSphere&&(n=(new Kd).fromJSON(t.boundingSphere)),Dt(Dt({},t),{},{boundingBox:e,boundingSphere:n})}),a._instanceInfo=t.instanceInfo,a._availableInstanceIds=t._availableInstanceIds,a._availableGeometryIds=t._availableGeometryIds,a._nextIndexStart=t.nextIndexStart,a._nextVertexStart=t.nextVertexStart,a._geometryCount=t.geometryCount,a._maxInstanceCount=t.maxInstanceCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._matricesTexture=u(t.matricesTexture.uuid),a._indirectTexture=u(t.indirectTexture.uuid),void 0!==t.colorsTexture&&(a._colorsTexture=u(t.colorsTexture.uuid)),void 0!==t.boundingSphere&&(a.boundingSphere=(new Kd).fromJSON(t.boundingSphere)),void 0!==t.boundingBox&&(a.boundingBox=(new kd).fromJSON(t.boundingBox));break;case"LOD":a=new Im;break;case"Line":a=new Bg(l(t.geometry),c(t.material));break;case"LineLoop":a=new Gg(l(t.geometry),c(t.material));break;case"LineSegments":a=new Hg(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":a=new Kg(l(t.geometry),c(t.material));break;case"Sprite":a=new Em(c(t.material));break;case"Group":a=new im;break;case"Bone":a=new jm;break;default:a=new kp}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(a.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.quaternion&&a.quaternion.fromArray(t.quaternion),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.up&&a.up.fromArray(t.up),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.intensity&&(a.shadow.intensity=t.shadow.intensity),void 0!==t.shadow.bias&&(a.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(a.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(a.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&a.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(a.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.frustumCulled&&(a.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(a.renderOrder=t.renderOrder),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.layers&&(a.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)a.add(this.parseObject(o[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];a.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(a.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=a.getObjectByProperty("uuid",n.object);void 0!==i&&a.addLevel(i,n.distance,n.hysteresis)}}return a}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse(function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}})}bindLightTargets(t){t.traverse(function(e){if(e.isDirectionalLight||e.isSpotLight){const n=e.target,i=t.getObjectByProperty("uuid",n);e.target=void 0!==i?i:new kp}})}}const K_={UVMapping:sc,CubeReflectionMapping:lc,CubeRefractionMapping:cc,EquirectangularReflectionMapping:uc,EquirectangularRefractionMapping:hc,CubeUVReflectionMapping:dc},J_={RepeatWrapping:pc,ClampToEdgeWrapping:fc,MirroredRepeatWrapping:mc},$_={NearestFilter:gc,NearestMipmapNearestFilter:yc,NearestMipmapLinearFilter:_c,LinearFilter:bc,LinearMipmapNearestFilter:wc,LinearMipmapLinearFilter:Mc},Q_=new WeakMap;class tx extends f_{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=h_.get("image-bitmap:".concat(t));if(void 0!==a)return r.manager.itemStart(t),a.then?void a.then(n=>{if(!0!==Q_.has(a))return e&&e(n),r.manager.itemEnd(t),n;i&&i(Q_.get(a)),r.manager.itemError(t),r.manager.itemEnd(t)}):(setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,o.signal="function"===typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const s=fetch(t,o).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){return h_.add("image-bitmap:".concat(t),n),e&&e(n),r.manager.itemEnd(t),n}).catch(function(e){i&&i(e),Q_.set(s,e),h_.remove("image-bitmap:".concat(t)),r.manager.itemError(t),r.manager.itemEnd(t)});h_.add("image-bitmap:".concat(t),s),r.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let ex;class nx{static getContext(){return void 0===ex&&(ex=new(window.AudioContext||window.webkitAudioContext)),ex}static setContext(t){ex=t}}class ix extends f_{constructor(t){super(t)}load(t,e,n,i){const r=this,a=new y_(this.manager);function o(e){i?i(e):console.error(e),r.manager.itemError(t)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(t){try{const n=t.slice(0);nx.getContext().decodeAudioData(n,function(t){e(t)}).catch(o)}catch(HH){o(HH)}},n,i)}}const rx=new ap,ax=new ap,ox=new ap;class sx{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new $f,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new $f,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,ox.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(Vh*e.fov*.5)/e.zoom;let a,o;ax.elements[12]=-n,rx.elements[12]=n,a=-r*e.aspect+i,o=r*e.aspect+i,ox.elements[0]=2*e.near/(o-a),ox.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(ox),a=-r*e.aspect-i,o=r*e.aspect-i,ox.elements[0]=2*e.near/(o-a),ox.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(ox)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(ax),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(rx)}}class lx extends $f{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class cx{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const ux=new Qh,hx=new $h,dx=new Qh,px=new Qh,fx=new Qh;class mx extends kp{constructor(){super(),this.type="AudioListener",this.context=nx.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new cx}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ux,hx,dx),px.set(0,0,-1).applyQuaternion(hx),fx.set(0,1,0).applyQuaternion(hx),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(ux.x,t),e.positionY.linearRampToValueAtTime(ux.y,t),e.positionZ.linearRampToValueAtTime(ux.z,t),e.forwardX.linearRampToValueAtTime(px.x,t),e.forwardY.linearRampToValueAtTime(px.y,t),e.forwardZ.linearRampToValueAtTime(px.z,t),e.upX.linearRampToValueAtTime(fx.x,t),e.upY.linearRampToValueAtTime(fx.y,t),e.upZ.linearRampToValueAtTime(fx.z,t)}else e.setPosition(ux.x,ux.y,ux.z),e.setOrientation(px.x,px.y,px.z,fx.x,fx.y,fx.z)}}class gx extends kp{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+t),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}copy(t,e){return super.copy(t,e),"buffer"!==t.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=t.autoplay,this.buffer=t.buffer,this.detune=t.detune,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.offset=t.offset,this.duration=t.duration,this.playbackRate=t.playbackRate,this.hasPlaybackControl=t.hasPlaybackControl,this.sourceType=t.sourceType,this.filters=t.filters.slice(),this)}clone(t){return new this.constructor(this.listener).copy(this,t)}}const yx=new Qh,vx=new $h,_x=new Qh,xx=new Qh;class bx extends gx{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(yx,vx,_x),xx.set(0,0,1).applyQuaternion(vx);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(yx.x,t),e.positionY.linearRampToValueAtTime(yx.y,t),e.positionZ.linearRampToValueAtTime(yx.z,t),e.orientationX.linearRampToValueAtTime(xx.x,t),e.orientationY.linearRampToValueAtTime(xx.y,t),e.orientationZ.linearRampToValueAtTime(xx.z,t)}else e.setPosition(yx.x,yx.y,yx.z),e.setOrientation(xx.x,xx.y,xx.z)}}class wx{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class Sx{constructor(t,e,n){let i,r,a;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let a=this.cumulativeWeight;if(0===a){for(let t=0;t!==i;++t)n[r+t]=n[t];a=e}else{a+=e;const t=e/a;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=a}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let s=e,l=e+e;s!==l;++s)if(n[s]!==n[s+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,a=i;r!==a;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let a=0;a!==r;++a)t[e+a]=t[n+a]}_slerp(t,e,n,i){$h.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const a=this._workIndex*r;$h.multiplyQuaternionsFlat(t,a,t,e,t,n),$h.slerpFlat(t,e,t,e,t,a,i)}_lerp(t,e,n,i,r){const a=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*a+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]+t[n+a]*i}}}const Mx="\\[\\]\\.:\\/",Tx=new RegExp("["+Mx+"]","g"),Ex="[^"+Mx+"]",Ax="[^"+Mx.replace("\\.","")+"]",Cx=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Ex)+/(WCOD+)?/.source.replace("WCOD",Ax)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ex)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ex)+"$"),Px=["material","materials","bones","map"];class Ix{constructor(t,e,n){this.path=e,this.parsedPath=n||Ix.parseTrackName(e),this.node=Ix.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Ix.Composite(t,e,n):new Ix(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Tx,"")}static parseTrackName(t){const e=Cx.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==Px.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const a=n(r.children);if(a)return a}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=Ix.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const a=t[i];if(void 0===a){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?o=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ix.Composite=class{constructor(t,e,n){const i=n||Ix.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Ix.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ix.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ix.prototype.GetterByBindingType=[Ix.prototype._getValue_direct,Ix.prototype._getValue_array,Ix.prototype._getValue_arrayElement,Ix.prototype._getValue_toArray],Ix.prototype.SetterByBindingTypeAndVersioning=[[Ix.prototype._setValue_direct,Ix.prototype._setValue_direct_setNeedsUpdate,Ix.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ix.prototype._setValue_array,Ix.prototype._setValue_array_setNeedsUpdate,Ix.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ix.prototype._setValue_arrayElement,Ix.prototype._setValue_arrayElement_setNeedsUpdate,Ix.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ix.prototype._setValue_fromArray,Ix.prototype._setValue_fromArray_setNeedsUpdate,Ix.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Rx{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Gh(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length;let o,s=t.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=e[h];if(void 0===d){d=s++,e[h]=d,t.push(u);for(let t=0,e=a;t!==e;++t)r[t].push(new Ix(u,n[t],i[t]))}else if(d<l){o=t[d];const s=--l,c=t[s];e[c.uuid]=d,t[d]=c,e[h]=s,t[s]=u;for(let t=0,e=a;t!==e;++t){const e=r[t],a=e[s];let o=e[d];e[d]=a,void 0===o&&(o=new Ix(u,n[t],i[t])),e[s]=o}}else t[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a],s=o.uuid,l=e[s];if(void 0!==l&&l>=r){const a=r++,c=t[a];e[c.uuid]=l,t[l]=c,e[s]=a,t[a]=o;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[a],r=e[l];e[l]=i,e[a]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,a=t.length;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o].uuid,l=e[s];if(void 0!==l)if(delete e[s],l<r){const o=--r,s=t[o],c=--a,u=t[c];e[s.uuid]=l,t[l]=s,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[c];e[l]=i,e[o]=r,e.pop()}}else{const r=--a,o=t[r];r>0&&(e[o.uuid]=l),t[l]=o,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[t]=i,a.push(t),o.push(e),r.push(u);for(let h=c,d=s.length;h!==d;++h){const n=s[h];u[h]=new Ix(n,t,e)}return u}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}class kx{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.blendMode;this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,a=r.length,o=new Array(a),s={endingStart:Du,endingEnd:Du};for(let l=0;l!==a;++l){const t=r[l].createInterpolant(null);o[l]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Pu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.fadeOut(e),this.fadeIn(e),!0===n){const n=this._clip.duration,i=t._clip.duration,r=i/n,a=n/i;t.warp(1,r,e),this.warp(a,1,e)}return this}crossFadeTo(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;i<0||0===n?e=0:(this._startTime=null,e=n*i)}e*=this._updateTimeScale(t);const a=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===Fu)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(a),e[n].accumulateAdditive(o);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(a),e[n].accumulate(i,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const a=n===Iu;if(0===t)return-1===r?i:a&&1===(1&r)?e-i:i;if(n===Cu){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(a&&1===(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=zu,i.endingEnd=zu):(i.endingStart=t?this.zeroSlopeAtStart?zu:Du:Nu,i.endingEnd=e?this.zeroSlopeAtEnd?zu:Du:Nu)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=e,o[1]=r+t,s[1]=n,this}}const Lx=new Float32Array(1);class Dx extends Bh{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,a=t._propertyBindings,o=t._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let u=0;u!==r;++u){const t=i[u],r=t.name;let l=c[r];if(void 0!==l)++l.referenceCount,a[u]=l;else{if(l=a[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,r));continue}const i=e&&e._propertyBindings[u].binding.parsedPath;l=new Sx(Ix.create(n,r,i),t.ValueTypeName,t.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,r),a[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{const e=a.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),a.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const t=e[n];0===--t.referenceCount&&this._removeInactiveBinding(t)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let a=i[e];void 0===a&&(a={},i[e]=a),a[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new Qv(new Float32Array(2),new Float32Array(2),1,Lx),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let a="string"===typeof t?c_.findByName(i,t):t;const o=null!==a?a.uuid:t,s=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:Ou),void 0!==s){const t=s.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new kx(this,a,e,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"===typeof t?c_.findByName(n,t):t,a=r?r.uuid:t,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1;for(let l=0;l!==n;++l){e[l]._update(i,t,r,a)}const o=this._bindings,s=this._nActiveBindings;for(let l=0;l!==s;++l)o[l].apply(a);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,a=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,a._cacheIndex=r,e[r]=a,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const r in n){const t=n[r].actionByRoot[e];void 0!==t&&(this._deactivateAction(t),this._removeInactiveAction(t))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const r in i){const t=i[r];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class zx extends Ed{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(t,e,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Id(null,t,e,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Nx{constructor(t){this.value=t}clone(){return new Nx(void 0===this.value.clone?this.value:this.value.clone())}}let Ox=0;class Fx extends Bh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ox++}),this.name="",this.usage=Sh,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let n=0,i=e.length;n<i;n++){const t=Array.isArray(e[n])?e[n]:[e[n]];for(let e=0;e<t.length;e++)this.uniforms.push(t[e].clone())}return this}clone(){return(new this.constructor).copy(this)}}class Bx extends cm{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class Ux{constructor(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.normalized=a,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const jx=new ap;class Vx{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new rp(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new gp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return jx.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(jx),this}intersectObject(t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Gx(t,this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),e.sort(Hx),e}intersectObjects(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=t.length;i<r;i++)Gx(t[i],this,n,e);return n.sort(Hx),n}}function Hx(t,e){return t.distance-e.distance}function Gx(t,e,n,i){let r=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,n)&&(r=!1)}if(!0===r&&!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)Gx(i[t],e,n,!0)}}class Wx{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(t){this._document=t,void 0!==t.hidden&&(this._pageVisibilityHandler=qx.bind(this),t.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(t){return this._timescale=t,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(t){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==t?t:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function qx(){!1===this._document.hidden&&this.reset()}class Zx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.phi=e,this.theta=n}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Wh(this.phi,t,Math.PI-t),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Wh(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Xx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.theta=e,this.y=n}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}}class Yx{constructor(t,e,n,i){Yx.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==t&&this.set(t,e,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=t[n+e];return this}set(t,e,n,i){const r=this.elements;return r[0]=t,r[2]=e,r[1]=n,r[3]=i,this}}const Kx=new Jh;class Jx{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Jh(1/0,1/0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Jh(-1/0,-1/0);this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Kx.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Kx).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const $x=new Qh,Qx=new Qh,tb=new Qh,eb=new Qh,nb=new Qh,ib=new Qh,rb=new Qh;class ab{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh;this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){$x.subVectors(t,this.start),Qx.subVectors(this.end,this.start);const n=Qx.dot(Qx);let i=Qx.dot($x)/n;return e&&(i=Wh(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ib,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rb;const i=1e-8*1e-8;let r,a;const o=this.start,s=t.start,l=this.end,c=t.end;tb.subVectors(l,o),eb.subVectors(c,s),nb.subVectors(o,s);const u=tb.dot(tb),h=eb.dot(eb),d=eb.dot(nb);if(u<=i&&h<=i)return e.copy(o),n.copy(s),e.sub(n),e.dot(e);if(u<=i)r=0,a=d/h,a=Wh(a,0,1);else{const t=tb.dot(nb);if(h<=i)a=0,r=Wh(-t/u,0,1);else{const e=tb.dot(eb),n=u*h-e*e;r=0!==n?Wh((e*d-t*h)/n,0,1):0,a=(e*r+d)/h,a<0?(a=0,r=Wh(-t/u,0,1)):a>1&&(a=1,r=Wh((e-t)/u,0,1))}}return e.copy(o).add(tb.multiplyScalar(r)),n.copy(s).add(eb.multiplyScalar(a)),e.sub(n),e.dot(e)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const ob=new Qh;class sb extends kp{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new Cf,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,s=32;a<s;a++,o++){const t=a/s*Math.PI*2,e=o/s*Math.PI*2;i.push(Math.cos(t),Math.sin(t),1,Math.cos(e),Math.sin(e),1)}n.setAttribute("position",new xf(i,3));const r=new Rg({fog:!1,toneMapped:!1});this.cone=new Hg(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),ob.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ob),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const lb=new Qh,cb=new ap,ub=new ap;class hb extends Hg{constructor(t){const e=db(t),n=new Cf,i=[],r=[];for(let s=0;s<e.length;s++){const t=e[s];t.parent&&t.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(0,0,0),r.push(0,0,0))}n.setAttribute("position",new xf(i,3)),n.setAttribute("color",new xf(r,3));super(n,new Rg({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1;const a=new Jp(255),o=new Jp(65280);this.setColors(a,o)}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");ub.copy(this.root.matrixWorld).invert();for(let r=0,a=0;r<e.length;r++){const t=e[r];t.parent&&t.parent.isBone&&(cb.multiplyMatrices(ub,t.matrixWorld),lb.setFromMatrixPosition(cb),i.setXYZ(a,lb.x,lb.y,lb.z),cb.multiplyMatrices(ub,t.parent.matrixWorld),lb.setFromMatrixPosition(cb),i.setXYZ(a+1,lb.x,lb.y,lb.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}setColors(t,e){const n=this.geometry.getAttribute("color");for(let i=0;i<n.count;i+=2)n.setXYZ(i,t.r,t.g,t.b),n.setXYZ(i+1,e.r,e.g,e.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function db(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push(...db(t.children[n]));return e}class pb extends Uf{constructor(t,e,n){super(new Tv(e,4,2),new ef({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const fb=new Qh,mb=new Jp,gb=new Jp;class yb extends kp{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new bv(e);i.rotateY(.5*Math.PI),this.material=new ef({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),a=new Float32Array(3*r.count);i.setAttribute("color",new hf(a,3)),this.add(new Uf(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");mb.copy(this.light.color),gb.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?mb:gb;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(fb.setFromMatrixPosition(this.light.matrixWorld).negate())}}class vb extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new Jp(n),i=new Jp(i);const r=e/2,a=t/e,o=t/2,s=[],l=[];for(let u=0,h=0,d=-o;u<=e;u++,d+=a){s.push(-o,0,d,o,0,d),s.push(d,0,-o,d,0,o);const t=u===r?n:i;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}const c=new Cf;c.setAttribute("position",new xf(s,3)),c.setAttribute("color",new xf(l,3));super(c,new Rg({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class _b extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;r=new Jp(r),a=new Jp(a);const o=[],s=[];if(e>1)for(let c=0;c<e;c++){const n=c/e*(2*Math.PI),i=Math.sin(n)*t,l=Math.cos(n)*t;o.push(0,0,0),o.push(i,0,l);const u=1&c?r:a;s.push(u.r,u.g,u.b),s.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const e=1&c?r:a,l=t-t/n*c;for(let t=0;t<i;t++){let n=t/i*(2*Math.PI),r=Math.sin(n)*l,a=Math.cos(n)*l;o.push(r,0,a),s.push(e.r,e.g,e.b),n=(t+1)/i*(2*Math.PI),r=Math.sin(n)*l,a=Math.cos(n)*l,o.push(r,0,a),s.push(e.r,e.g,e.b)}}const l=new Cf;l.setAttribute("position",new xf(o,3)),l.setAttribute("color",new xf(s,3));super(l,new Rg({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const xb=new Qh,bb=new Qh,wb=new Qh;class Sb extends kp{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===e&&(e=1);let i=new Cf;i.setAttribute("position",new xf([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Rg({fog:!1,toneMapped:!1});this.lightPlane=new Bg(i,r),this.add(this.lightPlane),i=new Cf,i.setAttribute("position",new xf([0,0,0,0,0,1],3)),this.targetLine=new Bg(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),xb.setFromMatrixPosition(this.light.matrixWorld),bb.setFromMatrixPosition(this.light.target.matrixWorld),wb.subVectors(bb,xb),this.lightPlane.lookAt(bb),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(bb),this.targetLine.scale.z=wb.length()}}const Mb=new Qh,Tb=new Xf;class Eb extends Hg{constructor(t){const e=new Cf,n=new Rg({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],a={};function o(t,e){s(t),s(e)}function s(t){i.push(0,0,0),r.push(0,0,0),void 0===a[t]&&(a[t]=[]),a[t].push(i.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),e.setAttribute("position",new xf(i,3)),e.setAttribute("color",new xf(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new Jp(16755200),c=new Jp(16711680),u=new Jp(43775),h=new Jp(16777215),d=new Jp(3355443);this.setColors(l,c,u,h,d)}setColors(t,e,n,i,r){const a=this.geometry.getAttribute("color");return a.setXYZ(0,t.r,t.g,t.b),a.setXYZ(1,t.r,t.g,t.b),a.setXYZ(2,t.r,t.g,t.b),a.setXYZ(3,t.r,t.g,t.b),a.setXYZ(4,t.r,t.g,t.b),a.setXYZ(5,t.r,t.g,t.b),a.setXYZ(6,t.r,t.g,t.b),a.setXYZ(7,t.r,t.g,t.b),a.setXYZ(8,t.r,t.g,t.b),a.setXYZ(9,t.r,t.g,t.b),a.setXYZ(10,t.r,t.g,t.b),a.setXYZ(11,t.r,t.g,t.b),a.setXYZ(12,t.r,t.g,t.b),a.setXYZ(13,t.r,t.g,t.b),a.setXYZ(14,t.r,t.g,t.b),a.setXYZ(15,t.r,t.g,t.b),a.setXYZ(16,t.r,t.g,t.b),a.setXYZ(17,t.r,t.g,t.b),a.setXYZ(18,t.r,t.g,t.b),a.setXYZ(19,t.r,t.g,t.b),a.setXYZ(20,t.r,t.g,t.b),a.setXYZ(21,t.r,t.g,t.b),a.setXYZ(22,t.r,t.g,t.b),a.setXYZ(23,t.r,t.g,t.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0,this}update(){const t=this.geometry,e=this.pointMap;let n,i;if(Tb.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,i=0;else if(this.camera.coordinateSystem===Dh)n=-1,i=1;else{if(this.camera.coordinateSystem!==zh)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,i=1}Ab("c",e,t,Tb,0,0,n),Ab("t",e,t,Tb,0,0,i),Ab("n1",e,t,Tb,-1,-1,n),Ab("n2",e,t,Tb,1,-1,n),Ab("n3",e,t,Tb,-1,1,n),Ab("n4",e,t,Tb,1,1,n),Ab("f1",e,t,Tb,-1,-1,i),Ab("f2",e,t,Tb,1,-1,i),Ab("f3",e,t,Tb,-1,1,i),Ab("f4",e,t,Tb,1,1,i),Ab("u1",e,t,Tb,.7,1.1,n),Ab("u2",e,t,Tb,-.7,1.1,n),Ab("u3",e,t,Tb,0,2,n),Ab("cf1",e,t,Tb,-1,0,i),Ab("cf2",e,t,Tb,1,0,i),Ab("cf3",e,t,Tb,0,-1,i),Ab("cf4",e,t,Tb,0,1,i),Ab("cn1",e,t,Tb,-1,0,n),Ab("cn2",e,t,Tb,1,0,n),Ab("cn3",e,t,Tb,0,-1,n),Ab("cn4",e,t,Tb,0,1,n),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ab(t,e,n,i,r,a,o){Mb.set(r,a,o).unproject(i);const s=e[t];if(void 0!==s){const t=n.getAttribute("position");for(let e=0,n=s.length;e<n;e++)t.setXYZ(s[e],Mb.x,Mb.y,Mb.z)}}const Cb=new kd;class Pb extends Hg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Cf;r.setIndex(new hf(n,1)),r.setAttribute("position",new hf(i,3)),super(r,new Rg({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Cb.setFromObject(this.object),Cb.isEmpty())return;const t=Cb.min,e=Cb.max,n=this.geometry.attributes.position,i=n.array;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=t.x,i[4]=e.y,i[5]=e.z,i[6]=t.x,i[7]=t.y,i[8]=e.z,i[9]=e.x,i[10]=t.y,i[11]=e.z,i[12]=e.x,i[13]=e.y,i[14]=t.z,i[15]=t.x,i[16]=e.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=e.x,i[22]=t.y,i[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ib extends Hg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Cf;i.setIndex(new hf(n,1)),i.setAttribute("position",new xf([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Rg({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class Rb extends Bg{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,i=new Cf;i.setAttribute("position",new xf([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new Rg({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const r=new Cf;r.setAttribute("position",new xf([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new Uf(r,new ef({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const kb=new Qh;let Lb,Db;class zb extends kp{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh(0,0,1),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qh(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*r;super(),this.type="ArrowHelper",void 0===Lb&&(Lb=new Cf,Lb.setAttribute("position",new xf([0,0,0,0,1,0],3)),Db=new uy(.5,1,5,1),Db.translate(0,-.5,0)),this.position.copy(e),this.line=new Bg(Lb,new Rg({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Uf(Db,new ef({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{kb.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(kb,e)}}setLength(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*t,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*e;this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Nb extends Hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Cf;n.setAttribute("position",new xf(e,3)),n.setAttribute("color",new xf([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Rg({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new Jp,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Ob{constructor(){this.type="ShapePath",this.color=new Jp,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new By,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,a){return this.currentPath.bezierCurveTo(t,e,n,i,r,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let i=!1;for(let r=n-1,a=0;a<n;r=a++){let n=e[r],o=e[a],s=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[a],s=-s,o=e[r],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-s*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return i}const n=fv.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,a,o;const s=[];if(1===i.length)return a=i[0],o=new Uy,o.curves=a.curves,s.push(o),s;let l=!n(i[0].getPoints());l=t?!l:l;const c=[],u=[];let h,d,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)a=i[m],h=a.getPoints(),r=n(h),r=t?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new Uy,p:h},u[f].s.curves=a.curves,l&&f++,p[f]=[]):p[f].push({h:a,p:h[0]});if(!u[0])return function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new Uy;r.curves=i.curves,e.push(r)}return e}(i);if(u.length>1){let t=!1,n=0;for(let e=0,i=u.length;e<i;e++)c[e]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let a=0;a<r.length;a++){const o=r[a];let s=!0;for(let r=0;r<u.length;r++)e(o.p,u[r].p)&&(i!==r&&n++,s?(s=!1,c[r].push(o)):t=!0);s&&c[i].push(o)}}n>0&&!1===t&&(p=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,s.push(o),d=p[m];for(let t=0,e=d.length;t<e;t++)o.holes.push(d[t].h)}return s}}class Fb extends Bh{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(t){void 0!==t?(null!==this.domElement&&this.disconnect(),this.domElement=t):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}}function Bb(t,e,n,i){const r=function(t){switch(t){case Ec:case Ac:return{byteLength:1,components:1};case Pc:case Cc:case Lc:return{byteLength:2,components:1};case Dc:case zc:return{byteLength:2,components:4};case Rc:case Ic:case kc:return{byteLength:4,components:1};case Oc:case Fc:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(t,"."))}(i);switch(n){case Bc:return t*e;case Gc:case Wc:return t*e/r.components*r.byteLength;case qc:case Zc:return t*e*2/r.components*r.byteLength;case Uc:return t*e*3/r.components*r.byteLength;case jc:case Yc:return t*e*4/r.components*r.byteLength;case Kc:case Jc:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case $c:case Qc:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case eu:case iu:return Math.max(t,16)*Math.max(e,8)/4;case tu:case nu:return Math.max(t,8)*Math.max(e,8)/2;case ru:case au:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case ou:case su:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case lu:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case cu:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case uu:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case hu:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case du:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case pu:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case fu:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case mu:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case gu:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case yu:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case vu:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case _u:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case xu:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case bu:case wu:case Su:return Math.ceil(t/4)*Math.ceil(e/4)*16;case Mu:case Tu:return Math.ceil(t/4)*Math.ceil(e/4)*8;case Eu:case Au:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error("Unable to determine texture byte length for ".concat(n," format."))}class Ub{static contain(t,e){return function(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}(t,e)}static cover(t,e){return function(t,e){const n=t.image&&t.image.width?t.image.width/t.image.height:1;return n>e?(t.repeat.x=e/n,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=n/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}(t,e)}static fill(t){return function(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}(t)}static getByteLength(t,e,n,i){return Bb(t,e,n,i)}}function jb(){let t=null,e=!1,n=null,i=null;function r(e,a){n(e,a),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Vb(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=e.get(n);i&&(t.deleteBuffer(i.buffer),e.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=e.get(n);if(void 0===r)e.set(n,function(e,n){const i=e.array,r=e.usage,a=i.byteLength,o=t.createBuffer();let s;if(t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback(),i instanceof Float32Array)s=t.FLOAT;else if("undefined"!==typeof Float16Array&&i instanceof Float16Array)s=t.HALF_FLOAT;else if(i instanceof Uint16Array)s=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(i instanceof Int16Array)s=t.SHORT;else if(i instanceof Uint32Array)s=t.UNSIGNED_INT;else if(i instanceof Int32Array)s=t.INT;else if(i instanceof Int8Array)s=t.BYTE;else if(i instanceof Uint8Array)s=t.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);s=t.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,size:a}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,i){const r=n.array,a=n.updateRanges;if(t.bindBuffer(i,e),0===a.length)t.bufferSubData(i,0,r);else{a.sort((t,e)=>t.start-e.start);let e=0;for(let t=1;t<a.length;t++){const n=a[e],i=a[t];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++e,a[e]=i)}a.length=e+1;for(let n=0,o=a.length;n<o;n++){const e=a[n];t.bufferSubData(i,e.start*r.BYTES_PER_ELEMENT,r,e.start,e.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:tl}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=tl);const Hb={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow( sampler2D shadow, vec2 uv, float compare ) {\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare, distribution.x );\n\t\t#endif\n\t\tif ( hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Gb={common:{diffuse:{value:new Jp(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new nd},alphaMap:{value:null},alphaMapTransform:{value:new nd},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new nd}},envmap:{envMap:{value:null},envMapRotation:{value:new nd},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new nd}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new nd}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new nd},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new nd},normalScale:{value:new Jh(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new nd},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new nd}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new nd}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new nd}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Jp(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Jp(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new nd},alphaTest:{value:0},uvTransform:{value:new nd}},sprite:{diffuse:{value:new Jp(16777215)},opacity:{value:1},center:{value:new Jh(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new nd},alphaMap:{value:null},alphaMapTransform:{value:new nd},alphaTest:{value:0}}},Wb={basic:{uniforms:Gf([Gb.common,Gb.specularmap,Gb.envmap,Gb.aomap,Gb.lightmap,Gb.fog]),vertexShader:Hb.meshbasic_vert,fragmentShader:Hb.meshbasic_frag},lambert:{uniforms:Gf([Gb.common,Gb.specularmap,Gb.envmap,Gb.aomap,Gb.lightmap,Gb.emissivemap,Gb.bumpmap,Gb.normalmap,Gb.displacementmap,Gb.fog,Gb.lights,{emissive:{value:new Jp(0)}}]),vertexShader:Hb.meshlambert_vert,fragmentShader:Hb.meshlambert_frag},phong:{uniforms:Gf([Gb.common,Gb.specularmap,Gb.envmap,Gb.aomap,Gb.lightmap,Gb.emissivemap,Gb.bumpmap,Gb.normalmap,Gb.displacementmap,Gb.fog,Gb.lights,{emissive:{value:new Jp(0)},specular:{value:new Jp(1118481)},shininess:{value:30}}]),vertexShader:Hb.meshphong_vert,fragmentShader:Hb.meshphong_frag},standard:{uniforms:Gf([Gb.common,Gb.envmap,Gb.aomap,Gb.lightmap,Gb.emissivemap,Gb.bumpmap,Gb.normalmap,Gb.displacementmap,Gb.roughnessmap,Gb.metalnessmap,Gb.fog,Gb.lights,{emissive:{value:new Jp(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Hb.meshphysical_vert,fragmentShader:Hb.meshphysical_frag},toon:{uniforms:Gf([Gb.common,Gb.aomap,Gb.lightmap,Gb.emissivemap,Gb.bumpmap,Gb.normalmap,Gb.displacementmap,Gb.gradientmap,Gb.fog,Gb.lights,{emissive:{value:new Jp(0)}}]),vertexShader:Hb.meshtoon_vert,fragmentShader:Hb.meshtoon_frag},matcap:{uniforms:Gf([Gb.common,Gb.bumpmap,Gb.normalmap,Gb.displacementmap,Gb.fog,{matcap:{value:null}}]),vertexShader:Hb.meshmatcap_vert,fragmentShader:Hb.meshmatcap_frag},points:{uniforms:Gf([Gb.points,Gb.fog]),vertexShader:Hb.points_vert,fragmentShader:Hb.points_frag},dashed:{uniforms:Gf([Gb.common,Gb.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Hb.linedashed_vert,fragmentShader:Hb.linedashed_frag},depth:{uniforms:Gf([Gb.common,Gb.displacementmap]),vertexShader:Hb.depth_vert,fragmentShader:Hb.depth_frag},normal:{uniforms:Gf([Gb.common,Gb.bumpmap,Gb.normalmap,Gb.displacementmap,{opacity:{value:1}}]),vertexShader:Hb.meshnormal_vert,fragmentShader:Hb.meshnormal_frag},sprite:{uniforms:Gf([Gb.sprite,Gb.fog]),vertexShader:Hb.sprite_vert,fragmentShader:Hb.sprite_frag},background:{uniforms:{uvTransform:{value:new nd},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Hb.background_vert,fragmentShader:Hb.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new nd}},vertexShader:Hb.backgroundCube_vert,fragmentShader:Hb.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Hb.cube_vert,fragmentShader:Hb.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Hb.equirect_vert,fragmentShader:Hb.equirect_frag},distanceRGBA:{uniforms:Gf([Gb.common,Gb.displacementmap,{referencePosition:{value:new Qh},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Hb.distanceRGBA_vert,fragmentShader:Hb.distanceRGBA_frag},shadow:{uniforms:Gf([Gb.lights,Gb.fog,{color:{value:new Jp(0)},opacity:{value:1}}]),vertexShader:Hb.shadow_vert,fragmentShader:Hb.shadow_frag}};Wb.physical={uniforms:Gf([Wb.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new nd},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new nd},clearcoatNormalScale:{value:new Jh(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new nd},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new nd},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new nd},sheen:{value:0},sheenColor:{value:new Jp(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new nd},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new nd},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new nd},transmissionSamplerSize:{value:new Jh},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new nd},attenuationDistance:{value:0},attenuationColor:{value:new Jp(0)},specularColor:{value:new Jp(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new nd},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new nd},anisotropyVector:{value:new Jh},anisotropyMap:{value:null},anisotropyMapTransform:{value:new nd}}]),vertexShader:Hb.meshphysical_vert,fragmentShader:Hb.meshphysical_frag};const qb={r:0,b:0,g:0},Zb=new mp,Xb=new ap;function Yb(t,e,n,i,r,a,o){const s=new Jp(0);let l,c,u=!0===a?0:1,h=null,d=0,p=null;function f(t){let i=!0===t.isScene?t.background:null;if(i&&i.isTexture){i=(t.backgroundBlurriness>0?n:e).get(i)}return i}function m(e,n){e.getRGB(qb,Wf(t)),i.buffers.color.setClear(qb.r,qb.g,qb.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(t),u=e,m(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,m(s,u)},render:function(e){let n=!1;const r=f(e);null===r?m(s,u):r&&r.isColor&&(m(r,1),n=!0);const a=t.xr.getEnvironmentBlendMode();"additive"===a?i.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&i.buffers.color.setClear(0,0,0,0,o),(t.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===dc)?(void 0===c&&(c=new Uf(new Vf(1,1,1),new Zf({name:"BackgroundCubeMaterial",uniforms:Hf(Wb.backgroundCube.uniforms),vertexShader:Wb.backgroundCube.vertexShader,fragmentShader:Wb.backgroundCube.fragmentShader,side:dl,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Zb.copy(n.backgroundRotation),Zb.x*=-1,Zb.y*=-1,Zb.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Zb.y*=-1,Zb.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Xb.makeRotationFromEuler(Zb)),c.material.toneMapped=fd.getTransfer(i.colorSpace)!==$u,h===i&&d===i.version&&p===t.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,p=t.toneMapping),c.layers.enableAll(),e.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new Uf(new wv(2,2),new Zf({name:"BackgroundMaterial",uniforms:Hf(Wb.background.uniforms),vertexShader:Wb.background.vertexShader,fragmentShader:Wb.background.fragmentShader,side:hl,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=fd.getTransfer(i.colorSpace)!==$u,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&p===t.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function Kb(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=c(null);let a=r,o=!1;function s(e){return t.bindVertexArray(e)}function l(e){return t.deleteVertexArray(e)}function c(t){const e=[],i=[],r=[];for(let a=0;a<n;a++)e[a]=0,i[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function u(){const t=a.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function h(t){d(t,0)}function d(e,n){const i=a.newAttributes,r=a.enabledAttributes,o=a.attributeDivisors;i[e]=1,0===r[e]&&(t.enableVertexAttribArray(e),r[e]=1),o[e]!==n&&(t.vertexAttribDivisor(e,n),o[e]=n)}function p(){const e=a.newAttributes,n=a.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function f(e,n,i,r,a,o,s){!0===s?t.vertexAttribIPointer(e,n,i,a,o):t.vertexAttribPointer(e,n,i,r,a,o)}function m(){g(),o=!0,a!==r&&(a=r,s(a.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let y=!1;const v=function(e,n,r){const a=!0===r.wireframe;let o=i[e.id];void 0===o&&(o={},i[e.id]=o);let s=o[n.id];void 0===s&&(s={},o[n.id]=s);let l=s[a];void 0===l&&(l=c(t.createVertexArray()),s[a]=l);return l}(m,l,r);a!==v&&(a=v,s(a.object)),y=function(t,e,n,i){const r=a.attributes,o=e.attributes;let s=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){const e=r[a];let n=o[a];if(void 0===n&&("instanceMatrix"===a&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===a&&t.instanceColor&&(n=t.instanceColor)),void 0===e)return!0;if(e.attribute!==n)return!0;if(n&&e.data!==n.data)return!0;s++}}return a.attributesNum!==s||a.index!==i}(n,m,l,g),y&&function(t,e,n,i){const r={},o=e.attributes;let s=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){let e=o[a];void 0===e&&("instanceMatrix"===a&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===a&&t.instanceColor&&(e=t.instanceColor));const n={};n.attribute=e,e&&e.data&&(n.data=e.data),r[a]=n,s++}}a.attributes=r,a.attributesNum=s,a.index=i}(n,m,l,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(y||o)&&(o=!1,function(n,i,r,a){u();const o=a.attributes,s=r.getAttributes(),l=i.defaultAttributeValues;for(const c in s){const i=s[c];if(i.location>=0){let r=o[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const o=r.normalized,s=r.itemSize,l=e.get(r);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===t.INT||u===t.UNSIGNED_INT||r.gpuType===Ic;if(r.isInterleavedBufferAttribute){const e=r.data,l=e.stride,g=r.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)d(i.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<i.locationSize;t++)h(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<i.locationSize;t++)f(i.location+t,s/i.locationSize,u,o,l*p,(g+s/i.locationSize*t)*p,m)}else{if(r.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)d(i.location+t,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let t=0;t<i.locationSize;t++)h(i.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<i.locationSize;t++)f(i.location+t,s/i.locationSize,u,o,s*p,s/i.locationSize*t*p,m)}}else if(void 0!==l){const e=l[c];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(i.location,e);break;case 3:t.vertexAttrib3fv(i.location,e);break;case 4:t.vertexAttrib4fv(i.location,e);break;default:t.vertexAttrib1fv(i.location,e)}}}}p()}(n,r,l,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in i){const e=i[t];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete i[t]}},releaseStatesOfGeometry:function(t){if(void 0===i[t.id])return;const e=i[t.id];for(const n in e){const t=e[n];for(const e in t)l(t[e].object),delete t[e];delete e[n]}delete i[t.id]},releaseStatesOfProgram:function(t){for(const e in i){const n=i[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)l(r[t].object),delete r[t];delete n[t.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:p}}function Jb(t,e,n){let i;function r(e,r,a){0!==a&&(t.drawArraysInstanced(i,e,r,a),n.update(r,i,a))}this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(t,r,a){if(0===a)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,t,0,r,0,a);let o=0;for(let e=0;e<a;e++)o+=r[e];n.update(o,i,1)},this.renderMultiDrawInstances=function(t,a,o,s){if(0===o)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)r(t[e],a[e],s[e]);else{l.multiDrawArraysInstancedWEBGL(i,t,0,a,0,s,0,o);let e=0;for(let t=0;t<o;t++)e+=a[t]*s[t];n.update(e,i,1)}}}function $b(t,e,n,i){let r;function a(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reversedDepthBuffer&&e.has("EXT_clip_control"),u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,textureFormatReadable:function(e){return e===jc||i.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===Lc&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(n!==Ec&&i.convert(n)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==kc&&!r)},precision:o,logarithmicDepthBuffer:l,reversedDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function Qb(t){const e=this;let n=null,i=0,r=!1,a=!1;const o=new rg,s=new nd,l={value:null,needsUpdate:!1};function c(t,n,i,r){const a=null!==t?t.length:0;let c=null;if(0!==a){if(c=l.value,!0!==r||null===c){const e=i+4*a,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let n=0,l=i;n!==a;++n,l+=4)o.copy(t[n]).applyMatrix4(r,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=a,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(t,e){n=c(t,e,0)},this.setState=function(o,s,u){const h=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,f=t.get(o);if(!r||null===h||0===h.length||a&&!p)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0}();else{const t=a?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=c(h,s,e,u);for(let i=0;i!==e;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function tw(t){let e=new WeakMap;function n(t,e){return e===uc?t.mapping=lc:e===hc&&(t.mapping=cc),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping;if(a===uc||a===hc){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const a=r.image;if(a&&a.height>0){const o=new nm(a.height);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}const ew=[.125,.215,.35,.446,.526,.582],nw=20,iw=new F_,rw=new Jp;let aw=null,ow=0,sw=0,lw=!1;const cw=(1+Math.sqrt(5))/2,uw=1/cw,hw=[new Qh(-cw,uw,0),new Qh(cw,uw,0),new Qh(-uw,0,cw),new Qh(uw,0,cw),new Qh(0,cw,-uw),new Qh(0,cw,uw),new Qh(-1,1,-1),new Qh(1,1,-1),new Qh(-1,1,1),new Qh(1,1,1)],dw=new Qh;class pw{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:a=256,position:o=dw}=r;aw=this._renderer.getRenderTarget(),ow=this._renderer.getActiveCubeFace(),sw=this._renderer.getActiveMipmapLevel(),lw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,n,i,s,o),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}fromCubemap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=yw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=gw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(aw,ow,sw),this._renderer.xr.enabled=lw,t.scissorTest=!1,mw(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===lc||t.mapping===cc?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),aw=this._renderer.getRenderTarget(),ow=this._renderer.getActiveCubeFace(),sw=this._renderer.getActiveMipmapLevel(),lw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:bc,minFilter:bc,generateMipmaps:!1,type:Lc,format:jc,colorSpace:Ku,depthBuffer:!1},i=fw(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=fw(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const a=t-4+1+ew.length;for(let o=0;o<a;o++){const a=Math.pow(2,r);n.push(a);let s=1/a;o>t-4?s=ew[o-t+4-1]:0===o&&(s=0),i.push(s);const l=1/(a-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,y=new Float32Array(f*p*d),v=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];y.set(i,f*p*t),v.set(h,m*p*t);const r=[t,t,t,t,t,t];_.set(r,g*p*t)}const x=new Cf;x.setAttribute("position",new hf(y,f)),x.setAttribute("uv",new hf(v,m)),x.setAttribute("faceIndex",new hf(_,g)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(nw),r=new Qh(0,1,0),a=new Zf({name:"SphericalGaussianBlur",defines:{n:nw,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(t,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:fl,depthTest:!1,depthWrite:!1});return a}(i,t,e)}return i}_compileMaterial(t){const e=new Uf(this._lodPlanes[0],t);this._renderer.compile(e,iw)}_sceneToCubeUV(t,e,n,i,r){const a=new $f(90,1,e,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(rw),l.toneMapping=Jl,l.autoClear=!1;l.state.buffers.depth.getReversed()&&(l.setRenderTarget(i),l.clearDepth(),l.setRenderTarget(null));const h=new ef({name:"PMREM.Background",side:dl,depthWrite:!1,depthTest:!1}),d=new Uf(new Vf,h);let p=!1;const f=t.background;f?f.isColor&&(h.color.copy(f),t.background=null,p=!0):(h.color.copy(rw),p=!0);for(let m=0;m<6;m++){const e=m%3;0===e?(a.up.set(0,o[m],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x+s[m],r.y,r.z)):1===e?(a.up.set(0,0,o[m]),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y+s[m],r.z)):(a.up.set(0,o[m],0),a.position.set(r.x,r.y,r.z),a.lookAt(r.x,r.y,r.z+s[m]));const n=this._cubeSize;mw(i,e*n,m>2?n:0,n,n),l.setRenderTarget(i),p&&l.render(d,a),l.render(t,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=c,t.background=f}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===lc||t.mapping===cc;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=yw()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=gw());const r=i?this._cubemapMaterial:this._equirectMaterial,a=new Uf(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const o=this._cubeSize;mw(e,0,0,3*o,2*o),n.setRenderTarget(e),n.render(a,iw)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const e=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=hw[(i-r-1)%hw.length];this._blur(t,r-1,r,e,n)}e.autoClear=n}_blur(t,e,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,n,i,"latitudinal",r),this._halfBlur(a,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Uf(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):nw;f>nw&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(nw));const m=[];let g=0;for(let _=0;_<nw;++_){const t=_/p,e=Math.exp(-t*t/2);m.push(e),0===_?g+=e:_<f&&(g+=2*e)}for(let _=0;_<m.length;_++)m[_]=m[_]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);const{_lodMax:y}=this;u.dTheta.value=d,u.mipInt.value=y-n;const v=this._sizeLods[i];mw(e,3*v*(i>y-4?i-y+4:0),4*(this._cubeSize-v),3*v,2*v),s.setRenderTarget(e),s.render(c,iw)}}function fw(t,e,n){const i=new Ad(t,e,n);return i.texture.mapping=dc,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function mw(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function gw(){return new Zf({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:fl,depthTest:!1,depthWrite:!1})}function yw(){return new Zf({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:fl,depthTest:!1,depthWrite:!1})}function vw(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping,o=a===uc||a===hc,s=a===lc||a===cc;if(o||s){let a=e.get(r);const l=void 0!==a?a.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new pw(t)),a=o?n.fromEquirectangular(r,a):n.fromCubemap(r,a),a.texture.pmremVersion=r.pmremVersion,e.set(r,a),a.texture;if(void 0!==a)return a.texture;{const l=r.image;return o&&l&&l.height>0||s&&l&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(l)?(null===n&&(n=new pw(t)),a=o?n.fromEquirectangular(r):n.fromCubemap(r),a.texture.pmremVersion=r.pmremVersion,e.set(r,a),r.addEventListener("dispose",i),a.texture):null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function _w(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&ud("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function xw(t,e,n,i){const r={},a=new WeakMap;function o(t){const s=t.target;null!==s.index&&e.remove(s.index);for(const n in s.attributes)e.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete r[s.id];const l=a.get(s);l&&(e.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],a=t[e+2];n.push(i,r,r,a,a,i)}}else{if(void 0===r)return;{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const s=new(rd(n)?vf:gf)(n,1);s.version=o;const l=a.get(t);l&&e.remove(l),a.set(t,s)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const r in i)e.update(i[r],t.ARRAY_BUFFER)},getWireframeAttribute:function(t){const e=a.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return a.get(t)}}}function bw(t,e,n){let i,r,a;function o(e,o,s){0!==s&&(t.drawElementsInstanced(i,o,r,e*a,s),n.update(o,i,s))}this.setMode=function(t){i=t},this.setIndex=function(t){r=t.type,a=t.bytesPerElement},this.render=function(e,o){t.drawElements(i,o,r,e*a),n.update(o,i,1)},this.renderInstances=o,this.renderMultiDraw=function(t,a,o){if(0===o)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,a,0,r,t,0,o);let s=0;for(let e=0;e<o;e++)s+=a[e];n.update(s,i,1)},this.renderMultiDrawInstances=function(t,s,l,c){if(0===l)return;const u=e.get("WEBGL_multi_draw");if(null===u)for(let e=0;e<t.length;e++)o(t[e]/a,s[e],c[e]);else{u.multiDrawElementsInstancedWEBGL(i,s,0,r,t,0,c,0,l);let e=0;for(let t=0;t<l;t++)e+=s[t]*c[t];n.update(e,i,1)}}}function ww(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Sw(t,e,n){const i=new WeakMap,r=new Td;return{update:function(a,o,s){const l=a.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(o);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==o.morphAttributes.position,p=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,m=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let v=0;!0===d&&(v=1),!0===p&&(v=2),!0===f&&(v=3);let _=o.attributes.position.count*v,x=1;_>e.maxTextureSize&&(x=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const b=new Float32Array(_*x*4*u),w=new Cd(b,_,x,u);w.type=kc,w.needsUpdate=!0;const S=4*v;for(let T=0;T<u;T++){const E=m[T],A=g[T],C=y[T],P=_*x*4*T;for(let I=0;I<E.count;I++){const R=I*S;!0===d&&(r.fromBufferAttribute(E,I),b[P+R+0]=r.x,b[P+R+1]=r.y,b[P+R+2]=r.z,b[P+R+3]=0),!0===p&&(r.fromBufferAttribute(A,I),b[P+R+4]=r.x,b[P+R+5]=r.y,b[P+R+6]=r.z,b[P+R+7]=0),!0===f&&(r.fromBufferAttribute(C,I),b[P+R+8]=r.x,b[P+R+9]=r.y,b[P+R+10]=r.z,b[P+R+11]=4===C.itemSize?r.w:1)}}function M(){w.dispose(),i.delete(o),o.removeEventListener("dispose",M)}h={count:u,texture:w,size:new Jh(_,x)},i.set(o,h),o.addEventListener("dispose",M)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)s.getUniforms().setValue(t,"morphTexture",a.morphTexture,n);else{let k=0;for(let D=0;D<l.length;D++)k+=l[D];const L=o.morphTargetsRelative?1:1-k;s.getUniforms().setValue(t,"morphTargetBaseInfluence",L),s.getUniforms().setValue(t,"morphTargetInfluences",l)}s.getUniforms().setValue(t,"morphTargetsTexture",h.texture,n),s.getUniforms().setValue(t,"morphTargetsTextureSize",h.size)}}}function Mw(t,e,n,i){let r=new WeakMap;function a(t){const e=t.target;e.removeEventListener("dispose",a),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(o){const s=i.render.frame,l=o.geometry,c=e.get(o,l);if(r.get(c)!==s&&(e.update(c),r.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),r.get(o)!==s&&(n.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,t.ARRAY_BUFFER),r.set(o,s))),o.isSkinnedMesh){const t=o.skeleton;r.get(t)!==s&&(t.update(),r.set(t,s))}return c},dispose:function(){r=new WeakMap}}}const Tw=new Md,Ew=new ay(1,1),Aw=new Cd,Cw=new Id,Pw=new em,Iw=[],Rw=[],kw=new Float32Array(16),Lw=new Float32Array(9),Dw=new Float32Array(4);function zw(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let a=Iw[r];if(void 0===a&&(a=new Float32Array(r),Iw[r]=a),0!==e){i.toArray(a,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(a,r)}return a}function Nw(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Ow(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Fw(t,e){let n=Rw[e];void 0===n&&(n=new Int32Array(e),Rw[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Bw(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Uw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Nw(n,e))return;t.uniform2fv(this.addr,e),Ow(n,e)}}function jw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Nw(n,e))return;t.uniform3fv(this.addr,e),Ow(n,e)}}function Vw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Nw(n,e))return;t.uniform4fv(this.addr,e),Ow(n,e)}}function Hw(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Nw(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ow(n,e)}else{if(Nw(n,i))return;Dw.set(i),t.uniformMatrix2fv(this.addr,!1,Dw),Ow(n,i)}}function Gw(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Nw(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ow(n,e)}else{if(Nw(n,i))return;Lw.set(i),t.uniformMatrix3fv(this.addr,!1,Lw),Ow(n,i)}}function Ww(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(Nw(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ow(n,e)}else{if(Nw(n,i))return;kw.set(i),t.uniformMatrix4fv(this.addr,!1,kw),Ow(n,i)}}function qw(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Zw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Nw(n,e))return;t.uniform2iv(this.addr,e),Ow(n,e)}}function Xw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Nw(n,e))return;t.uniform3iv(this.addr,e),Ow(n,e)}}function Yw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Nw(n,e))return;t.uniform4iv(this.addr,e),Ow(n,e)}}function Kw(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Jw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Nw(n,e))return;t.uniform2uiv(this.addr,e),Ow(n,e)}}function $w(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Nw(n,e))return;t.uniform3uiv(this.addr,e),Ow(n,e)}}function Qw(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Nw(n,e))return;t.uniform4uiv(this.addr,e),Ow(n,e)}}function tS(t,e,n){const i=this.cache,r=n.allocateTextureUnit();let a;i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),this.type===t.SAMPLER_2D_SHADOW?(Ew.compareFunction=vh,a=Ew):a=Tw,n.setTexture2D(e||a,r)}function eS(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||Cw,r)}function nS(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||Pw,r)}function iS(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||Aw,r)}function rS(t,e){t.uniform1fv(this.addr,e)}function aS(t,e){const n=zw(e,this.size,2);t.uniform2fv(this.addr,n)}function oS(t,e){const n=zw(e,this.size,3);t.uniform3fv(this.addr,n)}function sS(t,e){const n=zw(e,this.size,4);t.uniform4fv(this.addr,n)}function lS(t,e){const n=zw(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function cS(t,e){const n=zw(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function uS(t,e){const n=zw(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function hS(t,e){t.uniform1iv(this.addr,e)}function dS(t,e){t.uniform2iv(this.addr,e)}function pS(t,e){t.uniform3iv(this.addr,e)}function fS(t,e){t.uniform4iv(this.addr,e)}function mS(t,e){t.uniform1uiv(this.addr,e)}function gS(t,e){t.uniform2uiv(this.addr,e)}function yS(t,e){t.uniform3uiv(this.addr,e)}function vS(t,e){t.uniform4uiv(this.addr,e)}function _S(t,e,n){const i=this.cache,r=e.length,a=Fw(n,r);Nw(i,a)||(t.uniform1iv(this.addr,a),Ow(i,a));for(let o=0;o!==r;++o)n.setTexture2D(e[o]||Tw,a[o])}function xS(t,e,n){const i=this.cache,r=e.length,a=Fw(n,r);Nw(i,a)||(t.uniform1iv(this.addr,a),Ow(i,a));for(let o=0;o!==r;++o)n.setTexture3D(e[o]||Cw,a[o])}function bS(t,e,n){const i=this.cache,r=e.length,a=Fw(n,r);Nw(i,a)||(t.uniform1iv(this.addr,a),Ow(i,a));for(let o=0;o!==r;++o)n.setTextureCube(e[o]||Pw,a[o])}function wS(t,e,n){const i=this.cache,r=e.length,a=Fw(n,r);Nw(i,a)||(t.uniform1iv(this.addr,a),Ow(i,a));for(let o=0;o!==r;++o)n.setTexture2DArray(e[o]||Aw,a[o])}class SS{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return Bw;case 35664:return Uw;case 35665:return jw;case 35666:return Vw;case 35674:return Hw;case 35675:return Gw;case 35676:return Ww;case 5124:case 35670:return qw;case 35667:case 35671:return Zw;case 35668:case 35672:return Xw;case 35669:case 35673:return Yw;case 5125:return Kw;case 36294:return Jw;case 36295:return $w;case 36296:return Qw;case 35678:case 36198:case 36298:case 36306:case 35682:return tS;case 35679:case 36299:case 36307:return eS;case 35680:case 36300:case 36308:case 36293:return nS;case 36289:case 36303:case 36311:case 36292:return iS}}(e.type)}}class MS{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return rS;case 35664:return aS;case 35665:return oS;case 35666:return sS;case 35674:return lS;case 35675:return cS;case 35676:return uS;case 5124:case 35670:return hS;case 35667:case 35671:return dS;case 35668:case 35672:return pS;case 35669:case 35673:return fS;case 5125:return mS;case 36294:return gS;case 36295:return yS;case 36296:return vS;case 35678:case 36198:case 36298:case 36306:case 35682:return _S;case 35679:case 36299:case 36307:return xS;case 35680:case 36300:case 36308:case 36293:return bS;case 36289:case 36303:case 36311:case 36292:return wS}}(e.type)}}class TS{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const a=i[r];a.setValue(t,e[a.id],n)}}}const ES=/(\w+)(\])?(\[|\.)?/g;function AS(t,e){t.seq.push(e),t.map[e.id]=e}function CS(t,e,n){const i=t.name,r=i.length;for(ES.lastIndex=0;;){const a=ES.exec(i),o=ES.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){AS(n,void 0===c?new SS(s,t,e):new MS(s,t,e));break}{let t=n.map[s];void 0===t&&(t=new TS(s),AS(n,t)),n=t}}}class PS{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);CS(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,a=e.length;r!==a;++r){const a=e[r],o=n[a.id];!1!==o.needsUpdate&&a.setValue(t,o.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function IS(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}let RS=0;const kS=new nd;function LS(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=(t.getShaderInfoLog(e)||"").trim();if(i&&""===r)return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const i=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),a=Math.min(e+6,n.length);for(let o=r;o<a;o++){const t=o+1;i.push("".concat(t===e?">":" "," ").concat(t,": ").concat(n[o]))}return i.join("\n")}(t.getShaderSource(e),i)}return r}function DS(t,e){const n=function(t){fd._getMatrix(kS,fd.workingColorSpace,t);const e="mat3( ".concat(kS.elements.map(t=>t.toFixed(4))," )");switch(fd.getTransfer(t)){case Ju:return[e,"LinearTransferOETF"];case $u:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}(e);return["vec4 ".concat(t,"( vec4 value ) {"),"\treturn ".concat(n[1],"( vec4( value.rgb * ").concat(n[0],", value.a ) );"),"}"].join("\n")}function zS(t,e){let n;switch(e){case $l:n="Linear";break;case Ql:n="Reinhard";break;case tc:n="Cineon";break;case ec:n="ACESFilmic";break;case ic:n="AgX";break;case rc:n="Neutral";break;case nc:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const NS=new Qh;function OS(){fd.getLuminanceCoefficients(NS);const t=NS.x.toFixed(4),e=NS.y.toFixed(4),n=NS.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","\tconst vec3 weights = vec3( ".concat(t,", ").concat(e,", ").concat(n," );"),"\treturn dot( weights, rgb );","}"].join("\n")}function FS(t){return""!==t}function BS(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function US(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const jS=/^[ \t]*#include +<([\w\d./]+)>/gm;function VS(t){return t.replace(jS,GS)}const HS=new Map;function GS(t,e){let n=Hb[e];if(void 0===n){const t=HS.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=Hb[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return VS(n)}const WS=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function qS(t){return t.replace(WS,ZS)}function ZS(t,e,n,i){let r="";for(let a=parseInt(e);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function XS(t){let e="precision ".concat(t.precision," float;\n\tprecision ").concat(t.precision," int;\n\tprecision ").concat(t.precision," sampler2D;\n\tprecision ").concat(t.precision," samplerCube;\n\tprecision ").concat(t.precision," sampler3D;\n\tprecision ").concat(t.precision," sampler2DArray;\n\tprecision ").concat(t.precision," sampler2DShadow;\n\tprecision ").concat(t.precision," samplerCubeShadow;\n\tprecision ").concat(t.precision," sampler2DArrayShadow;\n\tprecision ").concat(t.precision," isampler2D;\n\tprecision ").concat(t.precision," isampler3D;\n\tprecision ").concat(t.precision," isamplerCube;\n\tprecision ").concat(t.precision," isampler2DArray;\n\tprecision ").concat(t.precision," usampler2D;\n\tprecision ").concat(t.precision," usampler3D;\n\tprecision ").concat(t.precision," usamplerCube;\n\tprecision ").concat(t.precision," usampler2DArray;\n\t");return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function YS(t,e,n,i){const r=t.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===ll?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===cl?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===ul&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case lc:case cc:e="ENVMAP_TYPE_CUBE";break;case dc:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),u=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===cc&&(e="ENVMAP_MODE_REFRACTION");return e}(n),h=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Xl:e="ENVMAP_BLENDING_MULTIPLY";break;case Yl:e="ENVMAP_BLENDING_MIX";break;case Kl:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(FS).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(a),m=r.createProgram();let g,y,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(FS).join("\n"),g.length>0&&(g+="\n"),y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(FS).join("\n"),y.length>0&&(y+="\n")):(g=[XS(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(FS).join("\n"),y=[XS(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Jl?"#define TONE_MAPPING":"",n.toneMapping!==Jl?Hb.tonemapping_pars_fragment:"",n.toneMapping!==Jl?zS("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Hb.colorspace_pars_fragment,DS("linearToOutputTexel",n.outputColorSpace),OS(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(FS).join("\n")),o=VS(o),o=BS(o,n),o=US(o,n),s=VS(s),s=BS(s,n),s=US(s,n),o=qS(o),s=qS(s),!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["#define varying in",n.glslVersion===Lh?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Lh?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const _=v+g+o,x=v+y+s,b=IS(r,r.VERTEX_SHADER,_),w=IS(r,r.FRAGMENT_SHADER,x);function S(e){if(t.debug.checkShaderErrors){const n=r.getProgramInfoLog(m)||"",i=r.getShaderInfoLog(b)||"",a=r.getShaderInfoLog(w)||"",o=n.trim(),s=i.trim(),l=a.trim();let c=!0,u=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(c=!1,"function"===typeof t.debug.onShaderError)t.debug.onShaderError(r,m,b,w);else{const t=LS(r,b,"vertex"),n=LS(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+o+"\n"+t+"\n"+n)}else""!==o?console.warn("THREE.WebGLProgram: Program Info Log:",o):""!==s&&""!==l||(u=!1);u&&(e.diagnostics={runnable:c,programLog:o,vertexShader:{log:s,prefix:g},fragmentShader:{log:l,prefix:y}})}r.deleteShader(b),r.deleteShader(w),M=new PS(r,m),T=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),a=i.name;let o=1;i.type===t.FLOAT_MAT2&&(o=2),i.type===t.FLOAT_MAT3&&(o=3),i.type===t.FLOAT_MAT4&&(o=4),n[a]={type:i.type,location:t.getAttribLocation(e,a),locationSize:o}}return n}(r,m)}let M,T;r.attachShader(m,b),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===M&&S(this),M},this.getAttributes=function(){return void 0===T&&S(this),T};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=r.getProgramParameter(m,37297)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=RS++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=w,this}let KS=0;class JS{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(t);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new $S(t),e.set(t,n)),n}}class $S{constructor(t){this.id=KS++,this.code=t,this.usedTimes=0}}function QS(t,e,n,i,r,a,o){const s=new gp,l=new JS,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return c.add(t),0===t?"uv":"uv".concat(t)}return{getParameters:function(a,s,u,g,y){const v=g.fog,_=y.geometry,x=a.isMeshStandardMaterial?g.environment:null,b=(a.isMeshStandardMaterial?n:e).get(a.envMap||x),w=b&&b.mapping===dc?b.image.height:null,S=f[a.type];null!==a.precision&&(p=r.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));const M=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,T=void 0!==M?M.length:0;let E,A,C,P,I=0;if(void 0!==_.morphAttributes.position&&(I=1),void 0!==_.morphAttributes.normal&&(I=2),void 0!==_.morphAttributes.color&&(I=3),S){const t=Wb[S];E=t.vertexShader,A=t.fragmentShader}else E=a.vertexShader,A=a.fragmentShader,l.update(a),C=l.getVertexShaderID(a),P=l.getFragmentShaderID(a);const R=t.getRenderTarget(),k=t.state.buffers.depth.getReversed(),L=!0===y.isInstancedMesh,D=!0===y.isBatchedMesh,z=!!a.map,N=!!a.matcap,O=!!b,F=!!a.aoMap,B=!!a.lightMap,U=!!a.bumpMap,j=!!a.normalMap,V=!!a.displacementMap,H=!!a.emissiveMap,G=!!a.metalnessMap,W=!!a.roughnessMap,q=a.anisotropy>0,Z=a.clearcoat>0,X=a.dispersion>0,Y=a.iridescence>0,K=a.sheen>0,J=a.transmission>0,$=q&&!!a.anisotropyMap,Q=Z&&!!a.clearcoatMap,tt=Z&&!!a.clearcoatNormalMap,et=Z&&!!a.clearcoatRoughnessMap,nt=Y&&!!a.iridescenceMap,it=Y&&!!a.iridescenceThicknessMap,rt=K&&!!a.sheenColorMap,at=K&&!!a.sheenRoughnessMap,ot=!!a.specularMap,st=!!a.specularColorMap,lt=!!a.specularIntensityMap,ct=J&&!!a.transmissionMap,ut=J&&!!a.thicknessMap,ht=!!a.gradientMap,dt=!!a.alphaMap,pt=a.alphaTest>0,ft=!!a.alphaHash,mt=!!a.extensions;let gt=Jl;a.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(gt=t.toneMapping));const yt={shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:E,fragmentShader:A,defines:a.defines,customVertexShaderID:C,customFragmentShaderID:P,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:D,batchingColor:D&&null!==y._colorsTexture,instancing:L,instancingColor:L&&null!==y.instanceColor,instancingMorph:L&&null!==y.morphTexture,supportsVertexTextures:d,outputColorSpace:null===R?t.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:Ku,alphaToCoverage:!!a.alphaToCoverage,map:z,matcap:N,envMap:O,envMapMode:O&&b.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:B,bumpMap:U,normalMap:j,displacementMap:d&&V,emissiveMap:H,normalMapObjectSpace:j&&a.normalMapType===Zu,normalMapTangentSpace:j&&a.normalMapType===qu,metalnessMap:G,roughnessMap:W,anisotropy:q,anisotropyMap:$,clearcoat:Z,clearcoatMap:Q,clearcoatNormalMap:tt,clearcoatRoughnessMap:et,dispersion:X,iridescence:Y,iridescenceMap:nt,iridescenceThicknessMap:it,sheen:K,sheenColorMap:rt,sheenRoughnessMap:at,specularMap:ot,specularColorMap:st,specularIntensityMap:lt,transmission:J,transmissionMap:ct,thicknessMap:ut,gradientMap:ht,opaque:!1===a.transparent&&a.blending===ml&&!1===a.alphaToCoverage,alphaMap:dt,alphaTest:pt,alphaHash:ft,combine:a.combine,mapUv:z&&m(a.map.channel),aoMapUv:F&&m(a.aoMap.channel),lightMapUv:B&&m(a.lightMap.channel),bumpMapUv:U&&m(a.bumpMap.channel),normalMapUv:j&&m(a.normalMap.channel),displacementMapUv:V&&m(a.displacementMap.channel),emissiveMapUv:H&&m(a.emissiveMap.channel),metalnessMapUv:G&&m(a.metalnessMap.channel),roughnessMapUv:W&&m(a.roughnessMap.channel),anisotropyMapUv:$&&m(a.anisotropyMap.channel),clearcoatMapUv:Q&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:tt&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:nt&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:it&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:at&&m(a.sheenRoughnessMap.channel),specularMapUv:ot&&m(a.specularMap.channel),specularColorMapUv:st&&m(a.specularColorMap.channel),specularIntensityMapUv:lt&&m(a.specularIntensityMap.channel),transmissionMapUv:ct&&m(a.transmissionMap.channel),thicknessMapUv:ut&&m(a.thicknessMap.channel),alphaMapUv:dt&&m(a.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(j||q),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,pointsUvs:!0===y.isPoints&&!!_.attributes.uv&&(z||dt),fog:!!v,useFog:!0===a.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===a.flatShading&&!1===a.wireframe,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reversedDepthBuffer:k,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:T,morphTextureStride:I,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:t.shadowMap.enabled&&u.length>0,shadowMapType:t.shadowMap.type,toneMapping:gt,decodeVideoTexture:z&&!0===a.map.isVideoTexture&&fd.getTransfer(a.map.colorSpace)===$u,decodeVideoTextureEmissive:H&&!0===a.emissiveMap.isVideoTexture&&fd.getTransfer(a.emissiveMap.colorSpace)===$u,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===pl,flipSided:a.side===dl,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:mt&&!0===a.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(mt&&!0===a.extensions.multiDraw||D)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return yt.vertexUv1s=c.has(1),yt.vertexUv2s=c.has(2),yt.vertexUv3s=c.has(3),c.clear(),yt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){s.disableAll(),e.supportsVertexTextures&&s.enable(0);e.instancing&&s.enable(1);e.instancingColor&&s.enable(2);e.instancingMorph&&s.enable(3);e.matcap&&s.enable(4);e.envMap&&s.enable(5);e.normalMapObjectSpace&&s.enable(6);e.normalMapTangentSpace&&s.enable(7);e.clearcoat&&s.enable(8);e.iridescence&&s.enable(9);e.alphaTest&&s.enable(10);e.vertexColors&&s.enable(11);e.vertexAlphas&&s.enable(12);e.vertexUv1s&&s.enable(13);e.vertexUv2s&&s.enable(14);e.vertexUv3s&&s.enable(15);e.vertexTangents&&s.enable(16);e.anisotropy&&s.enable(17);e.alphaHash&&s.enable(18);e.batching&&s.enable(19);e.dispersion&&s.enable(20);e.batchingColor&&s.enable(21);e.gradientMap&&s.enable(22);t.push(s.mask),s.disableAll(),e.fog&&s.enable(0);e.useFog&&s.enable(1);e.flatShading&&s.enable(2);e.logarithmicDepthBuffer&&s.enable(3);e.reversedDepthBuffer&&s.enable(4);e.skinning&&s.enable(5);e.morphTargets&&s.enable(6);e.morphNormals&&s.enable(7);e.morphColors&&s.enable(8);e.premultipliedAlpha&&s.enable(9);e.shadowMapEnabled&&s.enable(10);e.doubleSided&&s.enable(11);e.flipSided&&s.enable(12);e.useDepthPacking&&s.enable(13);e.dithering&&s.enable(14);e.transmission&&s.enable(15);e.sheen&&s.enable(16);e.opaque&&s.enable(17);e.pointsUvs&&s.enable(18);e.decodeVideoTexture&&s.enable(19);e.decodeVideoTextureEmissive&&s.enable(20);e.alphaToCoverage&&s.enable(21);t.push(s.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=Wb[e];n=qf.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,r=u.length;t<r;t++){const e=u[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new YS(t,n,e,a),u.push(i)),i},releaseProgram:function(t){if(0===--t.usedTimes){const e=u.indexOf(t);u[e]=u[u.length-1],u.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:u,dispose:function(){l.dispose()}}}function tM(){let t=new WeakMap;return{has:function(e){return t.has(e)},get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function eM(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function nM(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function iM(){const t=[];let e=0;const n=[],i=[],r=[];function a(n,i,r,a,o,s){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,o,s,l,c){const u=a(t,e,o,s,l,c);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(t,e,o,s,l,c){const u=a(t,e,o,s,l,c);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||eM),i.length>1&&i.sort(e||nM),r.length>1&&r.sort(e||nM)}}}function rM(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new iM,t.set(e,[r])):n>=i.length?(r=new iM,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function aM(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new Qh,color:new Jp};break;case"SpotLight":n={position:new Qh,direction:new Qh,color:new Jp,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Qh,color:new Jp,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Qh,skyColor:new Jp,groundColor:new Jp};break;case"RectAreaLight":n={color:new Jp,position:new Qh,halfWidth:new Qh,halfHeight:new Qh}}return t[e.id]=n,n}}}let oM=0;function sM(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function lM(t){const e=new aM,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jh};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jh,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let s=0;s<9;s++)i.probe.push(new Qh);const r=new Qh,a=new ap,o=new ap;return{setup:function(r){let a=0,o=0,s=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0;r.sort(sM);for(let t=0,x=r.length;t<x;t++){const _=r[t],x=_.color,b=_.intensity,w=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)a+=x.r*b,o+=x.g*b,s+=x.b*b;else if(_.isLightProbe){for(let t=0;t<9;t++)i.probe[t].addScaledVector(_.sh.coefficients[t],b);v++}else if(_.isDirectionalLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,i.directionalShadow[l]=e,i.directionalShadowMap[l]=S,i.directionalShadowMatrix[l]=_.shadow.matrix,p++}i.directional[l]=t,l++}else if(_.isSpotLight){const t=e.get(_);t.position.setFromMatrixPosition(_.matrixWorld),t.color.copy(x).multiplyScalar(b),t.distance=w,t.coneCos=Math.cos(_.angle),t.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),t.decay=_.decay,i.spot[u]=t;const r=_.shadow;if(_.map&&(i.spotLightMap[g]=_.map,g++,r.updateMatrices(_),_.castShadow&&y++),i.spotLightMatrix[u]=r.matrix,_.castShadow){const t=n.get(_);t.shadowIntensity=r.intensity,t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,i.spotShadow[u]=t,i.spotShadowMap[u]=S,m++}u++}else if(_.isRectAreaLight){const t=e.get(_);t.color.copy(x).multiplyScalar(b),t.halfWidth.set(.5*_.width,0,0),t.halfHeight.set(0,.5*_.height,0),i.rectArea[h]=t,h++}else if(_.isPointLight){const t=e.get(_);if(t.color.copy(_.color).multiplyScalar(_.intensity),t.distance=_.distance,t.decay=_.decay,_.castShadow){const t=_.shadow,e=n.get(_);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,i.pointShadow[c]=e,i.pointShadowMap[c]=S,i.pointShadowMatrix[c]=_.shadow.matrix,f++}i.point[c]=t,c++}else if(_.isHemisphereLight){const t=e.get(_);t.skyColor.copy(_.color).multiplyScalar(b),t.groundColor.copy(_.groundColor).multiplyScalar(b),i.hemi[d]=t,d++}}h>0&&(!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Gb.LTC_FLOAT_1,i.rectAreaLTC2=Gb.LTC_FLOAT_2):(i.rectAreaLTC1=Gb.LTC_HALF_1,i.rectAreaLTC2=Gb.LTC_HALF_2)),i.ambient[0]=a,i.ambient[1]=o,i.ambient[2]=s;const _=i.hash;_.directionalLength===l&&_.pointLength===c&&_.spotLength===u&&_.rectAreaLength===h&&_.hemiLength===d&&_.numDirectionalShadows===p&&_.numPointShadows===f&&_.numSpotShadows===m&&_.numSpotMaps===g&&_.numLightProbes===v||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-y,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=y,i.numLightProbes=v,_.directionalLength=l,_.pointLength=c,_.spotLength=u,_.rectAreaLength=h,_.hemiLength=d,_.numDirectionalShadows=p,_.numPointShadows=f,_.numSpotShadows=m,_.numSpotMaps=g,_.numLightProbes=v,i.version=oM++)},setupView:function(t,e){let n=0,s=0,l=0,c=0,u=0;const h=e.matrixWorldInverse;for(let d=0,p=t.length;d<p;d++){const e=t[d];if(e.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(e.matrixWorld),r.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(h),n++}else if(e.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),t.direction.setFromMatrixPosition(e.matrixWorld),r.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(h),l++}else if(e.isRectAreaLight){const t=i.rectArea[c];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),o.identity(),a.copy(e.matrixWorld),a.premultiply(h),o.extractRotation(a),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(e.isPointLight){const t=i.point[s];t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(h),s++}else if(e.isHemisphereLight){const t=i.hemi[u];t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(h),u++}}},state:i}}function cM(t){const e=new lM(t),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){r.camera=t,n.length=0,i.length=0},state:r,setupLights:function(){e.setup(n)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){i.push(t)}}}function uM(t){let e=new WeakMap;return{get:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.get(n);let a;return void 0===r?(a=new cM(t),e.set(n,[a])):i>=r.length?(a=new cM(t),r.push(a)):a=r[i],a},dispose:function(){e=new WeakMap}}}function hM(t,e,n){let i=new lg;const r=new Jh,a=new Jh,o=new Td,s=new jv({depthPacking:Hu}),l=new Vv,c={},u=n.maxTextureSize,h={[hl]:dl,[dl]:hl,[pl]:pl},d=new Zf({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Jh},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Cf;f.setAttribute("position",new hf(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Uf(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ll;let y=this.type;function v(n,i){const a=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Ad(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,a,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,a,p,m,null)}function _(e,n,i,r){let a=null;const o=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===i.isPointLight?l:s,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const t=a.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=a.clone(),i[e]=r,n.addEventListener("dispose",b)),a=r}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=r===ul?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],a.alphaMap=n.alphaMap,a.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){t.properties.get(a).light=i}return a}function x(n,r,a,o,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===ul)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=e.update(n),l=n.material;if(Array.isArray(l)){const e=i.groups;for(let c=0,u=e.length;c<u;c++){const u=e[c],h=l[u.materialIndex];if(h&&h.visible){const e=_(n,h,o,s);n.onBeforeShadow(t,n,r,a,i,e,u),t.renderBufferDirect(a,null,i,e,n,u),n.onAfterShadow(t,n,r,a,i,e,u)}}}else if(l.visible){const e=_(n,l,o,s);n.onBeforeShadow(t,n,r,a,i,e,null),t.renderBufferDirect(a,null,i,e,n,null),n.onAfterShadow(t,n,r,a,i,e,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)x(l[t],r,a,o,s)}function b(t){t.target.removeEventListener("dispose",b);for(const e in c){const n=c[e],i=t.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(e,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),d=t.state;d.setBlending(fl),!0===d.buffers.depth.getReversed()?d.buffers.color.setClear(0,0,0,0):d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=y!==ul&&this.type===ul,f=y===ul&&this.type!==ul;for(let m=0,g=e.length;m<g;m++){const l=e[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),a.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/h.x),r.x=a.x*h.x,c.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/h.y),r.y=a.y*h.y,c.mapSize.y=a.y)),null===c.map||!0===p||!0===f){const t=this.type!==ul?{minFilter:gc,magFilter:gc}:{};null!==c.map&&c.map.dispose(),c.map=new Ad(r.x,r.y,t),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const g=c.getViewportCount();for(let t=0;t<g;t++){const e=c.getViewport(t);o.set(a.x*e.x,a.y*e.y,a.x*e.z,a.y*e.w),d.viewport(o),c.updateMatrices(l,t),i=c.getFrustum(),x(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===ul&&v(c,s),c.needsUpdate=!1}y=this.type,g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}const dM={[Ul]:jl,[Vl]:ql,[Gl]:Zl,[Hl]:Wl,[jl]:Ul,[ql]:Vl,[Zl]:Gl,[Wl]:Hl};function pM(t,e){const n=new function(){let e=!1;const n=new Td;let i=null;const r=new Td(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,a,o,s){!0===s&&(e*=o,i*=o,a*=o),n.set(e,i,a,o),!1===r.equals(n)&&(t.clearColor(e,i,a,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,a=null,o=null;return{setReversed:function(t){if(i!==t){const n=e.get("EXT_clip_control");t?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),i=t;const r=o;o=null,this.setClear(r)}},getReversed:function(){return i},setTest:function(e){e?U(t.DEPTH_TEST):j(t.DEPTH_TEST)},setMask:function(e){r===e||n||(t.depthMask(e),r=e)},setFunc:function(e){if(i&&(e=dM[e]),a!==e){switch(e){case Ul:t.depthFunc(t.NEVER);break;case jl:t.depthFunc(t.ALWAYS);break;case Vl:t.depthFunc(t.LESS);break;case Hl:t.depthFunc(t.LEQUAL);break;case Gl:t.depthFunc(t.EQUAL);break;case Wl:t.depthFunc(t.GEQUAL);break;case ql:t.depthFunc(t.GREATER);break;case Zl:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}a=e}},setLocked:function(t){n=t},setClear:function(e){o!==e&&(i&&(e=1-e),t.clearDepth(e),o=e)},reset:function(){n=!1,r=null,a=null,o=null,i=!1}}},r=new function(){let e=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){e||(n?U(t.STENCIL_TEST):j(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&a===o||(t.stencilFunc(e,n,o),i=e,r=n,a=o)},setOp:function(e,n,i){o===e&&s===n&&l===i||(t.stencilOp(e,n,i),o=e,s=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null}}},a=new WeakMap,o=new WeakMap;let s={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,x=new Jp(0,0,0),b=0,w=!1,S=null,M=null,T=null,E=null,A=null;const C=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let P=!1,I=0;const R=t.getParameter(t.VERSION);-1!==R.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(R)[1]),P=I>=1):-1!==R.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),P=I>=2);let k=null,L={};const D=t.getParameter(t.SCISSOR_BOX),z=t.getParameter(t.VIEWPORT),N=(new Td).fromArray(D),O=(new Td).fromArray(z);function F(e,n,i,r){const a=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let s=0;s<i;s++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,a):t.texImage2D(n+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a);return o}const B={};function U(e){!0!==s[e]&&(t.enable(e),s[e]=!0)}function j(e){!1!==s[e]&&(t.disable(e),s[e]=!1)}B[t.TEXTURE_2D]=F(t.TEXTURE_2D,t.TEXTURE_2D,1),B[t.TEXTURE_CUBE_MAP]=F(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),B[t.TEXTURE_2D_ARRAY]=F(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),B[t.TEXTURE_3D]=F(t.TEXTURE_3D,t.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),U(t.DEPTH_TEST),i.setFunc(Hl),W(!1),q(rl),U(t.CULL_FACE),G(fl);const V={[xl]:t.FUNC_ADD,[bl]:t.FUNC_SUBTRACT,[wl]:t.FUNC_REVERSE_SUBTRACT};V[Sl]=t.MIN,V[Ml]=t.MAX;const H={[Tl]:t.ZERO,[El]:t.ONE,[Al]:t.SRC_COLOR,[Pl]:t.SRC_ALPHA,[zl]:t.SRC_ALPHA_SATURATE,[Ll]:t.DST_COLOR,[Rl]:t.DST_ALPHA,[Cl]:t.ONE_MINUS_SRC_COLOR,[Il]:t.ONE_MINUS_SRC_ALPHA,[Dl]:t.ONE_MINUS_DST_COLOR,[kl]:t.ONE_MINUS_DST_ALPHA,[Nl]:t.CONSTANT_COLOR,[Ol]:t.ONE_MINUS_CONSTANT_COLOR,[Fl]:t.CONSTANT_ALPHA,[Bl]:t.ONE_MINUS_CONSTANT_ALPHA};function G(e,n,i,r,a,o,s,l,c,u){if(e!==fl){if(!1===d&&(U(t.BLEND),d=!0),e===_l)a=a||n,o=o||i,s=s||r,n===f&&a===y||(t.blendEquationSeparate(V[n],V[a]),f=n,y=a),i===m&&r===g&&o===v&&s===_||(t.blendFuncSeparate(H[i],H[r],H[o],H[s]),m=i,g=r,v=o,_=s),!1!==l.equals(x)&&c===b||(t.blendColor(l.r,l.g,l.b,c),x.copy(l),b=c),p=e,w=!1;else if(e!==p||u!==w){if(f===xl&&y===xl||(t.blendEquation(t.FUNC_ADD),f=xl,y=xl),u)switch(e){case ml:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case gl:t.blendFunc(t.ONE,t.ONE);break;case yl:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case vl:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case ml:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case gl:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case yl:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case vl:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,v=null,_=null,x.set(0,0,0),b=0,p=e,w=u}}else!0===d&&(j(t.BLEND),d=!1)}function W(e){S!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),S=e)}function q(e){e!==il?(U(t.CULL_FACE),e!==M&&(e===rl?t.cullFace(t.BACK):e===al?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):j(t.CULL_FACE),M=e}function Z(e,n,i){e?(U(t.POLYGON_OFFSET_FILL),E===n&&A===i||(t.polygonOffset(n,i),E=n,A=i)):j(t.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:U,disable:j,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,e===t.DRAW_FRAMEBUFFER&&(l[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(l[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let i=u,r=!1;if(e){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const a=e.textures;if(i.length!==a.length||i[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=a.length;e<n;e++)i[e]=t.COLOR_ATTACHMENT0+e;i.length=a.length,r=!0}}else i[0]!==t.BACK&&(i[0]=t.BACK,r=!0);r&&t.drawBuffers(i)},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:G,setMaterial:function(e,a){e.side===pl?j(t.CULL_FACE):U(t.CULL_FACE);let o=e.side===dl;a&&(o=!o),W(o),e.blending===ml&&!1===e.transparent?G(fl):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),n.setMask(e.colorWrite);const s=e.stencilWrite;r.setTest(s),s&&(r.setMask(e.stencilWriteMask),r.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),r.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?U(t.SAMPLE_ALPHA_TO_COVERAGE):j(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:q,setLineWidth:function(e){e!==T&&(P&&t.lineWidth(e),T=e)},setPolygonOffset:Z,setScissorTest:function(e){e?U(t.SCISSOR_TEST):j(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+C-1),k!==e&&(t.activeTexture(e),k=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===k?t.TEXTURE0+C-1:k);let r=L[i];void 0===r&&(r={type:void 0,texture:void 0},L[i]=r),r.type===e&&r.texture===n||(k!==i&&(t.activeTexture(i),k=i),t.bindTexture(e,n||B[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=L[k];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},compressedTexImage3D:function(){try{t.compressedTexImage3D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},texImage2D:function(){try{t.texImage2D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},texImage3D:function(){try{t.texImage3D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},updateUBOMapping:function(e,n){let i=o.get(n);void 0===i&&(i=new WeakMap,o.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=o.get(n).get(e);a.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),a.set(n,i))},texStorage2D:function(){try{t.texStorage2D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},texStorage3D:function(){try{t.texStorage3D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},texSubImage2D:function(){try{t.texSubImage2D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},texSubImage3D:function(){try{t.texSubImage3D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D(...arguments)}catch(dE){console.error("THREE.WebGLState:",dE)}},scissor:function(e){!1===N.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),N.copy(e))},viewport:function(e){!1===O.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),O.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),i.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),s={},k=null,L={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,x=new Jp(0,0,0),b=0,w=!1,S=null,M=null,T=null,E=null,A=null,N.set(0,0,t.canvas.width,t.canvas.height),O.set(0,0,t.canvas.width,t.canvas.height),n.reset(),i.reset(),r.reset()}}}function fM(t,e,n,i,r,a,o){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new Jh,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function f(t,e){return p?new OffscreenCanvas(t,e):sd("canvas")}function m(t,e,n){let i=1;const r=H(t);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(i*r.width),a=Math.floor(i*r.height);void 0===h&&(h=f(n,a));const o=e?f(n,a):h;o.width=n,o.height=a;return o.getContext("2d").drawImage(t,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),t}return t}function g(t){return t.generateMipmaps}function y(e){t.generateMipmap(e)}function v(e){return e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:e.isWebGL3DRenderTarget?t.TEXTURE_3D:e.isWebGLArrayRenderTarget||e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function _(n,i,r,a){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=i;if(i===t.RED&&(r===t.FLOAT&&(s=t.R32F),r===t.HALF_FLOAT&&(s=t.R16F),r===t.UNSIGNED_BYTE&&(s=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.R8UI),r===t.UNSIGNED_SHORT&&(s=t.R16UI),r===t.UNSIGNED_INT&&(s=t.R32UI),r===t.BYTE&&(s=t.R8I),r===t.SHORT&&(s=t.R16I),r===t.INT&&(s=t.R32I)),i===t.RG&&(r===t.FLOAT&&(s=t.RG32F),r===t.HALF_FLOAT&&(s=t.RG16F),r===t.UNSIGNED_BYTE&&(s=t.RG8)),i===t.RG_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.RG8UI),r===t.UNSIGNED_SHORT&&(s=t.RG16UI),r===t.UNSIGNED_INT&&(s=t.RG32UI),r===t.BYTE&&(s=t.RG8I),r===t.SHORT&&(s=t.RG16I),r===t.INT&&(s=t.RG32I)),i===t.RGB_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.RGB8UI),r===t.UNSIGNED_SHORT&&(s=t.RGB16UI),r===t.UNSIGNED_INT&&(s=t.RGB32UI),r===t.BYTE&&(s=t.RGB8I),r===t.SHORT&&(s=t.RGB16I),r===t.INT&&(s=t.RGB32I)),i===t.RGBA_INTEGER&&(r===t.UNSIGNED_BYTE&&(s=t.RGBA8UI),r===t.UNSIGNED_SHORT&&(s=t.RGBA16UI),r===t.UNSIGNED_INT&&(s=t.RGBA32UI),r===t.BYTE&&(s=t.RGBA8I),r===t.SHORT&&(s=t.RGBA16I),r===t.INT&&(s=t.RGBA32I)),i===t.RGB&&(r===t.UNSIGNED_INT_5_9_9_9_REV&&(s=t.RGB9_E5),r===t.UNSIGNED_INT_10F_11F_11F_REV&&(s=t.R11F_G11F_B10F)),i===t.RGBA){const e=o?Ju:fd.getTransfer(a);r===t.FLOAT&&(s=t.RGBA32F),r===t.HALF_FLOAT&&(s=t.RGBA16F),r===t.UNSIGNED_BYTE&&(s=e===$u?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(s=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(s=t.RGB5_A1)}return s!==t.R16F&&s!==t.R32F&&s!==t.RG16F&&s!==t.RG32F&&s!==t.RGBA16F&&s!==t.RGBA32F||e.get("EXT_color_buffer_float"),s}function x(e,n){let i;return e?null===n||n===Rc||n===Nc?i=t.DEPTH24_STENCIL8:n===kc?i=t.DEPTH32F_STENCIL8:n===Pc&&(i=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Rc||n===Nc?i=t.DEPTH_COMPONENT24:n===kc?i=t.DEPTH_COMPONENT32F:n===Pc&&(i=t.DEPTH_COMPONENT16),i}function b(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==gc&&t.minFilter!==bc?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function w(t){const e=t.target;e.removeEventListener("dispose",w),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=d.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(t),0===Object.keys(r).length&&d.delete(n)}i.remove(t)}(e),e.isVideoTexture&&u.delete(e)}function S(e){const n=e.target;n.removeEventListener("dispose",S),function(e){const n=i.get(e);e.depthTexture&&(e.depthTexture.dispose(),i.remove(e.depthTexture));if(e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let e=0;e<n.__webglFramebuffer[i].length;e++)t.deleteFramebuffer(n.__webglFramebuffer[i][e]);else t.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=e.textures;for(let a=0,s=r.length;a<s;a++){const e=i.get(r[a]);e.__webglTexture&&(t.deleteTexture(e.__webglTexture),o.memory.textures--),i.remove(r[a])}i.remove(e)}(n)}function M(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete d.get(r)[n.__cacheKey],o.memory.textures--}let T=0;function E(e,r){const a=i.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;u.get(t)!==e&&(u.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&!0!==e.isExternalTexture&&e.version>0&&a.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void L(a,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}else e.isExternalTexture&&(a.__webglTexture=e.sourceTexture?e.sourceTexture:null);n.bindTexture(t.TEXTURE_2D,a.__webglTexture,t.TEXTURE0+r)}const A={[pc]:t.REPEAT,[fc]:t.CLAMP_TO_EDGE,[mc]:t.MIRRORED_REPEAT},C={[gc]:t.NEAREST,[yc]:t.NEAREST_MIPMAP_NEAREST,[_c]:t.NEAREST_MIPMAP_LINEAR,[bc]:t.LINEAR,[wc]:t.LINEAR_MIPMAP_NEAREST,[Mc]:t.LINEAR_MIPMAP_LINEAR},P={[mh]:t.NEVER,[wh]:t.ALWAYS,[gh]:t.LESS,[vh]:t.LEQUAL,[yh]:t.EQUAL,[bh]:t.GEQUAL,[_h]:t.GREATER,[xh]:t.NOTEQUAL};function I(n,a){if(a.type!==kc||!1!==e.has("OES_texture_float_linear")||a.magFilter!==bc&&a.magFilter!==wc&&a.magFilter!==_c&&a.magFilter!==Mc&&a.minFilter!==bc&&a.minFilter!==wc&&a.minFilter!==_c&&a.minFilter!==Mc||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,A[a.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,A[a.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,A[a.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,C[a.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,C[a.minFilter]),a.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,P[a.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(a.magFilter===gc)return;if(a.minFilter!==_c&&a.minFilter!==Mc)return;if(a.type===kc&&!1===e.has("OES_texture_float_linear"))return;if(a.anisotropy>1||i.get(a).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy}}}function R(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",w));const r=n.source;let a=d.get(r);void 0===a&&(a={},d.set(r,a));const s=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(s!==e.__cacheKey){void 0===a[s]&&(a[s]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),a[s].usedTimes++;const r=a[e.__cacheKey];void 0!==r&&(a[e.__cacheKey].usedTimes--,0===r.usedTimes&&M(n)),e.__cacheKey=s,e.__webglTexture=a[s].texture}return i}function k(t,e,n){return Math.floor(Math.floor(t/n)/e)}function L(e,o,s){let l=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=t.TEXTURE_3D);const c=R(e,o),u=o.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+s);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(t.TEXTURE0+s);const e=fd.getPrimaries(fd.workingColorSpace),i=o.colorSpace===Xu?null:fd.getPrimaries(o.colorSpace),d=o.colorSpace===Xu||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(o.image,!1,r.maxTextureSize);p=V(o,p);const f=a.convert(o.format,o.colorSpace),v=a.convert(o.type);let w,S=_(o.internalFormat,f,v,o.colorSpace,o.isVideoTexture);I(l,o);const M=o.mipmaps,T=!0!==o.isVideoTexture,E=void 0===h.__version||!0===c,A=u.dataReady,C=b(o,p);if(o.isDepthTexture)S=x(o.format===Hc,o.type),E&&(T?n.texStorage2D(t.TEXTURE_2D,1,S,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,v,null));else if(o.isDataTexture)if(M.length>0){T&&E&&n.texStorage2D(t.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let e=0,i=M.length;e<i;e++)w=M[e],T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,v,w.data):n.texImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,f,v,w.data);o.generateMipmaps=!1}else T?(E&&n.texStorage2D(t.TEXTURE_2D,C,S,p.width,p.height),A&&function(e,i,r,a){const o=e.updateRanges;if(0===o.length)n.texSubImage2D(t.TEXTURE_2D,0,0,0,i.width,i.height,r,a,i.data);else{o.sort((t,e)=>t.start-e.start);let s=0;for(let t=1;t<o.length;t++){const e=o[s],n=o[t],r=e.start+e.count,a=k(n.start,i.width,4),l=k(e.start,i.width,4);n.start<=r+1&&a===l&&k(n.start+n.count-1,i.width,4)===a?e.count=Math.max(e.count,n.start+n.count-e.start):(++s,o[s]=n)}o.length=s+1;const l=t.getParameter(t.UNPACK_ROW_LENGTH),c=t.getParameter(t.UNPACK_SKIP_PIXELS),u=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,i.width);for(let e=0,h=o.length;e<h;e++){const s=o[e],l=Math.floor(s.start/4),c=Math.ceil(s.count/4),u=l%i.width,h=Math.floor(l/i.width),d=c,p=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,u),t.pixelStorei(t.UNPACK_SKIP_ROWS,h),n.texSubImage2D(t.TEXTURE_2D,0,u,h,d,p,r,a,i.data)}e.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,l),t.pixelStorei(t.UNPACK_SKIP_PIXELS,c),t.pixelStorei(t.UNPACK_SKIP_ROWS,u)}}(o,p,f,v)):n.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,v,p.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){T&&E&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,S,M[0].width,M[0].height,p.depth);for(let e=0,i=M.length;e<i;e++)if(w=M[e],o.format!==jc)if(null!==f)if(T){if(A)if(o.layerUpdates.size>0){const i=Bb(w.width,w.height,o.format,o.type);for(const r of o.layerUpdates){const a=w.data.subarray(r*i/w.data.BYTES_PER_ELEMENT,(r+1)*i/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,r,w.width,w.height,1,f,a)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,w.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,S,w.width,w.height,p.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?A&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,v,w.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,S,w.width,w.height,p.depth,0,f,v,w.data)}else{T&&E&&n.texStorage2D(t.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let e=0,i=M.length;e<i;e++)w=M[e],o.format!==jc?null!==f?T?A&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,w.data):n.compressedTexImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,v,w.data):n.texImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,f,v,w.data)}else if(o.isDataArrayTexture)if(T){if(E&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,S,p.width,p.height,p.depth),A)if(o.layerUpdates.size>0){const e=Bb(p.width,p.height,o.format,o.type);for(const i of o.layerUpdates){const r=p.data.subarray(i*e/p.data.BYTES_PER_ELEMENT,(i+1)*e/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,v,r)}o.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,v,p.data);else if(o.isData3DTexture)T?(E&&n.texStorage3D(t.TEXTURE_3D,C,S,p.width,p.height,p.depth),A&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)):n.texImage3D(t.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,v,p.data);else if(o.isFramebufferTexture){if(E)if(T)n.texStorage2D(t.TEXTURE_2D,C,S,p.width,p.height);else{let e=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(t.TEXTURE_2D,r,S,e,i,0,f,v,null),e>>=1,i>>=1}}else if(M.length>0){if(T&&E){const e=H(M[0]);n.texStorage2D(t.TEXTURE_2D,C,S,e.width,e.height)}for(let e=0,i=M.length;e<i;e++)w=M[e],T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,v,w):n.texImage2D(t.TEXTURE_2D,e,S,f,v,w);o.generateMipmaps=!1}else if(T){if(E){const e=H(p);n.texStorage2D(t.TEXTURE_2D,C,S,e.width,e.height)}A&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,v,p)}else n.texImage2D(t.TEXTURE_2D,0,S,f,v,p);g(o)&&y(l),h.__version=u.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function D(e,r,o,l,c,u){const h=a.convert(o.format,o.colorSpace),d=a.convert(o.type),p=_(o.internalFormat,h,d,o.colorSpace),f=i.get(r),m=i.get(o);if(m.__renderTarget=r,!f.__hasExternalTextures){const e=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,e,i,r.depth,0,h,d,null):n.texImage2D(c,u,p,e,i,0,h,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),j(r)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,c,m.__webglTexture,0,U(r)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(t.FRAMEBUFFER,null)}function z(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer){const r=n.depthTexture,a=r&&r.isDepthTexture?r.type:null,o=x(n.stencilBuffer,a),l=n.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,c=U(n);j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,c,o,n.width,n.height):i?t.renderbufferStorageMultisample(t.RENDERBUFFER,c,o,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,o,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,e)}else{const e=n.textures;for(let r=0;r<e.length;r++){const o=e[r],l=a.convert(o.format,o.colorSpace),c=a.convert(o.type),u=_(o.internalFormat,l,c,o.colorSpace),h=U(n);i&&!1===j(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,h,u,n.width,n.height):j(n)?s.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,h,u,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,u,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function N(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const a=i.get(r.depthTexture);a.__renderTarget=r,a.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);const o=a.__webglTexture,l=U(r);if(r.depthTexture.format===Vc)j(r)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(r.depthTexture.format!==Hc)throw new Error("Unknown depthTexture format");j(r)?s.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}function O(e){const r=i.get(e),a=!0===e.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==e.depthTexture){const t=e.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),t){const e=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,t.removeEventListener("dispose",e)};t.addEventListener("dispose",e),r.__depthDisposeCallback=e}r.__boundDepthTexture=t}if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");const t=e.texture.mipmaps;t&&t.length>0?N(r.__webglFramebuffer[0],e):N(r.__webglFramebuffer,e)}else if(a){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=t.createRenderbuffer(),z(r.__webglDepthbuffer[i],e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,a=r.__webglDepthbuffer[i];t.bindRenderbuffer(t.RENDERBUFFER,a),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,a)}}else{const i=e.texture.mipmaps;if(i&&i.length>0?n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=t.createRenderbuffer(),z(r.__webglDepthbuffer,e,!1);else{const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,i),t.framebufferRenderbuffer(t.FRAMEBUFFER,n,t.RENDERBUFFER,i)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}const F=[],B=[];function U(t){return Math.min(r.maxSamples,t.samples)}function j(t){const n=i.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(t,e){const n=t.colorSpace,i=t.format,r=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==Ku&&n!==Xu&&(fd.getTransfer(n)===$u?i===jc&&r===Ec||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function H(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement?(c.width=t.naturalWidth||t.width,c.height=t.naturalHeight||t.height):"undefined"!==typeof VideoFrame&&t instanceof VideoFrame?(c.width=t.displayWidth,c.height=t.displayHeight):(c.width=t.width,c.height=t.height),c}this.allocateTextureUnit=function(){const t=T;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(e,r){const a=i.get(e);!1===e.isRenderTargetTexture&&e.version>0&&a.__version!==e.version?L(a,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,a.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const a=i.get(e);!1===e.isRenderTargetTexture&&e.version>0&&a.__version!==e.version?L(a,e,r):n.bindTexture(t.TEXTURE_3D,a.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,o){const s=i.get(e);e.version>0&&s.__version!==e.version?function(e,o,s){if(6!==o.image.length)return;const l=R(e,o),c=o.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+s);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(t.TEXTURE0+s);const e=fd.getPrimaries(fd.workingColorSpace),i=o.colorSpace===Xu?null:fd.getPrimaries(o.colorSpace),h=o.colorSpace===Xu||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=o.isCompressedTexture||o.image[0].isCompressedTexture,p=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?o.image[t].image:o.image[t]:m(o.image[t],!0,r.maxCubemapSize),f[t]=V(o,f[t]);const v=f[0],x=a.convert(o.format,o.colorSpace),w=a.convert(o.type),S=_(o.internalFormat,x,w,o.colorSpace),M=!0!==o.isVideoTexture,T=void 0===u.__version||!0===l,E=c.dataReady;let A,C=b(o,v);if(I(t.TEXTURE_CUBE_MAP,o),d){M&&T&&n.texStorage2D(t.TEXTURE_CUBE_MAP,C,S,v.width,v.height);for(let e=0;e<6;e++){A=f[e].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];o.format!==jc?null!==x?M?E&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,x,r.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,S,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,x,w,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,S,r.width,r.height,0,x,w,r.data)}}}else{if(A=o.mipmaps,M&&T){A.length>0&&C++;const e=H(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,C,S,e.width,e.height)}for(let e=0;e<6;e++)if(p){M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,x,w,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,f[e].width,f[e].height,0,x,w,f[e].data);for(let i=0;i<A.length;i++){const r=A[i].image[e].image;M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,x,w,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,S,r.width,r.height,0,x,w,r.data)}}else{M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,x,w,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,x,w,f[e]);for(let i=0;i<A.length;i++){const r=A[i];M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,x,w,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,S,x,w,r.image[e])}}}g(o)&&y(t.TEXTURE_CUBE_MAP),u.__version=c.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(s,e,o):n.bindTexture(t.TEXTURE_CUBE_MAP,s.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,n,r){const a=i.get(e);void 0!==n&&D(a.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&O(e)},this.setupRenderTarget=function(e){const r=e.texture,s=i.get(e),l=i.get(r);e.addEventListener("dispose",S);const c=e.textures,u=!0===e.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=t.createTexture()),l.__version=r.version,o.memory.textures++),u){s.__webglFramebuffer=[];for(let e=0;e<6;e++)if(r.mipmaps&&r.mipmaps.length>0){s.__webglFramebuffer[e]=[];for(let n=0;n<r.mipmaps.length;n++)s.__webglFramebuffer[e][n]=t.createFramebuffer()}else s.__webglFramebuffer[e]=t.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){s.__webglFramebuffer=[];for(let e=0;e<r.mipmaps.length;e++)s.__webglFramebuffer[e]=t.createFramebuffer()}else s.__webglFramebuffer=t.createFramebuffer();if(h)for(let e=0,n=c.length;e<n;e++){const n=i.get(c[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===j(e)){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];s.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const r=a.convert(i.format,i.colorSpace),o=a.convert(i.type),l=_(i.internalFormat,r,o,i.colorSpace,!0===e.isXRRenderTarget),u=U(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,u,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,s.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),z(s.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(u){n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),I(t.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)D(s.__webglFramebuffer[n][i],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else D(s.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&y(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,a=c.length;r<a;r++){const a=c[r],o=i.get(a);let l=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(l=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(l,o.__webglTexture),I(l,a),D(s.__webglFramebuffer,e,a,t.COLOR_ATTACHMENT0+r,l,0),g(a)&&y(l)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),I(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)D(s.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,i,n);else D(s.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0,i,0);g(r)&&y(i),n.unbindTexture()}e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(t){const e=t.textures;for(let r=0,a=e.length;r<a;r++){const a=e[r];if(g(a)){const e=v(t),r=i.get(a).__webglTexture;n.bindTexture(e,r),y(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===j(e)){const r=e.textures,a=e.width,o=e.height;let s=t.COLOR_BUFFER_BIT;const c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=i.get(e),h=r.length>1;if(h)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const d=e.texture.mipmaps;d&&d.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(s|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(s|=t.STENCIL_BUFFER_BIT)),h){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,a,o,0,0,a,o,s,t.NEAREST),!0===l&&(F.length=0,B.length=0,F.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&!1===e.resolveDepthBuffer&&(F.push(c),B.push(c),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,B)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,F))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),h)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,u.__webglColorRenderbuffer[e]);const a=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,a,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&l){const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=D,this.useMultisampledRTT=j}function mM(t,e){return{convert:function(n){let i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xu;const a=fd.getTransfer(r);if(n===Ec)return t.UNSIGNED_BYTE;if(n===Dc)return t.UNSIGNED_SHORT_4_4_4_4;if(n===zc)return t.UNSIGNED_SHORT_5_5_5_1;if(n===Oc)return t.UNSIGNED_INT_5_9_9_9_REV;if(n===Fc)return t.UNSIGNED_INT_10F_11F_11F_REV;if(n===Ac)return t.BYTE;if(n===Cc)return t.SHORT;if(n===Pc)return t.UNSIGNED_SHORT;if(n===Ic)return t.INT;if(n===Rc)return t.UNSIGNED_INT;if(n===kc)return t.FLOAT;if(n===Lc)return t.HALF_FLOAT;if(n===Bc)return t.ALPHA;if(n===Uc)return t.RGB;if(n===jc)return t.RGBA;if(n===Vc)return t.DEPTH_COMPONENT;if(n===Hc)return t.DEPTH_STENCIL;if(n===Gc)return t.RED;if(n===Wc)return t.RED_INTEGER;if(n===qc)return t.RG;if(n===Zc)return t.RG_INTEGER;if(n===Yc)return t.RGBA_INTEGER;if(n===Kc||n===Jc||n===$c||n===Qc)if(a===$u){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Kc)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Jc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===$c)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Qc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Kc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Jc)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===$c)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Qc)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===tu||n===eu||n===nu||n===iu){if(i=e.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===tu)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===eu)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===nu)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===iu)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===ru||n===au||n===ou){if(i=e.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===ru||n===au)return a===$u?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===ou)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===su||n===lu||n===cu||n===uu||n===hu||n===du||n===pu||n===fu||n===mu||n===gu||n===yu||n===vu||n===_u||n===xu){if(i=e.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===su)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===lu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===cu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===uu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===hu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===du)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===pu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===fu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===mu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===gu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===yu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===vu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===_u)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===xu)return a===$u?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===bu||n===wu||n===Su){if(i=e.get("EXT_texture_compression_bptc"),null===i)return null;if(n===bu)return a===$u?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===wu)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Su)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Mu||n===Tu||n===Eu||n===Au){if(i=e.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===Mu)return i.COMPRESSED_RED_RGTC1_EXT;if(n===Tu)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Eu)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Au)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Nc?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class gM{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e){if(null===this.texture){const n=new oy(t.texture);t.depthNear===e.depthNear&&t.depthFar===e.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,n=new Zf({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new Uf(new wv(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class yM extends Bh{constructor(t,e){super();const n=this;let i=null,r=1,a=null,o="local-floor",s=1,l=null,c=null,u=null,h=null,d=null,p=null;const f="undefined"!==typeof XRWebGLBinding,m=new gM,g={},y=e.getContextAttributes();let v=null,_=null;const x=[],b=[],w=new Jh;let S=null;const M=new $f;M.viewport=new Td;const T=new $f;T.viewport=new Td;const E=[M,T],A=new lx;let C=null,P=null;function I(t){const e=b.indexOf(t.inputSource);if(-1===e)return;const n=x[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||a),n.dispatchEvent({type:t.type,data:t.inputSource}))}function R(){i.removeEventListener("select",I),i.removeEventListener("selectstart",I),i.removeEventListener("selectend",I),i.removeEventListener("squeeze",I),i.removeEventListener("squeezestart",I),i.removeEventListener("squeezeend",I),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",k);for(let t=0;t<x.length;t++){const e=b[t];null!==e&&(b[t]=null,x[t].disconnect(e))}C=null,P=null,m.reset();for(const t in g)delete g[t];t.setRenderTarget(v),d=null,h=null,u=null,i=null,_=null,O.stop(),n.isPresenting=!1,t.setPixelRatio(S),t.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}function k(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=b.indexOf(n);i>=0&&(b[i]=null,x[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=b.indexOf(n);if(-1===i){for(let t=0;t<x.length;t++){if(t>=b.length){b.push(n),i=t;break}if(null===b[t]){b[t]=n,i=t;break}}if(-1===i)break}const r=x[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=x[t];return void 0===e&&(e=new am,x[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=x[t];return void 0===e&&(e=new am,x[t]=e),e.getGripSpace()},this.getHand=function(t){let e=x[t];return void 0===e&&(e=new am,x[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return null===u&&f&&(u=new XRWebGLBinding(i,e)),u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){v=t.getRenderTarget(),i.addEventListener("select",I),i.addEventListener("selectstart",I),i.addEventListener("selectend",I),i.addEventListener("squeeze",I),i.addEventListener("squeezestart",I),i.addEventListener("squeezeend",I),i.addEventListener("end",R),i.addEventListener("inputsourceschange",k),!0!==y.xrCompatible&&await e.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(w);if(f&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,a=null,o=null;y.depth&&(o=y.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=y.stencil?Hc:Vc,a=y.stencil?Nc:Rc);const s={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:r};u=this.getBinding(),h=u.createProjectionLayer(s),i.updateRenderState({layers:[h]}),t.setPixelRatio(1),t.setSize(h.textureWidth,h.textureHeight,!1),_=new Ad(h.textureWidth,h.textureHeight,{format:jc,type:Ec,depthTexture:new ay(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:y.stencil,colorSpace:t.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),_=new Ad(d.framebufferWidth,d.framebufferHeight,{format:jc,type:Ec,colorSpace:t.outputColorSpace,stencilBuffer:y.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}_.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await i.requestReferenceSpace(o),O.setContext(i),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const L=new Qh,D=new Qh;function z(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;let e=t.near,n=t.far;null!==m.texture&&(m.depthNear>0&&(e=m.depthNear),m.depthFar>0&&(n=m.depthFar)),A.near=T.near=M.near=e,A.far=T.far=M.far=n,C===A.near&&P===A.far||(i.updateRenderState({depthNear:A.near,depthFar:A.far}),C=A.near,P=A.far),A.layers.mask=6|t.layers.mask,M.layers.mask=3&A.layers.mask,T.layers.mask=5&A.layers.mask;const r=t.parent,a=A.cameras;z(A,r);for(let i=0;i<a.length;i++)z(a[i],r);2===a.length?function(t,e,n){L.setFromMatrixPosition(e.matrixWorld),D.setFromMatrixPosition(n.matrixWorld);const i=L.distanceTo(D),r=e.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=o*u,p=o*h,f=i/(-u+h),m=f*-u;if(e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),-1===r[10])t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const e=o+f,n=s+f,r=d-m,a=p+(i-m),u=l*s/n*e,h=c*s/n*e;t.projectionMatrix.makePerspective(r,a,u,h,e,n),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}}(A,M,T):A.projectionMatrix.copy(M.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Hh*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,A,r)},this.getCamera=function(){return A},this.getFoveation=function(){if(null!==h||null!==d)return s},this.setFoveation=function(t){s=t,null!==h&&(h.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(A)},this.getCameraTexture=function(t){return g[t]};let N=null;const O=new jb;O.setAnimationLoop(function(e,r){if(c=r.getViewerPose(l||a),p=r,null!==c){const e=c.views;null!==d&&(t.setRenderTargetFramebuffer(_,d.framebuffer),t.setRenderTarget(_));let r=!1;e.length!==A.cameras.length&&(A.cameras.length=0,r=!0);for(let n=0;n<e.length;n++){const i=e[n];let a=null;if(null!==d)a=d.getViewport(i);else{const e=u.getViewSubImage(h,i);a=e.viewport,0===n&&(t.setRenderTargetTextures(_,e.colorTexture,e.depthStencilTexture),t.setRenderTarget(_))}let o=E[n];void 0===o&&(o=new $f,o.layers.enable(n),o.viewport=new Td,E[n]=o),o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(i.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===n&&(A.matrix.copy(o.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale)),!0===r&&A.cameras.push(o)}const a=i.enabledFeatures;if(a&&a.includes("depth-sensing")&&"gpu-optimized"==i.depthUsage&&f){u=n.getBinding();const t=u.getDepthInformation(e[0]);t&&t.isValid&&t.texture&&m.init(t,i.renderState)}if(a&&a.includes("camera-access")&&f){t.state.unbindTexture(),u=n.getBinding();for(let t=0;t<e.length;t++){const n=e[t].camera;if(n){let t=g[n];t||(t=new oy,g[n]=t);const e=u.getCameraImage(n);t.sourceTexture=e}}}}for(let t=0;t<x.length;t++){const e=b[t],n=x[t];null!==e&&void 0!==n&&n.update(e,r,l||a)}N&&N(e,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null}),this.setAnimationLoop=function(t){N=t},this.dispose=function(){}}}const vM=new mp,_M=new ap;function xM(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map,n(i.map,t.mapTransform)),i.alphaMap&&(t.alphaMap.value=i.alphaMap,n(i.alphaMap,t.alphaMapTransform)),i.bumpMap&&(t.bumpMap.value=i.bumpMap,n(i.bumpMap,t.bumpMapTransform),t.bumpScale.value=i.bumpScale,i.side===dl&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,n(i.normalMap,t.normalMapTransform),t.normalScale.value.copy(i.normalScale),i.side===dl&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,n(i.displacementMap,t.displacementMapTransform),t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,t.emissiveMapTransform)),i.specularMap&&(t.specularMap.value=i.specularMap,n(i.specularMap,t.specularMapTransform)),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const r=e.get(i),a=r.envMap,o=r.envMapRotation;a&&(t.envMap.value=a,vM.copy(o),vM.x*=-1,vM.y*=-1,vM.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(vM.y*=-1,vM.z*=-1),t.envMapRotation.value.setFromMatrix4(_M.makeRotationFromEuler(vM)),t.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,t.lightMapTransform)),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,Wf(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,a,o,s){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===dl&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,s)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,a,o):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function bM(t,e,n,i){let r={},a={},o=[];const s=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(t,e,n,i){const r=t.value,a=e+"_"+n;if(void 0===i[a])return i[a]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const t=i[a];if("number"===typeof r||"boolean"===typeof r){if(t!==r)return i[a]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function c(t){const e={boundary:0,storage:0};return"number"===typeof t||"boolean"===typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function u(e){const n=e.target;n.removeEventListener("dispose",u);const i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;for(let a=0,o=e.length;a<o;a++){const t=Array.isArray(e[a])?e[a]:[e[a]];for(let e=0,r=t.length;e<r;e++){const r=t[e],a=Array.isArray(r.value)?r.value:[r.value];for(let t=0,e=a.length;t<e;t++){const e=c(a[t]),o=n%i,s=o%e.boundary,l=o+s;n+=s,0!==l&&i-l<e.storage&&(n+=i-l),r.__data=new Float32Array(e.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=e.storage}}}const r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<s;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,a=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,a),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=e.render.frame;a[n.id]!==f&&(!function(e){const n=r[e.id],i=e.uniforms,a=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let r=0,o=i.length;r<o;r++){const e=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=e.length;n<i;n++){const i=e[n];if(!0===l(i,r,n,a)){const e=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let a=0;a<n.length;a++){const o=n[a],s=c(o);"number"===typeof o||"boolean"===typeof o?(i.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+r,i.__data)):o.isMatrix3?(i.__data[0]=o.elements[0],i.__data[1]=o.elements[1],i.__data[2]=o.elements[2],i.__data[3]=0,i.__data[4]=o.elements[3],i.__data[5]=o.elements[4],i.__data[6]=o.elements[5],i.__data[7]=0,i.__data[8]=o.elements[6],i.__data[9]=o.elements[7],i.__data[10]=o.elements[8],i.__data[11]=0):(o.toArray(i.__data,r),r+=s.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,i.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);o=[],r={},a={}}}}class wM{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:e=ld(),context:n=null,depth:i=!0,stencil:r=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:h=!1}=t;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=a;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const y=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Jl,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const _=this;let x=!1;this._outputColorSpace=Yu;let b=0,w=0,S=null,M=-1,T=null;const E=new Td,A=new Td;let C=null;const P=new Jp(0);let I=0,R=e.width,k=e.height,L=1,D=null,z=null;const N=new Td(0,0,R,k),O=new Td(0,0,R,k);let F=!1;const B=new lg;let U=!1,j=!1;const V=new ap,H=new Qh,G=new Td,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function Z(){return null===S?L:1}let X,Y,K,J,$,Q,tt,et,nt,it,rt,at,ot,st,lt,ct,ut,ht,dt,pt,ft,mt,gt,yt,vt=n;function _t(t,n){return e.getContext(t,n)}try{const t={alpha:!0,depth:i,stencil:r,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r".concat(tl)),e.addEventListener("webglcontextlost",wt,!1),e.addEventListener("webglcontextrestored",St,!1),e.addEventListener("webglcontextcreationerror",Mt,!1),null===vt){const e="webgl2";if(vt=_t(e,t),null===vt)throw _t(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(dE){throw console.error("THREE.WebGLRenderer: "+dE.message),dE}function xt(){X=new _w(vt),X.init(),mt=new mM(vt,X),Y=new $b(vt,X,t,mt),K=new pM(vt,X),Y.reversedDepthBuffer&&h&&K.buffers.depth.setReversed(!0),J=new ww(vt),$=new tM,Q=new fM(vt,X,K,$,Y,mt,J),tt=new tw(_),et=new vw(_),nt=new Vb(vt),gt=new Kb(vt,nt),it=new xw(vt,nt,J,gt),rt=new Mw(vt,it,nt,J),dt=new Sw(vt,Y,Q),ct=new Qb($),at=new QS(_,tt,et,X,Y,gt,ct),ot=new xM(_,$),st=new rM,lt=new uM(X),ht=new Yb(_,tt,et,K,rt,d,s),ut=new hM(_,rt,Y),yt=new bM(vt,J,Y,K),pt=new Jb(vt,X,J),ft=new bw(vt,X,J),J.programs=at.programs,_.capabilities=Y,_.extensions=X,_.properties=$,_.renderLists=st,_.shadowMap=ut,_.state=K,_.info=J}xt();const bt=new yM(_,vt);function wt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const t=J.autoReset,e=ut.enabled,n=ut.autoUpdate,i=ut.needsUpdate,r=ut.type;xt(),J.autoReset=t,ut.enabled=e,ut.autoUpdate=n,ut.needsUpdate=i,ut.type=r}function Mt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Tt(t){const e=t.target;e.removeEventListener("dispose",Tt),function(t){(function(t){const e=$.get(t).programs;void 0!==e&&(e.forEach(function(t){at.releaseProgram(t)}),t.isShaderMaterial&&at.releaseShaderCache(t))})(t),$.remove(t)}(e)}function Et(t,e,n){!0===t.transparent&&t.side===pl&&!1===t.forceSinglePass?(t.side=dl,t.needsUpdate=!0,Nt(t,e,n),t.side=hl,t.needsUpdate=!0,Nt(t,e,n),t.side=pl):Nt(t,e,n)}this.xr=bt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(t){void 0!==t&&(L=t,this.setSize(R,k,!1))},this.getSize=function(t){return t.set(R,k)},this.setSize=function(t,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];bt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,k=n,e.width=Math.floor(t*L),e.height=Math.floor(n*L),!0===i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(R*L,k*L).floor()},this.setDrawingBufferSize=function(t,n,i){R=t,k=n,L=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(N)},this.setViewport=function(t,e,n,i){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,i),K.viewport(E.copy(N).multiplyScalar(L).round())},this.getScissor=function(t){return t.copy(O)},this.setScissor=function(t,e,n,i){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,n,i),K.scissor(A.copy(O).multiplyScalar(L).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(t){K.setScissorTest(F=t)},this.setOpaqueSort=function(t){D=t},this.setTransparentSort=function(t){z=t},this.getClearColor=function(t){return t.copy(ht.getClearColor())},this.setClearColor=function(){ht.setClearColor(...arguments)},this.getClearAlpha=function(){return ht.getClearAlpha()},this.setClearAlpha=function(){ht.setClearAlpha(...arguments)},this.clear=function(){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let t=!1;if(null!==S){const e=S.texture.format;t=e===Yc||e===Zc||e===Wc}if(t){const t=S.texture.type,e=t===Ec||t===Rc||t===Pc||t===Nc||t===Dc||t===zc,n=ht.getClearColor(),i=ht.getClearAlpha(),r=n.r,a=n.g,o=n.b;e?(p[0]=r,p[1]=a,p[2]=o,p[3]=i,vt.clearBufferuiv(vt.COLOR,0,p)):(f[0]=r,f[1]=a,f[2]=o,f[3]=i,vt.clearBufferiv(vt.COLOR,0,f))}else n|=vt.COLOR_BUFFER_BIT}t&&(n|=vt.DEPTH_BUFFER_BIT),e&&(n|=vt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),vt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",wt,!1),e.removeEventListener("webglcontextrestored",St,!1),e.removeEventListener("webglcontextcreationerror",Mt,!1),ht.dispose(),st.dispose(),lt.dispose(),$.dispose(),tt.dispose(),et.dispose(),rt.dispose(),gt.dispose(),yt.dispose(),at.dispose(),bt.dispose(),bt.removeEventListener("sessionstart",Ct),bt.removeEventListener("sessionend",Pt),It.stop()},this.renderBufferDirect=function(t,e,n,i,r,a){null===e&&(e=W);const o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(t,e,n,i,r){!0!==e.isScene&&(e=W);Q.resetTextureUnits();const a=e.fog,o=i.isMeshStandardMaterial?e.environment:null,s=null===S?_.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:Ku,l=(i.isMeshStandardMaterial?et:tt).get(i.envMap||o),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=Jl;i.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(f=_.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==m?m.length:0,v=$.get(i),x=g.state.lights;if(!0===U&&(!0===j||t!==T)){const e=t===T&&i.id===M;ct.setState(i,t,e)}let b=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==x.state.version||v.outputColorSpace!==s||r.isBatchedMesh&&!1===v.batching?b=!0:r.isBatchedMesh||!0!==v.batching?r.isBatchedMesh&&!0===v.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===v.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===v.instancing?b=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?b=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===v.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===v.instancingMorph&&null!==r.morphTexture||v.envMap!==l||!0===i.fog&&v.fog!==a?b=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===ct.numPlanes&&v.numIntersection===ct.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==y)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,v.__version=i.version);let w=v.currentProgram;!0===b&&(w=Nt(i,e,r));let E=!1,A=!1,C=!1;const P=w.getUniforms(),I=v.uniforms;K.useProgram(w.program)&&(E=!0,A=!0,C=!0);i.id!==M&&(M=i.id,A=!0);if(E||T!==t){K.buffers.depth.getReversed()&&!0!==t.reversedDepth&&(t._reversedDepth=!0,t.updateProjectionMatrix()),P.setValue(vt,"projectionMatrix",t.projectionMatrix),P.setValue(vt,"viewMatrix",t.matrixWorldInverse);const e=P.map.cameraPosition;void 0!==e&&e.setValue(vt,H.setFromMatrixPosition(t.matrixWorld)),Y.logarithmicDepthBuffer&&P.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,A=!0,C=!0)}if(r.isSkinnedMesh){P.setOptional(vt,r,"bindMatrix"),P.setOptional(vt,r,"bindMatrixInverse");const t=r.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(vt,"boneTexture",t.boneTexture,Q))}r.isBatchedMesh&&(P.setOptional(vt,r,"batchingTexture"),P.setValue(vt,"batchingTexture",r._matricesTexture,Q),P.setOptional(vt,r,"batchingIdTexture"),P.setValue(vt,"batchingIdTexture",r._indirectTexture,Q),P.setOptional(vt,r,"batchingColorTexture"),null!==r._colorsTexture&&P.setValue(vt,"batchingColorTexture",r._colorsTexture,Q));const R=n.morphAttributes;void 0===R.position&&void 0===R.normal&&void 0===R.color||dt.update(r,n,w);(A||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,P.setValue(vt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==e.environment&&(I.envMapIntensity.value=e.environmentIntensity);A&&(P.setValue(vt,"toneMappingExposure",_.toneMappingExposure),v.needsLights&&(z=C,(D=I).ambientLightColor.needsUpdate=z,D.lightProbe.needsUpdate=z,D.directionalLights.needsUpdate=z,D.directionalLightShadows.needsUpdate=z,D.pointLights.needsUpdate=z,D.pointLightShadows.needsUpdate=z,D.spotLights.needsUpdate=z,D.spotLightShadows.needsUpdate=z,D.rectAreaLights.needsUpdate=z,D.hemisphereLights.needsUpdate=z),a&&!0===i.fog&&ot.refreshFogUniforms(I,a),ot.refreshMaterialUniforms(I,i,L,k,g.state.transmissionRenderTarget[t.id]),PS.upload(vt,Ot(v),I,Q));var D,z;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(PS.upload(vt,Ot(v),I,Q),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&P.setValue(vt,"center",r.center);if(P.setValue(vt,"modelViewMatrix",r.modelViewMatrix),P.setValue(vt,"normalMatrix",r.normalMatrix),P.setValue(vt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];yt.update(n,w),yt.bind(n,w)}}return w}(t,e,n,i,r);K.setMaterial(i,o);let l=n.index,c=1;if(!0===i.wireframe){if(l=it.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==a&&(d=Math.max(d,a.start*c),p=Math.min(p,(a.start+a.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;gt.setup(r,i,s,n,l);let y=pt;if(null!==l&&(m=nt.get(l),y=ft,y.setIndex(m)),r.isMesh)!0===i.wireframe?(K.setLineWidth(i.wireframeLinewidth*Z()),y.setMode(vt.LINES)):y.setMode(vt.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),K.setLineWidth(t*Z()),r.isLineSegments?y.setMode(vt.LINES):r.isLineLoop?y.setMode(vt.LINE_LOOP):y.setMode(vt.LINE_STRIP)}else r.isPoints?y.setMode(vt.POINTS):r.isSprite&&y.setMode(vt.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)ud("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),y.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(X.get("WEBGL_multi_draw"))y.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const t=r._multiDrawStarts,e=r._multiDrawCounts,n=r._multiDrawCount,a=l?nt.get(l).bytesPerElement:1,o=$.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)o.setValue(vt,"_gl_DrawID",i),y.render(t[i]/a,e[i])}else if(r.isInstancedMesh)y.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);y.renderInstances(d,f,e)}else y.render(d,f)},this.compile=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=t),g=lt.get(n),g.init(e),v.push(g),n.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))}),t!==n&&t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(g.pushLight(t),t.castShadow&&g.pushShadow(t))}),g.setupLights();const i=new Set;return t.traverse(function(t){if(!(t.isMesh||t.isPoints||t.isLine||t.isSprite))return;const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const a=e[r];Et(a,n,t),i.add(a)}else Et(e,n,t),i.add(e)}),g=v.pop(),i},this.compileAsync=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.compile(t,e,n);return new Promise(e=>{function n(){i.forEach(function(t){$.get(t).currentProgram.isReady()&&i.delete(t)}),0!==i.size?setTimeout(n,10):e(t)}null!==X.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let At=null;function Ct(){It.stop()}function Pt(){It.start()}const It=new jb;function Rt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)g.pushLight(t),t.castShadow&&g.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){i&&G.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=rt.update(t),r=t.material;r.visible&&m.push(t,e,r,n,G.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||B.intersectsObject(t))){const e=rt.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)),G.applyMatrix4(t.matrixWorld).applyMatrix4(V)),Array.isArray(r)){const i=e.groups;for(let a=0,o=i.length;a<o;a++){const o=i[a],s=r[o.materialIndex];s&&s.visible&&m.push(t,e,s,n,G.z,o)}}else r.visible&&m.push(t,e,r,n,G.z,null)}const r=t.children;for(let a=0,o=r.length;a<o;a++)Rt(r[a],e,n,i)}function kt(t,e,n,i){const r=t.opaque,a=t.transmissive,o=t.transparent;g.setupLightsView(n),!0===U&&ct.setGlobalState(_.clippingPlanes,n),i&&K.viewport(E.copy(i)),r.length>0&&Dt(r,e,n),a.length>0&&Dt(a,e,n),o.length>0&&Dt(o,e,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Lt(t,e,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[i.id]&&(g.state.transmissionRenderTarget[i.id]=new Ad(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")||X.has("EXT_color_buffer_float")?Lc:Ec,minFilter:Mc,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:fd.workingColorSpace}));const a=g.state.transmissionRenderTarget[i.id],o=i.viewport||E;a.setSize(o.z*_.transmissionResolutionScale,o.w*_.transmissionResolutionScale);const s=_.getRenderTarget(),l=_.getActiveCubeFace(),c=_.getActiveMipmapLevel();_.setRenderTarget(a),_.getClearColor(P),I=_.getClearAlpha(),I<1&&_.setClearColor(16777215,.5),_.clear(),q&&ht.render(n);const u=_.toneMapping;_.toneMapping=Jl;const h=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),g.setupLightsView(i),!0===U&&ct.setGlobalState(_.clippingPlanes,i),Dt(t,n,i),Q.updateMultisampleRenderTarget(a),Q.updateRenderTargetMipmap(a),!1===X.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let r=0,a=e.length;r<a;r++){const a=e[r],o=a.object,s=a.geometry,l=a.material,c=a.group;if(l.side===pl&&o.layers.test(i.layers)){const e=l.side;l.side=dl,l.needsUpdate=!0,zt(o,n,i,s,l,c),l.side=e,l.needsUpdate=!0,t=!0}}!0===t&&(Q.updateMultisampleRenderTarget(a),Q.updateRenderTargetMipmap(a))}_.setRenderTarget(s,l,c),_.setClearColor(P,I),void 0!==h&&(i.viewport=h),_.toneMapping=u}function Dt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,a=t.length;r<a;r++){const a=t[r],o=a.object,s=a.geometry,l=a.group;let c=a.material;!0===c.allowOverride&&null!==i&&(c=i),o.layers.test(n.layers)&&zt(o,e,n,s,c,l)}}function zt(t,e,n,i,r,a){t.onBeforeRender(_,e,n,i,r,a),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(_,e,n,i,t,a),!0===r.transparent&&r.side===pl&&!1===r.forceSinglePass?(r.side=dl,r.needsUpdate=!0,_.renderBufferDirect(n,e,i,r,t,a),r.side=hl,r.needsUpdate=!0,_.renderBufferDirect(n,e,i,r,t,a),r.side=pl):_.renderBufferDirect(n,e,i,r,t,a),t.onAfterRender(_,e,n,i,r,a)}function Nt(t,e,n){!0!==e.isScene&&(e=W);const i=$.get(t),r=g.state.lights,a=g.state.shadowsArray,o=r.state.version,s=at.getParameters(t,r.state,a,e,n),l=at.getProgramCacheKey(s);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?et:tt).get(t.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===c&&(t.addEventListener("dispose",Tt),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ft(t,s),u}else s.uniforms=at.getUniforms(t),t.onBeforeCompile(s,_),u=at.acquireProgram(s,l),c.set(l,u),i.uniforms=s.uniforms;const h=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=ct.uniform),Ft(t,s),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Ot(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=PS.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Ft(t,e){const n=$.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.batchingColor=e.batchingColor,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}It.setAnimationLoop(function(t){At&&At(t)}),"undefined"!==typeof self&&It.setContext(self),this.setAnimationLoop=function(t){At=t,bt.setAnimationLoop(t),null===t?It.stop():It.start()},bt.addEventListener("sessionstart",Ct),bt.addEventListener("sessionend",Pt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===bt.enabled&&!0===bt.isPresenting&&(!0===bt.cameraAutoUpdate&&bt.updateCamera(e),e=bt.getCamera()),!0===t.isScene&&t.onBeforeRender(_,t,e,S),g=lt.get(t,v.length),g.init(e),v.push(g),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),B.setFromProjectionMatrix(V,Dh,e.reversedDepth),j=this.localClippingEnabled,U=ct.init(this.clippingPlanes,j),m=st.get(t,y.length),m.init(),y.push(m),!0===bt.enabled&&!0===bt.isPresenting){const t=_.xr.getDepthSensingMesh();null!==t&&Rt(t,e,-1/0,_.sortObjects)}Rt(t,e,0,_.sortObjects),m.finish(),!0===_.sortObjects&&m.sort(D,z),q=!1===bt.enabled||!1===bt.isPresenting||!1===bt.hasDepthSensing(),q&&ht.addToRenderList(m,t),this.info.render.frame++,!0===U&&ct.beginShadows();const n=g.state.shadowsArray;ut.render(n,t,e),!0===U&&ct.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=m.opaque,r=m.transmissive;if(g.setupLights(),e.isArrayCamera){const n=e.cameras;if(r.length>0)for(let e=0,a=n.length;e<a;e++){Lt(i,r,t,n[e])}q&&ht.render(t);for(let e=0,i=n.length;e<i;e++){const i=n[e];kt(m,t,i,i.viewport)}}else r.length>0&&Lt(i,r,t,e),q&&ht.render(t),kt(m,t,e);null!==S&&0===w&&(Q.updateMultisampleRenderTarget(S),Q.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(_,t,e),gt.resetDefaultState(),M=-1,T=null,v.pop(),v.length>0?(g=v[v.length-1],!0===U&&ct.setGlobalState(_.clippingPlanes,g.state.camera)):g=null,y.pop(),m=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,n){const i=$.get(t);i.__autoAllocateDepthBuffer=!1===t.resolveDepthBuffer,!1===i.__autoAllocateDepthBuffer&&(i.__useRenderToTexture=!1),$.get(t.texture).__webglTexture=e,$.get(t.depthTexture).__webglTexture=i.__autoAllocateDepthBuffer?void 0:n,i.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(t,e){const n=$.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e};const Bt=vt.createFramebuffer();this.setRenderTarget=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;S=t,b=e,w=n;let i=!0,r=null,a=!1,o=!1;if(t){const s=$.get(t);if(void 0!==s.__useDefaultFramebuffer)K.bindFramebuffer(vt.FRAMEBUFFER,null),i=!1;else if(void 0===s.__webglFramebuffer)Q.setupRenderTarget(t);else if(s.__hasExternalTextures)Q.rebindTextures(t,$.get(t.texture).__webglTexture,$.get(t.depthTexture).__webglTexture);else if(t.depthBuffer){const e=t.depthTexture;if(s.__boundDepthTexture!==e){if(null!==e&&$.has(e)&&(t.width!==e.image.width||t.height!==e.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Q.setupDepthRenderbuffer(t)}}const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=$.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(c[e])?c[e][n]:c[e],a=!0):r=t.samples>0&&!1===Q.useMultisampledRTT(t)?$.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(t.viewport),A.copy(t.scissor),C=t.scissorTest}else E.copy(N).multiplyScalar(L).floor(),A.copy(O).multiplyScalar(L).floor(),C=F;0!==n&&(r=Bt);if(K.bindFramebuffer(vt.FRAMEBUFFER,r)&&i&&K.drawBuffers(t,r),K.viewport(E),K.scissor(A),K.setScissorTest(C),a){const i=$.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(o){const i=e;for(let e=0;e<t.textures.length;e++){const r=$.get(t.textures[e]);vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0+e,r.__webglTexture,n,i)}}else if(null!==t&&0!==n){const e=$.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_2D,e.__webglTexture,n)}M=-1},this.readRenderTargetPixels=function(t,e,n,i,r,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=$.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){K.bindFramebuffer(vt.FRAMEBUFFER,l);try{const o=t.textures[s],l=o.format,c=o.type;if(!Y.textureFormatReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&(t.textures.length>1&&vt.readBuffer(vt.COLOR_ATTACHMENT0+s),vt.readPixels(e,n,i,r,mt.convert(l),mt.convert(c),a))}finally{const t=null!==S?$.get(S).__webglFramebuffer:null;K.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,n,i,r,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=$.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){if(e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r){K.bindFramebuffer(vt.FRAMEBUFFER,l);const o=t.textures[s],c=o.format,u=o.type;if(!Y.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const h=vt.createBuffer();vt.bindBuffer(vt.PIXEL_PACK_BUFFER,h),vt.bufferData(vt.PIXEL_PACK_BUFFER,a.byteLength,vt.STREAM_READ),t.textures.length>1&&vt.readBuffer(vt.COLOR_ATTACHMENT0+s),vt.readPixels(e,n,i,r,mt.convert(c),mt.convert(u),0);const d=null!==S?$.get(S).__webglFramebuffer:null;K.bindFramebuffer(vt.FRAMEBUFFER,d);const p=vt.fenceSync(vt.SYNC_GPU_COMMANDS_COMPLETE,0);return vt.flush(),await function(t,e,n){return new Promise(function(i,r){setTimeout(function a(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:i()}},n)})}(vt,p,4),vt.bindBuffer(vt.PIXEL_PACK_BUFFER,h),vt.getBufferSubData(vt.PIXEL_PACK_BUFFER,0,a),vt.deleteBuffer(h),vt.deleteSync(p),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i),o=null!==e?e.x:0,s=null!==e?e.y:0;Q.setTexture2D(t,0),vt.copyTexSubImage2D(vt.TEXTURE_2D,n,0,0,o,s,r,a),K.unbindTexture()};const Ut=vt.createFramebuffer(),jt=vt.createFramebuffer();this.copyTextureToTexture=function(t,e){let n,i,r,a,o,s,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===f&&(0!==p?(ud("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),f=p,p=0):f=0);const m=t.isCompressedTexture?t.mipmaps[f]:t.image;if(null!==h)n=h.max.x-h.min.x,i=h.max.y-h.min.y,r=h.isBox3?h.max.z-h.min.z:1,a=h.min.x,o=h.min.y,s=h.isBox3?h.min.z:0;else{const e=Math.pow(2,-p);n=Math.floor(m.width*e),i=Math.floor(m.height*e),r=t.isDataArrayTexture?m.depth:t.isData3DTexture?Math.floor(m.depth*e):1,a=0,o=0,s=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const g=mt.convert(e.format),y=mt.convert(e.type);let v;e.isData3DTexture?(Q.setTexture3D(e,0),v=vt.TEXTURE_3D):e.isDataArrayTexture||e.isCompressedArrayTexture?(Q.setTexture2DArray(e,0),v=vt.TEXTURE_2D_ARRAY):(Q.setTexture2D(e,0),v=vt.TEXTURE_2D),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,e.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,e.unpackAlignment);const _=vt.getParameter(vt.UNPACK_ROW_LENGTH),x=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),b=vt.getParameter(vt.UNPACK_SKIP_PIXELS),w=vt.getParameter(vt.UNPACK_SKIP_ROWS),S=vt.getParameter(vt.UNPACK_SKIP_IMAGES);vt.pixelStorei(vt.UNPACK_ROW_LENGTH,m.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,m.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,a),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,o),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,s);const M=t.isDataArrayTexture||t.isData3DTexture,T=e.isDataArrayTexture||e.isData3DTexture;if(t.isDepthTexture){const h=$.get(t),d=$.get(e),m=$.get(h.__renderTarget),g=$.get(d.__renderTarget);K.bindFramebuffer(vt.READ_FRAMEBUFFER,m.__webglFramebuffer),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let y=0;y<r;y++)M&&(vt.framebufferTextureLayer(vt.READ_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,$.get(t).__webglTexture,p,s+y),vt.framebufferTextureLayer(vt.DRAW_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,$.get(e).__webglTexture,f,u+y)),vt.blitFramebuffer(a,o,n,i,l,c,n,i,vt.DEPTH_BUFFER_BIT,vt.NEAREST);K.bindFramebuffer(vt.READ_FRAMEBUFFER,null),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,null)}else if(0!==p||t.isRenderTargetTexture||$.has(t)){const h=$.get(t),d=$.get(e);K.bindFramebuffer(vt.READ_FRAMEBUFFER,Ut),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,jt);for(let t=0;t<r;t++)M?vt.framebufferTextureLayer(vt.READ_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,h.__webglTexture,p,s+t):vt.framebufferTexture2D(vt.READ_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_2D,h.__webglTexture,p),T?vt.framebufferTextureLayer(vt.DRAW_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,d.__webglTexture,f,u+t):vt.framebufferTexture2D(vt.DRAW_FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_2D,d.__webglTexture,f),0!==p?vt.blitFramebuffer(a,o,n,i,l,c,n,i,vt.COLOR_BUFFER_BIT,vt.NEAREST):T?vt.copyTexSubImage3D(v,f,l,c,u+t,a,o,n,i):vt.copyTexSubImage2D(v,f,l,c,a,o,n,i);K.bindFramebuffer(vt.READ_FRAMEBUFFER,null),K.bindFramebuffer(vt.DRAW_FRAMEBUFFER,null)}else T?t.isDataTexture||t.isData3DTexture?vt.texSubImage3D(v,f,l,c,u,n,i,r,g,y,m.data):e.isCompressedArrayTexture?vt.compressedTexSubImage3D(v,f,l,c,u,n,i,r,g,m.data):vt.texSubImage3D(v,f,l,c,u,n,i,r,g,y,m):t.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,f,l,c,n,i,g,y,m.data):t.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,f,l,c,m.width,m.height,g,m.data):vt.texSubImage2D(vt.TEXTURE_2D,f,l,c,n,i,g,y,m);vt.pixelStorei(vt.UNPACK_ROW_LENGTH,_),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,x),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,b),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,w),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,S),0===f&&e.generateMipmaps&&vt.generateMipmap(v),K.unbindTexture()},this.initRenderTarget=function(t){void 0===$.get(t).__webglFramebuffer&&Q.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?Q.setTextureCube(t,0):t.isData3DTexture?Q.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?Q.setTexture2DArray(t,0):Q.setTexture2D(t,0),K.unbindTexture()},this.resetState=function(){b=0,w=0,S=null,K.reset(),gt.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Dh}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=fd._getDrawingBufferColorSpace(t),e.unpackColorSpace=fd._getUnpackColorSpace()}}var SM=n(878);function MM(t){let e;const n=new Set,i=(t,i)=>{const r="function"===typeof t?t(e):t;if(r!==e){const t=e;e=i?r:Object.assign({},e,r),n.forEach(n=>n(e,t))}},r=()=>e,a={setState:i,getState:r,subscribe:(t,i,a)=>i||a?function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let o=i(e);function s(){const n=i(e);if(!a(o,n)){const e=o;t(o=n,e)}}return n.add(s),()=>n.delete(s)}(t,i,a):(n.add(t),()=>n.delete(t)),destroy:()=>n.clear()};return e=t(i,r,a),a}const TM="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function EM(t){const e="function"===typeof t?MM(t):t,n=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,r]=(0,i.useReducer)(t=>t+1,0),a=e.getState(),o=(0,i.useRef)(a),s=(0,i.useRef)(t),l=(0,i.useRef)(n),c=(0,i.useRef)(!1),u=(0,i.useRef)();let h;void 0===u.current&&(u.current=t(a));let d=!1;(o.current!==a||s.current!==t||l.current!==n||c.current)&&(h=t(a),d=!n(u.current,h)),TM(()=>{d&&(u.current=h),o.current=a,s.current=t,l.current=n,c.current=!1});const p=(0,i.useRef)(a);TM(()=>{const t=()=>{try{const t=e.getState(),n=s.current(t);l.current(u.current,n)||(o.current=t,u.current=n,r())}catch(dE){c.current=!0,r()}},n=e.subscribe(t);return e.getState()!==p.current&&t(),n},[]);const f=d?h:u.current;return(0,i.useDebugValue)(f),f};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const t=[n,e];return{next(){const e=t.length<=0;return{value:t.shift(),done:e}}}},n}const AM=[];function CM(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(t,e)=>t===e;if(t===e)return!0;if(!t||!e)return!1;const i=t.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!n(t[r],e[r]))return!1;return!0}function PM(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};null===e&&(e=[t]);for(const o of AM)if(CM(e,o.keys,o.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return i.lifespan&&i.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,i.lifespan)),o.response;if(!n)throw o.promise}const r={keys:e,equal:i.equal,remove:()=>{const t=AM.indexOf(r);-1!==t&&AM.splice(t,1)},promise:(a=t,"object"===typeof a&&"function"===typeof a.then?t:t(...e)).then(t=>{r.response=t,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(t=>r.error=t)};var a;if(AM.push(r),!n)throw r.promise}var IM=n(235),RM=n.n(IM),kM=n(340);const LM=["args","attach"],DM=["args","children"],zM=["args","children"],NM=["children","key","ref"],OM=["children","key","ref"],FM=["params"],BM=["events","size"];const UM={};var jM,VM;const HM=t=>"colorSpace"in t||"outputColorSpace"in t,GM=()=>{var t;return null!=(t=UM.ColorManagement)?t:null},WM=t=>t&&t.isOrthographicCamera,qM="undefined"!==typeof window&&(null!=(jM=window.document)&&jM.createElement||"ReactNative"===(null==(VM=window.navigator)?void 0:VM.product))?i.useLayoutEffect:i.useEffect;function ZM(t){const e=i.useRef(t);return qM(()=>{e.current=t},[t]),e}function XM(t){let{set:e}=t;return qM(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class YM extends i.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}YM.getDerivedStateFromError=()=>({error:!0});const KM="__default",JM=new Map,$M=t=>t&&!!t.memoized&&!!t.changes;function QM(t){var e;const n="undefined"!==typeof window?null!=(e=window.devicePixelRatio)?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const tT=t=>{var e;return null==(e=t.__r3f)?void 0:e.root.getState()};function eT(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const nT={obj:t=>t===Object(t)&&!nT.arr(t)&&"function"!==typeof t,fun:t=>"function"===typeof t,str:t=>"string"===typeof t,num:t=>"number"===typeof t,boo:t=>"boolean"===typeof t,und:t=>void 0===t,arr:t=>Array.isArray(t),equ(t,e){let{arrays:n="shallow",objects:i="reference",strict:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(typeof t!==typeof e||!!t!==!!e)return!1;if(nT.str(t)||nT.num(t)||nT.boo(t))return t===e;const a=nT.obj(t);if(a&&"reference"===i)return t===e;const o=nT.arr(t);if(o&&"reference"===n)return t===e;if((o||a)&&t===e)return!0;let s;for(s in t)if(!(s in e))return!1;if(a&&"shallow"===n&&"shallow"===i){for(s in r?e:t)if(!nT.equ(t[s],e[s],{strict:r,objects:"reference"}))return!1}else for(s in r?e:t)if(t[s]!==e[s])return!1;if(nT.und(s)){if(o&&0===t.length&&0===e.length)return!0;if(a&&0===Object.keys(t).length&&0===Object.keys(e).length)return!0;if(t!==e)return!1}return!0}};function iT(t){const e={nodes:{},materials:{}};return t&&t.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function rT(t,e){return t.__r3f=Dt({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},e),t}function aT(t,e){let n=t;if(e.includes("-")){const i=e.split("-"),r=i.pop();return n=i.reduce((t,e)=>t[e],t),{target:n,key:r}}return{target:n,key:e}}const oT=/-\d+$/;function sT(t,e,n){if(nT.str(n)){if(oT.test(n)){const e=n.replace(oT,""),{target:i,key:r}=aT(t,e);Array.isArray(i[r])||(i[r]=[])}const{target:i,key:r}=aT(t,n);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=n(t,e)}function lT(t,e,n){var i,r;if(nT.str(n)){const{target:i,key:r}=aT(t,n),a=e.__r3f.previousAttach;void 0===a?delete i[r]:i[r]=a}else null==(i=e.__r3f)||null==i.previousAttach||i.previousAttach(t,e);null==(r=e.__r3f)||delete r.previousAttach}function cT(t,e){let{children:n,key:i,ref:r}=e,a=Qe(e,NM),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{children:s,key:l,ref:c}=o,u=Qe(o,OM),h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=t.__r3f,p=Object.entries(a),f=[];if(h){const t=Object.keys(u);for(let e=0;e<t.length;e++)a.hasOwnProperty(t[e])||p.unshift([t[e],KM+"remove"])}p.forEach(e=>{let[n,i]=e;var r;if(null!=(r=t.__r3f)&&r.primitive&&"object"===n)return;if(nT.equ(i,u[n]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return f.push([n,i,!0,[]]);let o=[];n.includes("-")&&(o=n.split("-")),f.push([n,i,!1,o]);for(const t in a){const e=a[t];t.startsWith("".concat(n,"-"))&&f.push([t,e,!1,t.split("-")])}});const m=Dt({},a);return null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.args&&(m.args=d.memoizedProps.args),null!=d&&d.memoizedProps&&null!=d&&d.memoizedProps.attach&&(m.attach=d.memoizedProps.attach),{memoized:m,changes:f}}const uT="undefined"!==typeof process&&!1;function hT(t,e){var n;const i=t.__r3f,r=null==i?void 0:i.root,a=null==r||null==r.getState?void 0:r.getState(),{memoized:o,changes:s}=$M(e)?e:cT(t,e),l=null==i?void 0:i.eventCount;t.__r3f&&(t.__r3f.memoizedProps=o);for(let h=0;h<s.length;h++){let[e,n,r,o]=s[h];if(HM(t)){const t=3001,i="srgb",r="srgb-linear";"encoding"===e?(e="colorSpace",n=n===t?i:r):"outputEncoding"===e&&(e="outputColorSpace",n=n===t?i:r)}let l=t,d=l[e];if(o.length&&(d=o.reduce((t,e)=>t[e],t),!d||!d.set)){const[n,...i]=o.reverse();l=i.reverse().reduce((t,e)=>t[e],t),e=n}if(n===KM+"remove")if(l.constructor){let t=JM.get(l.constructor);t||(t=new l.constructor,JM.set(l.constructor,t)),n=t[e]}else n=0;if(r&&i)n?i.handlers[e]=n:delete i.handlers[e],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof gp)){if(Array.isArray(n))d.fromArray?d.fromArray(n):d.set(...n);else if(d.copy&&n&&n.constructor&&(uT?d.constructor.name===n.constructor.name:d.constructor===n.constructor))d.copy(n);else if(void 0!==n){var c;const t=null==(c=d)?void 0:c.isColor;!t&&d.setScalar?d.setScalar(n):d instanceof gp&&n instanceof gp?d.mask=n.mask:d.set(n),!GM()&&a&&!a.linear&&t&&d.convertSRGBToLinear()}}else{var u;if(l[e]=n,null!=(u=l[e])&&u.isTexture&&l[e].format===jc&&l[e].type===Ec&&a){const t=l[e];HM(t)&&HM(a.gl)?t.colorSpace=a.gl.outputColorSpace:t.encoding=a.gl.outputEncoding}}dT(t)}if(i&&i.parent&&t.raycast&&l!==i.eventCount){const e=eT(t).getState().internal,n=e.interaction.indexOf(t);n>-1&&e.interaction.splice(n,1),i.eventCount&&e.interaction.push(t)}return!(1===s.length&&"onUpdate"===s[0][0])&&s.length&&null!=(n=t.__r3f)&&n.parent&&pT(t),t}function dT(t){var e,n;const i=null==(e=t.__r3f)||null==(n=e.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function pT(t){null==t.onUpdate||t.onUpdate(t)}function fT(t,e){t.manual||(WM(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function mT(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function gT(t,e,n,i){const r=n.get(e);r&&(n.delete(e),0===n.size&&(t.delete(i),r.target.releasePointerCapture(i)))}function yT(t){function e(t){return t.filter(t=>["Move","Over","Enter","Out","Leave"].some(e=>{var n;return null==(n=t.__r3f)?void 0:n.handlers["onPointer"+e]}))}function n(e){const{internal:n}=t.getState();for(const t of n.hovered.values())if(!e.length||!e.find(e=>e.object===t.object&&e.index===t.index&&e.instanceId===t.instanceId)){const i=t.eventObject.__r3f,r=null==i?void 0:i.handlers;if(n.hovered.delete(mT(t)),null!=i&&i.eventCount){const n=Dt(Dt({},t),{},{intersections:e});null==r.onPointerOut||r.onPointerOut(n),null==r.onPointerLeave||r.onPointerLeave(n)}}}function i(t,e){for(let n=0;n<e.length;n++){const i=e[n].__r3f;null==i||null==i.handlers.onPointerMissed||i.handlers.onPointerMissed(t)}}return{handlePointer:function(r){switch(r){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return e=>{const{internal:i}=t.getState();"pointerId"in e&&i.capturedMap.has(e.pointerId)&&requestAnimationFrame(()=>{i.capturedMap.has(e.pointerId)&&(i.capturedMap.delete(e.pointerId),n([]))})}}return function(a){const{onPointerMissed:o,internal:s}=t.getState();s.lastEvent.current=a;const l="onPointerMove"===r,c="onClick"===r||"onContextMenu"===r||"onDoubleClick"===r,u=function(e,n){const i=t.getState(),r=new Set,a=[],o=n?n(i.internal.interaction):i.internal.interaction;for(let t=0;t<o.length;t++){const e=tT(o[t]);e&&(e.raycaster.camera=void 0)}i.previousRoot||null==i.events.compute||i.events.compute(e,i);let s=o.flatMap(function(t){const n=tT(t);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(e,n,null==(i=n.previousRoot)?void 0:i.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(t,!0):[]):[];var i}).sort((t,e)=>{const n=tT(t.object),i=tT(e.object);return n&&i&&i.events.priority-n.events.priority||t.distance-e.distance}).filter(t=>{const e=mT(t);return!r.has(e)&&(r.add(e),!0)});i.events.filter&&(s=i.events.filter(s,i));for(const t of s){let e=t.object;for(;e;){var l;null!=(l=e.__r3f)&&l.eventCount&&a.push(Dt(Dt({},t),{},{eventObject:e})),e=e.parent}}if("pointerId"in e&&i.internal.capturedMap.has(e.pointerId))for(let t of i.internal.capturedMap.get(e.pointerId).values())r.has(mT(t.intersection))||a.push(t.intersection);return a}(a,l?e:void 0),h=c?function(e){const{internal:n}=t.getState(),i=e.offsetX-n.initialClick[0],r=e.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(a):0;"onPointerDown"===r&&(s.initialClick=[a.offsetX,a.offsetY],s.initialHits=u.map(t=>t.eventObject)),c&&!u.length&&h<=2&&(i(a,s.interaction),o&&o(a)),l&&n(u),function(e,i,r,a){const o=t.getState();if(e.length){const t={stopped:!1};for(const s of e){const l=tT(s.object)||o,{raycaster:c,pointer:u,camera:h,internal:d}=l,p=new Qh(u.x,u.y,0).unproject(h),f=t=>{var e,n;return null!=(e=null==(n=d.capturedMap.get(t))?void 0:n.has(s.eventObject))&&e},m=t=>{const e={intersection:s,target:i.target};d.capturedMap.has(t)?d.capturedMap.get(t).set(s.eventObject,e):d.capturedMap.set(t,new Map([[s.eventObject,e]])),i.target.setPointerCapture(t)},g=t=>{const e=d.capturedMap.get(t);e&&gT(d.capturedMap,s.eventObject,e,t)};let y={};for(let t in i){let e=i[t];"function"!==typeof e&&(y[t]=e)}let v=Dt(Dt(Dt({},s),y),{},{pointer:u,intersections:e,stopped:t.stopped,delta:r,unprojectedPoint:p,ray:c.ray,camera:h,stopPropagation(){const r="pointerId"in i&&d.capturedMap.get(i.pointerId);(!r||r.has(s.eventObject))&&(v.stopped=t.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(t=>t.eventObject===s.eventObject))&&n([...e.slice(0,e.indexOf(s)),s])},target:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},currentTarget:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},nativeEvent:i});if(a(v),!0===t.stopped)break}}}(u,a,h,function(t){const e=t.eventObject,n=e.__r3f,o=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){const e=mT(t),n=s.hovered.get(e);n?n.stopped&&t.stopPropagation():(s.hovered.set(e,t),null==o.onPointerOver||o.onPointerOver(t),null==o.onPointerEnter||o.onPointerEnter(t))}null==o.onPointerMove||o.onPointerMove(t)}else{const n=o[r];n?c&&!s.initialHits.includes(e)||(i(a,s.interaction.filter(t=>!s.initialHits.includes(t))),n(t)):c&&s.initialHits.includes(e)&&i(a,s.interaction.filter(t=>!s.initialHits.includes(t)))}})}}}}const vT=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],_T=t=>!(null==t||!t.render),xT=i.createContext(null);let bT,wT=new Set,ST=new Set,MT=new Set;function TT(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function ET(t,e){switch(t){case"before":return TT(wT,e);case"after":return TT(ST,e);case"tail":return TT(MT,e)}}let AT,CT;function PT(t,e,n){let i=e.clock.getDelta();for("never"===e.frameloop&&"number"===typeof t&&(i=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),AT=e.internal.subscribers,bT=0;bT<AT.length;bT++)CT=AT[bT],CT.ref.current(CT.store.getState(),i,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),"always"===e.frameloop?1:e.internal.frames}function IT(){const t=i.useContext(xT);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function RT(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>t,e=arguments.length>1?arguments[1]:void 0;return IT()(t,e)}function kT(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=IT(),i=n.getState().internal.subscribe,r=ZM(t);return qM(()=>i(r,e,n),[e,i,n]),null}const LT=new WeakMap;function DT(t,e){return function(n){let i=LT.get(n);i||(i=new n,LT.set(n,i)),t&&t(i);for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return Promise.all(a.map(t=>new Promise((n,r)=>i.load(t,t=>{t.scene&&Object.assign(t,iT(t.scene)),n(t)},e,e=>r(new Error("Could not load ".concat(t,": ").concat(null==e?void 0:e.message)))))))}}function zT(t,e,n,i){const r=Array.isArray(e)?e:[e],a=((t,e,n)=>PM(t,e,!1,n))(DT(n,i),[t,...r],{equal:nT.equ});return Array.isArray(e)?a:a[0]}zT.preload=function(t,e,n){const i=Array.isArray(e)?e:[e];return((t,e,n)=>{PM(t,e,!0,n)})(DT(n),[t,...i])},zT.clear=function(t,e){return(t=>{if(void 0===t||0===t.length)AM.splice(0,AM.length);else{const e=AM.find(e=>CM(t,e.keys,e.equal));e&&e.remove()}})([t,...Array.isArray(e)?e:[e]])};const NT=new Map,{invalidate:OT,advance:FT}=function(t){let e,n,i,r=!1,a=!1;function o(s){n=requestAnimationFrame(o),r=!0,e=0,ET("before",s),a=!0;for(const n of t.values()){var l;i=n.store.getState(),!i.internal.active||!("always"===i.frameloop||i.internal.frames>0)||null!=(l=i.gl.xr)&&l.isPresenting||(e+=PT(s,i))}if(a=!1,ET("after",s),0===e)return ET("tail",s),r=!1,cancelAnimationFrame(n)}return{loop:o,invalidate:function e(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var s;if(!n)return t.forEach(t=>e(t.store.getState(),i));null!=(s=n.gl.xr)&&s.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=i>1?Math.min(60,n.internal.frames+i):a?2:1,r||(r=!0,requestAnimationFrame(o)))},advance:function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(n&&ET("before",e),i)PT(e,i,r);else for(const a of t.values())PT(e,a.store.getState());n&&ET("after",e)}}}(NT),{reconciler:BT,applyProps:UT}=function(t,e){function n(t,e,n){let i,{args:r=[],attach:a}=e,o=Qe(e,LM),s="".concat(t[0].toUpperCase()).concat(t.slice(1));if("primitive"===t){if(void 0===o.object)throw new Error("R3F: Primitives without 'object' are invalid!");i=rT(o.object,{type:t,root:n,attach:a,primitive:!0})}else{const e=UM[s];if(!e)throw new Error("R3F: ".concat(s," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively"));if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");i=rT(new e(...r),{type:t,root:n,attach:a,memoizedProps:{args:r}})}return void 0===i.__r3f.attach&&(i.isBufferGeometry?i.__r3f.attach="geometry":i.isMaterial&&(i.__r3f.attach="material")),"inject"!==s&&hT(i,o),i}function i(t,e){let n=!1;var i,r;e&&(null!=(i=e.__r3f)&&i.attach?sT(t,e,e.__r3f.attach):e.isObject3D&&t.isObject3D&&(t.add(e),n=!0),n||null==(r=t.__r3f)||r.objects.push(e),e.__r3f||rT(e,{}),e.__r3f.parent=t,pT(e),dT(e))}function r(t,e,n){let i=!1;if(e){var r,a;if(null!=(r=e.__r3f)&&r.attach)sT(t,e,e.__r3f.attach);else if(e.isObject3D&&t.isObject3D){e.parent=t,e.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:e});const r=t.children.filter(t=>t!==e),a=r.indexOf(n);t.children=[...r.slice(0,a),e,...r.slice(a)],i=!0}i||null==(a=t.__r3f)||a.objects.push(e),e.__r3f||rT(e,{}),e.__r3f.parent=t,pT(e),dT(e)}}function a(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&[...t].forEach(t=>o(e,t,n))}function o(t,e,n){if(e){var i,r,o;if(e.__r3f&&(e.__r3f.parent=null),null!=(i=t.__r3f)&&i.objects&&(t.__r3f.objects=t.__r3f.objects.filter(t=>t!==e)),null!=(r=e.__r3f)&&r.attach)lT(t,e,e.__r3f.attach);else if(e.isObject3D&&t.isObject3D){var s;t.remove(e),null!=(s=e.__r3f)&&s.root&&function(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(t=>t!==e),n.initialHits=n.initialHits.filter(t=>t!==e),n.hovered.forEach((t,i)=>{t.eventObject!==e&&t.object!==e||n.hovered.delete(i)}),n.capturedMap.forEach((t,i)=>{gT(n.capturedMap,e,t,i)})}(eT(e),e)}const c=null==(o=e.__r3f)?void 0:o.primitive,u=!c&&(void 0===n?null!==e.dispose:n);var l;if(!c)a(null==(l=e.__r3f)?void 0:l.objects,e,u),a(e.children,e,u);if(delete e.__r3f,u&&e.dispose&&"Scene"!==e.type){const t=()=>{try{e.dispose()}catch(HH){}};"undefined"===typeof IS_REACT_ACT_ENVIRONMENT?(0,kM.unstable_scheduleCallback)(kM.unstable_IdlePriority,t):t()}dT(t)}}const s=()=>{},l=RM()({createInstance:n,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,e)=>{if(!e)return;const n=t.getState().scene;n.__r3f&&(n.__r3f.root=t,i(n,e))},removeChildFromContainer:(t,e)=>{e&&o(t.getState().scene,e)},insertInContainerBefore:(t,e,n)=>{if(!e||!n)return;const i=t.getState().scene;i.__r3f&&r(i,e,n)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var e;const n=null!=(e=null==t?void 0:t.__r3f)?e:{};return Boolean(n.handlers)},prepareUpdate(t,e,n,i){var r;if((null!=(r=null==t?void 0:t.__r3f)?r:{}).primitive&&i.object&&i.object!==t)return[!0];{const{args:e=[],children:r}=i,a=Qe(i,DM),{args:o=[],children:s}=n,l=Qe(n,zM);if(!Array.isArray(e))throw new Error("R3F: the args prop must be an array!");if(e.some((t,e)=>t!==o[e]))return[!0];const c=cT(t,a,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(t,e,r,a,s,l){let[c,u]=e;c?function(t,e,r,a){var s;const l=null==(s=t.__r3f)?void 0:s.parent;if(!l)return;const c=n(e,r,t.__r3f.root);if(t.children){for(const e of t.children)e.__r3f&&i(c,e);t.children=t.children.filter(t=>!t.__r3f)}t.__r3f.objects.forEach(t=>i(c,t)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||o(l,t),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),i(l,c),c.raycast&&c.__r3f.eventCount&&eT(c).getState().internal.interaction.push(c);[a,a.alternate].forEach(t=>{null!==t&&(t.stateNode=c,t.ref&&("function"===typeof t.ref?t.ref(c):t.ref.current=c))})}(t,r,s,l):hT(t,u)},commitMount(t,e,n,i){var r;const a=null!=(r=t.__r3f)?r:{};t.raycast&&a.handlers&&a.eventCount&&eT(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>rT(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var e;const{attach:n,parent:i}=null!=(e=t.__r3f)?e:{};n&&i&&lT(i,t,n),t.isObject3D&&(t.visible=!1),dT(t)},unhideInstance(t,e){var n;const{attach:i,parent:r}=null!=(n=t.__r3f)?n:{};i&&r&&sT(r,t,i),(t.isObject3D&&null==e.visible||e.visible)&&(t.visible=!0),dT(t)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>e?e():SM.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!==typeof performance&&nT.fun(performance.now)?performance.now:nT.fun(Date.now)?Date.now:()=>0,scheduleTimeout:nT.fun(setTimeout)?setTimeout:void 0,cancelTimeout:nT.fun(clearTimeout)?clearTimeout:void 0});return{reconciler:l,applyProps:hT}}(0,function(){var t;const e="undefined"!==typeof self&&self||"undefined"!==typeof window&&window;if(!e)return SM.DefaultEventPriority;switch(null==(t=e.event)?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return SM.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return SM.ContinuousEventPriority;default:return SM.DefaultEventPriority}}),jT={objects:"shallow",strict:!1},VT=(t,e)=>{const n="function"===typeof t?t(e):t;return _T(n)?n:new wM(Dt({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0},t))};function HT(t){const e=NT.get(t),n=null==e?void 0:e.fiber,r=null==e?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const a="function"===typeof reportError?reportError:console.error,o=r||((t,e)=>{const n=EM((n,r)=>{const a=new Qh,o=new Qh,s=new Qh;function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size;const{width:i,height:l,top:c,left:u}=n,h=i/l;e.isVector3?s.copy(e):s.set(...e);const d=t.getWorldPosition(a).distanceTo(s);if(WM(t))return{width:i/t.zoom,height:l/t.zoom,top:c,left:u,factor:1,distance:d,aspect:h};{const e=t.fov*Math.PI/180,n=2*Math.tan(e/2)*d,r=n*(i/l);return{width:r,height:n,top:c,left:u,factor:i/r,distance:d,aspect:h}}}let c;const u=t=>n(e=>({performance:Dt(Dt({},e.performance),{},{current:t})})),h=new Jh,d={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return t(r(),e)},advance:(t,n)=>e(t,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new cx,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const t=r();c&&clearTimeout(c),t.performance.current!==t.performance.min&&u(t.performance.min),c=setTimeout(()=>u(r().performance.max),t.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:t=>n(e=>Dt(Dt({},e),{},{events:Dt(Dt({},e.events),t)})),setSize:(t,e,i,a,s)=>{const c=r().camera,u={width:t,height:e,top:a||0,left:s||0,updateStyle:i};n(t=>({size:u,viewport:Dt(Dt({},t.viewport),l(c,o,u))}))},setDpr:t=>n(e=>{const n=QM(t);return{viewport:Dt(Dt({},e.viewport),{},{dpr:n,initialDpr:e.viewport.initialDpr||n})}}),setFrameloop:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";const e=r().clock;e.stop(),e.elapsedTime=0,"never"!==t&&(e.start(),e.elapsedTime=0),n(()=>({frameloop:t}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(t,e,n)=>{const i=r().internal;return i.priority=i.priority+(e>0?1:0),i.subscribers.push({ref:t,priority:e,store:n}),i.subscribers=i.subscribers.sort((t,e)=>t.priority-e.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(e>0?1:0),n.subscribers=n.subscribers.filter(e=>e.ref!==t))}}}};return d}),r=n.getState();let a=r.size,o=r.viewport.dpr,s=r.camera;return n.subscribe(()=>{const{camera:t,size:e,viewport:i,gl:r,set:l}=n.getState();if(e.width!==a.width||e.height!==a.height||i.dpr!==o){var c;a=e,o=i.dpr,fT(t,e),r.setPixelRatio(i.dpr);const n=null!=(c=e.updateStyle)?c:"undefined"!==typeof HTMLCanvasElement&&r.domElement instanceof HTMLCanvasElement;r.setSize(e.width,e.height,n)}t!==s&&(s=t,l(e=>({viewport:Dt(Dt({},e.viewport),e.viewport.getCurrentViewport(t))})))}),n.subscribe(e=>t(e)),n})(OT,FT),s=n||BT.createContainer(o,SM.ConcurrentRoot,null,!1,null,"",a,null);let l;e||NT.set(t,{fiber:s,store:o});let c,u=!1;return{configure(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{gl:n,size:i,scene:r,events:a,onCreated:s,shadows:h=!1,linear:d=!1,flat:p=!1,legacy:f=!1,orthographic:m=!1,frameloop:g="always",dpr:y=[1,2],performance:v,raycaster:_,camera:x,onPointerMissed:b}=e,w=o.getState(),S=w.gl;w.gl||w.set({gl:S=VT(n,t)});let M=w.raycaster;M||w.set({raycaster:M=new Vx});const T=_||{},{params:E}=T,A=Qe(T,FM);if(nT.equ(A,M,jT)||UT(M,Dt({},A)),nT.equ(E,M.params,jT)||UT(M,{params:Dt(Dt({},M.params),E)}),!w.camera||w.camera===c&&!nT.equ(c,x,jT)){c=x;const t=x instanceof Xf,e=t?x:m?new F_(0,0,0,0,.1,1e3):new $f(75,0,.1,1e3);t||(e.position.z=5,x&&(UT(e,x),("aspect"in x||"left"in x||"right"in x||"bottom"in x||"top"in x)&&(e.manual=!0,e.updateProjectionMatrix())),w.camera||null!=x&&x.rotation||e.lookAt(0,0,0)),w.set({camera:e}),M.camera=e}if(!w.scene){let t;null!=r&&r.isScene?t=r:(t=new lm,r&&UT(t,r)),w.set({scene:rT(t)})}if(!w.xr){var C;const t=(t,e)=>{const n=o.getState();"never"!==n.frameloop&&FT(t,!0,n,e)},e=()=>{const e=o.getState();e.gl.xr.enabled=e.gl.xr.isPresenting,e.gl.xr.setAnimationLoop(e.gl.xr.isPresenting?t:null),e.gl.xr.isPresenting||OT(e)},n={connect(){const t=o.getState().gl;t.xr.addEventListener("sessionstart",e),t.xr.addEventListener("sessionend",e)},disconnect(){const t=o.getState().gl;t.xr.removeEventListener("sessionstart",e),t.xr.removeEventListener("sessionend",e)}};"function"===typeof(null==(C=S.xr)?void 0:C.addEventListener)&&n.connect(),w.set({xr:n})}if(S.shadowMap){const t=S.shadowMap.enabled,e=S.shadowMap.type;if(S.shadowMap.enabled=!!h,nT.boo(h))S.shadowMap.type=cl;else if(nT.str(h)){var P;const t={basic:sl,percentage:ll,soft:cl,variance:ul};S.shadowMap.type=null!=(P=t[h])?P:cl}else nT.obj(h)&&Object.assign(S.shadowMap,h);t===S.shadowMap.enabled&&e===S.shadowMap.type||(S.shadowMap.needsUpdate=!0)}const I=GM();if(I&&("enabled"in I?I.enabled=!f:"legacyMode"in I&&(I.legacyMode=f)),!u){UT(S,{outputEncoding:d?3e3:3001,toneMapping:p?Jl:ec})}w.legacy!==f&&w.set(()=>({legacy:f})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==p&&w.set(()=>({flat:p})),!n||nT.fun(n)||_T(n)||nT.equ(n,S,jT)||UT(S,n),a&&!w.events.handlers&&w.set({events:a(o)});const R=function(t,e){const n="undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement;if(e){const{width:t,height:i,top:r,left:a,updateStyle:o=n}=e;return{width:t,height:i,top:r,left:a,updateStyle:o}}if("undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:e,height:i,top:r,left:a}=t.parentElement.getBoundingClientRect();return{width:e,height:i,top:r,left:a,updateStyle:n}}return"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas?{width:t.width,height:t.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(t,i);return nT.equ(R,w.size,jT)||w.setSize(R.width,R.height,R.updateStyle,R.top,R.left),y&&w.viewport.dpr!==QM(y)&&w.setDpr(y),w.frameloop!==g&&w.setFrameloop(g),w.onPointerMissed||w.set({onPointerMissed:b}),v&&!nT.equ(v,w.performance,jT)&&w.set(t=>({performance:Dt(Dt({},t.performance),v)})),l=s,u=!0,this},render(e){return u||this.configure(),BT.updateContainer((0,zt.jsx)(GT,{store:o,children:e,onCreated:l,rootElement:t}),s,null,()=>{}),o},unmount(){WT(t)}}}function GT(t){let{store:e,children:n,onCreated:i,rootElement:r}=t;return qM(()=>{const t=e.getState();t.set(t=>({internal:Dt(Dt({},t.internal),{},{active:!0})})),i&&i(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)},[]),(0,zt.jsx)(xT.Provider,{value:e,children:n})}function WT(t,e){const n=NT.get(t),i=null==n?void 0:n.fiber;if(i){const r=null==n?void 0:n.store.getState();r&&(r.internal.active=!1),BT.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var n,i,a,o;null==r.events.disconnect||r.events.disconnect(),null==(n=r.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(a=r.gl)||null==a.forceContextLoss||a.forceContextLoss(),null!=(o=r.gl)&&o.xr&&r.xr.disconnect(),function(t){t.dispose&&"Scene"!==t.type&&t.dispose();for(const e in t)null==e.dispose||e.dispose(),delete t[e]}(r),NT.delete(t),e&&e(t)}catch(HH){}},500)})}}function qT(t){let{state:e={},children:n,container:r}=t;const{events:a,size:o}=e,s=Qe(e,BM),l=IT(),[c]=i.useState(()=>new Vx),[u]=i.useState(()=>new Jh),h=i.useCallback((t,e)=>{const n=Dt({},t);let i;if(Object.keys(t).forEach(i=>{(vT.includes(i)||t[i]!==e[i]&&e[i])&&delete n[i]}),e&&o){const n=e.camera;i=t.viewport.getCurrentViewport(n,new Qh,o),n!==t.camera&&fT(n,o)}return Dt(Dt({},n),{},{scene:r,raycaster:c,pointer:u,mouse:u,previousRoot:l,events:Dt(Dt(Dt({},t.events),null==e?void 0:e.events),a),size:Dt(Dt({},t.size),o),viewport:Dt(Dt({},t.viewport),i)},s)},[e]),[d]=i.useState(()=>{const t=l.getState(),e=EM((e,n)=>Dt(Dt(Dt({},t),{},{scene:r,raycaster:c,pointer:u,mouse:u,previousRoot:l,events:Dt(Dt({},t.events),a),size:Dt(Dt({},t.size),o)},s),{},{set:e,get:n,setEvents:t=>e(e=>Dt(Dt({},e),{},{events:Dt(Dt({},e.events),t)}))}));return e});return i.useEffect(()=>{const t=l.subscribe(t=>d.setState(e=>h(t,e)));return()=>{t()}},[h]),i.useEffect(()=>{d.setState(t=>h(l.getState(),t))},[h]),i.useEffect(()=>()=>{d.destroy()},[]),(0,zt.jsx)(zt.Fragment,{children:BT.createPortal((0,zt.jsx)(xT.Provider,{value:d,children:n}),d,null)})}BT.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:i.version});i.unstable_act;const ZT={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function XT(t){const{handlePointer:e}=yT(t);return{priority:1,enabled:!0,compute(t,e,n){e.pointer.set(t.offsetX/e.size.width*2-1,-t.offsetY/e.size.height*2+1),e.raycaster.setFromCamera(e.pointer,e.camera)},connected:void 0,handlers:Object.keys(ZT).reduce((t,n)=>Dt(Dt({},t),{},{[n]:e(n)}),{}),update:()=>{var e;const{events:n,internal:i}=t.getState();null!=(e=i.lastEvent)&&e.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:e=>{var n;const{set:i,events:r}=t.getState();null==r.disconnect||r.disconnect(),i(t=>({events:Dt(Dt({},t.events),{},{connected:e})})),Object.entries(null!=(n=r.handlers)?n:[]).forEach(t=>{let[n,i]=t;const[r,a]=ZT[n];e.addEventListener(r,i,{passive:a})})},disconnect:()=>{const{set:e,events:n}=t.getState();var i;n.connected&&(Object.entries(null!=(i=n.handlers)?i:[]).forEach(t=>{let[e,i]=t;if(n&&n.connected instanceof HTMLElement){const[t]=ZT[e];n.connected.removeEventListener(t,i)}}),e(t=>({events:Dt(Dt({},t.events),{},{connected:void 0})})))}}}function YT(t,e){let n;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function KT(){let{debounce:t,scroll:e,polyfill:n,offsetSize:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debounce:0,scroll:!1,offsetSize:!1};const a=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,s]=(0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),c=t?"number"==typeof t?t:t.scroll:null,u=t?"number"==typeof t?t:t.resize:null,h=(0,i.useRef)(!1);(0,i.useEffect)(()=>(h.current=!0,()=>{h.current=!1}));const[d,p,f]=(0,i.useMemo)(()=>{const t=()=>{if(!l.current.element)return;const{left:t,top:e,width:n,height:i,bottom:a,right:o,x:c,y:u}=l.current.element.getBoundingClientRect(),d={left:t,top:e,width:n,height:i,bottom:a,right:o,x:c,y:u};l.current.element instanceof HTMLElement&&r&&(d.height=l.current.element.offsetHeight,d.width=l.current.element.offsetWidth),Object.freeze(d),h.current&&!QT(l.current.lastBounds,d)&&s(l.current.lastBounds=d)};return[t,u?YT(t,u):t,c?YT(t,c):t]},[s,r,c,u]);function m(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(t=>t.removeEventListener("scroll",f,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null),l.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",l.current.orientationHandler))}function g(){l.current.element&&(l.current.resizeObserver=new a(f),l.current.resizeObserver.observe(l.current.element),e&&l.current.scrollContainers&&l.current.scrollContainers.forEach(t=>t.addEventListener("scroll",f,{capture:!0,passive:!0})),l.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",l.current.orientationHandler))}return function(t,e){(0,i.useEffect)(()=>{if(e){const e=t;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}},[t,e])}(f,!!e),function(t){(0,i.useEffect)(()=>{const e=t;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[t])}(p),(0,i.useEffect)(()=>{m(),g()},[e,f,p]),(0,i.useEffect)(()=>m,[]),[t=>{!t||t===l.current.element||(m(),l.current.element=t,l.current.scrollContainers=JT(t),g())},o,d]}function JT(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:i,overflowY:r}=window.getComputedStyle(t);return[n,i,r].some(t=>"auto"===t||"scroll"===t)&&e.push(t),[...e,...JT(t.parentElement)]}const $T=["x","y","top","bottom","left","right","width","height"],QT=(t,e)=>$T.every(n=>t[n]===e[n]);var tE,eE,nE=Object.defineProperty,iE=Object.defineProperties,rE=Object.getOwnPropertyDescriptors,aE=Object.getOwnPropertySymbols,oE=Object.prototype.hasOwnProperty,sE=Object.prototype.propertyIsEnumerable,lE=(t,e,n)=>e in t?nE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,cE=(t,e)=>{for(var n in e||(e={}))oE.call(e,n)&&lE(t,n,e[n]);if(aE)for(var n of aE(e))sE.call(e,n)&&lE(t,n,e[n]);return t};"undefined"===typeof window||!(null==(tE=window.document)?void 0:tE.createElement)&&"ReactNative"!==(null==(eE=window.navigator)?void 0:eE.product)?i.useEffect:i.useLayoutEffect;function uE(t,e,n){if(!t)return;if(!0===n(t))return t;let i=e?t.return:t.child;for(;i;){const t=uE(i,e,n);if(t)return t;i=e?null:i.sibling}}function hE(t){try{return Object.defineProperties(t,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(Gj){return t}}const dE=console.error;console.error=function(){const t=[...arguments].join("");if(!(null==t?void 0:t.startsWith("Warning:"))||!t.includes("useContext"))return dE.apply(this,arguments);console.error=dE};const pE=hE(i.createContext(null));class fE extends i.Component{render(){return i.createElement(pE.Provider,{value:this._reactInternals},this.props.children)}}function mE(){const t=i.useContext(pE);if(null===t)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=i.useId();return i.useMemo(()=>{for(const n of[t,null==t?void 0:t.alternate]){if(!n)continue;const t=uE(n,!1,t=>{let n=t.memoizedState;for(;n;){if(n.memoizedState===e)return!0;n=n.next}});if(t)return t}},[t,e])}function gE(){const t=function(){const t=mE(),[e]=i.useState(()=>new Map);e.clear();let n=t;for(;n;){if(n.type&&"object"===typeof n.type){const t=void 0===n.type._context&&n.type.Provider===n.type?n.type:n.type._context;t&&t!==pE&&!e.has(t)&&e.set(t,i.useContext(hE(t)))}n=n.return}return e}();return i.useMemo(()=>Array.from(t.keys()).reduce((e,n)=>r=>i.createElement(e,null,i.createElement(n.Provider,((t,e)=>iE(t,rE(e)))(cE({},r),{value:t.get(n)}))),t=>i.createElement(fE,cE({},t))),[t])}const yE=["children","fallback","resize","style","gl","events","eventSource","eventPrefix","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","scene","onPointerMissed","onCreated"],vE=i.forwardRef(function(e,n){let{children:r,fallback:a,resize:o,style:s,gl:l,events:c=XT,eventSource:u,eventPrefix:h,shadows:d,linear:p,flat:f,legacy:m,orthographic:g,frameloop:y,dpr:v,performance:_,raycaster:x,camera:b,scene:w,onPointerMissed:S,onCreated:M}=e,T=Qe(e,yE);i.useMemo(()=>{return e=t,void Object.assign(UM,e);var e},[]);const E=gE(),[A,C]=KT(Dt({scroll:!0,debounce:{scroll:50,resize:0}},o)),P=i.useRef(null),I=i.useRef(null);i.useImperativeHandle(n,()=>P.current);const R=ZM(S),[k,L]=i.useState(!1),[D,z]=i.useState(!1);if(k)throw k;if(D)throw D;const N=i.useRef(null);qM(()=>{const t=P.current;C.width>0&&C.height>0&&t&&(N.current||(N.current=HT(t)),N.current.configure({gl:l,events:c,shadows:d,linear:p,flat:f,legacy:m,orthographic:g,frameloop:y,dpr:v,performance:_,raycaster:x,camera:b,scene:w,size:C,onPointerMissed:function(){return null==R.current?void 0:R.current(...arguments)},onCreated:t=>{var e;null==t.events.connect||t.events.connect(u?(e=u)&&e.hasOwnProperty("current")?u.current:u:I.current),h&&t.setEvents({compute:(t,e)=>{const n=t[h+"X"],i=t[h+"Y"];e.pointer.set(n/e.size.width*2-1,-i/e.size.height*2+1),e.raycaster.setFromCamera(e.pointer,e.camera)}}),null==M||M(t)}}),N.current.render((0,zt.jsx)(E,{children:(0,zt.jsx)(YM,{set:z,children:(0,zt.jsx)(i.Suspense,{fallback:(0,zt.jsx)(XM,{set:L}),children:null!=r?r:null})})})))}),i.useEffect(()=>{const t=P.current;if(t)return()=>WT(t)},[]);const O=u?"none":"auto";return(0,zt.jsx)("div",Dt(Dt({ref:I,style:Dt({position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:O},s)},T),{},{children:(0,zt.jsx)("div",{ref:A,style:{width:"100%",height:"100%"},children:(0,zt.jsx)("canvas",{ref:P,style:{display:"block"},children:a})})}))}),_E=i.forwardRef(function(t,e){return(0,zt.jsx)(fE,{children:(0,zt.jsx)(vE,Dt(Dt({},t),{},{ref:e}))})});function xE(){return xE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},xE.apply(null,arguments)}const bE=["args","children"];function wE(t,e){const n=t+"Geometry";return i.forwardRef((t,r)=>{let{args:a,children:o}=t,s=Qe(t,bE);const l=i.useRef(null);return i.useImperativeHandle(r,()=>l.current),i.useLayoutEffect(()=>{null==e||e(l.current)}),i.createElement("mesh",xE({ref:l},s),i.createElement(n,{attach:"geometry",args:a}),o)})}const SE=wE("sphere");var ME=Object.defineProperty,TE=(t,e,n)=>(((t,e,n)=>{e in t?ME(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!==typeof e?e+"":e,n),n);function EE(t,e,n,i,r){let a;if(t=t.subarray||t.slice?t:t.buffer,n=n.subarray||n.slice?n:n.buffer,t=e?t.subarray?t.subarray(e,r&&e+r):t.slice(e,r&&e+r):t,n.set)n.set(t,i);else for(a=0;a<t.length;a++)n[a+i]=t[a];return n}class AE extends Cf{constructor(){super(),TE(this,"type","MeshLine"),TE(this,"isMeshLine",!0),TE(this,"positions",[]),TE(this,"previous",[]),TE(this,"next",[]),TE(this,"side",[]),TE(this,"width",[]),TE(this,"indices_array",[]),TE(this,"uvs",[]),TE(this,"counters",[]),TE(this,"widthCallback",null),TE(this,"_attributes"),TE(this,"_points",[]),TE(this,"points"),TE(this,"matrixWorld",new ap),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(t){this.setPoints(t,this.widthCallback)}}})}setMatrixWorld(t){this.matrixWorld=t}setPoints(t,e){if(t=function(t){return t instanceof Float32Array?t:t instanceof Cf?t.getAttribute("position").array:t.map(t=>{const e=Array.isArray(t);return t instanceof Qh?[t.x,t.y,t.z]:t instanceof Jh?[t.x,t.y,0]:e&&3===t.length?[t[0],t[1],t[2]]:e&&2===t.length?[t[0],t[1],0]:t}).flat()}(t),this._points=t,this.widthCallback=null!=e?e:null,this.positions=[],this.counters=[],t.length&&t[0]instanceof Qh)for(let n=0;n<t.length;n++){const e=t[n],i=n/(t.length-1);this.positions.push(e.x,e.y,e.z),this.positions.push(e.x,e.y,e.z),this.counters.push(i),this.counters.push(i)}else for(let n=0;n<t.length;n+=3){const e=n/(t.length-1);this.positions.push(t[n],t[n+1],t[n+2]),this.positions.push(t[n],t[n+1],t[n+2]),this.counters.push(e),this.counters.push(e)}this.process()}compareV3(t,e){const n=6*t,i=6*e;return this.positions[n]===this.positions[i]&&this.positions[n+1]===this.positions[i+1]&&this.positions[n+2]===this.positions[i+2]}copyV3(t){const e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]}process(){const t=this.positions.length/6;let e,n;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],n=this.compareV3(0,t-1)?this.copyV3(t-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let i=0;i<t;i++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(t-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(t-1),0),this.uvs.push(i/(t-1),1),i<t-1){n=this.copyV3(i),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);const t=2*i;this.indices_array.push(t,t+1,t+2),this.indices_array.push(t+2,t+1,t+3)}i>0&&(n=this.copyV3(i),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]))}n=this.compareV3(t-1,0)?this.copyV3(1):this.copyV3(t-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new hf(new Float32Array(this.positions),3),previous:new hf(new Float32Array(this.previous),3),next:new hf(new Float32Array(this.next),3),side:new hf(new Float32Array(this.side),1),width:new hf(new Float32Array(this.width),1),uv:new hf(new Float32Array(this.uvs),2),index:new hf(new Uint16Array(this.indices_array),1),counters:new hf(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance(t){let{x:e,y:n,z:i}=t;const r=this._attributes.position.array,a=this._attributes.previous.array,o=this._attributes.next.array,s=r.length;EE(r,0,a,0,s),EE(r,6,r,0,s-6),r[s-6]=e,r[s-5]=n,r[s-4]=i,r[s-3]=e,r[s-2]=n,r[s-1]=i,EE(r,6,o,0,s-6),o[s-6]=e,o[s-5]=n,o[s-4]=i,o[s-3]=e,o[s-2]=n,o[s-1]=i,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const CE="\n  #include <fog_pars_fragment>\n  #include <logdepthbuf_pars_fragment>\n  #include <clipping_planes_pars_fragment>\n  \n  uniform sampler2D map;\n  uniform sampler2D alphaMap;\n  uniform float useGradient;\n  uniform float useMap;\n  uniform float useAlphaMap;\n  uniform float useDash;\n  uniform float dashArray;\n  uniform float dashOffset;\n  uniform float dashRatio;\n  uniform float visibility;\n  uniform float alphaTest;\n  uniform vec2 repeat;\n  uniform vec3 gradient[2];\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  void main() {\n    #include <logdepthbuf_fragment>\n    vec4 diffuseColor = vColor;\n    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);\n    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);\n    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;\n    if (diffuseColor.a < alphaTest) discard;\n    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));\n    diffuseColor.a *= step(vCounters, visibility);\n    #include <clipping_planes_fragment>\n    gl_FragColor = diffuseColor;     \n    #include <fog_fragment>\n    #include <tonemapping_fragment>\n    #include <".concat((()=>parseInt(tl.replace(/\D+/g,"")))()>=154?"colorspace_fragment":"encodings_fragment",">\n  }\n");class PE extends Zf{constructor(t){super({uniforms:Dt(Dt({},Gb.fog),{},{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new Jp(16777215)},gradient:{value:[new Jp(16711680),new Jp(65280)]},opacity:{value:1},resolution:{value:new Jh(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Jh(1,1)}}),vertexShader:"\n  #include <common>\n  #include <logdepthbuf_pars_vertex>\n  #include <fog_pars_vertex>\n  #include <clipping_planes_pars_vertex>\n\n  attribute vec3 previous;\n  attribute vec3 next;\n  attribute float side;\n  attribute float width;\n  attribute float counters;\n  \n  uniform vec2 resolution;\n  uniform float lineWidth;\n  uniform vec3 color;\n  uniform float opacity;\n  uniform float sizeAttenuation;\n  \n  varying vec2 vUV;\n  varying vec4 vColor;\n  varying float vCounters;\n  \n  vec2 fix(vec4 i, float aspect) {\n    vec2 res = i.xy / i.w;\n    res.x *= aspect;\n    return res;\n  }\n  \n  void main() {\n    float aspect = resolution.x / resolution.y;\n    vColor = vec4(color, opacity);\n    vUV = uv;\n    vCounters = counters;\n  \n    mat4 m = projectionMatrix * modelViewMatrix;\n    vec4 finalPosition = m * vec4(position, 1.0) * aspect;\n    vec4 prevPos = m * vec4(previous, 1.0);\n    vec4 nextPos = m * vec4(next, 1.0);\n  \n    vec2 currentP = fix(finalPosition, aspect);\n    vec2 prevP = fix(prevPos, aspect);\n    vec2 nextP = fix(nextPos, aspect);\n  \n    float w = lineWidth * width;\n  \n    vec2 dir;\n    if (nextP == currentP) dir = normalize(currentP - prevP);\n    else if (prevP == currentP) dir = normalize(nextP - currentP);\n    else {\n      vec2 dir1 = normalize(currentP - prevP);\n      vec2 dir2 = normalize(nextP - currentP);\n      dir = normalize(dir1 + dir2);\n  \n      vec2 perp = vec2(-dir1.y, dir1.x);\n      vec2 miter = vec2(-dir.y, dir.x);\n      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);\n    }\n  \n    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;\n    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);\n    normal.xy *= .5 * w;\n    //normal *= projectionMatrix;\n    if (sizeAttenuation == 0.) {\n      normal.xy *= finalPosition.w;\n      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;\n    }\n  \n    finalPosition.xy += normal.xy * side;\n    gl_Position = finalPosition;\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    #include <clipping_planes_vertex>\n    #include <fog_vertex>\n  }\n",fragmentShader:CE}),TE(this,"lineWidth"),TE(this,"map"),TE(this,"useMap"),TE(this,"alphaMap"),TE(this,"useAlphaMap"),TE(this,"color"),TE(this,"gradient"),TE(this,"resolution"),TE(this,"sizeAttenuation"),TE(this,"dashArray"),TE(this,"dashOffset"),TE(this,"dashRatio"),TE(this,"useDash"),TE(this,"useGradient"),TE(this,"visibility"),TE(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(t){this.uniforms.color.value=t}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(t){this.uniforms.gradient.value=t}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(t){this.uniforms.useDash.value=t}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(t){this.uniforms.useGradient.value=t}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(t)}copy(t){return super.copy(t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.gradient=t.gradient,this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray=t.dashArray,this.dashOffset=t.dashOffset,this.dashRatio=t.dashRatio,this.useDash=t.useDash,this.useGradient=t.useGradient,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this}}const IE={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},RE=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.set(t.subarray(e)),t.fill(-1/0,-e),t};const kE=i.forwardRef((t,e)=>{const{children:n}=t,{width:r,length:a,decay:o,local:s,stride:l,interval:c}=Dt(Dt({},IE),t),{color:u="hotpink",attenuation:h,target:d}=t,p=RT(t=>t.size),f=RT(t=>t.scene),m=i.useRef(null),[g,y]=i.useState(null),v=function(t,e){const{length:n,local:r,decay:a,interval:o,stride:s}=Dt(Dt({},IE),e),l=i.useRef(),[c]=i.useState(()=>new Qh);i.useLayoutEffect(()=>{t&&(l.current=Float32Array.from({length:10*n*3},(e,n)=>t.position.getComponent(n%3)))},[n,t]);const u=i.useRef(new Qh),h=i.useRef(0);return kT(()=>{if(t&&l.current){if(0===h.current){let e;r?e=t.position:(t.getWorldPosition(c),e=c);const n=1*a;for(let t=0;t<n;t++)e.distanceTo(u.current)<s||(RE(l.current,3),l.current.set(e.toArray(),l.current.length-3));u.current.copy(e)}h.current++,h.current=h.current%o}}),l}(g,{length:a,decay:o,local:s,stride:l,interval:c});i.useEffect(()=>{const t=(null==d?void 0:d.current)||m.current.children.find(t=>t instanceof kp);t&&y(t)},[v,d]);const _=i.useMemo(()=>new AE,[]),x=i.useMemo(()=>{var t;const e=new PE({lineWidth:.1*r,color:u,sizeAttenuation:1,resolution:new Jh(p.width,p.height)});let i;if(n)if(Array.isArray(n))i=n.find(t=>{const e=t;return"string"===typeof e.type&&"meshLineMaterial"===e.type});else{const t=n;"string"===typeof t.type&&"meshLineMaterial"===t.type&&(i=t)}return"object"===typeof(null==(t=i)?void 0:t.props)&&e.setValues(i.props),e},[r,u,p,n]);return i.useEffect(()=>{x.uniforms.resolution.value.set(p.width,p.height)},[p]),kT(()=>{v.current&&_.setPoints(v.current,h)}),i.createElement("group",null,function(t,e,n){return(0,zt.jsx)(qT,{children:t,container:e,state:n},e.uuid)}(i.createElement("mesh",{ref:e,geometry:_,material:x}),f),i.createElement("group",{ref:m},n))});function LE(t){let{pixelated:e}=t;const n=RT(t=>t.gl),r=RT(t=>t.internal.active),a=RT(t=>t.performance.current),o=RT(t=>t.viewport.initialDpr),s=RT(t=>t.setDpr);return i.useEffect(()=>{const t=n.domElement;return()=>{r&&s(o),e&&t&&(t.style.imageRendering="auto")}},[]),i.useEffect(()=>{s(a*o),e&&n.domElement&&(n.domElement.style.imageRendering=1===a?"auto":"pixelated")},[a]),null}function DE(){const t=(0,i.useRef)(),e=(0,i.useMemo)(()=>{const t=[];for(let e=0;e<2e3;e++){const e=150+150*Math.random(),n=Math.random()*Math.PI*2,i=Math.acos(2*Math.random()-1),r=e*Math.sin(i)*Math.cos(n),a=e*Math.sin(i)*Math.sin(n),o=e*Math.cos(i);t.push(r,a,o)}return new Float32Array(t)},[]);return kT(()=>{t.current&&(t.current.rotation.y+=15e-5)}),(0,zt.jsxs)("points",{ref:t,frustumCulled:!0,children:[(0,zt.jsx)("bufferGeometry",{children:(0,zt.jsx)("bufferAttribute",{attachObject:["attributes","position"],count:e.length/3,array:e,itemSize:3})}),(0,zt.jsx)("pointsMaterial",{size:.6,sizeAttenuation:!0,color:"#ffffff",transparent:!0,opacity:.85})]})}function zE(){const t=(0,i.useRef)(),e=(0,i.useRef)(),n=(0,i.useRef)(),r=(0,i.useMemo)(()=>{const t=1024,e=document.createElement("canvas");e.width=2048,e.height=t;const n=e.getContext("2d"),i=n.createLinearGradient(0,0,0,t);i.addColorStop(0,"#0a1a3f"),i.addColorStop(1,"#09203f"),n.fillStyle=i,n.fillRect(0,0,2048,t),n.fillStyle="#2e8b57";const r=(t,e,i,r)=>{n.beginPath(),n.ellipse(t,e,i,r,0,0,2*Math.PI),n.fill()};return r(600,420,240,160),r(520,540,120,140),r(800,700,120,220),r(1100,380,150,90),r(1200,580,160,240),r(1400,450,260,180),r(1640,780,120,80),n.fillStyle="#c2a36b",r(1180,520,120,70),r(1320,520,140,80),new ry(e)},[]),a=(0,i.useMemo)(()=>{const t=document.createElement("canvas");t.width=2048,t.height=1024;const e=t.getContext("2d");e.clearRect(0,0,2048,1024);const n=(t,n,i,r)=>{const a=e.createRadialGradient(t,n,0,t,n,i);a.addColorStop(0,"rgba(255, 230, 180, ".concat(r,")")),a.addColorStop(1,"rgba(255, 230, 180, 0)"),e.fillStyle=a,e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fill()};for(let i=0;i<1800;i++){n(380+440*Math.random(),350+300*Math.random(),.8+1.8*Math.random(),.25+.6*Math.random())}return new ry(t)},[]),o=(0,i.useMemo)(()=>{const t=1024,e=document.createElement("canvas");e.width=t,e.height=512;const n=e.getContext("2d");n.clearRect(0,0,t,512),n.fillStyle="rgba(255,255,255,0.65)";for(let i=0;i<120;i++){const e=Math.random()*t,i=512*Math.random(),r=20+80*Math.random(),a=10+40*Math.random();n.beginPath(),n.ellipse(e,i,r,a,Math.random()*Math.PI,0,2*Math.PI),n.fill()}return new ry(e)},[]);return kT(()=>{t.current&&(t.current.rotation.y+=8e-4),e.current&&(e.current.rotation.y+=.001)}),(0,zt.jsxs)("group",{position:[-2.2,-.2,0],rotation:[.15,-1.2,0],children:[(0,zt.jsx)(SE,{ref:t,args:[2.4,96,96],children:(0,zt.jsx)("meshStandardMaterial",{map:r,emissiveMap:a,emissive:"#ffd9a8",emissiveIntensity:.9,roughness:1,metalness:0})}),(0,zt.jsx)(SE,{ref:e,args:[2.46,64,64],children:(0,zt.jsx)("meshLambertMaterial",{map:o,transparent:!0,opacity:.55,depthWrite:!1})}),(0,zt.jsx)(SE,{ref:n,args:[2.6,64,64],children:(0,zt.jsx)("meshBasicMaterial",{color:"#6fb7ff",transparent:!0,opacity:.12,side:dl,depthWrite:!1})})]})}function NE(t){let{position:e,onDone:n,duration:r=.6}=t;const a=(0,i.useRef)(),o=(0,i.useMemo)(()=>{const t=256,e=document.createElement("canvas");e.width=t,e.height=t;const n=e.getContext("2d"),i=n.createRadialGradient(128,128,10,128,128,128);return i.addColorStop(0,"rgba(255,240,200,1)"),i.addColorStop(.3,"rgba(255,180,60,0.95)"),i.addColorStop(.6,"rgba(255,90,0,0.6)"),i.addColorStop(1,"rgba(255,0,0,0)"),n.fillStyle=i,n.beginPath(),n.arc(128,128,128,0,2*Math.PI),n.fill(),new ry(e)},[]),s=(0,i.useRef)(null);return kT(t=>{let{clock:e}=t;const i=e.getElapsedTime();null===s.current&&(s.current=i);const o=Math.min((i-s.current)/r,1),l=.4+3.5*o,c=1-o;a.current&&(a.current.scale.setScalar(l),a.current.material.opacity=c),o>=1&&n&&n()}),(0,zt.jsx)("sprite",{ref:a,position:e,children:(0,zt.jsx)("spriteMaterial",{map:o,color:"#ffd9a8",blending:gl,transparent:!0,depthWrite:!1})})}function OE(){const t=(0,i.useRef)(),e=(0,i.useRef)(),n=(0,i.useRef)(),r=(0,i.useRef)(),[a,o]=(0,i.useState)(null),s=(0,i.useMemo)(()=>{const t=256,e=document.createElement("canvas");e.width=t,e.height=t;const n=e.getContext("2d"),i=n.createRadialGradient(128,128,10,128,128,128);i.addColorStop(0,"rgba(255,200,50,1)"),i.addColorStop(.3,"rgba(255,120,20,0.9)"),i.addColorStop(.6,"rgba(255,80,0,0.6)"),i.addColorStop(1,"rgba(255,0,0,0)"),n.fillStyle=i,n.beginPath(),n.arc(128,128,128,0,2*Math.PI),n.fill();const r=new ry(e);return r.needsUpdate=!0,r.wrapS=r.wrapT=fc,r},[]),l=(0,i.useMemo)(()=>{const t=new Float32Array(1200);for(let e=0;e<400;e++)t[3*e+0]=2*-Math.random(),t[3*e+1]=.6*(Math.random()-.5),t[3*e+2]=.6*(Math.random()-.5);return t},[]),c=(0,i.useRef)(0),u=new Qh(6.5,2.6,-1.4),h=new Qh(-2.2,-.2,0),d=h.clone();return kT((i,r)=>{if(a)return;c.current+=.08*r;const s=Math.min(c.current,1),l=(new Qh).lerpVectors(u,d,s);if(t.current){t.current.visible=!0,t.current.position.copy(l),t.current.rotation.x+=.01,t.current.rotation.y+=.02;const e=(new Qh).subVectors(d,u).normalize();t.current.lookAt(l.clone().add(e))}const p=i.clock.getElapsedTime();e.current&&(e.current.material.opacity=.5+.25*Math.sin(20*p)),n.current&&(n.current.material.opacity=.35+.2*Math.cos(17*p));(l.distanceTo(h)<=2.548||s>=1)&&(t.current&&(t.current.visible=!1),o({position:l.clone()}))}),(0,zt.jsxs)("group",{children:[(0,zt.jsxs)("group",{ref:t,children:[(0,zt.jsx)(kE,{width:2.2,length:12,color:"#ff7a18",attenuation:t=>t,children:(0,zt.jsxs)("mesh",{castShadow:!0,children:[(0,zt.jsx)("icosahedronGeometry",{args:[.32,1]}),(0,zt.jsx)("meshStandardMaterial",{color:"#5a5a5a",roughness:.9,metalness:.1,emissive:"#ff6a00",emissiveIntensity:.15})]})}),(0,zt.jsx)("sprite",{ref:e,position:[-.35,0,0],children:(0,zt.jsx)("spriteMaterial",{map:s,color:"#ff7a18",blending:gl,transparent:!0,depthWrite:!1})}),(0,zt.jsx)("sprite",{ref:n,position:[-.6,.05,0],children:(0,zt.jsx)("spriteMaterial",{map:s,color:"#ff3d00",blending:gl,transparent:!0,depthWrite:!1})}),(0,zt.jsxs)("points",{ref:r,position:[-.6,0,0],children:[(0,zt.jsx)("bufferGeometry",{children:(0,zt.jsx)("bufferAttribute",{attachObject:["attributes","position"],count:l.length/3,array:l,itemSize:3})}),(0,zt.jsx)("pointsMaterial",{size:.05,color:"#ffa366",blending:gl,transparent:!0})]})]}),a&&(0,zt.jsx)(NE,{position:a.position,onDone:()=>{o(null),c.current=0,t.current&&(t.current.visible=!0,t.current.position.copy(u))}})]})}function FE(t){let{intensity:e=.12}=t;const{mouse:n,camera:i}=RT();return kT(()=>{i.position.x=4+(n.x||0)*e,i.position.y=2+(n.y||0)*e,i.lookAt(0,0,0)}),null}function BE(){return(0,zt.jsx)("div",{className:"hero-bg-canvas",style:{position:"absolute",inset:0},children:(0,zt.jsxs)(_E,{camera:{position:[8,4,8],fov:50},dpr:[1,1.75],gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},children:[(0,zt.jsxs)("mesh",{children:[(0,zt.jsx)("sphereGeometry",{args:[300,32,32]}),(0,zt.jsx)("meshBasicMaterial",{color:"#000005",side:dl})]}),(0,zt.jsx)(DE,{}),(0,zt.jsx)("ambientLight",{intensity:.12,color:"#404080"}),(0,zt.jsx)("directionalLight",{position:[10,2,5],intensity:1.35,color:"#ffffff"}),(0,zt.jsx)("pointLight",{position:[-10,-10,-10],intensity:.35,color:"#4050ff"}),(0,zt.jsx)(zE,{}),(0,zt.jsx)(OE,{}),(0,zt.jsx)(FE,{}),(0,zt.jsx)(LE,{pixelated:!0})]})})}const UE=function(){const{dispatch:t}=Ut(),[e,n]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{const e=["Low","Medium","High","Critical"],n=e[Math.floor(Math.random()*e.length)];t({type:"SET_THREAT_LEVEL",payload:n})},[t]),(0,zt.jsxs)("div",{className:"home",children:[(0,zt.jsxs)("section",{className:"hero",children:[(0,zt.jsx)(BE,{}),(0,zt.jsxs)("div",{className:"hero-content",children:[(0,zt.jsxs)("div",{className:"hero-text",children:[(0,zt.jsxs)(Ks.h1,{className:"hero-title",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:["Impact Explorer",(0,zt.jsx)("span",{className:"hero-year",children:"2025"})]}),(0,zt.jsx)(Ks.p,{className:"hero-description",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},children:"Simulate asteroid impacts on Earth using real NASA data. Visualize trajectories, analyze impact zones, and explore the science behind planetary defense."}),(0,zt.jsxs)(Ks.div,{className:"hero-actions",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},children:[(0,zt.jsx)(At,{to:"/dashboard",className:"btn btn--primary btn--large",children:"Explore the Impact"}),(0,zt.jsxs)("button",{type:"button",className:"btn btn--secondary btn--large",onClick:()=>n(!0),children:[(0,zt.jsx)("span",{children:"\u25b6"}),"Watch Trailer"]})]})]}),(0,zt.jsxs)("div",{className:"hero-visualization",children:[(0,zt.jsx)(i.Suspense,{fallback:(0,zt.jsx)("div",{className:"loading-spinner"})}),(0,zt.jsxs)("div",{className:"asteroid-stats",children:[(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("span",{className:"stat-label",children:"ASTEROID SIZE"}),(0,zt.jsx)("span",{className:"stat-value",children:"247 km"})]}),(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("span",{className:"stat-label",children:"VELOCITY"}),(0,zt.jsx)("span",{className:"stat-value",children:"19.3 km/s"})]}),(0,zt.jsxs)("div",{className:"stat-item",children:[(0,zt.jsx)("span",{className:"stat-label",children:"DISTANCE"}),(0,zt.jsx)("span",{className:"stat-value",children:"1.94 km"})]}),(0,zt.jsxs)("div",{className:"stat-item stat-item--danger",children:[(0,zt.jsx)("span",{className:"stat-label",children:"POTENTIAL RISK"}),(0,zt.jsx)("span",{className:"stat-value danger-indicator",children:"\u25cf"})]})]})]})]})]}),(0,zt.jsx)(Qs,{open:e,onClose:()=>n(!1),videoId:"1s6l1YfI3IQqRPfe0TQS-iASqJC11OkTS"}),(0,zt.jsx)("section",{className:"story-preview",children:(0,zt.jsx)("div",{className:"container",children:(0,zt.jsx)(Js,{})})}),(0,zt.jsx)("section",{className:"research-preview",children:(0,zt.jsx)("div",{className:"container",children:(0,zt.jsx)($s,{})})}),(0,zt.jsx)("footer",{className:"home-footer",children:(0,zt.jsxs)("div",{className:"container",children:[(0,zt.jsxs)("div",{className:"footer-content",children:[(0,zt.jsxs)("div",{className:"footer-logo",children:[(0,zt.jsx)("div",{className:"logo-icon",children:(0,zt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,zt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,zt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,zt.jsxs)("div",{className:"footer-nav",children:[(0,zt.jsx)("h4",{children:"Navigation"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)(At,{to:"/",children:"Home"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)(At,{to:"/story",children:"Story Mode"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)(At,{to:"/dashboard",children:"Simulation Dashboard"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)(At,{to:"/results",children:"Impact Results"})})]})]}),(0,zt.jsxs)("div",{className:"footer-sources",children:[(0,zt.jsx)("h4",{children:"Data Sources"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,zt.jsxs)("div",{className:"footer-bottom",children:[(0,zt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,zt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})})]})};const jE=function(){const[t,e]=(0,i.useState)(0),n=[{id:1,title:"The Beginning of the Journey",subtitle:"Step 1: Detection",description:"An asteroid is detected by NASA's Near-Earth Object Observation Program. Scientists calculate its trajectory and determine it is on a collision course.",content:"Learn More"},{id:2,title:"Path Through the Solar System",subtitle:"Step 2: Trajectory",description:"The asteroid point through space, its path determined by gravitational forces. We can now predict exactly where and when it will impact.",content:"Learn More"},{id:3,title:"Entering Earth's Vicinity",subtitle:"Step 3: Approach",description:"As the asteroid approaches Earth, it begins to heat up from atmospheric friction. The space object has a fragile ground.",content:"Learn More"},{id:4,title:"Breaking Through the Atmosphere",subtitle:"Step 4: Entry",description:"The asteroid breaks through Earth's atmosphere, creating a brilliant fireball. Air pressure causes the object to break apart into smaller fragments.",content:"Learn More"},{id:5,title:"The Moment of Collision",subtitle:"Step 5: Impact",description:"Impact occurs with devastating force, released enormous energy that creates craters, triggers seismic activity, and causes widespread damage to the immediate area.",content:"00:45-43:49"}];return(0,i.useEffect)(()=>{const t=()=>{const t=window.scrollY,i=window.innerHeight,r=Math.floor(t/i);e(Math.min(r,n.length-1))};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[n.length]),(0,zt.jsxs)("div",{className:"story-mode",children:[(0,zt.jsx)("nav",{className:"story-nav","aria-label":"Story steps",children:n.map((e,n)=>(0,zt.jsx)("button",{type:"button","aria-label":"Go to step ".concat(e.id,": ").concat(e.title),className:"nav-step ".concat(n===t?"active":""),onClick:()=>{window.scrollTo({top:n*window.innerHeight,behavior:"smooth"})},children:(0,zt.jsx)("span",{className:"step-index",children:e.id})},e.id))}),n.map((t,e)=>(0,zt.jsx)("section",{className:"story-section",children:(0,zt.jsxs)("div",{className:"story-content",children:[(0,zt.jsxs)("div",{className:"story-text",children:[(0,zt.jsxs)(Ks.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},transition:{duration:.8,delay:.2},viewport:{once:!0},className:"step-badge",children:[(0,zt.jsx)("span",{className:"step-number",children:t.id}),(0,zt.jsx)("span",{className:"step-label",children:t.subtitle})]}),(0,zt.jsx)(Ks.h1,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.4},viewport:{once:!0},className:"story-title",children:t.title}),(0,zt.jsx)(Ks.p,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.6},viewport:{once:!0},className:"story-description",children:t.description}),(0,zt.jsx)(Ks.button,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.8},viewport:{once:!0},className:"story-cta",children:t.content})]}),(0,zt.jsxs)("div",{className:"story-visual",children:[(0,zt.jsxs)(Ks.div,{initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},transition:{duration:1,delay:.3},viewport:{once:!0},className:"earth-visual",children:[(0,zt.jsxs)("div",{className:"earth-globe",children:[(0,zt.jsx)("div",{className:"earth-surface"}),(0,zt.jsx)("div",{className:"earth-clouds"})]}),(0,zt.jsx)("div",{className:"asteroid-trail step-".concat(t.id),children:(0,zt.jsx)("div",{className:"asteroid"})}),5===t.id&&(0,zt.jsxs)("div",{className:"impact-effect",children:[(0,zt.jsx)("div",{className:"impact-flash"}),(0,zt.jsx)("div",{className:"impact-waves"})]})]}),(0,zt.jsxs)("div",{className:"visual-label",children:[(0,zt.jsx)("span",{className:"visual-title",children:"Impact Zone"}),(0,zt.jsx)("span",{className:"visual-coords",children:"43\xb0N 67\xb0W"})]})]})]})},t.id)),(0,zt.jsxs)("footer",{className:"story-footer",children:[(0,zt.jsxs)("div",{className:"footer-container",children:[(0,zt.jsxs)("div",{className:"footer-logo",children:[(0,zt.jsx)("div",{className:"logo-icon",children:(0,zt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,zt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,zt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,zt.jsxs)("div",{className:"footer-nav",children:[(0,zt.jsx)("h4",{children:"Navigation"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/",children:"Home"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/story",children:"Story Mode"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/dashboard",children:"Simulation Dashboard"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/results",children:"Impact Results"})})]})]}),(0,zt.jsxs)("div",{className:"footer-sources",children:[(0,zt.jsx)("h4",{children:"Data Sources"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,zt.jsxs)("div",{className:"footer-bottom",children:[(0,zt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,zt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})]})},VE=JSON.parse('{"Pacific Ocean":{"type":"ocean","centroid":{"lat":-0.703107,"lon":-120.9375},"boundingbox":[-60,66,100,-70],"note":"Huge \u2014 use polygon/bbox, or Nominatim for exact matched node","population":0,"density":0},"Atlantic Ocean":{"type":"ocean","centroid":{"lat":0,"lon":-30},"boundingbox":[-60,70,-90,20],"population":0,"density":0},"Indian Ocean":{"type":"ocean","centroid":{"lat":-20,"lon":80},"boundingbox":[-60,30,20,120],"population":0,"density":0},"Dhaka, Bangladesh":{"type":"city","centroid":{"lat":23.810332,"lon":90.412518},"population":9000000,"density":23000,"note":"Major urban center"},"New York, USA":{"type":"city","centroid":{"lat":40.7128,"lon":-74.006},"population":8400000,"density":10000,"note":"Major urban center"},"Tokyo, Japan":{"type":"city","centroid":{"lat":35.6762,"lon":139.6503},"population":37400000,"density":6000,"note":"Major urban center"},"London, UK":{"type":"city","centroid":{"lat":51.5074,"lon":-0.1278},"population":9300000,"density":5700,"note":"Major urban center"},"Cairo, Egypt":{"type":"city","centroid":{"lat":30.0444,"lon":31.2357},"population":20900000,"density":7400,"note":"Major urban center"},"Rural Bangladesh":{"type":"rural","centroid":{"lat":24,"lon":90.5},"population":500000,"density":1200,"note":"Rural agricultural area"},"Australian Outback":{"type":"rural","centroid":{"lat":-25,"lon":133},"population":50000,"density":0.1,"note":"Sparsely populated desert"},"Amazon Rainforest":{"type":"rural","centroid":{"lat":-3.4653,"lon":-62.2159},"population":100000,"density":0.4,"note":"Dense forest, low population"}}');const HE=function(t){let{impactData:e}=t;const{state:n}=Ut(),{isLoading:i}=n;return i?(0,zt.jsxs)("div",{className:"preliminary-results preliminary-results--loading",children:[(0,zt.jsx)("h3",{children:"Preliminary Results"}),(0,zt.jsxs)("div",{className:"loading-container",children:[(0,zt.jsx)("div",{className:"loading-spinner"}),(0,zt.jsx)("p",{children:"Calculating impact parameters..."})]})]}):(0,zt.jsxs)("div",{className:"preliminary-results",children:[(0,zt.jsx)("h3",{children:"Preliminary Results"}),(0,zt.jsxs)("div",{className:"results-list",children:[(0,zt.jsxs)("div",{className:"result-item",children:[(0,zt.jsx)("span",{className:"result-label",children:"Asteroid Diameter:"}),(0,zt.jsxs)("span",{className:"result-value",children:[e?e.asteroidDiameter:"2.5"," km"]})]}),(0,zt.jsxs)("div",{className:"result-item",children:[(0,zt.jsx)("span",{className:"result-label",children:"Impact Energy:"}),(0,zt.jsxs)("span",{className:"result-value result-value--energy",children:[e?e.energy:"12,100"," Megatons"]})]}),(0,zt.jsxs)("div",{className:"result-item",children:[(0,zt.jsx)("span",{className:"result-label",children:"Blast Radius:"}),(0,zt.jsxs)("span",{className:"result-value result-value--blast",children:[e?e.blastRadius:"243.2"," km"]})]}),(0,zt.jsxs)("div",{className:"result-item",children:[(0,zt.jsx)("span",{className:"result-label",children:"Affected Population:"}),(0,zt.jsx)("span",{className:"result-value",children:e?e.affectedPopulation:"2,500,000"})]}),(0,zt.jsxs)("div",{className:"result-item",children:[(0,zt.jsx)("span",{className:"result-label",children:"Estimated Casualties:"}),(0,zt.jsx)("span",{className:"result-value result-value--tsunami",children:e?e.casualties:"250,000"})]})]}),(0,zt.jsxs)("button",{className:"download-report-btn",children:[(0,zt.jsx)("span",{className:"btn-icon",children:"\ud83d\udce5"}),"Download Full Report"]})]})};function GE(t){return t+.5|0}const WE=(t,e,n)=>Math.max(Math.min(t,n),e);function qE(t){return WE(GE(2.55*t),0,255)}function ZE(t){return WE(GE(255*t),0,255)}function XE(t){return WE(GE(t/2.55)/100,0,1)}function YE(t){return WE(GE(100*t),0,100)}const KE={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},JE=[..."0123456789ABCDEF"],$E=t=>JE[15&t],QE=t=>JE[(240&t)>>4]+JE[15&t],tA=t=>(240&t)>>4===(15&t);function eA(t){var e=(t=>tA(t.r)&&tA(t.g)&&tA(t.b)&&tA(t.a))(t)?$E:QE;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const nA=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function iA(t,e,n){const i=e*Math.min(n,1-n),r=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+t/30)%12;return n-i*Math.max(Math.min(r-3,9-r,1),-1)};return[r(0),r(8),r(4)]}function rA(t,e,n){const i=function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(i+t/60)%6;return n-n*e*Math.max(Math.min(r,4-r,1),0)};return[i(5),i(3),i(1)]}function aA(t,e,n){const i=iA(t,1,.5);let r;for(e+n>1&&(r=1/(e+n),e*=r,n*=r),r=0;r<3;r++)i[r]*=1-e-n,i[r]+=e;return i}function oA(t){const e=t.r/255,n=t.g/255,i=t.b/255,r=Math.max(e,n,i),a=Math.min(e,n,i),o=(r+a)/2;let s,l,c;return r!==a&&(c=r-a,l=o>.5?c/(2-r-a):c/(r+a),s=function(t,e,n,i,r){return t===r?(e-n)/i+(e<n?6:0):e===r?(n-t)/i+2:(t-e)/i+4}(e,n,i,c,r),s=60*s+.5),[0|s,l||0,o]}function sA(t,e,n,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,i)).map(ZE)}function lA(t,e,n){return sA(iA,t,e,n)}function cA(t){return(t%360+360)%360}function uA(t){const e=nA.exec(t);let n,i=255;if(!e)return;e[5]!==n&&(i=e[6]?qE(+e[5]):ZE(+e[5]));const r=cA(+e[2]),a=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return sA(aA,t,e,n)}(r,a,o):"hsv"===e[1]?function(t,e,n){return sA(rA,t,e,n)}(r,a,o):lA(r,a,o),{r:n[0],g:n[1],b:n[2],a:i}}const hA={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},dA={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let pA;function fA(t){pA||(pA=function(){const t={},e=Object.keys(dA),n=Object.keys(hA);let i,r,a,o,s;for(i=0;i<e.length;i++){for(o=s=e[i],r=0;r<n.length;r++)a=n[r],s=s.replace(a,hA[a]);a=parseInt(dA[o],16),t[s]=[a>>16&255,a>>8&255,255&a]}return t}(),pA.transparent=[0,0,0,0]);const e=pA[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const mA=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const gA=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,yA=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function vA(t,e,n){if(t){let i=oA(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*n,0===e?360:1)),i=lA(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function _A(t,e){return t?Object.assign(e||{},t):t}function xA(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=ZE(t[3]))):(e=_A(t,{r:0,g:0,b:0,a:1})).a=ZE(e.a),e}function bA(t){return"r"===t.charAt(0)?function(t){const e=mA.exec(t);let n,i,r,a=255;if(e){if(e[7]!==n){const t=+e[7];a=e[8]?qE(t):WE(255*t,0,255)}return n=+e[1],i=+e[3],r=+e[5],n=255&(e[2]?qE(n):WE(n,0,255)),i=255&(e[4]?qE(i):WE(i,0,255)),r=255&(e[6]?qE(r):WE(r,0,255)),{r:n,g:i,b:r,a:a}}}(t):uA(t)}class wA{constructor(t){if(t instanceof wA)return t;const e=typeof t;let n;"object"===e?n=xA(t):"string"===e&&(n=function(t){var e,n=t.length;return"#"===t[0]&&(4===n||5===n?e={r:255&17*KE[t[1]],g:255&17*KE[t[2]],b:255&17*KE[t[3]],a:5===n?17*KE[t[4]]:255}:7!==n&&9!==n||(e={r:KE[t[1]]<<4|KE[t[2]],g:KE[t[3]]<<4|KE[t[4]],b:KE[t[5]]<<4|KE[t[6]],a:9===n?KE[t[7]]<<4|KE[t[8]]:255})),e}(t)||fA(t)||bA(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=_A(this._rgb);return t&&(t.a=XE(t.a)),t}set rgb(t){this._rgb=xA(t)}rgbString(){return this._valid?function(t){return t&&(t.a<255?"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(XE(t.a),")"):"rgb(".concat(t.r,", ").concat(t.g,", ").concat(t.b,")"))}(this._rgb):void 0}hexString(){return this._valid?eA(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=oA(t),n=e[0],i=YE(e[1]),r=YE(e[2]);return t.a<255?"hsla(".concat(n,", ").concat(i,"%, ").concat(r,"%, ").concat(XE(t.a),")"):"hsl(".concat(n,", ").concat(i,"%, ").concat(r,"%)")}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,i=t.rgb;let r;const a=e===r?.5:e,o=2*a-1,s=n.a-i.a,l=((o*s===-1?o:(o+s)/(1+o*s))+1)/2;r=1-l,n.r=255&l*n.r+r*i.r+.5,n.g=255&l*n.g+r*i.g+.5,n.b=255&l*n.b+r*i.b+.5,n.a=a*n.a+(1-a)*i.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const i=yA(XE(t.r)),r=yA(XE(t.g)),a=yA(XE(t.b));return{r:ZE(gA(i+n*(yA(XE(e.r))-i))),g:ZE(gA(r+n*(yA(XE(e.g))-r))),b:ZE(gA(a+n*(yA(XE(e.b))-a))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new wA(this.rgb)}alpha(t){return this._rgb.a=ZE(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=GE(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return vA(this._rgb,2,t),this}darken(t){return vA(this._rgb,2,-t),this}saturate(t){return vA(this._rgb,1,t),this}desaturate(t){return vA(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=oA(t);n[0]=cA(n[0]+e),n=lA(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}function SA(){}const MA=(()=>{let t=0;return()=>t++})();function TA(t){return null===t||void 0===t}function EA(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function AA(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}function CA(t){return("number"===typeof t||t instanceof Number)&&isFinite(+t)}function PA(t,e){return CA(t)?t:e}function IA(t,e){return"undefined"===typeof t?e:t}const RA=(t,e)=>"string"===typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function kA(t,e,n){if(t&&"function"===typeof t.call)return t.apply(n,e)}function LA(t,e,n,i){let r,a,o;if(EA(t))if(a=t.length,i)for(r=a-1;r>=0;r--)e.call(n,t[r],r);else for(r=0;r<a;r++)e.call(n,t[r],r);else if(AA(t))for(o=Object.keys(t),a=o.length,r=0;r<a;r++)e.call(n,t[o[r]],o[r])}function DA(t,e){let n,i,r,a;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(r=t[n],a=e[n],r.datasetIndex!==a.datasetIndex||r.index!==a.index)return!1;return!0}function zA(t){if(EA(t))return t.map(zA);if(AA(t)){const e=Object.create(null),n=Object.keys(t),i=n.length;let r=0;for(;r<i;++r)e[n[r]]=zA(t[n[r]]);return e}return t}function NA(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function OA(t,e,n,i){if(!NA(t))return;const r=e[t],a=n[t];AA(r)&&AA(a)?FA(r,a,i):e[t]=zA(a)}function FA(t,e,n){const i=EA(e)?e:[e],r=i.length;if(!AA(t))return t;const a=(n=n||{}).merger||OA;let o;for(let s=0;s<r;++s){if(o=i[s],!AA(o))continue;const e=Object.keys(o);for(let i=0,r=e.length;i<r;++i)a(e[i],t,o,n)}return t}function BA(t,e){return FA(t,e,{merger:UA})}function UA(t,e,n){if(!NA(t))return;const i=e[t],r=n[t];AA(i)&&AA(r)?BA(i,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=zA(r))}const jA={"":t=>t,x:t=>t.x,y:t=>t.y};function VA(t,e){const n=jA[e]||(jA[e]=function(t){const e=function(t){const e=t.split("."),n=[];let i="";for(const r of e)i+=r,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(t);return t=>{for(const n of e){if(""===n)break;t=t&&t[n]}return t}}(e));return n(t)}function HA(t){return t.charAt(0).toUpperCase()+t.slice(1)}const GA=t=>"undefined"!==typeof t,WA=t=>"function"===typeof t,qA=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};const ZA=Math.PI,XA=2*ZA,YA=XA+ZA,KA=Number.POSITIVE_INFINITY,JA=ZA/180,$A=ZA/2,QA=ZA/4,tC=2*ZA/3,eC=Math.log10,nC=Math.sign;function iC(t,e,n){return Math.abs(t-e)<n}function rC(t){const e=Math.round(t);t=iC(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(eC(t))),i=t/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function aC(t){return!function(t){return"symbol"===typeof t||"object"===typeof t&&null!==t&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function oC(t,e,n){let i,r,a;for(i=0,r=t.length;i<r;i++)a=t[i][n],isNaN(a)||(e.min=Math.min(e.min,a),e.max=Math.max(e.max,a))}function sC(t){return t*(ZA/180)}function lC(t){return t*(180/ZA)}function cC(t){if(!CA(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function uC(t,e){const n=e.x-t.x,i=e.y-t.y,r=Math.sqrt(n*n+i*i);let a=Math.atan2(i,n);return a<-.5*ZA&&(a+=XA),{angle:a,distance:r}}function hC(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function dC(t,e){return(t-e+YA)%XA-ZA}function pC(t){return(t%XA+XA)%XA}function fC(t,e,n,i){const r=pC(t),a=pC(e),o=pC(n),s=pC(a-r),l=pC(o-r),c=pC(r-a),u=pC(r-o);return r===a||r===o||i&&a===o||s>l&&c<u}function mC(t,e,n){return Math.max(e,Math.min(n,t))}function gC(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return t>=Math.min(e,n)-i&&t<=Math.max(e,n)+i}function yC(t,e,n){n=n||(n=>t[n]<e);let i,r=t.length-1,a=0;for(;r-a>1;)i=a+r>>1,n(i)?a=i:r=i;return{lo:a,hi:r}}const vC=(t,e,n,i)=>yC(t,n,i?i=>{const r=t[i][e];return r<n||r===n&&t[i+1][e]===n}:i=>t[i][e]<n),_C=(t,e,n)=>yC(t,n,i=>t[i][e]>=n);const xC=["push","pop","shift","splice","unshift"];function bC(t,e){const n=t._chartjs;if(!n)return;const i=n.listeners,r=i.indexOf(e);-1!==r&&i.splice(r,1),i.length>0||(xC.forEach(e=>{delete t[e]}),delete t._chartjs)}function wC(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const SC="undefined"===typeof window?function(t){return t()}:window.requestAnimationFrame;function MC(t,e){let n=[],i=!1;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];n=a,i||(i=!0,SC.call(window,()=>{i=!1,t.apply(e,n)}))}}const TC=t=>"start"===t?"left":"end"===t?"right":"center",EC=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function AC(t,e,n){const i=e.length;let r=0,a=i;if(t._sorted){const{iScale:o,vScale:s,_parsed:l}=t,c=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,u=o.axis,{min:h,max:d,minDefined:p,maxDefined:f}=o.getUserBounds();if(p){if(r=Math.min(vC(l,u,h).lo,n?i:vC(e,u,o.getPixelForValue(h)).lo),c){const t=l.slice(0,r+1).reverse().findIndex(t=>!TA(t[s.axis]));r-=Math.max(0,t)}r=mC(r,0,i-1)}if(f){let t=Math.max(vC(l,o.axis,d,!0).hi+1,n?0:vC(e,u,o.getPixelForValue(d),!0).hi+1);if(c){const e=l.slice(t-1).findIndex(t=>!TA(t[s.axis]));t+=Math.max(0,e)}a=mC(t,r,i)-r}else a=i-r}return{start:r,count:a}}function CC(t){const{xScale:e,yScale:n,_scaleRanges:i}=t,r={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!i)return t._scaleRanges=r,!0;const a=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,r),a}const PC=t=>0===t||1===t,IC=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*XA/n),RC=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*XA/n)+1,kC={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*$A),easeOutSine:t=>Math.sin(t*$A),easeInOutSine:t=>-.5*(Math.cos(ZA*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>PC(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>PC(t)?t:IC(t,.075,.3),easeOutElastic:t=>PC(t)?t:RC(t,.075,.3),easeInOutElastic(t){const e=.1125;return PC(t)?t:t<.5?.5*IC(2*t,e,.45):.5+.5*RC(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-kC.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?.5*kC.easeInBounce(2*t):.5*kC.easeOutBounce(2*t-1)+.5};function LC(t){if(t&&"object"===typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function DC(t){return LC(t)?t:new wA(t)}function zC(t){return LC(t)?t:new wA(t).saturate(.5).darken(.1).hexString()}const NC=["x","y","borderWidth","radius","tension"],OC=["color","borderColor","backgroundColor"];const FC=new Map;function BC(t,e,n){return function(t,e){e=e||{};const n=t+JSON.stringify(e);let i=FC.get(n);return i||(i=new Intl.NumberFormat(t,e),FC.set(n,i)),i}(e,n).format(t)}const UC={values:t=>EA(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const i=this.chart.options.locale;let r,a=t;if(n.length>1){const e=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(e<1e-4||e>1e15)&&(r="scientific"),a=function(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t));return n}(t,n)}const o=eC(Math.abs(a)),s=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:r,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(l,this.options.ticks.format),BC(t,i,l)},logarithmic(t,e,n){if(0===t)return"0";const i=n[e].significand||t/Math.pow(10,Math.floor(eC(t)));return[1,2,3,5,10,15].includes(i)||e>.8*n.length?UC.numeric.call(this,t,e,n):""}};var jC={formatters:UC};const VC=Object.create(null),HC=Object.create(null);function GC(t,e){if(!e)return t;const n=e.split(".");for(let i=0,r=n.length;i<r;++i){const e=n[i];t=t[e]||(t[e]=Object.create(null))}return t}function WC(t,e,n){return"string"===typeof e?FA(GC(t,e),n):FA(GC(t,""),e)}class qC{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>zC(e.backgroundColor),this.hoverBorderColor=(t,e)=>zC(e.borderColor),this.hoverColor=(t,e)=>zC(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return WC(this,t,e)}get(t){return GC(this,t)}describe(t,e){return WC(HC,t,e)}override(t,e){return WC(VC,t,e)}route(t,e,n,i){const r=GC(this,t),a=GC(this,n),o="_"+e;Object.defineProperties(r,{[o]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=a[i];return AA(t)?Object.assign({},e,t):IA(t,e)},set(t){this[o]=t}}})}apply(t){t.forEach(t=>t(this))}}var ZC=new qC({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),t.set("animations",{colors:{type:"color",properties:OC},numbers:{type:"number",properties:NC}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}})},function(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:jC.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t&&"dash"!==t}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t})}]);function XC(t,e,n,i,r){let a=e[r];return a||(a=e[r]=t.measureText(r).width,n.push(r)),a>i&&(i=a),i}function YC(t,e,n,i){let r=(i=i||{}).data=i.data||{},a=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(r=i.data={},a=i.garbageCollect=[],i.font=e),t.save(),t.font=e;let o=0;const s=n.length;let l,c,u,h,d;for(l=0;l<s;l++)if(h=n[l],void 0===h||null===h||EA(h)){if(EA(h))for(c=0,u=h.length;c<u;c++)d=h[c],void 0===d||null===d||EA(d)||(o=XC(t,r,a,o,d))}else o=XC(t,r,a,o,h);t.restore();const p=a.length/2;if(p>n.length){for(l=0;l<p;l++)delete r[a[l]];a.splice(0,p)}return o}function KC(t,e,n){const i=t.currentDevicePixelRatio,r=0!==n?Math.max(n/2,.5):0;return Math.round((e-r)*i)/i+r}function JC(t,e){(e||t)&&((e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function $C(t,e,n,i){QC(t,e,n,i,null)}function QC(t,e,n,i,r){let a,o,s,l,c,u,h,d;const p=e.pointStyle,f=e.rotation,m=e.radius;let g=(f||0)*JA;if(p&&"object"===typeof p&&(a=p.toString(),"[object HTMLImageElement]"===a||"[object HTMLCanvasElement]"===a))return t.save(),t.translate(n,i),t.rotate(g),t.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),void t.restore();if(!(isNaN(m)||m<=0)){switch(t.beginPath(),p){default:r?t.ellipse(n,i,r/2,m,0,0,XA):t.arc(n,i,m,0,XA),t.closePath();break;case"triangle":u=r?r/2:m,t.moveTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=tC,t.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=tC,t.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),t.closePath();break;case"rectRounded":c=.516*m,l=m-c,o=Math.cos(g+QA)*l,h=Math.cos(g+QA)*(r?r/2-c:l),s=Math.sin(g+QA)*l,d=Math.sin(g+QA)*(r?r/2-c:l),t.arc(n-h,i-s,c,g-ZA,g-$A),t.arc(n+d,i-o,c,g-$A,g),t.arc(n+h,i+s,c,g,g+$A),t.arc(n-d,i+o,c,g+$A,g+ZA),t.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,u=r?r/2:l,t.rect(n-u,i-l,2*u,2*l);break}g+=QA;case"rectRot":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+d,i-o),t.lineTo(n+h,i+s),t.lineTo(n-d,i+o),t.closePath();break;case"crossRot":g+=QA;case"cross":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+h,i+s),t.moveTo(n+d,i-o),t.lineTo(n-d,i+o);break;case"star":h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+h,i+s),t.moveTo(n+d,i-o),t.lineTo(n-d,i+o),g+=QA,h=Math.cos(g)*(r?r/2:m),o=Math.cos(g)*m,s=Math.sin(g)*m,d=Math.sin(g)*(r?r/2:m),t.moveTo(n-h,i-s),t.lineTo(n+h,i+s),t.moveTo(n+d,i-o),t.lineTo(n-d,i+o);break;case"line":o=r?r/2:Math.cos(g)*m,s=Math.sin(g)*m,t.moveTo(n-o,i-s),t.lineTo(n+o,i+s);break;case"dash":t.moveTo(n,i),t.lineTo(n+Math.cos(g)*(r?r/2:m),i+Math.sin(g)*m);break;case!1:t.closePath()}t.fill(),e.borderWidth>0&&t.stroke()}}function tP(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function eP(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function nP(t){t.restore()}function iP(t,e,n,i,r){if(!e)return t.lineTo(n.x,n.y);if("middle"===r){const i=(e.x+n.x)/2;t.lineTo(i,e.y),t.lineTo(i,n.y)}else"after"===r!==!!i?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function rP(t,e,n,i){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function aP(t,e,n,i,r){if(r.strikethrough||r.underline){const a=t.measureText(i),o=e-a.actualBoundingBoxLeft,s=e+a.actualBoundingBoxRight,l=n-a.actualBoundingBoxAscent,c=n+a.actualBoundingBoxDescent,u=r.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(o,u),t.lineTo(s,u),t.stroke()}}function oP(t,e){const n=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=n}function sP(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=EA(e)?e:[e],s=a.strokeWidth>0&&""!==a.strokeColor;let l,c;for(t.save(),t.font=r.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),TA(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,a),l=0;l<o.length;++l)c=o[l],a.backdrop&&oP(t,a.backdrop),s&&(a.strokeColor&&(t.strokeStyle=a.strokeColor),TA(a.strokeWidth)||(t.lineWidth=a.strokeWidth),t.strokeText(c,n,i,a.maxWidth)),t.fillText(c,n,i,a.maxWidth),aP(t,n,i,c,a),i+=Number(r.lineHeight);t.restore()}function lP(t,e){const{x:n,y:i,w:r,h:a,radius:o}=e;t.arc(n+o.topLeft,i+o.topLeft,o.topLeft,1.5*ZA,ZA,!0),t.lineTo(n,i+a-o.bottomLeft),t.arc(n+o.bottomLeft,i+a-o.bottomLeft,o.bottomLeft,ZA,$A,!0),t.lineTo(n+r-o.bottomRight,i+a),t.arc(n+r-o.bottomRight,i+a-o.bottomRight,o.bottomRight,$A,0,!0),t.lineTo(n+r,i+o.topRight),t.arc(n+r-o.topRight,i+o.topRight,o.topRight,0,-$A,!0),t.lineTo(n+o.topLeft,i)}const cP=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,uP=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function hP(t,e){const n=(""+t).match(cP);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}const dP=t=>+t||0;function pP(t,e){const n={},i=AA(e),r=i?Object.keys(e):e,a=AA(t)?i?n=>IA(t[n],t[e[n]]):e=>t[e]:()=>t;for(const o of r)n[o]=dP(a(o));return n}function fP(t){return pP(t,{top:"y",right:"x",bottom:"y",left:"x"})}function mP(t){return pP(t,["topLeft","topRight","bottomLeft","bottomRight"])}function gP(t){const e=fP(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function yP(t,e){t=t||{},e=e||ZC.font;let n=IA(t.size,e.size);"string"===typeof n&&(n=parseInt(n,10));let i=IA(t.style,e.style);i&&!(""+i).match(uP)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const r={family:IA(t.family,e.family),lineHeight:hP(IA(t.lineHeight,e.lineHeight),n),size:n,style:i,weight:IA(t.weight,e.weight),string:""};return r.string=function(t){return!t||TA(t.size)||TA(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(r),r}function vP(t,e,n,i){let r,a,o,s=!0;for(r=0,a=t.length;r<a;++r)if(o=t[r],void 0!==o&&(void 0!==e&&"function"===typeof o&&(o=o(e),s=!1),void 0!==n&&EA(o)&&(o=o[n%o.length],s=!1),void 0!==o))return i&&!s&&(i.cacheable=!1),o}function _P(t,e){return Object.assign(Object.create(t),e)}function xP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>t[0];const r=(arguments.length>2?arguments[2]:void 0)||t;"undefined"===typeof n&&(n=RP("_fallback",t));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:r,_fallback:n,_getTarget:i,override:i=>xP([i,...t],e,r,n)};return new Proxy(a,{deleteProperty:(e,n)=>(delete e[n],delete e._keys,delete t[0][n],!0),get:(n,i)=>TP(n,i,()=>function(t,e,n,i){let r;for(const a of e)if(r=RP(SP(a,t),n),"undefined"!==typeof r)return MP(t,r)?PP(n,i,t,r):r}(i,e,t,n)),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>kP(t).includes(e),ownKeys:t=>kP(t),set(t,e,n){const r=t._storage||(t._storage=i());return t[e]=r[e]=n,delete t._keys,!0}})}function bP(t,e,n,i){const r={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:wP(t,i),setContext:e=>bP(t,e,n,i),override:r=>bP(t.override(r),e,n,i)};return new Proxy(r,{deleteProperty:(e,n)=>(delete e[n],delete t[n],!0),get:(t,e,n)=>TP(t,e,()=>function(t,e,n){const{_proxy:i,_context:r,_subProxy:a,_descriptors:o}=t;let s=i[e];WA(s)&&o.isScriptable(e)&&(s=function(t,e,n,i){const{_proxy:r,_context:a,_subProxy:o,_stack:s}=n;if(s.has(t))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+t);s.add(t);let l=e(a,o||i);s.delete(t),MP(t,l)&&(l=PP(r._scopes,r,t,l));return l}(e,s,t,n));EA(s)&&s.length&&(s=function(t,e,n,i){const{_proxy:r,_context:a,_subProxy:o,_descriptors:s}=n;if("undefined"!==typeof a.index&&i(t))return e[a.index%e.length];if(AA(e[0])){const n=e,i=r._scopes.filter(t=>t!==n);e=[];for(const l of n){const n=PP(i,r,t,l);e.push(bP(n,a,o&&o[t],s))}}return e}(e,s,t,o.isIndexable));MP(e,s)&&(s=bP(s,r,a&&a[e],o));return s}(t,e,n)),getOwnPropertyDescriptor:(e,n)=>e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,n)=>Reflect.has(t,n),ownKeys:()=>Reflect.ownKeys(t),set:(e,n,i)=>(t[n]=i,delete e[n],!0)})}function wP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:n=e.scriptable,_indexable:i=e.indexable,_allKeys:r=e.allKeys}=t;return{allKeys:r,scriptable:n,indexable:i,isScriptable:WA(n)?n:()=>n,isIndexable:WA(i)?i:()=>i}}const SP=(t,e)=>t?t+HA(e):e,MP=(t,e)=>AA(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function TP(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e)||"constructor"===e)return t[e];const i=n();return t[e]=i,i}function EP(t,e,n){return WA(t)?t(e,n):t}const AP=(t,e)=>!0===t?e:"string"===typeof t?VA(e,t):void 0;function CP(t,e,n,i,r){for(const a of e){const e=AP(n,a);if(e){t.add(e);const a=EP(e._fallback,n,r);if("undefined"!==typeof a&&a!==n&&a!==i)return a}else if(!1===e&&"undefined"!==typeof i&&n!==i)return null}return!1}function PP(t,e,n,i){const r=e._rootScopes,a=EP(e._fallback,n,i),o=[...t,...r],s=new Set;s.add(i);let l=IP(s,o,n,a||n,i);return null!==l&&(("undefined"===typeof a||a===n||(l=IP(s,o,a,l,i),null!==l))&&xP(Array.from(s),[""],r,a,()=>function(t,e,n){const i=t._getTarget();e in i||(i[e]={});const r=i[e];if(EA(r)&&AA(n))return n;return r||{}}(e,n,i)))}function IP(t,e,n,i,r){for(;n;)n=CP(t,e,n,i,r);return n}function RP(t,e){for(const n of e){if(!n)continue;const e=n[t];if("undefined"!==typeof e)return e}}function kP(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const n of t)for(const t of Object.keys(n).filter(t=>!t.startsWith("_")))e.add(t);return Array.from(e)}(t._scopes)),e}function LP(t,e,n,i){const{iScale:r}=t,{key:a="r"}=this._parsing,o=new Array(i);let s,l,c,u;for(s=0,l=i;s<l;++s)c=s+n,u=e[c],o[s]={r:r.parse(VA(u,a),c)};return o}const DP=Number.EPSILON||1e-14,zP=(t,e)=>e<t.length&&!t[e].skip&&t[e],NP=t=>"x"===t?"y":"x";function OP(t,e,n,i){const r=t.skip?e:t,a=e,o=n.skip?e:n,s=hC(a,r),l=hC(o,a);let c=s/(s+l),u=l/(s+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const h=i*c,d=i*u;return{previous:{x:a.x-h*(o.x-r.x),y:a.y-h*(o.y-r.y)},next:{x:a.x+d*(o.x-r.x),y:a.y+d*(o.y-r.y)}}}function FP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const n=NP(e),i=t.length,r=Array(i).fill(0),a=Array(i);let o,s,l,c=zP(t,0);for(o=0;o<i;++o)if(s=l,l=c,c=zP(t,o+1),l){if(c){const t=c[e]-l[e];r[o]=0!==t?(c[n]-l[n])/t:0}a[o]=s?c?nC(r[o-1])!==nC(r[o])?0:(r[o-1]+r[o])/2:r[o-1]:r[o]}!function(t,e,n){const i=t.length;let r,a,o,s,l,c=zP(t,0);for(let u=0;u<i-1;++u)l=c,c=zP(t,u+1),l&&c&&(iC(e[u],0,DP)?n[u]=n[u+1]=0:(r=n[u]/e[u],a=n[u+1]/e[u],s=Math.pow(r,2)+Math.pow(a,2),s<=9||(o=3/Math.sqrt(s),n[u]=r*o*e[u],n[u+1]=a*o*e[u])))}(t,r,a),function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const i=NP(n),r=t.length;let a,o,s,l=zP(t,0);for(let c=0;c<r;++c){if(o=s,s=l,l=zP(t,c+1),!s)continue;const r=s[n],u=s[i];o&&(a=(r-o[n])/3,s["cp1".concat(n)]=r-a,s["cp1".concat(i)]=u-a*e[c]),l&&(a=(l[n]-r)/3,s["cp2".concat(n)]=r+a,s["cp2".concat(i)]=u+a*e[c])}}(t,a,e)}function BP(t,e,n){return Math.max(Math.min(t,n),e)}function UP(t,e,n,i,r){let a,o,s,l;if(e.spanGaps&&(t=t.filter(t=>!t.skip)),"monotone"===e.cubicInterpolationMode)FP(t,r);else{let n=i?t[t.length-1]:t[0];for(a=0,o=t.length;a<o;++a)s=t[a],l=OP(n,s,t[Math.min(a+1,o-(i?0:1))%o],e.tension),s.cp1x=l.previous.x,s.cp1y=l.previous.y,s.cp2x=l.next.x,s.cp2y=l.next.y,n=s}e.capBezierPoints&&function(t,e){let n,i,r,a,o,s=tP(t[0],e);for(n=0,i=t.length;n<i;++n)o=a,a=s,s=n<i-1&&tP(t[n+1],e),a&&(r=t[n],o&&(r.cp1x=BP(r.cp1x,e.left,e.right),r.cp1y=BP(r.cp1y,e.top,e.bottom)),s&&(r.cp2x=BP(r.cp2x,e.left,e.right),r.cp2y=BP(r.cp2y,e.top,e.bottom)))}(t,n)}function jP(){return"undefined"!==typeof window&&"undefined"!==typeof document}function VP(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function HP(t,e,n){let i;return"string"===typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[n])):i=t,i}const GP=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);const WP=["top","right","bottom","left"];function qP(t,e,n){const i={};n=n?"-"+n:"";for(let r=0;r<4;r++){const a=WP[r];i[a]=parseFloat(t[e+"-"+a+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function ZP(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:i}=e,r=GP(n),a="border-box"===r.boxSizing,o=qP(r,"padding"),s=qP(r,"border","width"),{x:l,y:c,box:u}=function(t,e){const n=t.touches,i=n&&n.length?n[0]:t,{offsetX:r,offsetY:a}=i;let o,s,l=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(r,a,t.target))o=r,s=a;else{const t=e.getBoundingClientRect();o=i.clientX-t.left,s=i.clientY-t.top,l=!0}return{x:o,y:s,box:l}}(t,n),h=o.left+(u&&s.left),d=o.top+(u&&s.top);let{width:p,height:f}=e;return a&&(p-=o.width+s.width,f-=o.height+s.height),{x:Math.round((l-h)/p*n.width/i),y:Math.round((c-d)/f*n.height/i)}}const XP=t=>Math.round(10*t)/10;function YP(t,e,n,i){const r=GP(t),a=qP(r,"margin"),o=HP(r.maxWidth,t,"clientWidth")||KA,s=HP(r.maxHeight,t,"clientHeight")||KA,l=function(t,e,n){let i,r;if(void 0===e||void 0===n){const a=t&&VP(t);if(a){const t=a.getBoundingClientRect(),o=GP(a),s=qP(o,"border","width"),l=qP(o,"padding");e=t.width-l.width-s.width,n=t.height-l.height-s.height,i=HP(o.maxWidth,a,"clientWidth"),r=HP(o.maxHeight,a,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:i||KA,maxHeight:r||KA}}(t,e,n);let{width:c,height:u}=l;if("content-box"===r.boxSizing){const t=qP(r,"border","width"),e=qP(r,"padding");c-=e.width+t.width,u-=e.height+t.height}c=Math.max(0,c-a.width),u=Math.max(0,i?c/i:u-a.height),c=XP(Math.min(c,o,l.maxWidth)),u=XP(Math.min(u,s,l.maxHeight)),c&&!u&&(u=XP(c/2));return(void 0!==e||void 0!==n)&&i&&l.height&&u>l.height&&(u=l.height,c=XP(Math.floor(u*i))),{width:c,height:u}}function KP(t,e,n){const i=e||1,r=Math.floor(t.height*i),a=Math.floor(t.width*i);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height="".concat(t.height,"px"),o.style.width="".concat(t.width,"px")),(t.currentDevicePixelRatio!==i||o.height!==r||o.width!==a)&&(t.currentDevicePixelRatio=i,o.height=r,o.width=a,t.ctx.setTransform(i,0,0,i,0,0),!0)}const JP=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};jP()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch(HH){}return t}();function $P(t,e){const n=function(t,e){return GP(t).getPropertyValue(e)}(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function QP(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function tI(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:"middle"===i?n<.5?t.y:e.y:"after"===i?n<1?t.y:e.y:n>0?e.y:t.y}}function eI(t,e,n,i){const r={x:t.cp2x,y:t.cp2y},a={x:e.cp1x,y:e.cp1y},o=QP(t,r,n),s=QP(r,a,n),l=QP(a,e,n),c=QP(o,s,n),u=QP(s,l,n);return QP(c,u,n)}function nI(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function iI(t,e){let n,i;"ltr"!==e&&"rtl"!==e||(n=t.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=i)}function rI(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function aI(t){return"angle"===t?{between:fC,compare:dC,normalize:pC}:{between:gC,compare:(t,e)=>t-e,normalize:t=>t}}function oI(t){let{start:e,end:n,count:i,loop:r,style:a}=t;return{start:e%i,end:n%i,loop:r&&(n-e+1)%i===0,style:a}}function sI(t,e,n){if(!n)return[t];const{property:i,start:r,end:a}=n,o=e.length,{compare:s,between:l,normalize:c}=aI(i),{start:u,end:h,loop:d,style:p}=function(t,e,n){const{property:i,start:r,end:a}=n,{between:o,normalize:s}=aI(i),l=e.length;let c,u,{start:h,end:d,loop:p}=t;if(p){for(h+=l,d+=l,c=0,u=l;c<u&&o(s(e[h%l][i]),r,a);++c)h--,d--;h%=l,d%=l}return d<h&&(d+=l),{start:h,end:d,loop:p,style:t.style}}(t,e,n),f=[];let m,g,y,v=!1,_=null;const x=()=>v||l(r,y,m)&&0!==s(r,y),b=()=>!v||0===s(a,m)||l(a,y,m);for(let w=u,S=u;w<=h;++w)g=e[w%o],g.skip||(m=c(g[i]),m!==y&&(v=l(m,r,a),null===_&&x()&&(_=0===s(m,r)?w:S),null!==_&&b()&&(f.push(oI({start:_,end:w,loop:d,count:o,style:p})),_=null),S=w,y=m));return null!==_&&f.push(oI({start:_,end:h,loop:d,count:o,style:p})),f}function lI(t,e){const n=[],i=t.segments;for(let r=0;r<i.length;r++){const a=sI(i[r],t.points,e);a.length&&n.push(...a)}return n}function cI(t,e,n,i){return i&&i.setContext&&n?function(t,e,n,i){const r=t._chart.getContext(),a=uI(t.options),{_datasetIndex:o,options:{spanGaps:s}}=t,l=n.length,c=[];let u=a,h=e[0].start,d=h;function p(t,e,i,r){const a=s?-1:1;if(t!==e){for(t+=l;n[t%l].skip;)t-=a;for(;n[e%l].skip;)e+=a;t%l!==e%l&&(c.push({start:t%l,end:e%l,loop:i,style:r}),u=r,h=e%l)}}for(const f of e){h=s?h:f.start;let t,e=n[h%l];for(d=h+1;d<=f.end;d++){const a=n[d%l];t=uI(i.setContext(_P(r,{type:"segment",p0:e,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),hI(t,u)&&p(h,d-1,f.loop,u),e=a,u=t}h<d-1&&p(h,d-1,f.loop,u)}return c}(t,e,n,i):e}function uI(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function hI(t,e){if(!e)return!1;const n=[],i=function(t,e){return LC(e)?(n.includes(e)||n.push(e),n.indexOf(e)):e};return JSON.stringify(t,i)!==JSON.stringify(e,i)}function dI(t,e,n){return t.options.clip?t[n]:e[n]}function pI(t,e){const n=e._clip;if(n.disabled)return!1;const i=function(t,e){const{xScale:n,yScale:i}=t;return n&&i?{left:dI(n,e,"left"),right:dI(n,e,"right"),top:dI(i,e,"top"),bottom:dI(i,e,"bottom")}:e}(e,t.chartArea);return{left:!1===n.left?0:i.left-(!0===n.left?0:n.left),right:!1===n.right?t.width:i.right+(!0===n.right?0:n.right),top:!1===n.top?0:i.top-(!0===n.top?0:n.top),bottom:!1===n.bottom?t.height:i.bottom+(!0===n.bottom?0:n.bottom)}}class fI{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,n,i){const r=e.listeners[i],a=e.duration;r.forEach(i=>i({chart:t,initial:e.initial,numSteps:a,currentStep:Math.min(n-e.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=SC.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),e=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;const r=n.items;let a,o=r.length-1,s=!1;for(;o>=0;--o)a=r[o],a._active?(a._total>n.duration&&(n.duration=a._total),a.tick(t),s=!0):(r[o]=r[r.length-1],r.pop());s&&(i.draw(),this._notify(i,n,t,"progress")),r.length||(n.running=!1,this._notify(i,n,t,"complete"),n.initial=!1),e+=r.length}),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}listen(t,e,n){this._getAnims(t).listeners[e].push(n)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((t,e)=>Math.max(t,e._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const n=e.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var mI=new fI;const gI="transparent",yI={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const i=DC(t||gI),r=i.valid&&DC(e||gI);return r&&r.valid?r.mix(i,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class vI{constructor(t,e,n,i){const r=e[n];i=vP([t.to,i,r,t.from]);const a=vP([t.from,r,i]);this._active=!0,this._fn=t.fn||yI[t.type||typeof a],this._easing=kC[t.easing]||kC.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=n,this._from=a,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,n){if(this._active){this._notify(!1);const i=this._target[this._prop],r=n-this._start,a=this._duration-r;this._start=n,this._duration=Math.floor(Math.max(a,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=vP([t.to,e,i,t.from]),this._from=vP([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,n=this._duration,i=this._prop,r=this._from,a=this._loop,o=this._to;let s;if(this._active=r!==o&&(a||e<n),!this._active)return this._target[i]=o,void this._notify(!0);e<0?this._target[i]=r:(s=e/n%2,s=a&&s>1?2-s:s,s=this._easing(Math.min(1,Math.max(0,s))),this._target[i]=this._fn(r,o,s))}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,n)=>{t.push({res:e,rej:n})})}_notify(t){const e=t?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][e]()}}class _I{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!AA(t))return;const e=Object.keys(ZC.animation),n=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const r=t[i];if(!AA(r))return;const a={};for(const t of e)a[t]=r[t];(EA(r.properties)&&r.properties||[i]).forEach(t=>{t!==i&&n.has(t)||n.set(t,a)})})}_animateOptions(t,e){const n=e.options,i=function(t,e){if(!e)return;let n=t.options;if(!n)return void(t.options=e);n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(t,n);if(!i)return[];const r=this._createAnimations(i,n);return n.$shared&&function(t,e){const n=[],i=Object.keys(e);for(let r=0;r<i.length;r++){const e=t[i[r]];e&&e.active()&&n.push(e.wait())}return Promise.all(n)}(t.options.$animations,n).then(()=>{t.options=n},()=>{}),r}_createAnimations(t,e){const n=this._properties,i=[],r=t.$animations||(t.$animations={}),a=Object.keys(e),o=Date.now();let s;for(s=a.length-1;s>=0;--s){const l=a[s];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(t,e));continue}const c=e[l];let u=r[l];const h=n.get(l);if(u){if(h&&u.active()){u.update(h,c,o);continue}u.cancel()}h&&h.duration?(r[l]=u=new vI(h,t,l,c),i.push(u)):t[l]=c}return i}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const n=this._createAnimations(t,e);return n.length?(mI.add(this._chart,n),!0):void 0}}function xI(t,e){const n=t&&t.options||{},i=n.reverse,r=void 0===n.min?e:0,a=void 0===n.max?e:0;return{start:i?a:r,end:i?r:a}}function bI(t,e){const n=[],i=t._getSortedDatasetMetas(e);let r,a;for(r=0,a=i.length;r<a;++r)n.push(i[r].index);return n}function wI(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=t.keys,a="single"===i.mode;let o,s,l,c;if(null===e)return;let u=!1;for(o=0,s=r.length;o<s;++o){if(l=+r[o],l===n){if(u=!0,i.all)continue;break}c=t.values[l],CA(c)&&(a||0===e||nC(e)===nC(c))&&(e+=c)}return u||i.all?e:0}function SI(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function MI(t,e,n){const i=t[e]||(t[e]={});return i[n]||(i[n]={})}function TI(t,e,n,i){for(const r of e.getMatchingVisibleMetas(i).reverse()){const e=t[r.index];if(n&&e>0||!n&&e<0)return r.index}return null}function EI(t,e){const{chart:n,_cachedMeta:i}=t,r=n._stacks||(n._stacks={}),{iScale:a,vScale:o,index:s}=i,l=a.axis,c=o.axis,u=function(t,e,n){return"".concat(t.id,".").concat(e.id,".").concat(n.stack||n.type)}(a,o,i),h=e.length;let d;for(let p=0;p<h;++p){const t=e[p],{[l]:n,[c]:a}=t;d=(t._stacks||(t._stacks={}))[c]=MI(r,u,n),d[s]=a,d._top=TI(d,o,!0,i.type),d._bottom=TI(d,o,!1,i.type);(d._visualValues||(d._visualValues={}))[s]=a}}function AI(t,e){const n=t.scales;return Object.keys(n).filter(t=>n[t].axis===e).shift()}function CI(t,e){const n=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[i]||void 0===e[i][n])return;delete e[i][n],void 0!==e[i]._visualValues&&void 0!==e[i]._visualValues[n]&&delete e[i]._visualValues[n]}}}const PI=t=>"reset"===t||"none"===t,II=(t,e)=>e?t:Object.assign({},t);class RI{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=SI(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&CI(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,n=this.getDataset(),i=(t,e,n,i)=>"x"===t?e:"r"===t?i:n,r=e.xAxisID=IA(n.xAxisID,AI(t,"x")),a=e.yAxisID=IA(n.yAxisID,AI(t,"y")),o=e.rAxisID=IA(n.rAxisID,AI(t,"r")),s=e.indexAxis,l=e.iAxisID=i(s,r,a,o),c=e.vAxisID=i(s,a,r,o);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(a),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&bC(this._data,this),t._stacked&&CI(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),n=this._data;if(AA(e)){const t=this._cachedMeta;this._data=function(t,e){const{iScale:n,vScale:i}=e,r="x"===n.axis?"x":"y",a="x"===i.axis?"x":"y",o=Object.keys(t),s=new Array(o.length);let l,c,u;for(l=0,c=o.length;l<c;++l)u=o[l],s[l]={[r]:u,[a]:t[u]};return s}(e,t)}else if(n!==e){if(n){bC(n,this);const t=this._cachedMeta;CI(t),t._parsed=[]}e&&Object.isExtensible(e)&&(r=this,(i=e)._chartjs?i._chartjs.listeners.push(r):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),xC.forEach(t=>{const e="_onData"+HA(t),n=i[t];Object.defineProperty(i,t,{configurable:!0,enumerable:!1,value(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];const o=n.apply(this,r);return i._chartjs.listeners.forEach(t=>{"function"===typeof t[e]&&t[e](...r)}),o}})}))),this._syncList=[],this._data=e}var i,r}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=SI(e.vScale,e),e.stack!==n.stack&&(i=!0,CI(e),e.stack=n.stack),this._resyncElements(t),(i||r!==e._stacked)&&(EI(this,e._parsed),e._stacked=SI(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:n,_data:i}=this,{iScale:r,_stacked:a}=n,o=r.axis;let s,l,c,u=0===t&&e===i.length||n._sorted,h=t>0&&n._parsed[t-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,c=i;else{c=EA(i[t])?this.parseArrayData(n,i,t,e):AA(i[t])?this.parseObjectData(n,i,t,e):this.parsePrimitiveData(n,i,t,e);const r=()=>null===l[o]||h&&l[o]<h[o];for(s=0;s<e;++s)n._parsed[s+t]=l=c[s],u&&(r()&&(u=!1),h=l);n._sorted=u}a&&EI(this,c)}parsePrimitiveData(t,e,n,i){const{iScale:r,vScale:a}=t,o=r.axis,s=a.axis,l=r.getLabels(),c=r===a,u=new Array(i);let h,d,p;for(h=0,d=i;h<d;++h)p=h+n,u[h]={[o]:c||r.parse(l[p],p),[s]:a.parse(e[p],p)};return u}parseArrayData(t,e,n,i){const{xScale:r,yScale:a}=t,o=new Array(i);let s,l,c,u;for(s=0,l=i;s<l;++s)c=s+n,u=e[c],o[s]={x:r.parse(u[0],c),y:a.parse(u[1],c)};return o}parseObjectData(t,e,n,i){const{xScale:r,yScale:a}=t,{xAxisKey:o="x",yAxisKey:s="y"}=this._parsing,l=new Array(i);let c,u,h,d;for(c=0,u=i;c<u;++c)h=c+n,d=e[h],l[c]={x:r.parse(VA(d,o),h),y:a.parse(VA(d,s),h)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,n){const i=this.chart,r=this._cachedMeta,a=e[t.axis];return wI({keys:bI(i,!0),values:e._stacks[t.axis]._visualValues},a,r.index,{mode:n})}updateRangeFromParsed(t,e,n,i){const r=n[e.axis];let a=null===r?NaN:r;const o=i&&n._stacks[e.axis];i&&o&&(i.values=o,a=wI(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,a),t.max=Math.max(t.max,a)}getMinMax(t,e){const n=this._cachedMeta,i=n._parsed,r=n._sorted&&t===n.iScale,a=i.length,o=this._getOtherScale(t),s=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:bI(n,!0),values:null})(e,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(t){const{min:e,max:n,minDefined:i,maxDefined:r}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:r?n:Number.POSITIVE_INFINITY}}(o);let h,d;function p(){d=i[h];const e=d[o.axis];return!CA(d[t.axis])||c>e||u<e}for(h=0;h<a&&(p()||(this.updateRangeFromParsed(l,t,d,s),!r));++h);if(r)for(h=a-1;h>=0;--h)if(!p()){this.updateRangeFromParsed(l,t,d,s);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,n=[];let i,r,a;for(i=0,r=e.length;i<r;++i)a=e[i][t.axis],CA(a)&&n.push(a);return n}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,n=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:n?""+n.getLabelForValue(r[n.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,n,i,r;return AA(t)?(e=t.top,n=t.right,i=t.bottom,r=t.left):e=n=i=r=t,{top:e,right:n,bottom:i,left:r,disabled:!1===t}}(IA(this.options.clip,function(t,e,n){if(!1===n)return!1;const i=xI(t,n),r=xI(e,n);return{top:r.end,right:i.end,bottom:r.start,left:i.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,n=this._cachedMeta,i=n.data||[],r=e.chartArea,a=[],o=this._drawStart||0,s=this._drawCount||i.length-o,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(t,r,o,s),c=o;c<o+s;++c){const e=i[c];e.hidden||(e.active&&l?a.push(e):e.draw(t,r))}for(c=0;c<a.length;++c)a[c].draw(t,r)}getStyle(t,e){const n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}getContext(t,e,n){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];r=e.$context||(e.$context=function(t,e,n){return _P(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=function(t,e){return _P(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=n,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2?arguments[2]:void 0;const i="active"===e,r=this._cachedDataOpts,a=t+"-"+e,o=r[a],s=this.enableOptionSharing&&GA(n);if(o)return II(o,s);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),u=i?["".concat(t,"Hover"),"hover",t,""]:[t,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(ZC.elements[t]),p=l.resolveNamedOptions(h,d,()=>this.getContext(n,i,e),u);return p.$shared&&(p.$shared=s,r[a]=Object.freeze(II(p,s))),p}_resolveAnimations(t,e,n){const i=this.chart,r=this._cachedDataOpts,a="animation-".concat(e),o=r[a];if(o)return o;let s;if(!1!==i.options.animation){const i=this.chart.config,r=i.datasetAnimationScopeKeys(this._type,e),a=i.getOptionScopes(this.getDataset(),r);s=i.createResolver(a,this.getContext(t,n,e))}const l=new _I(i,s&&s.animations);return s&&s._cacheable&&(r[a]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||PI(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const n=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(n),a=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,n),{sharedOptions:r,includeOptions:a}}updateElement(t,e,n,i){PI(i)?Object.assign(t,n):this._resolveAnimations(e,i).update(t,n)}updateSharedOptions(t,e,n){t&&!PI(e)&&this._resolveAnimations(void 0,e).update(t,n)}_setStyle(t,e,n,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,n,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,n){this._setStyle(t,n,"active",!1)}setHoverStyle(t,e,n){this._setStyle(t,n,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,n=this._cachedMeta.data;for(const[o,s,l]of this._syncList)this[o](s,l);this._syncList=[];const i=n.length,r=e.length,a=Math.min(r,i);a&&this.parse(0,a),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this._cachedMeta,r=i.data,a=t+e;let o;const s=t=>{for(t.length+=e,o=t.length-1;o>=a;o--)t[o]=t[o-e]};for(s(r),o=t;o<a;++o)r[o]=new this.dataElementType;this._parsing&&s(i._parsed),this.parse(t,e),n&&this.updateElements(r,t,e,"reset")}updateElements(t,e,n,i){}_removeElements(t,e){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(t,e);n._stacked&&CI(n,i)}n.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,n,i]=t;this[e](n,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function kI(t){const e=t.iScale,n=function(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let i=[];for(let e=0,r=n.length;e<r;e++)i=i.concat(n[e].controller.getAllParsedValues(t));t._cache.$bar=wC(i.sort((t,e)=>t-e))}return t._cache.$bar}(e,t.type);let i,r,a,o,s=e._length;const l=()=>{32767!==a&&-32768!==a&&(GA(o)&&(s=Math.min(s,Math.abs(a-o)||s)),o=a)};for(i=0,r=n.length;i<r;++i)a=e.getPixelForValue(n[i]),l();for(o=void 0,i=0,r=e.ticks.length;i<r;++i)a=e.getPixelForTick(i),l();return s}function LI(t,e,n,i){return EA(t)?function(t,e,n,i){const r=n.parse(t[0],i),a=n.parse(t[1],i),o=Math.min(r,a),s=Math.max(r,a);let l=o,c=s;Math.abs(o)>Math.abs(s)&&(l=s,c=o),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:r,end:a,min:o,max:s}}(t,e,n,i):e[n.axis]=n.parse(t,i),e}function DI(t,e,n,i){const r=t.iScale,a=t.vScale,o=r.getLabels(),s=r===a,l=[];let c,u,h,d;for(c=n,u=n+i;c<u;++c)d=e[c],h={},h[r.axis]=s||r.parse(o[c],c),l.push(LI(d,h,a,c));return l}function zI(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function NI(t,e,n,i){let r=e.borderSkipped;const a={};if(!r)return void(t.borderSkipped=a);if(!0===r)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:s,reverse:l,top:c,bottom:u}=function(t){let e,n,i,r,a;return t.horizontal?(e=t.base>t.x,n="left",i="right"):(e=t.base<t.y,n="bottom",i="top"),e?(r="end",a="start"):(r="start",a="end"),{start:n,end:i,reverse:e,top:r,bottom:a}}(t);"middle"===r&&n&&(t.enableBorderRadius=!0,(n._top||0)===i?r=c:(n._bottom||0)===i?r=u:(a[OI(u,o,s,l)]=!0,r=c)),a[OI(r,o,s,l)]=!0,t.borderSkipped=a}function OI(t,e,n,i){var r,a,o;return i?(o=n,t=FI(t=(r=t)===(a=e)?o:r===o?a:r,n,e)):t=FI(t,e,n),t}function FI(t,e,n){return"start"===t?e:"end"===t?n:t}function BI(t,e,n){let{inflateAmount:i}=e;t.inflateAmount="auto"===i?1===n?.33:0:i}kt(RI,"defaults",{}),kt(RI,"datasetElementType",null),kt(RI,"dataElementType",null);class UI extends RI{parsePrimitiveData(t,e,n,i){return DI(t,e,n,i)}parseArrayData(t,e,n,i){return DI(t,e,n,i)}parseObjectData(t,e,n,i){const{iScale:r,vScale:a}=t,{xAxisKey:o="x",yAxisKey:s="y"}=this._parsing,l="x"===r.axis?o:s,c="x"===a.axis?o:s,u=[];let h,d,p,f;for(h=n,d=n+i;h<d;++h)f=e[h],p={},p[r.axis]=r.parse(VA(f,l),h),u.push(LI(VA(f,c),p,a,h));return u}updateRangeFromParsed(t,e,n,i){super.updateRangeFromParsed(t,e,n,i);const r=n._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:n,vScale:i}=e,r=this.getParsed(t),a=r._custom,o=zI(a)?"["+a.start+", "+a.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+n.getLabelForValue(r[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,i){const r="reset"===i,{index:a,_cachedMeta:{vScale:o}}=this,s=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,i);for(let d=e;d<e+n;d++){const e=this.getParsed(d),n=r||TA(e[o.axis])?{base:s,head:s}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(e._stacks||{})[o.axis],m={horizontal:l,base:n.base,enableBorderRadius:!f||zI(e._custom)||a===f._top||a===f._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};h&&(m.options=u||this.resolveDataElementOptions(d,t[d].active?"active":i));const g=m.options||t[d].options;NI(m,g,f,a),BI(m,g,c.ratio),this.updateElement(t[d],d,m,i)}}_getStacks(t,e){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter(t=>t.controller.options.grouped),r=n.options.stacked,a=[],o=this._cachedMeta.controller.getParsed(e),s=o&&o[n.axis],l=t=>{const e=t._parsed.find(t=>t[n.axis]===s),i=e&&e[t.vScale.axis];if(TA(i)||isNaN(i))return!0};for(const c of i)if((void 0===e||!l(c))&&((!1===r||-1===a.indexOf(c.stack)||void 0===r&&void 0===c.stack)&&a.push(c.stack),c.index===t))break;return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(n=>t[n].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const n of this.chart.data.datasets)t[IA("x"===this.chart.options.indexAxis?n.xAxisID:n.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,n){const i=this._getStacks(t,n),r=void 0!==e?i.indexOf(e):-1;return-1===r?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,n=e.iScale,i=[];let r,a;for(r=0,a=e.data.length;r<a;++r)i.push(n.getPixelForValue(this.getParsed(r)[n.axis],r));const o=t.barThickness;return{min:o||kI(e),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:n,index:i},options:{base:r,minBarLength:a}}=this,o=r||0,s=this.getParsed(t),l=s._custom,c=zI(l);let u,h,d=s[e.axis],p=0,f=n?this.applyStack(e,s,n):d;f!==d&&(p=f-d,f=d),c&&(d=l.barStart,f=l.barEnd-l.barStart,0!==d&&nC(d)!==nC(l.barEnd)&&(p=0),p+=d);const m=TA(r)||c?p:r;let g=e.getPixelForValue(m);if(u=this.chart.getDataVisibility(t)?e.getPixelForValue(p+f):g,h=u-g,Math.abs(h)<a){h=function(t,e,n){return 0!==t?nC(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(h,e,o)*a,d===o&&(g-=h/2);const t=e.getPixelForDecimal(0),r=e.getPixelForDecimal(1),l=Math.min(t,r),p=Math.max(t,r);g=Math.max(Math.min(g,p),l),u=g+h,n&&!c&&(s._stacks[e.axis]._visualValues[i]=e.getValueForPixel(u)-e.getValueForPixel(g))}if(g===e.getPixelForValue(o)){const t=nC(h)*e.getLineWidthForValue(o)/2;g+=t,h-=t}return{size:h,base:g,head:u,center:u+h/2}}_calculateBarIndexPixels(t,e){const n=e.scale,i=this.options,r=i.skipNull,a=IA(i.maxBarThickness,1/0);let o,s;const l=this._getAxisCount();if(e.grouped){const n=r?this._getStackCount(t):e.stackCount,c="flex"===i.barThickness?function(t,e,n,i){const r=e.pixels,a=r[t];let o=t>0?r[t-1]:null,s=t<r.length-1?r[t+1]:null;const l=n.categoryPercentage;null===o&&(o=a-(null===s?e.end-e.start:s-a)),null===s&&(s=a+a-o);const c=a-(a-Math.min(o,s))/2*l;return{chunk:Math.abs(s-o)/2*l/i,ratio:n.barPercentage,start:c}}(t,e,i,n*l):function(t,e,n,i){const r=n.barThickness;let a,o;return TA(r)?(a=e.min*n.categoryPercentage,o=n.barPercentage):(a=r*i,o=1),{chunk:a/i,ratio:o,start:e.pixels[t]-a/2}}(t,e,i,n*l),u="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,h=this._getAxis().indexOf(IA(u,this.getFirstScaleIdForIndexAxis())),d=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+h;o=c.start+c.chunk*d+c.chunk/2,s=Math.min(a,c.chunk*c.ratio)}else o=n.getPixelForValue(this.getParsed(t)[n.axis],t),s=Math.min(a,e.min*e.ratio);return{base:o-s/2,head:o+s/2,center:o,size:s}}draw(){const t=this._cachedMeta,e=t.vScale,n=t.data,i=n.length;let r=0;for(;r<i;++r)null===this.getParsed(r)[e.axis]||n[r].hidden||n[r].draw(this._ctx)}}kt(UI,"id","bar"),kt(UI,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),kt(UI,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class jI extends RI{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,n,i){const r=super.parsePrimitiveData(t,e,n,i);for(let a=0;a<r.length;a++)r[a]._custom=this.resolveDataElementOptions(a+n).radius;return r}parseArrayData(t,e,n,i){const r=super.parseArrayData(t,e,n,i);for(let a=0;a<r.length;a++){const t=e[n+a];r[a]._custom=IA(t[2],this.resolveDataElementOptions(a+n).radius)}return r}parseObjectData(t,e,n,i){const r=super.parseObjectData(t,e,n,i);for(let a=0;a<r.length;a++){const t=e[n+a];r[a]._custom=IA(t&&t.r&&+t.r,this.resolveDataElementOptions(a+n).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=e,a=this.getParsed(t),o=i.getLabelForValue(a.x),s=r.getLabelForValue(a.y),l=a._custom;return{label:n[t]||"",value:"("+o+", "+s+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,n,i){const r="reset"===i,{iScale:a,vScale:o}=this._cachedMeta,{sharedOptions:s,includeOptions:l}=this._getSharedOptions(e,i),c=a.axis,u=o.axis;for(let h=e;h<e+n;h++){const e=t[h],n=!r&&this.getParsed(h),d={},p=d[c]=r?a.getPixelForDecimal(.5):a.getPixelForValue(n[c]),f=d[u]=r?o.getBasePixel():o.getPixelForValue(n[u]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=s||this.resolveDataElementOptions(h,e.active?"active":i),r&&(d.options.radius=0)),this.updateElement(e,h,d,i)}}resolveDataElementOptions(t,e){const n=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return"active"!==e&&(i.radius=0),i.radius+=IA(n&&n._custom,r),i}}kt(jI,"id","bubble"),kt(jI,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),kt(jI,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class VI extends RI{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{let r,a,o=t=>+n[t];if(AA(n[t])){const{key:t="value"}=this._parsing;o=e=>+VA(n[e],t)}for(r=t,a=t+e;r<a;++r)i._parsed[r]=o(r)}}_getRotation(){return sC(this.options.rotation-90)}_getCircumference(){return sC(this.options.circumference)}_getRotationExtents(){let t=XA,e=-XA;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const i=this.chart.getDatasetMeta(n).controller,r=i._getRotation(),a=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+a)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:n}=e,i=this._cachedMeta,r=i.data,a=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-a)/2,0),s=Math.min((l=this.options.cutout,c=o,"string"===typeof l&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:m,offsetY:g}=function(t,e,n){let i=1,r=1,a=0,o=0;if(e<XA){const s=t,l=s+e,c=Math.cos(s),u=Math.sin(s),h=Math.cos(l),d=Math.sin(l),p=(t,e,i)=>fC(t,s,l,!0)?1:Math.max(e,e*n,i,i*n),f=(t,e,i)=>fC(t,s,l,!0)?-1:Math.min(e,e*n,i,i*n),m=p(0,c,h),g=p($A,u,d),y=f(ZA,c,h),v=f(ZA+$A,u,d);i=(m-y)/2,r=(g-v)/2,a=-(m+y)/2,o=-(g+v)/2}return{ratioX:i,ratioY:r,offsetX:a,offsetY:o}}(d,h,s),y=(n.width-a)/p,v=(n.height-a)/f,_=Math.max(Math.min(y,v)/2,0),x=RA(this.options.radius,_),b=(x-Math.max(x*s,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*x,this.offsetY=g*x,i.total=this.calculateTotal(),this.outerRadius=x-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*u,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const n=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===i._parsed[t]||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/XA)}updateElements(t,e,n,i){const r="reset"===i,a=this.chart,o=a.chartArea,s=a.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=r&&s.animateScale,h=u?0:this.innerRadius,d=u?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,i);let m,g=this._getRotation();for(m=0;m<e;++m)g+=this._circumference(m,r);for(m=e;m<e+n;++m){const e=this._circumference(m,r),n=t[m],a={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+e,circumference:e,outerRadius:d,innerRadius:h};f&&(a.options=p||this.resolveDataElementOptions(m,n.active?"active":i)),g+=e,this.updateElement(n,m,a,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let n,i=0;for(n=0;n<e.length;n++){const r=t._parsed[n];null===r||isNaN(r)||!this.chart.getDataVisibility(n)||e[n].hidden||(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?XA*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=BC(e._parsed[t],n.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const n=this.chart;let i,r,a,o,s;if(!t)for(i=0,r=n.data.datasets.length;i<r;++i)if(n.isDatasetVisible(i)){a=n.getDatasetMeta(i),t=a.data,o=a.controller;break}if(!t)return 0;for(i=0,r=t.length;i<r;++i)s=o.resolveDataElementOptions(i),"inner"!==s.borderAlign&&(e=Math.max(e,s.borderWidth||0,s.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let n=0,i=t.length;n<i;++n){const t=this.resolveDataElementOptions(n);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}_getRingWeight(t){return Math.max(IA(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}kt(VI,"id","doughnut"),kt(VI,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),kt(VI,"descriptors",{_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),kt(VI,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n,color:i}}=t.legend.options;return e.labels.map((e,r)=>{const a=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,fontColor:i,lineWidth:a.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}}}});class HI extends RI{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:n,data:i=[],_dataset:r}=e,a=this.chart._animationsDisabled;let{start:o,count:s}=AC(e,i,a);this._drawStart=o,this._drawCount=s,CC(e)&&(o=0,s=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!r._decimated,n.points=i;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!a,options:l},t),this.updateElements(i,o,s,t)}updateElements(t,e,n,i){const r="reset"===i,{iScale:a,vScale:o,_stacked:s,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(e,i),h=a.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,m=aC(p)?p:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||"none"===i,y=e+n,v=t.length;let _=e>0&&this.getParsed(e-1);for(let x=0;x<v;++x){const n=t[x],p=g?n:{};if(x<e||x>=y){p.skip=!0;continue}const v=this.getParsed(x),b=TA(v[d]),w=p[h]=a.getPixelForValue(v[h],x),S=p[d]=r||b?o.getBasePixel():o.getPixelForValue(s?this.applyStack(o,v,s):v[d],x);p.skip=isNaN(w)||isNaN(S)||b,p.stop=x>0&&Math.abs(v[h]-_[h])>m,f&&(p.parsed=v,p.raw=l.data[x]),u&&(p.options=c||this.resolveDataElementOptions(x,n.active?"active":i)),g||this.updateElement(n,x,p,i),_=v}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return n;const r=i[0].size(this.resolveDataElementOptions(0)),a=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,r,a)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}kt(HI,"id","line"),kt(HI,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),kt(HI,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class GI extends RI{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],r=BC(e._parsed[t].r,n.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,n,i){return LP.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((t,n)=>{const i=this.getParsed(n).r;!isNaN(i)&&this.chart.getDataVisibility(n)&&(i<e.min&&(e.min=i),i>e.max&&(e.max=i))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,n=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),a=(r-Math.max(n.cutoutPercentage?r/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,n,i){const r="reset"===i,a=this.chart,o=a.options.animation,s=this._cachedMeta.rScale,l=s.xCenter,c=s.yCenter,u=s.getIndexAngle(0)-.5*ZA;let h,d=u;const p=360/this.countVisibleElements();for(h=0;h<e;++h)d+=this._computeAngle(h,i,p);for(h=e;h<e+n;h++){const e=t[h];let n=d,f=d+this._computeAngle(h,i,p),m=a.getDataVisibility(h)?s.getDistanceFromCenterForValue(this.getParsed(h).r):0;d=f,r&&(o.animateScale&&(m=0),o.animateRotate&&(n=f=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:n,endAngle:f,options:this.resolveDataElementOptions(h,e.active?"active":i)};this.updateElement(e,h,g,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((t,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,n){return this.chart.getDataVisibility(t)?sC(this.resolveDataElementOptions(t,e).angle||n):0}}kt(GI,"id","polarArea"),kt(GI,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),kt(GI,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n,color:i}}=t.legend.options;return e.labels.map((e,r)=>{const a=t.getDatasetMeta(0).controller.getStyle(r);return{text:e,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,fontColor:i,lineWidth:a.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class WI extends VI{}kt(WI,"id","pie"),kt(WI,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class qI extends RI{getLabelAndValue(t){const e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}parseObjectData(t,e,n,i){return LP.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta,n=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(n.points=i,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===i.length,options:e};this.updateElement(n,void 0,a,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,n,i){const r=this._cachedMeta.rScale,a="reset"===i;for(let o=e;o<e+n;o++){const e=t[o],n=this.resolveDataElementOptions(o,e.active?"active":i),s=r.getPointPositionForValue(o,this.getParsed(o).r),l=a?r.xCenter:s.x,c=a?r.yCenter:s.y,u={x:l,y:c,angle:s.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(e,o,u,i)}}}kt(qI,"id","radar"),kt(qI,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),kt(qI,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class ZI extends RI{getLabelAndValue(t){const e=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:r}=e,a=this.getParsed(t),o=i.getLabelForValue(a.x),s=r.getLabelForValue(a.y);return{label:n[t]||"",value:"("+o+", "+s+")"}}update(t){const e=this._cachedMeta,{data:n=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:a}=AC(e,n,i);if(this._drawStart=r,this._drawCount=a,CC(e)&&(r=0,a=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:a}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!a._decimated,r.points=n;const o=this.resolveDatasetElementOptions(t);o.segment=this.options.segment,this.updateElement(r,void 0,{animated:!i,options:o},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(n,r,a,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,n,i){const r="reset"===i,{iScale:a,vScale:o,_stacked:s,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(e,i),u=this.getSharedOptions(c),h=this.includeOptions(i,u),d=a.axis,p=o.axis,{spanGaps:f,segment:m}=this.options,g=aC(f)?f:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||"none"===i;let v=e>0&&this.getParsed(e-1);for(let _=e;_<e+n;++_){const e=t[_],n=this.getParsed(_),c=y?e:{},f=TA(n[p]),x=c[d]=a.getPixelForValue(n[d],_),b=c[p]=r||f?o.getBasePixel():o.getPixelForValue(s?this.applyStack(o,n,s):n[p],_);c.skip=isNaN(x)||isNaN(b)||f,c.stop=_>0&&Math.abs(n[d]-v[d])>g,m&&(c.parsed=n,c.raw=l.data[_]),h&&(c.options=u||this.resolveDataElementOptions(_,e.active?"active":i)),y||this.updateElement(e,_,c,i),v=n}this.updateSharedOptions(u,i,c)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}const n=t.dataset,i=n.options&&n.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),a=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,a)/2}}kt(ZI,"id","scatter"),kt(ZI,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),kt(ZI,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});function XI(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class YI{static override(t){Object.assign(YI.prototype,t)}constructor(t){kt(this,"options",void 0),this.options=t||{}}init(){}formats(){return XI()}parse(){return XI()}format(){return XI()}add(){return XI()}diff(){return XI()}startOf(){return XI()}endOf(){return XI()}}var KI=YI;function JI(t,e,n,i){const{controller:r,data:a,_sorted:o}=t,s=r._cachedMeta.iScale,l=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(s&&e===s.axis&&"r"!==e&&o&&a.length){const o=s._reversePixels?_C:vC;if(!i){const i=o(a,e,n);if(l){const{vScale:e}=r._cachedMeta,{_parsed:n}=t,a=n.slice(0,i.lo+1).reverse().findIndex(t=>!TA(t[e.axis]));i.lo-=Math.max(0,a);const o=n.slice(i.hi).findIndex(t=>!TA(t[e.axis]));i.hi+=Math.max(0,o)}return i}if(r._sharedOptions){const t=a[0],i="function"===typeof t.getRange&&t.getRange(e);if(i){const t=o(a,e,n-i),r=o(a,e,n+i);return{lo:t.lo,hi:r.hi}}}}return{lo:0,hi:a.length-1}}function $I(t,e,n,i,r){const a=t.getSortedVisibleDatasetMetas(),o=n[e];for(let s=0,l=a.length;s<l;++s){const{index:t,data:n}=a[s],{lo:l,hi:c}=JI(a[s],e,o,r);for(let e=l;e<=c;++e){const r=n[e];r.skip||i(r,t,e)}}}function QI(t,e,n,i,r){const a=[];if(!r&&!t.isPointInArea(e))return a;return $I(t,n,e,function(n,o,s){(r||tP(n,t.chartArea,0))&&n.inRange(e.x,e.y,i)&&a.push({element:n,datasetIndex:o,index:s})},!0),a}function tR(t,e,n,i,r,a){let o=[];const s=function(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,i){const r=e?Math.abs(t.x-i.x):0,a=n?Math.abs(t.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(a,2))}}(n);let l=Number.POSITIVE_INFINITY;return $I(t,n,e,function(n,c,u){const h=n.inRange(e.x,e.y,r);if(i&&!h)return;const d=n.getCenterPoint(r);if(!(!!a||t.isPointInArea(d))&&!h)return;const p=s(e,d);p<l?(o=[{element:n,datasetIndex:c,index:u}],l=p):p===l&&o.push({element:n,datasetIndex:c,index:u})}),o}function eR(t,e,n,i,r,a){return a||t.isPointInArea(e)?"r"!==n||i?tR(t,e,n,i,r,a):function(t,e,n,i){let r=[];return $I(t,n,e,function(t,n,a){const{startAngle:o,endAngle:s}=t.getProps(["startAngle","endAngle"],i),{angle:l}=uC(t,{x:e.x,y:e.y});fC(l,o,s)&&r.push({element:t,datasetIndex:n,index:a})}),r}(t,e,n,r):[]}function nR(t,e,n,i,r){const a=[],o="x"===n?"inXRange":"inYRange";let s=!1;return $I(t,n,e,(t,i,l)=>{t[o]&&t[o](e[n],r)&&(a.push({element:t,datasetIndex:i,index:l}),s=s||t.inRange(e.x,e.y,r))}),i&&!s?[]:a}var iR={evaluateInteractionItems:$I,modes:{index(t,e,n,i){const r=ZP(e,t),a=n.axis||"x",o=n.includeInvisible||!1,s=n.intersect?QI(t,r,a,i,o):eR(t,r,a,!1,i,o),l=[];return s.length?(t.getSortedVisibleDatasetMetas().forEach(t=>{const e=s[0].index,n=t.data[e];n&&!n.skip&&l.push({element:n,datasetIndex:t.index,index:e})}),l):[]},dataset(t,e,n,i){const r=ZP(e,t),a=n.axis||"xy",o=n.includeInvisible||!1;let s=n.intersect?QI(t,r,a,i,o):eR(t,r,a,!1,i,o);if(s.length>0){const e=s[0].datasetIndex,n=t.getDatasetMeta(e).data;s=[];for(let t=0;t<n.length;++t)s.push({element:n[t],datasetIndex:e,index:t})}return s},point:(t,e,n,i)=>QI(t,ZP(e,t),n.axis||"xy",i,n.includeInvisible||!1),nearest(t,e,n,i){const r=ZP(e,t),a=n.axis||"xy",o=n.includeInvisible||!1;return eR(t,r,a,n.intersect,i,o)},x:(t,e,n,i)=>nR(t,ZP(e,t),"x",n.intersect,i),y:(t,e,n,i)=>nR(t,ZP(e,t),"y",n.intersect,i)}};const rR=["left","top","right","bottom"];function aR(t,e){return t.filter(t=>t.pos===e)}function oR(t,e){return t.filter(t=>-1===rR.indexOf(t.pos)&&t.box.axis===e)}function sR(t,e){return t.sort((t,n)=>{const i=e?n:t,r=e?t:n;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function lR(t,e){const n=function(t){const e={};for(const n of t){const{stack:t,pos:i,stackWeight:r}=n;if(!t||!rR.includes(i))continue;const a=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=r}return e}(t),{vBoxMaxWidth:i,hBoxMaxHeight:r}=e;let a,o,s;for(a=0,o=t.length;a<o;++a){s=t[a];const{fullSize:o}=s.box,l=n[s.stack],c=l&&s.stackWeight/l.weight;s.horizontal?(s.width=c?c*i:o&&e.availableWidth,s.height=r):(s.width=i,s.height=c?c*r:o&&e.availableHeight)}return n}function cR(t,e,n,i){return Math.max(t[n],e[n])+Math.max(t[i],e[i])}function uR(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function hR(t,e,n,i){const{pos:r,box:a}=n,o=t.maxPadding;if(!AA(r)){n.size&&(t[r]-=n.size);const e=i[n.stack]||{size:0,count:1};e.size=Math.max(e.size,n.horizontal?a.height:a.width),n.size=e.size/e.count,t[r]+=n.size}a.getPadding&&uR(o,a.getPadding());const s=Math.max(0,e.outerWidth-cR(o,t,"left","right")),l=Math.max(0,e.outerHeight-cR(o,t,"top","bottom")),c=s!==t.w,u=l!==t.h;return t.w=s,t.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function dR(t,e){const n=e.maxPadding;function i(t){const i={left:0,top:0,right:0,bottom:0};return t.forEach(t=>{i[t]=Math.max(e[t],n[t])}),i}return i(t?["left","right"]:["top","bottom"])}function pR(t,e,n,i){const r=[];let a,o,s,l,c,u;for(a=0,o=t.length,c=0;a<o;++a){s=t[a],l=s.box,l.update(s.width||e.w,s.height||e.h,dR(s.horizontal,e));const{same:o,other:h}=hR(e,n,s,i);c|=o&&r.length,u=u||h,l.fullSize||r.push(s)}return c&&pR(r,e,n,i)||u}function fR(t,e,n,i,r){t.top=n,t.left=e,t.right=e+i,t.bottom=n+r,t.width=i,t.height=r}function mR(t,e,n,i){const r=n.padding;let{x:a,y:o}=e;for(const s of t){const t=s.box,l=i[s.stack]||{count:1,placed:0,weight:1},c=s.stackWeight/l.weight||1;if(s.horizontal){const i=e.w*c,a=l.size||t.height;GA(l.start)&&(o=l.start),t.fullSize?fR(t,r.left,o,n.outerWidth-r.right-r.left,a):fR(t,e.left+l.placed,o,i,a),l.start=o,l.placed+=i,o=t.bottom}else{const i=e.h*c,o=l.size||t.width;GA(l.start)&&(a=l.start),t.fullSize?fR(t,a,r.top,o,n.outerHeight-r.bottom-r.top):fR(t,a,e.top+l.placed,o,i),l.start=a,l.placed+=i,a=t.right}}e.x=a,e.y=o}var gR={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,i){if(!t)return;const r=gP(t.options.layout.padding),a=Math.max(e-r.width,0),o=Math.max(n-r.height,0),s=function(t){const e=function(t){const e=[];let n,i,r,a,o,s;for(n=0,i=(t||[]).length;n<i;++n)r=t[n],({position:a,options:{stack:o,stackWeight:s=1}}=r),e.push({index:n,box:r,pos:a,horizontal:r.isHorizontal(),weight:r.weight,stack:o&&a+o,stackWeight:s});return e}(t),n=sR(e.filter(t=>t.box.fullSize),!0),i=sR(aR(e,"left"),!0),r=sR(aR(e,"right")),a=sR(aR(e,"top"),!0),o=sR(aR(e,"bottom")),s=oR(e,"x"),l=oR(e,"y");return{fullSize:n,leftAndTop:i.concat(a),rightAndBottom:r.concat(l).concat(o).concat(s),chartArea:aR(e,"chartArea"),vertical:i.concat(r).concat(l),horizontal:a.concat(o).concat(s)}}(t.boxes),l=s.vertical,c=s.horizontal;LA(t.boxes,t=>{"function"===typeof t.beforeLayout&&t.beforeLayout()});const u=l.reduce((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:r,availableWidth:a,availableHeight:o,vBoxMaxWidth:a/2/u,hBoxMaxHeight:o/2}),d=Object.assign({},r);uR(d,gP(i));const p=Object.assign({maxPadding:d,w:a,h:o,x:r.left,y:r.top},r),f=lR(l.concat(c),h);pR(s.fullSize,p,h,f),pR(l,p,h,f),pR(c,p,h,f)&&pR(l,p,h,f),function(t){const e=t.maxPadding;function n(n){const i=Math.max(e[n]-t[n],0);return t[n]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(p),mR(s.leftAndTop,p,h,f),p.x+=p.w,p.y+=p.h,mR(s.rightAndBottom,p,h,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},LA(s.chartArea,e=>{const n=e.box;Object.assign(n,t.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class yR{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,n){}removeEventListener(t,e,n){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,n,i){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):n)}}isAttached(t){return!0}updateConfig(t){}}class vR extends yR{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const _R="$chartjs",xR={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},bR=t=>null===t||""===t;const wR=!!JP&&{passive:!0};function SR(t,e,n){t&&t.canvas&&t.canvas.removeEventListener(e,n,wR)}function MR(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function TR(t,e,n){const i=t.canvas,r=new MutationObserver(t=>{let e=!1;for(const n of t)e=e||MR(n.addedNodes,i),e=e&&!MR(n.removedNodes,i);e&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}function ER(t,e,n){const i=t.canvas,r=new MutationObserver(t=>{let e=!1;for(const n of t)e=e||MR(n.removedNodes,i),e=e&&!MR(n.addedNodes,i);e&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}const AR=new Map;let CR=0;function PR(){const t=window.devicePixelRatio;t!==CR&&(CR=t,AR.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function IR(t,e,n){const i=t.canvas,r=i&&VP(i);if(!r)return;const a=MC((t,e)=>{const i=r.clientWidth;n(t,e),i<r.clientWidth&&n()},window),o=new ResizeObserver(t=>{const e=t[0],n=e.contentRect.width,i=e.contentRect.height;0===n&&0===i||a(n,i)});return o.observe(r),function(t,e){AR.size||window.addEventListener("resize",PR),AR.set(t,e)}(t,a),o}function RR(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){AR.delete(t),AR.size||window.removeEventListener("resize",PR)}(t)}function kR(t,e,n){const i=t.canvas,r=MC(e=>{null!==t.ctx&&n(function(t,e){const n=xR[t.type]||t.type,{x:i,y:r}=ZP(t,e);return{type:n,chart:e,native:t,x:void 0!==i?i:null,y:void 0!==r?r:null}}(e,t))},t);return function(t,e,n){t&&t.addEventListener(e,n,wR)}(i,e,r),r}class LR extends yR{acquireContext(t,e){const n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){const n=t.style,i=t.getAttribute("height"),r=t.getAttribute("width");if(t[_R]={initial:{height:i,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",bR(r)){const e=$P(t,"width");void 0!==e&&(t.width=e)}if(bR(i))if(""===t.style.height)t.height=t.width/(e||2);else{const e=$P(t,"height");void 0!==e&&(t.height=e)}}(t,e),n):null}releaseContext(t){const e=t.canvas;if(!e[_R])return!1;const n=e[_R].initial;["height","width"].forEach(t=>{const i=n[t];TA(i)?e.removeAttribute(t):e.setAttribute(t,i)});const i=n.style||{};return Object.keys(i).forEach(t=>{e.style[t]=i[t]}),e.width=e.width,delete e[_R],!0}addEventListener(t,e,n){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),r={attach:TR,detach:ER,resize:IR}[e]||kR;i[e]=r(t,e,n)}removeEventListener(t,e){const n=t.$proxies||(t.$proxies={}),i=n[e];if(!i)return;({attach:RR,detach:RR,resize:RR}[e]||SR)(t,e,i),n[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,n,i){return YP(t,e,n,i)}isAttached(t){const e=t&&VP(t);return!(!e||!e.isConnected)}}class DR{constructor(){kt(this,"x",void 0),kt(this,"y",void 0),kt(this,"active",!1),kt(this,"options",void 0),kt(this,"$animations",void 0)}tooltipPosition(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}hasValue(){return aC(this.x)&&aC(this.y)}getProps(t,e){const n=this.$animations;if(!e||!n)return this;const i={};return t.forEach(t=>{i[t]=n[t]&&n[t].active()?n[t]._to:this[t]}),i}}function zR(t,e){const n=t.options.ticks,i=function(t){const e=t.options.offset,n=t._tickSize(),i=t._length/n+(e?0:1),r=t._maxLength/n;return Math.floor(Math.min(i,r))}(t),r=Math.min(n.maxTicksLimit||i,i),a=n.major.enabled?function(t){const e=[];let n,i;for(n=0,i=t.length;n<i;n++)t[n].major&&e.push(n);return e}(e):[],o=a.length,s=a[0],l=a[o-1],c=[];if(o>r)return function(t,e,n,i){let r,a=0,o=n[0];for(i=Math.ceil(i),r=0;r<t.length;r++)r===o&&(e.push(t[r]),a++,o=n[a*i])}(e,c,a,o/r),c;const u=function(t,e,n){const i=function(t){const e=t.length;let n,i;if(e<2)return!1;for(i=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==i)return!1;return i}(t),r=e.length/n;if(!i)return Math.max(r,1);const a=function(t){const e=[],n=Math.sqrt(t);let i;for(i=1;i<n;i++)t%i===0&&(e.push(i),e.push(t/i));return n===(0|n)&&e.push(n),e.sort((t,e)=>t-e).pop(),e}(i);for(let o=0,s=a.length-1;o<s;o++){const t=a[o];if(t>r)return t}return Math.max(r,1)}(a,e,r);if(o>0){let t,n;const i=o>1?Math.round((l-s)/(o-1)):null;for(NR(e,c,u,TA(i)?0:s-i,s),t=0,n=o-1;t<n;t++)NR(e,c,u,a[t],a[t+1]);return NR(e,c,u,l,TA(i)?e.length:l+i),c}return NR(e,c,u),c}function NR(t,e,n,i,r){const a=IA(i,0),o=Math.min(IA(r,t.length),t.length);let s,l,c,u=0;for(n=Math.ceil(n),r&&(s=r-i,n=s/Math.floor(s/n)),c=a;c<0;)u++,c=Math.round(a+u*n);for(l=Math.max(a,0);l<o;l++)l===c&&(e.push(t[l]),u++,c=Math.round(a+u*n))}kt(DR,"defaults",{}),kt(DR,"defaultRoutes",void 0);const OR=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n,FR=(t,e)=>Math.min(e||t,t);function BR(t,e){const n=[],i=t.length/e,r=t.length;let a=0;for(;a<r;a+=i)n.push(t[Math.floor(a)]);return n}function UR(t,e,n){const i=t.ticks.length,r=Math.min(e,i-1),a=t._startPixel,o=t._endPixel,s=1e-6;let l,c=t.getPixelForTick(r);if(!(n&&(l=1===i?Math.max(c-a,o-c):0===e?(t.getPixelForTick(1)-c)/2:(c-t.getPixelForTick(r-1))/2,c+=r<e?l:-l,c<a-s||c>o+s)))return c}function jR(t){return t.drawTicks?t.tickLength:0}function VR(t,e){if(!t.display)return 0;const n=yP(t.font,e),i=gP(t.padding);return(EA(t.text)?t.text.length:1)*n.lineHeight+i.height}function HR(t,e,n){let i=TC(t);return(n&&"right"!==e||!n&&"right"===e)&&(i=(t=>"left"===t?"right":"right"===t?"left":t)(i)),i}class GR extends DR{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:n,_suggestedMax:i}=this;return t=PA(t,Number.POSITIVE_INFINITY),e=PA(e,Number.NEGATIVE_INFINITY),n=PA(n,Number.POSITIVE_INFINITY),i=PA(i,Number.NEGATIVE_INFINITY),{min:PA(t,n),max:PA(e,i),minDefined:CA(t),maxDefined:CA(e)}}getMinMax(t){let e,{min:n,max:i,minDefined:r,maxDefined:a}=this.getUserBounds();if(r&&a)return{min:n,max:i};const o=this.getMatchingVisibleMetas();for(let s=0,l=o.length;s<l;++s)e=o[s].controller.getMinMax(this,t),r||(n=Math.min(n,e.min)),a||(i=Math.max(i,e.max));return n=a&&n>i?i:n,i=r&&n>i?n:i,{min:PA(n,PA(i,n)),max:PA(i,PA(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){kA(this.options.beforeUpdate,[this])}update(t,e,n){const{beginAtZero:i,grace:r,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){const{min:i,max:r}=t,a=RA(e,(r-i)/2),o=(t,e)=>n&&0===t?0:t+e;return{min:o(i,-Math.abs(a)),max:o(r,a)}}(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const s=o<this.ticks.length;this._convertTicksToLabels(s?BR(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||"auto"===a.source)&&(this.ticks=zR(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),s&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){kA(this.options.afterUpdate,[this])}beforeSetDimensions(){kA(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){kA(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),kA(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){kA(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let n,i,r;for(n=0,i=t.length;n<i;n++)r=t[n],r.label=kA(e.callback,[r.value,n,t],this)}afterTickToLabelConversion(){kA(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){kA(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,n=FR(this.ticks.length,t.ticks.maxTicksLimit),i=e.minRotation||0,r=e.maxRotation;let a,o,s,l=i;if(!this._isVisible()||!e.display||i>=r||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=mC(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/n:d/(n-1),u+6>a&&(a=d/(n-(t.offset?.5:1)),o=this.maxHeight-jR(t.grid)-e.padding-VR(t.title,this.chart.options.font),s=Math.sqrt(u*u+h*h),l=lC(Math.min(Math.asin(mC((c.highest.height+6)/a,-1,1)),Math.asin(mC(o/s,-1,1))-Math.asin(mC(h/s,-1,1)))),l=Math.max(i,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){kA(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){kA(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:n,title:i,grid:r}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const a=VR(i,e.options.font);if(o?(t.width=this.maxWidth,t.height=jR(r)+a):(t.height=this.maxHeight,t.width=jR(r)+a),n.display&&this.ticks.length){const{first:e,last:i,widest:r,highest:a}=this._getLabelSizes(),s=2*n.padding,l=sC(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const e=n.mirror?0:u*r.width+c*a.height;t.height=Math.min(this.maxHeight,t.height+e+s)}else{const e=n.mirror?0:c*r.width+u*a.height;t.width=Math.min(this.maxWidth,t.width+e+s)}this._calculatePadding(e,i,u,c)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,n,i){const{ticks:{align:r,padding:a},position:o}=this.options,s=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;s?l?(u=i*t.width,h=n*e.height):(u=n*t.height,h=i*e.width):"start"===r?h=e.width:"end"===r?u=t.width:"inner"!==r&&(u=t.width/2,h=e.width/2),this.paddingLeft=Math.max((u-o+a)*this.width/(this.width-o),0),this.paddingRight=Math.max((h-c+a)*this.width/(this.width-c),0)}else{let n=e.height/2,i=t.height/2;"start"===r?(n=0,i=t.height):"end"===r&&(n=e.height,i=0),this.paddingTop=n+a,this.paddingBottom=i+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){kA(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)TA(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let n=this.ticks;e<n.length&&(n=BR(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,n){const{ctx:i,_longestTextCache:r}=this,a=[],o=[],s=Math.floor(e/FR(e,n));let l,c,u,h,d,p,f,m,g,y,v,_=0,x=0;for(l=0;l<e;l+=s){if(h=t[l].label,d=this._resolveTickFontOptions(l),i.font=p=d.string,f=r[p]=r[p]||{data:{},gc:[]},m=d.lineHeight,g=y=0,TA(h)||EA(h)){if(EA(h))for(c=0,u=h.length;c<u;++c)v=h[c],TA(v)||EA(v)||(g=XC(i,f.data,f.gc,g,v),y+=m)}else g=XC(i,f.data,f.gc,g,h),y=m;a.push(g),o.push(y),_=Math.max(g,_),x=Math.max(y,x)}!function(t,e){LA(t,t=>{const n=t.gc,i=n.length/2;let r;if(i>e){for(r=0;r<i;++r)delete t.data[n[r]];n.splice(0,i)}})}(r,e);const b=a.indexOf(_),w=o.indexOf(x),S=t=>({width:a[t]||0,height:o[t]||0});return{first:S(0),last:S(e-1),widest:S(b),highest:S(w),widths:a,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return mC(this._alignToPixels?KC(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const n=e[t];return n.$context||(n.$context=function(t,e,n){return _P(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=function(t,e){return _P(t,{scale:e,type:"scale"})}(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=sC(this.labelRotation),n=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),a=t.autoSkipPadding||0,o=r?r.widest.width+a:0,s=r?r.highest.height+a:0;return this.isHorizontal()?s*n>o*i?o/n:s/i:s*i<o*n?s/n:o/i}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,n=this.chart,i=this.options,{grid:r,position:a,border:o}=i,s=r.offset,l=this.isHorizontal(),c=this.ticks.length+(s?1:0),u=jR(r),h=[],d=o.setContext(this.getContext()),p=d.display?d.width:0,f=p/2,m=function(t){return KC(n,t,p)};let g,y,v,_,x,b,w,S,M,T,E,A;if("top"===a)g=m(this.bottom),b=this.bottom-u,S=g-f,T=m(t.top)+f,A=t.bottom;else if("bottom"===a)g=m(this.top),T=t.top,A=m(t.bottom)-f,b=g+f,S=this.top+u;else if("left"===a)g=m(this.right),x=this.right-u,w=g-f,M=m(t.left)+f,E=t.right;else if("right"===a)g=m(this.left),M=t.left,E=m(t.right)-f,x=g+f,w=this.left+u;else if("x"===e){if("center"===a)g=m((t.top+t.bottom)/2+.5);else if(AA(a)){const t=Object.keys(a)[0],e=a[t];g=m(this.chart.scales[t].getPixelForValue(e))}T=t.top,A=t.bottom,b=g+f,S=b+u}else if("y"===e){if("center"===a)g=m((t.left+t.right)/2);else if(AA(a)){const t=Object.keys(a)[0],e=a[t];g=m(this.chart.scales[t].getPixelForValue(e))}x=g-f,w=x-u,M=t.left,E=t.right}const C=IA(i.ticks.maxTicksLimit,c),P=Math.max(1,Math.ceil(c/C));for(y=0;y<c;y+=P){const t=this.getContext(y),e=r.setContext(t),i=o.setContext(t),a=e.lineWidth,c=e.color,u=i.dash||[],d=i.dashOffset,p=e.tickWidth,f=e.tickColor,m=e.tickBorderDash||[],g=e.tickBorderDashOffset;v=UR(this,y,s),void 0!==v&&(_=KC(n,v,a),l?x=w=M=E=_:b=S=T=A=_,h.push({tx1:x,ty1:b,tx2:w,ty2:S,x1:M,y1:T,x2:E,y2:A,width:a,color:c,borderDash:u,borderDashOffset:d,tickWidth:p,tickColor:f,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,h}_computeLabelItems(t){const e=this.axis,n=this.options,{position:i,ticks:r}=n,a=this.isHorizontal(),o=this.ticks,{align:s,crossAlign:l,padding:c,mirror:u}=r,h=jR(n.grid),d=h+c,p=u?-c:d,f=-sC(this.labelRotation),m=[];let g,y,v,_,x,b,w,S,M,T,E,A,C="middle";if("top"===i)b=this.bottom-p,w=this._getXAxisLabelAlignment();else if("bottom"===i)b=this.top+p,w=this._getXAxisLabelAlignment();else if("left"===i){const t=this._getYAxisLabelAlignment(h);w=t.textAlign,x=t.x}else if("right"===i){const t=this._getYAxisLabelAlignment(h);w=t.textAlign,x=t.x}else if("x"===e){if("center"===i)b=(t.top+t.bottom)/2+d;else if(AA(i)){const t=Object.keys(i)[0],e=i[t];b=this.chart.scales[t].getPixelForValue(e)+d}w=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===i)x=(t.left+t.right)/2-d;else if(AA(i)){const t=Object.keys(i)[0],e=i[t];x=this.chart.scales[t].getPixelForValue(e)}w=this._getYAxisLabelAlignment(h).textAlign}"y"===e&&("start"===s?C="top":"end"===s&&(C="bottom"));const P=this._getLabelSizes();for(g=0,y=o.length;g<y;++g){v=o[g],_=v.label;const t=r.setContext(this.getContext(g));S=this.getPixelForTick(g)+r.labelOffset,M=this._resolveTickFontOptions(g),T=M.lineHeight,E=EA(_)?_.length:1;const e=E/2,n=t.color,s=t.textStrokeColor,c=t.textStrokeWidth;let h,d=w;if(a?(x=S,"inner"===w&&(d=g===y-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),A="top"===i?"near"===l||0!==f?-E*T+T/2:"center"===l?-P.highest.height/2-e*T+T:-P.highest.height+T/2:"near"===l||0!==f?T/2:"center"===l?P.highest.height/2-e*T:P.highest.height-E*T,u&&(A*=-1),0===f||t.showLabelBackdrop||(x+=T/2*Math.sin(f))):(b=S,A=(1-E)*T/2),t.showLabelBackdrop){const e=gP(t.backdropPadding),n=P.heights[g],i=P.widths[g];let r=A-e.top,a=0-e.left;switch(C){case"middle":r-=n/2;break;case"bottom":r-=n}switch(w){case"center":a-=i/2;break;case"right":a-=i;break;case"inner":g===y-1?a-=i:g>0&&(a-=i/2)}h={left:a,top:r,width:i+e.width,height:n+e.height,color:t.backdropColor}}m.push({label:_,font:M,textOffset:A,options:{rotation:f,color:n,strokeColor:s,strokeWidth:c,textAlign:d,textBaseline:C,translation:[x,b],backdrop:h}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-sC(this.labelRotation))return"top"===t?"left":"right";let n="center";return"start"===e.align?n="left":"end"===e.align?n="right":"inner"===e.align&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:n,mirror:i,padding:r}}=this.options,a=t+r,o=this._getLabelSizes().widest.width;let s,l;return"left"===e?i?(l=this.right+r,"near"===n?s="left":"center"===n?(s="center",l+=o/2):(s="right",l+=o)):(l=this.right-a,"near"===n?s="right":"center"===n?(s="center",l-=o/2):(s="left",l=this.left)):"right"===e?i?(l=this.left+r,"near"===n?s="right":"center"===n?(s="center",l-=o/2):(s="left",l-=o)):(l=this.left+a,"near"===n?s="left":"center"===n?(s="center",l+=o/2):(s="right",l=this.right)):s="right",{textAlign:s,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:n,top:i,width:r,height:a}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(n,i,r,a),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(e=>e.value===t);if(n>=0){return e.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,a;const o=(t,e,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.restore())};if(e.display)for(r=0,a=i.length;r<a;++r){const t=i[r];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:n,grid:i}}=this,r=n.setContext(this.getContext()),a=n.display?r.width:0;if(!a)return;const o=i.setContext(this.getContext(0)).lineWidth,s=this._borderValue;let l,c,u,h;this.isHorizontal()?(l=KC(t,this.left,a)-a/2,c=KC(t,this.right,o)+o/2,u=h=s):(u=KC(t,this.top,a)-a/2,h=KC(t,this.bottom,o)+o/2,l=c=s),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(l,u),e.lineTo(c,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,n=this._computeLabelArea();n&&eP(e,n);const i=this.getLabelItems(t);for(const r of i){const t=r.options,n=r.font;sP(e,r.label,0,r.textOffset,n,t)}n&&nP(e)}drawTitle(){const{ctx:t,options:{position:e,title:n,reverse:i}}=this;if(!n.display)return;const r=yP(n.font),a=gP(n.padding),o=n.align;let s=r.lineHeight/2;"bottom"===e||"center"===e||AA(e)?(s+=a.bottom,EA(n.text)&&(s+=r.lineHeight*(n.text.length-1))):s+=a.top;const{titleX:l,titleY:c,maxWidth:u,rotation:h}=function(t,e,n,i){const{top:r,left:a,bottom:o,right:s,chart:l}=t,{chartArea:c,scales:u}=l;let h,d,p,f=0;const m=o-r,g=s-a;if(t.isHorizontal()){if(d=EC(i,a,s),AA(n)){const t=Object.keys(n)[0],i=n[t];p=u[t].getPixelForValue(i)+m-e}else p="center"===n?(c.bottom+c.top)/2+m-e:OR(t,n,e);h=s-a}else{if(AA(n)){const t=Object.keys(n)[0],i=n[t];d=u[t].getPixelForValue(i)-g+e}else d="center"===n?(c.left+c.right)/2-g+e:OR(t,n,e);p=EC(i,o,r),f="left"===n?-$A:$A}return{titleX:d,titleY:p,maxWidth:h,rotation:f}}(this,s,e,o);sP(t,n.text,0,0,r,{color:n.color,maxWidth:u,rotation:h,textAlign:HR(o,e,i),textBaseline:"middle",translation:[l,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,n=IA(t.grid&&t.grid.z,-1),i=IA(t.border&&t.border.z,0);return this._isVisible()&&this.draw===GR.prototype.draw?[{z:n,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let r,a;for(r=0,a=e.length;r<a;++r){const a=e[r];a[n]!==this.id||t&&a.type!==t||i.push(a)}return i}_resolveTickFontOptions(t){return yP(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class WR{constructor(t,e,n){this.type=t,this.scope=e,this.override=n,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let n;(function(t){return"id"in t&&"defaults"in t})(e)&&(n=this.register(e));const i=this.items,r=t.id,a=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,function(t,e,n){const i=FA(Object.create(null),[n?ZC.get(n):{},ZC.get(e),t.defaults]);ZC.set(e,i),t.defaultRoutes&&function(t,e){Object.keys(e).forEach(n=>{const i=n.split("."),r=i.pop(),a=[t].concat(i).join("."),o=e[n].split("."),s=o.pop(),l=o.join(".");ZC.route(a,r,l,s)})}(e,t.defaultRoutes);t.descriptors&&ZC.describe(e,t.descriptors)}(t,a,n),this.override&&ZC.override(t.id,t.overrides)),a}get(t){return this.items[t]}unregister(t){const e=this.items,n=t.id,i=this.scope;n in e&&delete e[n],i&&n in ZC[i]&&(delete ZC[i][n],this.override&&delete VC[n])}}class qR{constructor(){this.controllers=new WR(RI,"datasets",!0),this.elements=new WR(DR,"elements"),this.plugins=new WR(Object,"plugins"),this.scales=new WR(GR,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e)}remove(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e)}addControllers(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.controllers)}addElements(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.elements)}addPlugins(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.plugins)}addScales(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("register",e,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.controllers)}removeElements(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.elements)}removePlugins(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.plugins)}removeScales(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._each("unregister",e,this.scales)}_each(t,e,n){[...e].forEach(e=>{const i=n||this._getRegistryForType(e);n||i.isForType(e)||i===this.plugins&&e.id?this._exec(t,i,e):LA(e,e=>{const i=n||this._getRegistryForType(e);this._exec(t,i,e)})})}_exec(t,e,n){const i=HA(t);kA(n["before"+i],[],n),e[t](n),kA(n["after"+i],[],n)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}_get(t,e,n){const i=e.get(t);if(void 0===i)throw new Error('"'+t+'" is not a registered '+n+".");return i}}var ZR=new qR;class XR{constructor(){this._init=[]}notify(t,e,n,i){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const r=i?this._descriptors(t).filter(i):this._descriptors(t),a=this._notify(r,t,e,n);return"afterDestroy"===e&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),a}_notify(t,e,n,i){i=i||{};for(const r of t){const t=r.plugin;if(!1===kA(t[n],[e,i,r.options],t)&&i.cancelable)return!1}return!0}invalidate(){TA(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const n=t&&t.config,i=IA(n.options&&n.options.plugins,{}),r=function(t){const e={},n=[],i=Object.keys(ZR.plugins.items);for(let a=0;a<i.length;a++)n.push(ZR.getPlugin(i[a]));const r=t.plugins||[];for(let a=0;a<r.length;a++){const t=r[a];-1===n.indexOf(t)&&(n.push(t),e[t.id]=!0)}return{plugins:n,localIds:e}}(n);return!1!==i||e?function(t,e,n,i){let{plugins:r,localIds:a}=e;const o=[],s=t.getContext();for(const l of r){const e=l.id,r=YR(n[e],i);null!==r&&o.push({plugin:l,options:KR(t.config,{plugin:l,local:a[e]},r,s)})}return o}(t,r,i,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],n=this._cache,i=(t,e)=>t.filter(t=>!e.some(e=>t.plugin.id===e.plugin.id));this._notify(i(e,n),t,"stop"),this._notify(i(n,e),t,"start")}}function YR(t,e){return e||!1!==t?!0===t?{}:t:null}function KR(t,e,n,i){let{plugin:r,local:a}=e;const o=t.pluginScopeKeys(r),s=t.getOptionScopes(n,o);return a&&r.defaults&&s.push(r.defaults),t.createResolver(s,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function JR(t,e){const n=ZC.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function $R(t){if("x"===t||"y"===t||"r"===t)return t}function QR(t){return"top"===t||"bottom"===t?"x":"left"===t||"right"===t?"y":void 0}function tk(t){if($R(t))return t;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n){const e=r.axis||QR(r.position)||t.length>1&&$R(t[0].toLowerCase());if(e)return e}throw new Error("Cannot determine type of '".concat(t,"' axis. Please provide 'axis' or 'position' option."))}function ek(t,e,n){if(n[e+"AxisID"]===t)return{axis:e}}function nk(t,e){const n=VC[t.type]||{scales:{}},i=e.scales||{},r=JR(t.type,e),a=Object.create(null);return Object.keys(i).forEach(e=>{const o=i[e];if(!AA(o))return console.error("Invalid scale configuration for scale: ".concat(e));if(o._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(e));const s=tk(e,o,function(t,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(e=>e.xAxisID===t||e.yAxisID===t);if(n.length)return ek(t,"x",n[0])||ek(t,"y",n[0])}return{}}(e,t),ZC.scales[o.type]),l=function(t,e){return t===e?"_index_":"_value_"}(s,r),c=n.scales||{};a[e]=BA(Object.create(null),[{axis:s},o,c[s],c[l]])}),t.data.datasets.forEach(n=>{const r=n.type||t.type,o=n.indexAxis||JR(r,e),s=(VC[r]||{}).scales||{};Object.keys(s).forEach(t=>{const e=function(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,o),r=n[e+"AxisID"]||e;a[r]=a[r]||Object.create(null),BA(a[r],[{axis:e},i[r],s[t]])})}),Object.keys(a).forEach(t=>{const e=a[t];BA(e,[ZC.scales[e.type],ZC.scale])}),a}function ik(t){const e=t.options||(t.options={});e.plugins=IA(e.plugins,{}),e.scales=nk(t,e)}function rk(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const ak=new Map,ok=new Set;function sk(t,e){let n=ak.get(t);return n||(n=e(),ak.set(t,n),ok.add(n)),n}const lk=(t,e,n)=>{const i=VA(e,n);void 0!==i&&t.add(i)};class ck{constructor(t){this._config=function(t){return(t=t||{}).data=rk(t.data),ik(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=rk(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ik(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return sk(t,()=>[["datasets.".concat(t),""]])}datasetAnimationScopeKeys(t,e){return sk("".concat(t,".transition.").concat(e),()=>[["datasets.".concat(t,".transitions.").concat(e),"transitions.".concat(e)],["datasets.".concat(t),""]])}datasetElementScopeKeys(t,e){return sk("".concat(t,"-").concat(e),()=>[["datasets.".concat(t,".elements.").concat(e),"datasets.".concat(t),"elements.".concat(e),""]])}pluginScopeKeys(t){const e=t.id,n=this.type;return sk("".concat(n,"-plugin-").concat(e),()=>[["plugins.".concat(e),...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const n=this._scopeCache;let i=n.get(t);return i&&!e||(i=new Map,n.set(t,i)),i}getOptionScopes(t,e,n){const{options:i,type:r}=this,a=this._cachedScopes(t,n),o=a.get(e);if(o)return o;const s=new Set;e.forEach(e=>{t&&(s.add(t),e.forEach(e=>lk(s,t,e))),e.forEach(t=>lk(s,i,t)),e.forEach(t=>lk(s,VC[r]||{},t)),e.forEach(t=>lk(s,ZC,t)),e.forEach(t=>lk(s,HC,t))});const l=Array.from(s);return 0===l.length&&l.push(Object.create(null)),ok.has(e)&&a.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,VC[e]||{},ZC.datasets[e]||{},{type:e},ZC,HC]}resolveNamedOptions(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const r={$shared:!0},{resolver:a,subPrefixes:o}=uk(this._resolverCache,t,i);let s=a;if(function(t,e){const{isScriptable:n,isIndexable:i}=wP(t);for(const r of e){const e=n(r),a=i(r),o=(a||e)&&t[r];if(e&&(WA(o)||hk(o))||a&&EA(o))return!0}return!1}(a,e)){r.$shared=!1;s=bP(a,n=WA(n)?n():n,this.createResolver(t,n,o))}for(const l of e)r[l]=s[l];return r}createResolver(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],i=arguments.length>3?arguments[3]:void 0;const{resolver:r}=uk(this._resolverCache,t,n);return AA(e)?bP(r,e,void 0,i):r}}function uk(t,e,n){let i=t.get(e);i||(i=new Map,t.set(e,i));const r=n.join();let a=i.get(r);if(!a){a={resolver:xP(e,n),subPrefixes:n.filter(t=>!t.toLowerCase().includes("hover"))},i.set(r,a)}return a}const hk=t=>AA(t)&&Object.getOwnPropertyNames(t).some(e=>WA(t[e]));const dk=["top","bottom","left","right","chartArea"];function pk(t,e){return"top"===t||"bottom"===t||-1===dk.indexOf(t)&&"x"===e}function fk(t,e){return function(n,i){return n[t]===i[t]?n[e]-i[e]:n[t]-i[t]}}function mk(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),kA(n&&n.onComplete,[t],e)}function gk(t){const e=t.chart,n=e.options.animation;kA(n&&n.onProgress,[t],e)}function yk(t){return jP()&&"string"===typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const vk={},_k=t=>{const e=yk(t);return Object.values(vk).filter(t=>t.canvas===e).pop()};function xk(t,e,n){const i=Object.keys(t);for(const r of i){const i=+r;if(i>=e){const a=t[r];delete t[r],(n>0||i>e)&&(t[i+n]=a)}}}class bk{static register(){ZR.add(...arguments),wk()}static unregister(){ZR.remove(...arguments),wk()}constructor(t,e){const n=this.config=new ck(e),i=yk(t),r=_k(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const a=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(t){return!jP()||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas?vR:LR}(i)),this.platform.updateConfig(n);const o=this.platform.acquireContext(i,a.aspectRatio),s=o&&o.canvas,l=s&&s.height,c=s&&s.width;this.id=MA(),this.ctx=o,this.canvas=s,this.width=c,this.height=l,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new XR,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let n;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}(t=>this.update(t),a.resizeDelay||0),this._dataChanges=[],vk[this.id]=this,o&&s?(mI.listen(this,"complete",mk),mI.listen(this,"progress",gk),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:n,height:i,_aspectRatio:r}=this;return TA(t)?e&&r?r:i?n/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return ZR}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():KP(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return JC(this.canvas,this.ctx),this}stop(){return mI.stop(this),this}resize(t,e){mI.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const n=this.options,i=this.canvas,r=n.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(i,t,e,r),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),s=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,KP(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),kA(n.onResize,[this,a],this),this.attached&&this._doResize(s)&&this.render())}ensureScalesHaveIDs(){LA(this.options.scales||{},(t,e)=>{t.id=e})}buildOrUpdateScales(){const t=this.options,e=t.scales,n=this.scales,i=Object.keys(n).reduce((t,e)=>(t[e]=!1,t),{});let r=[];e&&(r=r.concat(Object.keys(e).map(t=>{const n=e[t],i=tk(t,n),r="r"===i,a="x"===i;return{options:n,dposition:r?"chartArea":a?"bottom":"left",dtype:r?"radialLinear":a?"category":"linear"}}))),LA(r,e=>{const r=e.options,a=r.id,o=tk(a,r),s=IA(r.type,e.dtype);void 0!==r.position&&pk(r.position,o)===pk(e.dposition)||(r.position=e.dposition),i[a]=!0;let l=null;if(a in n&&n[a].type===s)l=n[a];else{l=new(ZR.getScale(s))({id:a,type:s,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(r,t)}),LA(i,(t,e)=>{t||delete n[e]}),LA(n,t=>{gR.configure(this,t,t.options),gR.addBox(this,t)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort((t,e)=>t.index-e.index),n>e){for(let t=e;t<n;++t)this._destroyDatasetMeta(t);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(fk("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((t,n)=>{0===e.filter(e=>e===t._dataset).length&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=e.length;n<i;n++){const i=e[n];let r=this.getDatasetMeta(n);const a=i.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(n),r=this.getDatasetMeta(n)),r.type=a,r.indexAxis=i.indexAxis||JR(a,this.options),r.order=i.order||0,r.index=n,r.label=""+i.label,r.visible=this.isDatasetVisible(n),r.controller)r.controller.updateIndex(n),r.controller.linkScales();else{const e=ZR.getController(a),{datasetElementType:i,dataElementType:o}=ZC.datasets[a];Object.assign(e,{dataElementType:ZR.getElement(o),datasetElementType:i&&ZR.getElement(i)}),r.controller=new e(this,n),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){LA(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:t}=this.getDatasetMeta(l),e=!i&&-1===r.indexOf(t);t.buildOrUpdateElements(e),a=Math.max(+t.getMaxOverflow(),a)}a=this._minPadding=n.layout.autoPadding?a:0,this._updateLayout(a),i||LA(r,t=>{t.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(fk("z","_idx"));const{_active:o,_lastEvent:s}=this;s?this._eventHandler(s,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){LA(this.scales,t=>{gR.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);qA(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:r}of e){xk(t,i,"_removeElements"===n?-r:r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,n=e=>new Set(t.filter(t=>t[0]===e).map((t,e)=>e+","+t.splice(1).join(","))),i=n(0);for(let r=1;r<e;r++)if(!qA(i,n(r)))return;return Array.from(i).map(t=>t.split(",")).map(t=>({method:t[1],start:+t[2],count:+t[3]}))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;gR.update(this,this.width,this.height,t);const e=this.chartArea,n=e.width<=0||e.height<=0;this._layers=[],LA(this.boxes,t=>{n&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))},this),this._layers.forEach((t,e)=>{t._idx=e}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,n=this.data.datasets.length;e<n;++e)this._updateDataset(e,WA(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const n=this.getDatasetMeta(t),i={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(mI.has(this)?this.attached&&!mI.running(this)&&mI.start(this):(this.draw(),mk({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(t,e)}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,n=[];let i,r;for(i=0,r=e.length;i<r;++i){const r=e[i];t&&!r.visible||n.push(r)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,n={meta:t,index:t.index,cancelable:!0},i=pI(this,t);!1!==this.notifyPlugins("beforeDatasetDraw",n)&&(i&&eP(e,i),t.controller.draw(),i&&nP(e),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(t){return tP(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,n,i){const r=iR.modes[e];return"function"===typeof r?r(this,t,n,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],n=this._metasets;let i=n.filter(t=>t&&t._dataset===e).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=_P(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const n=this.getDatasetMeta(t);return"boolean"===typeof n.hidden?!n.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,n){const i=n?"show":"hide",r=this.getDatasetMeta(t),a=r.controller._resolveAnimations(void 0,i);GA(e)?(r.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),a.update(r,{visible:n}),this.update(e=>e.datasetIndex===t?i:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),mI.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),JC(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete vk[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(t,e,n)=>{t.offsetX=e,t.offsetY=n,this._eventHandler(t)};LA(this.options.events,t=>n(t,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(n,i)=>{t[n]&&(e.removeEventListener(this,n,i),delete t[n])},r=(t,e)=>{this.canvas&&this.resize(t,e)};let a;const o=()=>{i("attach",o),this.attached=!0,this.resize(),n("resize",r),n("detach",a)};a=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),n("attach",o)},e.isAttached(this.canvas)?o():a()}unbindEvents(){LA(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},LA(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,n){const i=n?"set":"remove";let r,a,o,s;for("dataset"===e&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),o=0,s=t.length;o<s;++o){a=t[o];const e=a&&this.getDatasetMeta(a.datasetIndex).controller;e&&e[i+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],n=t.map(t=>{let{datasetIndex:e,index:n}=t;const i=this.getDatasetMeta(e);if(!i)throw new Error("No dataset found at index "+e);return{datasetIndex:e,element:i.data[n],index:n}});!DA(n,e)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,e))}notifyPlugins(t,e,n){return this._plugins.notify(this,t,e,n)}isPluginEnabled(t){return 1===this._plugins._cache.filter(e=>e.plugin.id===t).length}_updateHoverStyles(t,e,n){const i=this.options.hover,r=(t,e)=>t.filter(t=>!e.some(e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)),a=r(e,t),o=n?t:r(t,e);a.length&&this.updateHoverStyle(a,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(t,e){const n={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const r=this._handleEvent(t,e,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(r||n.changed)&&this.render(),this}_handleEvent(t,e,n){const{_active:i=[],options:r}=this,a=e,o=this._getActiveElements(t,i,n,a),s=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,n,i){return n&&"mouseout"!==t.type?i?e:t:null}(t,this._lastEvent,n,s);n&&(this._lastEvent=null,kA(r.onHover,[t,o,this],this),s&&kA(r.onClick,[t,o,this],this));const c=!DA(o,i);return(c||e)&&(this._active=o,this._updateHoverStyles(o,i,e)),this._lastEvent=l,c}_getActiveElements(t,e,n,i){if("mouseout"===t.type)return[];if(!n)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}function wk(){return LA(bk.instances,t=>t._plugins.invalidate())}function Sk(t,e,n,i){const r=pP(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const a=(n-e)/2,o=Math.min(a,i*e/2),s=t=>{const e=(n-Math.min(a,t))*i/2;return mC(t,0,Math.min(a,e))};return{outerStart:s(r.outerStart),outerEnd:s(r.outerEnd),innerStart:mC(r.innerStart,0,o),innerEnd:mC(r.innerEnd,0,o)}}function Mk(t,e,n,i){return{x:n+t*Math.cos(e),y:i+t*Math.sin(e)}}function Tk(t,e,n,i,r,a){const{x:o,y:s,startAngle:l,pixelMargin:c,innerRadius:u}=e,h=Math.max(e.outerRadius+i+n-c,0),d=u>0?u+i+n+c:0;let p=0;const f=r-l;if(i){const t=((u>0?u-i:0)+(h>0?h-i:0))/2;p=(f-(0!==t?f*t/(t+i):f))/2}const m=(f-Math.max(.001,f*h-n/ZA)/h)/2,g=l+m+p,y=r-m-p,{outerStart:v,outerEnd:_,innerStart:x,innerEnd:b}=Sk(e,d,h,y-g),w=h-v,S=h-_,M=g+v/w,T=y-_/S,E=d+x,A=d+b,C=g+x/E,P=y-b/A;if(t.beginPath(),a){const e=(M+T)/2;if(t.arc(o,s,h,M,e),t.arc(o,s,h,e,T),_>0){const e=Mk(S,T,o,s);t.arc(e.x,e.y,_,T,y+$A)}const n=Mk(A,y,o,s);if(t.lineTo(n.x,n.y),b>0){const e=Mk(A,P,o,s);t.arc(e.x,e.y,b,y+$A,P+Math.PI)}const i=(y-b/d+(g+x/d))/2;if(t.arc(o,s,d,y-b/d,i,!0),t.arc(o,s,d,i,g+x/d,!0),x>0){const e=Mk(E,C,o,s);t.arc(e.x,e.y,x,C+Math.PI,g-$A)}const r=Mk(w,g,o,s);if(t.lineTo(r.x,r.y),v>0){const e=Mk(w,M,o,s);t.arc(e.x,e.y,v,g-$A,M)}}else{t.moveTo(o,s);const e=Math.cos(M)*h+o,n=Math.sin(M)*h+s;t.lineTo(e,n);const i=Math.cos(T)*h+o,r=Math.sin(T)*h+s;t.lineTo(i,r)}t.closePath()}function Ek(t,e,n,i,r){const{fullCircles:a,startAngle:o,circumference:s,options:l}=e,{borderWidth:c,borderJoinStyle:u,borderDash:h,borderDashOffset:d,borderRadius:p}=l,f="inner"===l.borderAlign;if(!c)return;t.setLineDash(h||[]),t.lineDashOffset=d,f?(t.lineWidth=2*c,t.lineJoin=u||"round"):(t.lineWidth=c,t.lineJoin=u||"bevel");let m=e.endAngle;if(a){Tk(t,e,n,i,m,r);for(let e=0;e<a;++e)t.stroke();isNaN(s)||(m=o+(s%XA||XA))}f&&function(t,e,n){const{startAngle:i,pixelMargin:r,x:a,y:o,outerRadius:s,innerRadius:l}=e;let c=r/s;t.beginPath(),t.arc(a,o,s,i-c,n+c),l>r?(c=r/l,t.arc(a,o,l,n+c,i-c,!0)):t.arc(a,o,r,n+$A,i-$A),t.closePath(),t.clip()}(t,e,m),l.selfJoin&&m-o>=ZA&&0===p&&"miter"!==u&&function(t,e,n){const{startAngle:i,x:r,y:a,outerRadius:o,innerRadius:s,options:l}=e,{borderWidth:c,borderJoinStyle:u}=l,h=Math.min(c/o,pC(i-n));if(t.beginPath(),t.arc(r,a,o-c/2,i+h/2,n-h/2),s>0){const e=Math.min(c/s,pC(i-n));t.arc(r,a,s+c/2,n-e/2,i+e/2,!0)}else{const e=Math.min(c/2,o*pC(i-n));if("round"===u)t.arc(r,a,e,n-ZA/2,i+ZA/2,!0);else if("bevel"===u){const o=2*e*e,s=-o*Math.cos(n+ZA/2)+r,l=-o*Math.sin(n+ZA/2)+a,c=o*Math.cos(i+ZA/2)+r,u=o*Math.sin(i+ZA/2)+a;t.lineTo(s,l),t.lineTo(c,u)}}t.closePath(),t.moveTo(0,0),t.rect(0,0,t.canvas.width,t.canvas.height),t.clip("evenodd")}(t,e,m),a||(Tk(t,e,n,i,m,r),t.stroke())}kt(bk,"defaults",ZC),kt(bk,"instances",vk),kt(bk,"overrides",VC),kt(bk,"registry",ZR),kt(bk,"version","4.5.0"),kt(bk,"getChart",_k);class Ak extends DR{constructor(t){super(),kt(this,"circumference",void 0),kt(this,"endAngle",void 0),kt(this,"fullCircles",void 0),kt(this,"innerRadius",void 0),kt(this,"outerRadius",void 0),kt(this,"pixelMargin",void 0),kt(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.getProps(["x","y"],n),{angle:r,distance:a}=uC(i,{x:t,y:e}),{startAngle:o,endAngle:s,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),h=(this.options.spacing+this.options.borderWidth)/2,d=IA(u,s-o),p=fC(r,o,s)&&o!==s,f=d>=XA||p,m=gC(a,l+h,c+h);return f&&m}getCenterPoint(t){const{x:e,y:n,startAngle:i,endAngle:r,innerRadius:a,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:s,spacing:l}=this.options,c=(i+r)/2,u=(a+o+l+s)/2;return{x:e+Math.cos(c)*u,y:n+Math.sin(c)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:n}=this,i=(e.offset||0)/4,r=(e.spacing||0)/2,a=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>XA?Math.floor(n/XA):0,0===n||this.innerRadius<0||this.outerRadius<0)return;t.save();const o=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(o)*i,Math.sin(o)*i);const s=i*(1-Math.sin(Math.min(ZA,n||0)));t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,function(t,e,n,i,r){const{fullCircles:a,startAngle:o,circumference:s}=e;let l=e.endAngle;if(a){Tk(t,e,n,i,l,r);for(let e=0;e<a;++e)t.fill();isNaN(s)||(l=o+(s%XA||XA))}Tk(t,e,n,i,l,r),t.fill()}(t,this,s,r,a),Ek(t,this,s,r,a),t.restore()}}function Ck(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;t.lineCap=IA(n.borderCapStyle,e.borderCapStyle),t.setLineDash(IA(n.borderDash,e.borderDash)),t.lineDashOffset=IA(n.borderDashOffset,e.borderDashOffset),t.lineJoin=IA(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=IA(n.borderWidth,e.borderWidth),t.strokeStyle=IA(n.borderColor,e.borderColor)}function Pk(t,e,n){t.lineTo(n.x,n.y)}function Ik(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.length,{start:r=0,end:a=i-1}=n,{start:o,end:s}=e,l=Math.max(r,o),c=Math.min(a,s),u=r<o&&a<o||r>s&&a>s;return{count:i,start:l,loop:e.loop,ilen:c<l&&!u?i+c-l:c-l}}function Rk(t,e,n,i){const{points:r,options:a}=e,{count:o,start:s,loop:l,ilen:c}=Ik(r,n,i),u=function(t){return t.stepped?iP:t.tension||"monotone"===t.cubicInterpolationMode?rP:Pk}(a);let h,d,p,{move:f=!0,reverse:m}=i||{};for(h=0;h<=c;++h)d=r[(s+(m?c-h:h))%o],d.skip||(f?(t.moveTo(d.x,d.y),f=!1):u(t,p,d,m,a.stepped),p=d);return l&&(d=r[(s+(m?c:0))%o],u(t,p,d,m,a.stepped)),!!l}function kk(t,e,n,i){const r=e.points,{count:a,start:o,ilen:s}=Ik(r,n,i),{move:l=!0,reverse:c}=i||{};let u,h,d,p,f,m,g=0,y=0;const v=t=>(o+(c?s-t:t))%a,_=()=>{p!==f&&(t.lineTo(g,f),t.lineTo(g,p),t.lineTo(g,m))};for(l&&(h=r[v(0)],t.moveTo(h.x,h.y)),u=0;u<=s;++u){if(h=r[v(u)],h.skip)continue;const e=h.x,n=h.y,i=0|e;i===d?(n<p?p=n:n>f&&(f=n),g=(y*g+e)/++y):(_(),t.lineTo(e,n),d=i,y=0,p=f=n),m=n}_()}function Lk(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&"monotone"!==e.cubicInterpolationMode&&!e.stepped&&!n?kk:Rk}kt(Ak,"id","arc"),kt(Ak,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),kt(Ak,"defaultRoutes",{backgroundColor:"backgroundColor"}),kt(Ak,"descriptors",{_scriptable:!0,_indexable:t=>"borderDash"!==t});const Dk="function"===typeof Path2D;function zk(t,e,n,i){Dk&&!e.options.segment?function(t,e,n,i){let r=e._path;r||(r=e._path=new Path2D,e.path(r,n,i)&&r.closePath()),Ck(t,e.options),t.stroke(r)}(t,e,n,i):function(t,e,n,i){const{segments:r,options:a}=e,o=Lk(e);for(const s of r)Ck(t,a,s.style),t.beginPath(),o(t,e,s,{start:n,end:n+i-1})&&t.closePath(),t.stroke()}(t,e,n,i)}class Nk extends DR{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;UP(this._points,n,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const n=t.points,i=t.options.spanGaps,r=n.length;if(!r)return[];const a=!!t._loop,{start:o,end:s}=function(t,e,n,i){let r=0,a=e-1;if(n&&!i)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,n&&(a+=r);a>r&&t[a%e].skip;)a--;return a%=e,{start:r,end:a}}(n,r,a,i);return cI(t,!0===i?[{start:o,end:s,loop:a}]:function(t,e,n,i){const r=t.length,a=[];let o,s=e,l=t[e];for(o=e+1;o<=n;++o){const n=t[o%r];n.skip||n.stop?l.skip||(i=!1,a.push({start:e%r,end:(o-1)%r,loop:i}),e=s=n.stop?o:null):(s=o,l.skip&&(e=o)),l=n}return null!==s&&a.push({start:e%r,end:s%r,loop:i}),a}(n,o,s<o?s+r:s,!!t._fullLoop&&0===o&&s===r-1),n,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}interpolate(t,e){const n=this.options,i=t[e],r=this.points,a=lI(this,{property:e,start:i,end:i});if(!a.length)return;const o=[],s=function(t){return t.stepped?tI:t.tension||"monotone"===t.cubicInterpolationMode?eI:QP}(n);let l,c;for(l=0,c=a.length;l<c;++l){const{start:c,end:u}=a[l],h=r[c],d=r[u];if(h===d){o.push(h);continue}const p=s(h,d,Math.abs((i-h[e])/(d[e]-h[e])),n.stepped);p[e]=t[e],o.push(p)}return 1===o.length?o[0]:o}pathSegment(t,e,n){return Lk(this)(t,this,e,n)}path(t,e,n){const i=this.segments,r=Lk(this);let a=this._loop;e=e||0,n=n||this.points.length-e;for(const o of i)a&=r(t,this,o,{start:e,end:e+n-1});return!!a}draw(t,e,n,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),zk(t,this,n,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Ok(t,e,n,i){const r=t.options,{[n]:a}=t.getProps([n],i);return Math.abs(e-a)<r.radius+r.hitRadius}kt(Nk,"id","line"),kt(Nk,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),kt(Nk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),kt(Nk,"descriptors",{_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t});class Fk extends DR{constructor(t){super(),kt(this,"parsed",void 0),kt(this,"skip",void 0),kt(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.options,{x:r,y:a}=this.getProps(["x","y"],n);return Math.pow(t-r,2)+Math.pow(e-a,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,e){return Ok(this,t,"x",e)}inYRange(t,e){return Ok(this,t,"y",e)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const n=this.options;this.skip||n.radius<.1||!tP(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,$C(t,n,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function Bk(t,e){const{x:n,y:i,base:r,width:a,height:o}=t.getProps(["x","y","base","width","height"],e);let s,l,c,u,h;return t.horizontal?(h=o/2,s=Math.min(n,r),l=Math.max(n,r),c=i-h,u=i+h):(h=a/2,s=n-h,l=n+h,c=Math.min(i,r),u=Math.max(i,r)),{left:s,top:c,right:l,bottom:u}}function Uk(t,e,n,i){return t?0:mC(e,n,i)}function jk(t){const e=Bk(t),n=e.right-e.left,i=e.bottom-e.top,r=function(t,e,n){const i=t.options.borderWidth,r=t.borderSkipped,a=fP(i);return{t:Uk(r.top,a.top,0,n),r:Uk(r.right,a.right,0,e),b:Uk(r.bottom,a.bottom,0,n),l:Uk(r.left,a.left,0,e)}}(t,n/2,i/2),a=function(t,e,n){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),r=t.options.borderRadius,a=mP(r),o=Math.min(e,n),s=t.borderSkipped,l=i||AA(r);return{topLeft:Uk(!l||s.top||s.left,a.topLeft,0,o),topRight:Uk(!l||s.top||s.right,a.topRight,0,o),bottomLeft:Uk(!l||s.bottom||s.left,a.bottomLeft,0,o),bottomRight:Uk(!l||s.bottom||s.right,a.bottomRight,0,o)}}(t,n/2,i/2);return{outer:{x:e.left,y:e.top,w:n,h:i,radius:a},inner:{x:e.left+r.l,y:e.top+r.t,w:n-r.l-r.r,h:i-r.t-r.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,a.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(r.b,r.r))}}}}function Vk(t,e,n,i){const r=null===e,a=null===n,o=t&&!(r&&a)&&Bk(t,i);return o&&(r||gC(e,o.left,o.right))&&(a||gC(n,o.top,o.bottom))}function Hk(t,e){t.rect(e.x,e.y,e.w,e.h)}function Gk(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.x!==n.x?-e:0,r=t.y!==n.y?-e:0,a=(t.x+t.w!==n.x+n.w?e:0)-i,o=(t.y+t.h!==n.y+n.h?e:0)-r;return{x:t.x+i,y:t.y+r,w:t.w+a,h:t.h+o,radius:t.radius}}kt(Fk,"id","point"),kt(Fk,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),kt(Fk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class Wk extends DR{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:n,backgroundColor:i}}=this,{inner:r,outer:a}=jk(this),o=(s=a.radius).topLeft||s.topRight||s.bottomLeft||s.bottomRight?lP:Hk;var s;t.save(),a.w===r.w&&a.h===r.h||(t.beginPath(),o(t,Gk(a,e,r)),t.clip(),o(t,Gk(r,-e,a)),t.fillStyle=n,t.fill("evenodd")),t.beginPath(),o(t,Gk(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,n){return Vk(this,t,e,n)}inXRange(t,e){return Vk(this,t,null,e)}inYRange(t,e){return Vk(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?n:(n+i)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}kt(Wk,"id","bar"),kt(Wk,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),kt(Wk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const qk=(t,e)=>{let{boxHeight:n=e,boxWidth:i=e}=t;return t.usePointStyle&&(n=Math.min(n,e),i=t.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(e,n)}};class Zk extends DR{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=kA(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(e=>t.filter(e,this.chart.data))),t.sort&&(e=e.sort((e,n)=>t.sort(e,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const n=t.labels,i=yP(n.font),r=i.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:s}=qk(n,r);let l,c;e.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(a,r,o,s)+10):(c=this.maxHeight,l=this._fitCols(a,i,o,s)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(c,t.maxHeight||this.maxHeight)}_fitRows(t,e,n,i){const{ctx:r,maxWidth:a,options:{labels:{padding:o}}}=this,s=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+o;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach((t,p)=>{const f=n+e/2+r.measureText(t.text).width;(0===p||l[l.length-1]+f+2*o>a)&&(u+=c,l[l.length-(p>0?0:1)]=0,d+=c,h++),s[p]={left:0,top:d,row:h,width:f,height:i},l[l.length-1]+=f+o}),u}_fitCols(t,e,n,i){const{ctx:r,maxHeight:a,options:{labels:{padding:o}}}=this,s=this.legendHitBoxes=[],l=this.columnSizes=[],c=a-t;let u=o,h=0,d=0,p=0,f=0;return this.legendItems.forEach((t,a)=>{const{itemWidth:m,itemHeight:g}=function(t,e,n,i,r){const a=function(t,e,n,i){let r=t.text;r&&"string"!==typeof r&&(r=r.reduce((t,e)=>t.length>e.length?t:e));return e+n.size/2+i.measureText(r).width}(i,t,e,n),o=function(t,e,n){let i=t;"string"!==typeof e.text&&(i=Xk(e,n));return i}(r,i,e.lineHeight);return{itemWidth:a,itemHeight:o}}(n,e,r,t,i);a>0&&d+g+2*o>c&&(u+=h+o,l.push({width:h,height:d}),p+=h+o,f++,h=d=0),s[a]={left:p,top:d,col:f,width:m,height:g},h=Math.max(h,m),d+=g+o}),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:n,labels:{padding:i},rtl:r}}=this,a=nI(r,this.left,this.width);if(this.isHorizontal()){let r=0,o=EC(n,this.left+i,this.right-this.lineWidths[r]);for(const s of e)r!==s.row&&(r=s.row,o=EC(n,this.left+i,this.right-this.lineWidths[r])),s.top+=this.top+t+i,s.left=a.leftForLtr(a.x(o),s.width),o+=s.width+i}else{let r=0,o=EC(n,this.top+t+i,this.bottom-this.columnSizes[r].height);for(const s of e)s.col!==r&&(r=s.col,o=EC(n,this.top+t+i,this.bottom-this.columnSizes[r].height)),s.top=o,s.left+=this.left+i,s.left=a.leftForLtr(a.x(s.left),s.width),o+=s.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;eP(t,this),this._draw(),nP(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:n,ctx:i}=this,{align:r,labels:a}=t,o=ZC.color,s=nI(t.rtl,this.left,this.width),l=yP(a.font),{padding:c}=a,u=l.size,h=u/2;let d;this.drawTitle(),i.textAlign=s.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:p,boxHeight:f,itemHeight:m}=qk(a,u),g=this.isHorizontal(),y=this._computeTitleHeight();d=g?{x:EC(r,this.left+c,this.right-n[0]),y:this.top+c+y,line:0}:{x:this.left+c,y:EC(r,this.top+y+c,this.bottom-e[0].height),line:0},iI(this.ctx,t.textDirection);const v=m+c;this.legendItems.forEach((_,x)=>{i.strokeStyle=_.fontColor,i.fillStyle=_.fontColor;const b=i.measureText(_.text).width,w=s.textAlign(_.textAlign||(_.textAlign=a.textAlign)),S=p+h+b;let M=d.x,T=d.y;s.setWidth(this.width),g?x>0&&M+S+c>this.right&&(T=d.y+=v,d.line++,M=d.x=EC(r,this.left+c,this.right-n[d.line])):x>0&&T+v>this.bottom&&(M=d.x=M+e[d.line].width+c,d.line++,T=d.y=EC(r,this.top+y+c,this.bottom-e[d.line].height));if(function(t,e,n){if(isNaN(p)||p<=0||isNaN(f)||f<0)return;i.save();const r=IA(n.lineWidth,1);if(i.fillStyle=IA(n.fillStyle,o),i.lineCap=IA(n.lineCap,"butt"),i.lineDashOffset=IA(n.lineDashOffset,0),i.lineJoin=IA(n.lineJoin,"miter"),i.lineWidth=r,i.strokeStyle=IA(n.strokeStyle,o),i.setLineDash(IA(n.lineDash,[])),a.usePointStyle){const o={radius:f*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:r},l=s.xPlus(t,p/2);QC(i,o,l,e+h,a.pointStyleWidth&&p)}else{const a=e+Math.max((u-f)/2,0),o=s.leftForLtr(t,p),l=mP(n.borderRadius);i.beginPath(),Object.values(l).some(t=>0!==t)?lP(i,{x:o,y:a,w:p,h:f,radius:l}):i.rect(o,a,p,f),i.fill(),0!==r&&i.stroke()}i.restore()}(s.x(M),T,_),M=((t,e,n,i)=>t===(i?"left":"right")?n:"center"===t?(e+n)/2:e)(w,M+p+h,g?M+S:this.right,t.rtl),function(t,e,n){sP(i,n.text,t,e+m/2,l,{strikethrough:n.hidden,textAlign:s.textAlign(n.textAlign)})}(s.x(M),T,_),g)d.x+=S+c;else if("string"!==typeof _.text){const t=l.lineHeight;d.y+=Xk(_,t)+c}else d.y+=v}),rI(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,n=yP(e.font),i=gP(e.padding);if(!e.display)return;const r=nI(t.rtl,this.left,this.width),a=this.ctx,o=e.position,s=n.size/2,l=i.top+s;let c,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+l,u=EC(t.align,u,this.right-h);else{const e=this.columnSizes.reduce((t,e)=>Math.max(t,e.height),0);c=l+EC(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=EC(o,u,u+h);a.textAlign=r.textAlign(TC(o)),a.textBaseline="middle",a.strokeStyle=e.color,a.fillStyle=e.color,a.font=n.string,sP(a,e.text,d,c,n)}_computeTitleHeight(){const t=this.options.title,e=yP(t.font),n=gP(t.padding);return t.display?e.lineHeight+n.height:0}_getLegendItemAt(t,e){let n,i,r;if(gC(t,this.left,this.right)&&gC(e,this.top,this.bottom))for(r=this.legendHitBoxes,n=0;n<r.length;++n)if(i=r[n],gC(t,i.left,i.left+i.width)&&gC(e,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(t){const e=this.options;if(!function(t,e){if(("mousemove"===t||"mouseout"===t)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const n=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const i=this._hoveredItem,r=((t,e)=>null!==t&&null!==e&&t.datasetIndex===e.datasetIndex&&t.index===e.index)(i,n);i&&!r&&kA(e.onLeave,[t,i,this],this),this._hoveredItem=n,n&&!r&&kA(e.onHover,[t,n,this],this)}else n&&kA(e.onClick,[t,n,this],this)}}function Xk(t,e){return e*(t.text?t.text.length:0)}var Yk={id:"legend",_element:Zk,start(t,e,n){const i=t.legend=new Zk({ctx:t.ctx,options:n,chart:t});gR.configure(t,i,n),gR.addBox(t,i)},stop(t){gR.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const i=t.legend;gR.configure(t,i,n),i.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const i=e.datasetIndex,r=n.chart;r.isDatasetVisible(i)?(r.hide(i),e.hidden=!0):(r.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:r,color:a,useBorderRadius:o,borderRadius:s}}=t.legend.options;return t._getSortedDatasetMetas().map(t=>{const l=t.controller.getStyle(n?0:void 0),c=gP(l.borderWidth);return{text:e[t.index].label,fillStyle:l.backgroundColor,fontColor:a,hidden:!t.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:r||l.textAlign,borderRadius:o&&(s||l.borderRadius),datasetIndex:t.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Kk extends DR{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const i=EA(n.text)?n.text.length:1;this._padding=gP(n.padding);const r=i*yP(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:n,bottom:i,right:r,options:a}=this,o=a.align;let s,l,c,u=0;return this.isHorizontal()?(l=EC(o,n,r),c=e+t,s=r-n):("left"===a.position?(l=n+t,c=EC(o,i,e),u=-.5*ZA):(l=r-t,c=EC(o,e,i),u=.5*ZA),s=i-e),{titleX:l,titleY:c,maxWidth:s,rotation:u}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const n=yP(e.font),i=n.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:o,rotation:s}=this._drawArgs(i);sP(t,e.text,0,0,n,{color:e.color,maxWidth:o,rotation:s,textAlign:TC(e.align),textBaseline:"middle",translation:[r,a]})}}var Jk={id:"title",_element:Kk,start(t,e,n){!function(t,e){const n=new Kk({ctx:t.ctx,options:e,chart:t});gR.configure(t,n,e),gR.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){const e=t.titleBlock;gR.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const i=t.titleBlock;gR.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;const $k={average(t){if(!t.length)return!1;let e,n,i=new Set,r=0,a=0;for(e=0,n=t.length;e<n;++e){const n=t[e].element;if(n&&n.hasValue()){const t=n.tooltipPosition();i.add(t.x),r+=t.y,++a}}if(0===a||0===i.size)return!1;const o=[...i].reduce((t,e)=>t+e)/i.size;return{x:o,y:r/a}},nearest(t,e){if(!t.length)return!1;let n,i,r,a=e.x,o=e.y,s=Number.POSITIVE_INFINITY;for(n=0,i=t.length;n<i;++n){const i=t[n].element;if(i&&i.hasValue()){const t=hC(e,i.getCenterPoint());t<s&&(s=t,r=i)}}if(r){const t=r.tooltipPosition();a=t.x,o=t.y}return{x:a,y:o}}};function Qk(t,e){return e&&(EA(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function tL(t){return("string"===typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function eL(t,e){const{element:n,datasetIndex:i,index:r}=e,a=t.getDatasetMeta(i).controller,{label:o,value:s}=a.getLabelAndValue(r);return{chart:t,label:o,parsed:a.getParsed(r),raw:t.data.datasets[i].data[r],formattedValue:s,dataset:a.getDataset(),dataIndex:r,datasetIndex:i,element:n}}function nL(t,e){const n=t.chart.ctx,{body:i,footer:r,title:a}=t,{boxWidth:o,boxHeight:s}=e,l=yP(e.bodyFont),c=yP(e.titleFont),u=yP(e.footerFont),h=a.length,d=r.length,p=i.length,f=gP(e.padding);let m=f.height,g=0,y=i.reduce((t,e)=>t+e.before.length+e.lines.length+e.after.length,0);if(y+=t.beforeBody.length+t.afterBody.length,h&&(m+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),y){m+=p*(e.displayColors?Math.max(s,l.lineHeight):l.lineHeight)+(y-p)*l.lineHeight+(y-1)*e.bodySpacing}d&&(m+=e.footerMarginTop+d*u.lineHeight+(d-1)*e.footerSpacing);let v=0;const _=function(t){g=Math.max(g,n.measureText(t).width+v)};return n.save(),n.font=c.string,LA(t.title,_),n.font=l.string,LA(t.beforeBody.concat(t.afterBody),_),v=e.displayColors?o+2+e.boxPadding:0,LA(i,t=>{LA(t.before,_),LA(t.lines,_),LA(t.after,_)}),v=0,n.font=u.string,LA(t.footer,_),n.restore(),g+=f.width,{width:g,height:m}}function iL(t,e,n,i){const{x:r,width:a}=n,{width:o,chartArea:{left:s,right:l}}=t;let c="center";return"center"===i?c=r<=(s+l)/2?"left":"right":r<=a/2?c="left":r>=o-a/2&&(c="right"),function(t,e,n,i){const{x:r,width:a}=i,o=n.caretSize+n.caretPadding;return"left"===t&&r+a+o>e.width||"right"===t&&r-a-o<0||void 0}(c,t,e,n)&&(c="center"),c}function rL(t,e,n){const i=n.yAlign||e.yAlign||function(t,e){const{y:n,height:i}=e;return n<i/2?"top":n>t.height-i/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||iL(t,e,n,i),yAlign:i}}function aL(t,e,n,i){const{caretSize:r,caretPadding:a,cornerRadius:o}=t,{xAlign:s,yAlign:l}=n,c=r+a,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=mP(o);let f=function(t,e){let{x:n,width:i}=t;return"right"===e?n-=i:"center"===e&&(n-=i/2),n}(e,s);const m=function(t,e,n){let{y:i,height:r}=t;return"top"===e?i+=n:i-="bottom"===e?r+n:r/2,i}(e,l,c);return"center"===l?"left"===s?f+=c:"right"===s&&(f-=c):"left"===s?f-=Math.max(u,d)+r:"right"===s&&(f+=Math.max(h,p)+r),{x:mC(f,0,i.width-e.width),y:mC(m,0,i.height-e.height)}}function oL(t,e,n){const i=gP(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-i.right:t.x+i.left}function sL(t){return Qk([],tL(t))}function lL(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}const cL={beforeTitle:SA,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return n[e.dataIndex]}return""},afterTitle:SA,beforeBody:SA,beforeLabel:SA,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return TA(n)||(e+=n),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:SA,afterBody:SA,beforeFooter:SA,footer:SA,afterFooter:SA};function uL(t,e,n,i){const r=t[e].call(n,i);return"undefined"===typeof r?cL[e].call(n,i):r}class hL extends DR{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&e.options.animation&&n.animations,r=new _I(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,n=this._tooltipItems,_P(t,{tooltip:e,tooltipItems:n,type:"tooltip"})));var t,e,n}getTitle(t,e){const{callbacks:n}=e,i=uL(n,"beforeTitle",this,t),r=uL(n,"title",this,t),a=uL(n,"afterTitle",this,t);let o=[];return o=Qk(o,tL(i)),o=Qk(o,tL(r)),o=Qk(o,tL(a)),o}getBeforeBody(t,e){return sL(uL(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:n}=e,i=[];return LA(t,t=>{const e={before:[],lines:[],after:[]},r=lL(n,t);Qk(e.before,tL(uL(r,"beforeLabel",this,t))),Qk(e.lines,uL(r,"label",this,t)),Qk(e.after,tL(uL(r,"afterLabel",this,t))),i.push(e)}),i}getAfterBody(t,e){return sL(uL(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:n}=e,i=uL(n,"beforeFooter",this,t),r=uL(n,"footer",this,t),a=uL(n,"afterFooter",this,t);let o=[];return o=Qk(o,tL(i)),o=Qk(o,tL(r)),o=Qk(o,tL(a)),o}_createItems(t){const e=this._active,n=this.chart.data,i=[],r=[],a=[];let o,s,l=[];for(o=0,s=e.length;o<s;++o)l.push(eL(this.chart,e[o]));return t.filter&&(l=l.filter((e,i,r)=>t.filter(e,i,r,n))),t.itemSort&&(l=l.sort((e,i)=>t.itemSort(e,i,n))),LA(l,e=>{const n=lL(t.callbacks,e);i.push(uL(n,"labelColor",this,e)),r.push(uL(n,"labelPointStyle",this,e)),a.push(uL(n,"labelTextColor",this,e))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=a,this.dataPoints=l,l}update(t,e){const n=this.options.setContext(this.getContext()),i=this._active;let r,a=[];if(i.length){const t=$k[n.position].call(this,i,this._eventPosition);a=this._createItems(n),this.title=this.getTitle(a,n),this.beforeBody=this.getBeforeBody(a,n),this.body=this.getBody(a,n),this.afterBody=this.getAfterBody(a,n),this.footer=this.getFooter(a,n);const e=this._size=nL(this,n),o=Object.assign({},t,e),s=rL(this.chart,n,o),l=aL(n,o,s,this.chart);this.xAlign=s.xAlign,this.yAlign=s.yAlign,r={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(r={opacity:0});this._tooltipItems=a,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,n,i){const r=this.getCaretPosition(t,n,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,n){const{xAlign:i,yAlign:r}=this,{caretSize:a,cornerRadius:o}=n,{topLeft:s,topRight:l,bottomLeft:c,bottomRight:u}=mP(o),{x:h,y:d}=t,{width:p,height:f}=e;let m,g,y,v,_,x;return"center"===r?(_=d+f/2,"left"===i?(m=h,g=m-a,v=_+a,x=_-a):(m=h+p,g=m+a,v=_-a,x=_+a),y=m):(g="left"===i?h+Math.max(s,c)+a:"right"===i?h+p-Math.max(l,u)-a:this.caretX,"top"===r?(v=d,_=v-a,m=g-a,y=g+a):(v=d+f,_=v+a,m=g+a,y=g-a),x=v),{x1:m,x2:g,x3:y,y1:v,y2:_,y3:x}}drawTitle(t,e,n){const i=this.title,r=i.length;let a,o,s;if(r){const l=nI(n.rtl,this.x,this.width);for(t.x=oL(this,n.titleAlign,n),e.textAlign=l.textAlign(n.titleAlign),e.textBaseline="middle",a=yP(n.titleFont),o=n.titleSpacing,e.fillStyle=n.titleColor,e.font=a.string,s=0;s<r;++s)e.fillText(i[s],l.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+o,s+1===r&&(t.y+=n.titleMarginBottom-o)}}_drawColorBox(t,e,n,i,r){const a=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:s,boxWidth:l}=r,c=yP(r.bodyFont),u=oL(this,"left",r),h=i.x(u),d=s<c.lineHeight?(c.lineHeight-s)/2:0,p=e.y+d;if(r.usePointStyle){const e={radius:Math.min(l,s)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=i.leftForLtr(h,l)+l/2,c=p+s/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,$C(t,e,n,c),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,$C(t,e,n,c)}else{t.lineWidth=AA(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const e=i.leftForLtr(h,l),n=i.leftForLtr(i.xPlus(h,1),l-2),o=mP(a.borderRadius);Object.values(o).some(t=>0!==t)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,lP(t,{x:e,y:p,w:l,h:s,radius:o}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),lP(t,{x:n,y:p+1,w:l-2,h:s-2,radius:o}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(e,p,l,s),t.strokeRect(e,p,l,s),t.fillStyle=a.backgroundColor,t.fillRect(n,p+1,l-2,s-2))}t.fillStyle=this.labelTextColors[n]}drawBody(t,e,n){const{body:i}=this,{bodySpacing:r,bodyAlign:a,displayColors:o,boxHeight:s,boxWidth:l,boxPadding:c}=n,u=yP(n.bodyFont);let h=u.lineHeight,d=0;const p=nI(n.rtl,this.x,this.width),f=function(n){e.fillText(n,p.x(t.x+d),t.y+h/2),t.y+=h+r},m=p.textAlign(a);let g,y,v,_,x,b,w;for(e.textAlign=a,e.textBaseline="middle",e.font=u.string,t.x=oL(this,m,n),e.fillStyle=n.bodyColor,LA(this.beforeBody,f),d=o&&"right"!==m?"center"===a?l/2+c:l+2+c:0,_=0,b=i.length;_<b;++_){for(g=i[_],y=this.labelTextColors[_],e.fillStyle=y,LA(g.before,f),v=g.lines,o&&v.length&&(this._drawColorBox(e,t,_,p,n),h=Math.max(u.lineHeight,s)),x=0,w=v.length;x<w;++x)f(v[x]),h=u.lineHeight;LA(g.after,f)}d=0,h=u.lineHeight,LA(this.afterBody,f),t.y-=r}drawFooter(t,e,n){const i=this.footer,r=i.length;let a,o;if(r){const s=nI(n.rtl,this.x,this.width);for(t.x=oL(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=s.textAlign(n.footerAlign),e.textBaseline="middle",a=yP(n.footerFont),e.fillStyle=n.footerColor,e.font=a.string,o=0;o<r;++o)e.fillText(i[o],s.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+n.footerSpacing}}drawBackground(t,e,n,i){const{xAlign:r,yAlign:a}=this,{x:o,y:s}=t,{width:l,height:c}=n,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:p}=mP(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(o+u,s),"top"===a&&this.drawCaret(t,e,n,i),e.lineTo(o+l-h,s),e.quadraticCurveTo(o+l,s,o+l,s+h),"center"===a&&"right"===r&&this.drawCaret(t,e,n,i),e.lineTo(o+l,s+c-p),e.quadraticCurveTo(o+l,s+c,o+l-p,s+c),"bottom"===a&&this.drawCaret(t,e,n,i),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),"center"===a&&"left"===r&&this.drawCaret(t,e,n,i),e.lineTo(o,s+u),e.quadraticCurveTo(o,s,o+u,s),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,n=this.$animations,i=n&&n.x,r=n&&n.y;if(i||r){const n=$k[t.position].call(this,this._active,this._eventPosition);if(!n)return;const a=this._size=nL(this,t),o=Object.assign({},n,this._size),s=rL(e,t,o),l=aL(t,o,s,e);i._to===l.x&&r._to===l.y||(this.xAlign=s.xAlign,this.yAlign=s.yAlign,this.width=a.width,this.height=a.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const a=gP(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(r,t,i,e),iI(t,e.textDirection),r.y+=a.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),rI(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const n=this._active,i=t.map(t=>{let{datasetIndex:e,index:n}=t;const i=this.chart.getDatasetMeta(e);if(!i)throw new Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:i.data[n],index:n}}),r=!DA(n,i),a=this._positionChanged(i,e);(r||a)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],a=this._getActiveElements(t,r,e,n),o=this._positionChanged(a,t),s=e||!DA(a,r)||o;return s&&(this._active=a,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),s}_getActiveElements(t,e,n,i){const r=this.options;if("mouseout"===t.type)return[];if(!i)return e.filter(t=>this.chart.data.datasets[t.datasetIndex]&&void 0!==this.chart.getDatasetMeta(t.datasetIndex).controller.getParsed(t.index));const a=this.chart.getElementsAtEventForMode(t,r.mode,r,n);return r.reverse&&a.reverse(),a}_positionChanged(t,e){const{caretX:n,caretY:i,options:r}=this,a=$k[r.position].call(this,t,e);return!1!==a&&(n!==a.x||i!==a.y)}}kt(hL,"positioners",$k);var dL={id:"tooltip",_element:hL,positioners:$k,afterInit(t,e,n){n&&(t.tooltip=new hL({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",Dt(Dt({},n),{},{cancelable:!0})))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:cL},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function pL(t,e,n,i){const r=t.indexOf(e);if(-1===r)return((t,e,n,i)=>("string"===typeof e?(n=t.push(e)-1,i.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,i);return r!==t.lastIndexOf(e)?n:r}function fL(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class mL extends GR{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:n,label:i}of e)t[n]===i&&t.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(TA(t))return null;const n=this.getLabels();return((t,e)=>null===t?null:mC(Math.round(t),0,e))(e=isFinite(e)&&n[e]===t?e:pL(n,t,IA(e,t),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(n=0),e||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const t=this.min,e=this.max,n=this.options.offset,i=[];let r=this.getLabels();r=0===t&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let a=t;a<=e;a++)i.push({value:a});return i}getLabelForValue(t){return fL.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!==typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function gL(t,e){const n=[],{bounds:i,step:r,min:a,max:o,precision:s,count:l,maxTicks:c,maxDigits:u,includeBounds:h}=t,d=r||1,p=c-1,{min:f,max:m}=e,g=!TA(a),y=!TA(o),v=!TA(l),_=(m-f)/(u+1);let x,b,w,S,M=rC((m-f)/p/d)*d;if(M<1e-14&&!g&&!y)return[{value:f},{value:m}];S=Math.ceil(m/M)-Math.floor(f/M),S>p&&(M=rC(S*M/p/d)*d),TA(s)||(x=Math.pow(10,s),M=Math.ceil(M*x)/x),"ticks"===i?(b=Math.floor(f/M)*M,w=Math.ceil(m/M)*M):(b=f,w=m),g&&y&&r&&function(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((o-a)/r,M/1e3)?(S=Math.round(Math.min((o-a)/M,c)),M=(o-a)/S,b=a,w=o):v?(b=g?a:b,w=y?o:w,S=l-1,M=(w-b)/S):(S=(w-b)/M,S=iC(S,Math.round(S),M/1e3)?Math.round(S):Math.ceil(S));const T=Math.max(cC(M),cC(b));x=Math.pow(10,TA(s)?T:s),b=Math.round(b*x)/x,w=Math.round(w*x)/x;let E=0;for(g&&(h&&b!==a?(n.push({value:a}),b<a&&E++,iC(Math.round((b+E*M)*x)/x,a,yL(a,_,t))&&E++):b<a&&E++);E<S;++E){const t=Math.round((b+E*M)*x)/x;if(y&&t>o)break;n.push({value:t})}return y&&h&&w!==o?n.length&&iC(n[n.length-1].value,o,yL(o,_,t))?n[n.length-1].value=o:n.push({value:o}):y&&w!==o||n.push({value:w}),n}function yL(t,e,n){let{horizontal:i,minRotation:r}=n;const a=sC(r),o=(i?Math.sin(a):Math.cos(a))||.001,s=.75*e*(""+t).length;return Math.min(e/o,s)}kt(mL,"id","category"),kt(mL,"defaults",{ticks:{callback:fL}});class vL extends GR{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return TA(t)||("number"===typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:i,max:r}=this;const a=t=>i=e?i:t,o=t=>r=n?r:t;if(t){const t=nC(i),e=nC(r);t<0&&e<0?o(0):t>0&&e>0&&a(0)}if(i===r){let e=0===r?1:Math.abs(.05*r);o(r+e),t||a(i-e)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:n,stepSize:i}=t;return i?(e=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,e>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(e," ticks. Limiting to 1000.")),e=1e3)):(e=this.computeTickLimit(),n=n||11),n&&(e=Math.min(n,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=gL({maxTicks:n,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&oC(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const t=this.ticks;let e=this.min,n=this.max;if(super.configure(),this.options.offset&&t.length){const i=(n-e)/Math.max(t.length-1,1)/2;e-=i,n+=i}this._startValue=e,this._endValue=n,this._valueRange=n-e}getLabelForValue(t){return BC(t,this.chart.options.locale,this.options.ticks.format)}}class _L extends vL{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=CA(t)?t:0,this.max=CA(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,n=sC(this.options.ticks.minRotation),i=(t?Math.sin(n):Math.cos(n))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}kt(_L,"id","linear"),kt(_L,"defaults",{ticks:{callback:jC.formatters.numeric}});const xL=t=>Math.floor(eC(t)),bL=(t,e)=>Math.pow(10,xL(t)+e);function wL(t){return 1===t/Math.pow(10,xL(t))}function SL(t,e,n){const i=Math.pow(10,n),r=Math.floor(t/i);return Math.ceil(e/i)-r}function ML(t,e){let{min:n,max:i}=e;n=PA(t.min,n);const r=[],a=xL(n);let o=function(t,e){let n=xL(e-t);for(;SL(t,e,n)>10;)n++;for(;SL(t,e,n)<10;)n--;return Math.min(n,xL(t))}(n,i),s=o<0?Math.pow(10,Math.abs(o)):1;const l=Math.pow(10,o),c=a>o?Math.pow(10,a):0,u=Math.round((n-c)*s)/s,h=Math.floor((n-c)/l/10)*l*10;let d=Math.floor((u-h)/Math.pow(10,o)),p=PA(t.min,Math.round((c+h+d*Math.pow(10,o))*s)/s);for(;p<i;)r.push({value:p,major:wL(p),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(o++,d=2,s=o>=0?1:s),p=Math.round((c+h+d*Math.pow(10,o))*s)/s;const f=PA(t.max,p);return r.push({value:f,major:wL(f),significand:d}),r}class TL extends GR{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const n=vL.prototype.parse.apply(this,[t,e]);if(0!==n)return CA(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=CA(t)?Math.max(0,t):null,this.max=CA(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!CA(this._userMin)&&(this.min=t===bL(this.min,0)?bL(this.min,-1):bL(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let n=this.min,i=this.max;const r=e=>n=t?n:e,a=t=>i=e?i:t;n===i&&(n<=0?(r(1),a(10)):(r(bL(n,-1)),a(bL(i,1)))),n<=0&&r(bL(i,-1)),i<=0&&a(bL(n,1)),this.min=n,this.max=i}buildTicks(){const t=this.options,e=ML({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&oC(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":BC(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=eC(t),this._valueRange=eC(this.max)-eC(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(eC(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function EL(t){const e=t.ticks;if(e.display&&t.display){const t=gP(e.backdropPadding);return IA(e.font&&e.font.size,ZC.font.size)+t.height}return 0}function AL(t,e,n){return n=EA(n)?n:[n],{w:YC(t,e.string,n),h:n.length*e.lineHeight}}function CL(t,e,n,i,r){return t===i||t===r?{start:e-n/2,end:e+n/2}:t<i||t>r?{start:e-n,end:e}:{start:e,end:e+n}}function PL(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),i=[],r=[],a=t._pointLabels.length,o=t.options.pointLabels,s=o.centerPointLabels?ZA/a:0;for(let l=0;l<a;l++){const a=o.setContext(t.getPointLabelContext(l));r[l]=a.padding;const c=t.getPointPosition(l,t.drawingArea+r[l],s),u=yP(a.font),h=AL(t.ctx,u,t._pointLabels[l]);i[l]=h;const d=pC(t.getIndexAngle(l)+s),p=Math.round(lC(d));IL(n,e,d,CL(p,c.x,h.w,0,180),CL(p,c.y,h.h,90,270))}t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function(t,e,n){const i=[],r=t._pointLabels.length,a=t.options,{centerPointLabels:o,display:s}=a.pointLabels,l={extra:EL(a)/2,additionalAngle:o?ZA/r:0};let c;for(let u=0;u<r;u++){l.padding=n[u],l.size=e[u];const r=RL(t,u,l);i.push(r),"auto"===s&&(r.visible=kL(r,c),r.visible&&(c=r))}return i}(t,i,r)}function IL(t,e,n,i,r){const a=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let s=0,l=0;i.start<e.l?(s=(e.l-i.start)/a,t.l=Math.min(t.l,e.l-s)):i.end>e.r&&(s=(i.end-e.r)/a,t.r=Math.max(t.r,e.r+s)),r.start<e.t?(l=(e.t-r.start)/o,t.t=Math.min(t.t,e.t-l)):r.end>e.b&&(l=(r.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function RL(t,e,n){const i=t.drawingArea,{extra:r,additionalAngle:a,padding:o,size:s}=n,l=t.getPointPosition(e,i+r+o,a),c=Math.round(lC(pC(l.angle+$A))),u=function(t,e,n){90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e);return t}(l.y,s.h,c),h=function(t){if(0===t||180===t)return"center";if(t<180)return"left";return"right"}(c),d=function(t,e,n){"right"===n?t-=e:"center"===n&&(t-=e/2);return t}(l.x,s.w,h);return{visible:!0,x:l.x,y:u,textAlign:h,left:d,top:u,right:d+s.w,bottom:u+s.h}}function kL(t,e){if(!e)return!0;const{left:n,top:i,right:r,bottom:a}=t;return!(tP({x:n,y:i},e)||tP({x:n,y:a},e)||tP({x:r,y:i},e)||tP({x:r,y:a},e))}function LL(t,e,n){const{left:i,top:r,right:a,bottom:o}=n,{backdropColor:s}=e;if(!TA(s)){const n=mP(e.borderRadius),l=gP(e.backdropPadding);t.fillStyle=s;const c=i-l.left,u=r-l.top,h=a-i+l.width,d=o-r+l.height;Object.values(n).some(t=>0!==t)?(t.beginPath(),lP(t,{x:c,y:u,w:h,h:d,radius:n}),t.fill()):t.fillRect(c,u,h,d)}}function DL(t,e,n,i){const{ctx:r}=t;if(n)r.arc(t.xCenter,t.yCenter,e,0,XA);else{let n=t.getPointPosition(0,e);r.moveTo(n.x,n.y);for(let a=1;a<i;a++)n=t.getPointPosition(a,e),r.lineTo(n.x,n.y)}}kt(TL,"id","logarithmic"),kt(TL,"defaults",{ticks:{callback:jC.formatters.logarithmic,major:{enabled:!0}}});class zL extends vL{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=gP(EL(this.options)/2),e=this.width=this.maxWidth-t.width,n=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+n/2+t.top),this.drawingArea=Math.floor(Math.min(e,n)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=CA(t)&&!isNaN(t)?t:0,this.max=CA(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/EL(this.options))}generateTickLabels(t){vL.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((t,e)=>{const n=kA(this.options.pointLabels.callback,[t,e],this);return n||0===n?n:""}).filter((t,e)=>this.chart.getDataVisibility(e))}fit(){const t=this.options;t.display&&t.pointLabels.display?PL(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,n,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,n,i))}getIndexAngle(t){return pC(t*(XA/(this._pointLabels.length||1))+sC(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(TA(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(TA(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const n=e[t];return function(t,e,n){return _P(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}getPointPosition(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.getIndexAngle(t)-$A+n;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:n,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:n,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const n=this.ctx;n.save(),n.beginPath(),DL(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),n.closePath(),n.fillStyle=t,n.fill(),n.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:n,grid:i,border:r}=e,a=this._pointLabels.length;let o,s,l;if(e.pointLabels.display&&function(t,e){const{ctx:n,options:{pointLabels:i}}=t;for(let r=e-1;r>=0;r--){const e=t._pointLabelItems[r];if(!e.visible)continue;const a=i.setContext(t.getPointLabelContext(r));LL(n,a,e);const o=yP(a.font),{x:s,y:l,textAlign:c}=e;sP(n,t._pointLabels[r],s,l+o.lineHeight/2,o,{color:a.color,textAlign:c,textBaseline:"middle"})}}(this,a),i.display&&this.ticks.forEach((t,e)=>{if(0!==e||0===e&&this.min<0){s=this.getDistanceFromCenterForValue(t.value);const n=this.getContext(e),o=i.setContext(n),l=r.setContext(n);!function(t,e,n,i,r){const a=t.ctx,o=e.circular,{color:s,lineWidth:l}=e;!o&&!i||!s||!l||n<0||(a.save(),a.strokeStyle=s,a.lineWidth=l,a.setLineDash(r.dash||[]),a.lineDashOffset=r.dashOffset,a.beginPath(),DL(t,n,o,i),a.closePath(),a.stroke(),a.restore())}(this,o,s,a,l)}}),n.display){for(t.save(),o=a-1;o>=0;o--){const i=n.setContext(this.getPointLabelContext(o)),{color:r,lineWidth:a}=i;a&&r&&(t.lineWidth=a,t.strokeStyle=r,t.setLineDash(i.borderDash),t.lineDashOffset=i.borderDashOffset,s=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),l=this.getPointPosition(o,s),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,n=e.ticks;if(!n.display)return;const i=this.getIndexAngle(0);let r,a;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((i,o)=>{if(0===o&&this.min>=0&&!e.reverse)return;const s=n.setContext(this.getContext(o)),l=yP(s.font);if(r=this.getDistanceFromCenterForValue(this.ticks[o].value),s.showLabelBackdrop){t.font=l.string,a=t.measureText(i.label).width,t.fillStyle=s.backdropColor;const e=gP(s.backdropPadding);t.fillRect(-a/2-e.left,-r-l.size/2-e.top,a+e.width,l.size+e.height)}sP(t,i.label,0,-r,l,{color:s.color,strokeColor:s.textStrokeColor,strokeWidth:s.textStrokeWidth})}),t.restore()}drawTitle(){}}kt(zL,"id","radialLinear"),kt(zL,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:jC.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}}),kt(zL,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),kt(zL,"descriptors",{angleLines:{_fallback:"grid"}});const NL={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},OL=Object.keys(NL);function FL(t,e){return t-e}function BL(t,e){if(TA(e))return null;const n=t._adapter,{parser:i,round:r,isoWeekday:a}=t._parseOpts;let o=e;return"function"===typeof i&&(o=i(o)),CA(o)||(o="string"===typeof i?n.parse(o,i):n.parse(o)),null===o?null:(r&&(o="week"!==r||!aC(a)&&!0!==a?n.startOf(o,r):n.startOf(o,"isoWeek",a)),+o)}function UL(t,e,n,i){const r=OL.length;for(let a=OL.indexOf(t);a<r-1;++a){const t=NL[OL[a]],r=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((n-e)/(r*t.size))<=i)return OL[a]}return OL[r-1]}function jL(t,e,n){if(n){if(n.length){const{lo:i,hi:r}=yC(n,e);t[n[i]>=e?n[i]:n[r]]=!0}}else t[e]=!0}function VL(t,e,n){const i=[],r={},a=e.length;let o,s;for(o=0;o<a;++o)s=e[o],r[s]=o,i.push({value:s,major:!1});return 0!==a&&n?function(t,e,n,i){const r=t._adapter,a=+r.startOf(e[0].value,i),o=e[e.length-1].value;let s,l;for(s=a;s<=o;s=+r.add(s,1,i))l=n[s],l>=0&&(e[l].major=!0);return e}(t,i,r,n):i}class HL extends GR{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.time||(t.time={}),i=this._adapter=new KI(t.adapters.date);i.init(e),BA(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:BL(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,n=t.time.unit||"day";let{min:i,max:r,minDefined:a,maxDefined:o}=this.getUserBounds();function s(t){a||isNaN(t.min)||(i=Math.min(i,t.min)),o||isNaN(t.max)||(r=Math.max(r,t.max))}a&&o||(s(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||s(this.getMinMax(!1))),i=CA(i)&&!isNaN(i)?i:+e.startOf(Date.now(),n),r=CA(r)&&!isNaN(r)?r:+e.endOf(Date.now(),n)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}buildTicks(){const t=this.options,e=t.time,n=t.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,a=function(t,e,n){let i=0,r=t.length;for(;i<r&&t[i]<e;)i++;for(;r>i&&t[r-1]>n;)r--;return i>0||r<t.length?t.slice(i,r):t}(i,r,this.max);return this._unit=e.unit||(n.autoSkip?UL(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):function(t,e,n,i,r){for(let a=OL.length-1;a>=OL.indexOf(n);a--){const n=OL[a];if(NL[n].common&&t._adapter.diff(r,i,n)>=e-1)return n}return OL[n?OL.indexOf(n):0]}(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(let e=OL.indexOf(t)+1,n=OL.length;e<n;++e)if(NL[OL[e]].common)return OL[e]}(this._unit):void 0,this.initOffsets(i),t.reverse&&a.reverse(),VL(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(){let t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=0,r=0;this.options.offset&&n.length&&(t=this.getDecimalForValue(n[0]),i=1===n.length?1-t:(this.getDecimalForValue(n[1])-t)/2,e=this.getDecimalForValue(n[n.length-1]),r=1===n.length?e:(e-this.getDecimalForValue(n[n.length-2]))/2);const a=n.length<3?.5:.25;i=mC(i,0,a),r=mC(r,0,a),this._offsets={start:i,end:r,factor:1/(i+1+r)}}_generate(){const t=this._adapter,e=this.min,n=this.max,i=this.options,r=i.time,a=r.unit||UL(r.minUnit,e,n,this._getLabelCapacity(e)),o=IA(i.ticks.stepSize,1),s="week"===a&&r.isoWeekday,l=aC(s)||!0===s,c={};let u,h,d=e;if(l&&(d=+t.startOf(d,"isoWeek",s)),d=+t.startOf(d,l?"day":a),t.diff(n,e,a)>1e5*o)throw new Error(e+" and "+n+" are too far apart with stepSize of "+o+" "+a);const p="data"===i.ticks.source&&this.getDataTimestamps();for(u=d,h=0;u<n;u=+t.add(u,o,a),h++)jL(c,u,p);return u!==n&&"ticks"!==i.bounds&&1!==h||jL(c,u,p),Object.keys(c).sort(FL).map(t=>+t)}getLabelForValue(t){const e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,i=this._unit,r=e||n[i];return this._adapter.format(t,r)}_tickFormatFunction(t,e,n,i){const r=this.options,a=r.ticks.callback;if(a)return kA(a,[t,e,n],this);const o=r.time.displayFormats,s=this._unit,l=this._majorUnit,c=s&&o[s],u=l&&o[l],h=n[e],d=l&&u&&h&&h.major;return this._adapter.format(t,i||(d?u:c))}generateTickLabels(t){let e,n,i;for(e=0,n=t.length;e<n;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,n=this.ctx.measureText(t).width,i=sC(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),a=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:n*r+o*a,h:n*a+o*r}}_getLabelCapacity(t){const e=this.options.time,n=e.displayFormats,i=n[e.unit]||n.millisecond,r=this._tickFormatFunction(t,0,VL(this,[t],this._majorUnit),i),a=this._getLabelSize(r),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,e=i.length;t<e;++t)n=n.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const t=this._cache.labels||[];let e,n;if(t.length)return t;const i=this.getLabels();for(e=0,n=i.length;e<n;++e)t.push(BL(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return wC(t.sort(FL))}}function GL(t,e,n){let i,r,a,o,s=0,l=t.length-1;n?(e>=t[s].pos&&e<=t[l].pos&&({lo:s,hi:l}=vC(t,"pos",e)),({pos:i,time:a}=t[s]),({pos:r,time:o}=t[l])):(e>=t[s].time&&e<=t[l].time&&({lo:s,hi:l}=vC(t,"time",e)),({time:i,pos:a}=t[s]),({time:r,pos:o}=t[l]));const c=r-i;return c?a+(o-a)*(e-i)/c:a}kt(HL,"id","time"),kt(HL,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class WL extends HL{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=GL(e,this.min),this._tableRange=GL(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:n}=this,i=[],r=[];let a,o,s,l,c;for(a=0,o=t.length;a<o;++a)l=t[a],l>=e&&l<=n&&i.push(l);if(i.length<2)return[{time:e,pos:0},{time:n,pos:1}];for(a=0,o=i.length;a<o;++a)c=i[a+1],s=i[a-1],l=i[a],Math.round((c+s)/2)!==l&&r.push({time:l,pos:a/(o-1)});return r}_generate(){const t=this.min,e=this.max;let n=super.getDataTimestamps();return n.includes(t)&&n.length||n.splice(0,0,t),n.includes(e)&&1!==n.length||n.push(e),n.sort((t,e)=>t-e)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t,t}getDecimalForValue(t){return(GL(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return GL(this._table,n*this._tableRange+this._minPos,!0)}}kt(WL,"id","timeseries"),kt(WL,"defaults",HL.defaults);const qL=["height","width","redraw","datasetIdKey","type","data","options","plugins","fallbackContent","updateMode"],ZL="label";function XL(t,e){"function"===typeof t?t(e):t&&(t.current=e)}function YL(t,e){t.labels=e}function KL(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ZL;const i=[];t.datasets=e.map(e=>{const r=t.datasets.find(t=>t[n]===e[n]);return r&&e.data&&!i.includes(r)?(i.push(r),Object.assign(r,e),r):Dt({},e)})}function JL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ZL;const n={labels:[],datasets:[]};return YL(n,t.labels),KL(n,t.datasets,e),n}function $L(t,e){const{height:n=150,width:r=300,redraw:a=!1,datasetIdKey:o,type:s,data:l,options:c,plugins:u=[],fallbackContent:h,updateMode:d}=t,p=Qe(t,qL),f=(0,i.useRef)(null),m=(0,i.useRef)(null),g=()=>{f.current&&(m.current=new bk(f.current,{type:s,data:JL(l,o),options:c&&Dt({},c),plugins:u}),XL(e,m.current))},y=()=>{XL(e,null),m.current&&(m.current.destroy(),m.current=null)};return(0,i.useEffect)(()=>{!a&&m.current&&c&&function(t,e){const n=t.options;n&&e&&Object.assign(n,e)}(m.current,c)},[a,c]),(0,i.useEffect)(()=>{!a&&m.current&&YL(m.current.config.data,l.labels)},[a,l.labels]),(0,i.useEffect)(()=>{!a&&m.current&&l.datasets&&KL(m.current.config.data,l.datasets,o)},[a,l.datasets]),(0,i.useEffect)(()=>{m.current&&(a?(y(),setTimeout(g)):m.current.update(d))},[a,c,l.labels,l.datasets,d]),(0,i.useEffect)(()=>{m.current&&(y(),setTimeout(g))},[s]),(0,i.useEffect)(()=>(g(),()=>y()),[]),i.createElement("canvas",Dt({ref:f,role:"img",height:n,width:r},p),h)}const QL=(0,i.forwardRef)($L);function tD(t,e){return bk.register(e),(0,i.forwardRef)((e,n)=>i.createElement(QL,Dt(Dt({},e),{},{ref:n,type:t})))}const eD=tD("line",HI),nD=tD("doughnut",VI);bk.register(Ak,dL,Yk);const iD=function(t){var e,n,i,r;let{impactData:a}=t;const o=(null===a||void 0===a||null===(e=a.populationBreakdown)||void 0===e?void 0:e.directImpact)||85e3,s=(null===a||void 0===a||null===(n=a.populationBreakdown)||void 0===n?void 0:n.secondary)||15e4,l=(null===a||void 0===a||null===(i=a.populationBreakdown)||void 0===i?void 0:i.longTerm)||85e3,c=(null===a||void 0===a||null===(r=a.populationBreakdown)||void 0===r?void 0:r.totalAffected)||32e4,u={labels:["Direct Impact (25%)","Secondary (47%)","Long-term Effects (28%)"],datasets:[{data:[o,s,l],backgroundColor:["#ff6b35","#00d4ff","#8b5cf6"],borderColor:["#ff6b35","#00d4ff","#8b5cf6"],borderWidth:2,cutout:"60%"}]};return(0,zt.jsxs)("div",{className:"population-impact",children:[(0,zt.jsxs)("div",{className:"impact-header",children:[(0,zt.jsx)("div",{className:"header-icon",children:"\ud83d\udc65"}),(0,zt.jsx)("h3",{children:"Population Impact"})]}),(0,zt.jsxs)("div",{className:"impact-chart",children:[(0,zt.jsxs)("div",{className:"chart-container",children:[(0,zt.jsx)(nD,{data:u,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,callbacks:{label:function(t){return"".concat(t.label,": ").concat(t.parsed.toLocaleString())}}}}}}),(0,zt.jsxs)("div",{className:"chart-center",children:[(0,zt.jsx)("div",{className:"total-affected",children:c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(0)+"K":c.toLocaleString()}),(0,zt.jsx)("div",{className:"total-label",children:"Affected"})]})]}),(0,zt.jsxs)("div",{className:"impact-legend",children:[(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--orange"}),(0,zt.jsx)("span",{className:"legend-label",children:"Direct Impact"}),(0,zt.jsx)("span",{className:"legend-value",children:o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(0)+"K":o.toLocaleString()})]}),(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--blue"}),(0,zt.jsx)("span",{className:"legend-label",children:"Secondary"}),(0,zt.jsx)("span",{className:"legend-value",children:s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toLocaleString()})]}),(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--purple"}),(0,zt.jsx)("span",{className:"legend-label",children:"Long-term"}),(0,zt.jsx)("span",{className:"legend-value",children:l>=1e6?(l/1e6).toFixed(1)+"M":l>=1e3?(l/1e3).toFixed(0)+"K":l.toLocaleString()})]})]})]})]})};const rD=function(t){let{impactData:e,simulationParams:n,selectedLocation:i}=t;const r=(()=>{if(!e||!n)return[{label:"Atmospheric Dust",level:"Low",severity:"low",progress:20},{label:"Temperature Change",level:"Low",severity:"low",progress:15},{label:"Tsunami Height",level:"Low",severity:"low",progress:10},{label:"Long-term Effects",level:"Low",severity:"low",progress:25}];const t=n.diameter,r=n.velocity,a=e.energy,o=(t=>t?"string"===typeof t?t:t.display_name?t.display_name:t.name?t.name:"":"")(i),s=t/1e3*r;let l,c,u,h,d,p,f,m,g;if(s<5?(l="Low",c=25,u="low"):s<15?(l="Medium",c=55,u="medium"):s<30?(l="High",c=80,u="high"):(l="Extreme",c=95,u="critical"),a<1?(h="Minimal",d=15,p="low"):a<10?(h="Low",d=35,p="low"):a<100?(h="Medium",d=60,p="medium"):a<1e3?(h="High",d=80,p="high"):(h="Catastrophic",d=95,p="critical"),o.toLowerCase().includes("ocean")||o.toLowerCase().includes("sea")){const e=Math.sqrt(a)*(t/1e3);e<2?(f="Low",m=30,g="medium"):e<5?(f="High",m=70,g="high"):(f="Extreme",m=95,g="critical")}else f="None",m=5,g="low";const y=(c+d+m)/3;let v,_,x;return y<30?(v="Minimal",_=20,x="low"):y<50?(v="Moderate",_=45,x="medium"):y<75?(v="Severe",_=70,x="high"):(v="Catastrophic",_=90,x="critical"),[{label:"Atmospheric Dust",level:l,severity:u,progress:c},{label:"Temperature Change",level:h,severity:p,progress:d},{label:"Tsunami Height",level:f,severity:g,progress:m},{label:"Long-term Effects",level:v,severity:x,progress:_}]})();return(0,zt.jsxs)("div",{className:"environmental-impact",children:[(0,zt.jsxs)("div",{className:"impact-header",children:[(0,zt.jsx)("div",{className:"header-icon",children:"\ud83c\udf0d"}),(0,zt.jsx)("h3",{children:"Environmental Impact"})]}),(0,zt.jsx)("div",{className:"impacts-list",children:r.map((t,e)=>(0,zt.jsxs)("div",{className:"impact-item",children:[(0,zt.jsxs)("div",{className:"impact-info",children:[(0,zt.jsx)("span",{className:"impact-label",children:t.label}),(0,zt.jsx)("span",{className:"impact-level impact-level--".concat(t.severity),children:t.level})]}),(0,zt.jsxs)("div",{className:"impact-progress",children:[(0,zt.jsx)("div",{className:"progress-bar",children:(0,zt.jsx)("div",{className:"progress-fill progress-fill--".concat(t.severity),style:{width:"".concat(t.progress,"%")}})}),(0,zt.jsxs)("span",{className:"progress-value",children:[t.progress,"%"]})]})]},e))})]})},aD=JSON.parse('[{"name":"22 Kalliope (A852 WA)","a":2.909,"e":0.0989,"i":13.7,"om":65.97,"w":358.24,"q":2.622,"ad":3.2,"per_y":4.96,"data_arc":62578,"condition_code":0,"n_obs_used":12405,"H":6.79,"diameter_km":166.2,"mass_kg":4400000000000000000,"impact_energy_mt":920000,"hazard_level":"moderate"},{"name":"31 Euphrosyne (A854 RA)","a":3.162,"e":0.2159,"i":26.31,"om":30.8,"w":61.97,"q":2.479,"ad":3.84,"per_y":5.62,"data_arc":60186,"condition_code":0,"n_obs_used":3972,"H":6.81,"diameter_km":255.9,"mass_kg":15900000000000000000,"impact_energy_mt":3340000,"hazard_level":"high"},{"name":"243 Ida (A884 SB)","a":2.863,"e":0.0455,"i":1.13,"om":323.55,"w":113.79,"q":2.732,"ad":2.99,"per_y":4.84,"data_arc":51340,"condition_code":0,"n_obs_used":12512,"H":10.08,"diameter_km":31.4,"mass_kg":42000000000000000,"impact_energy_mt":88200,"hazard_level":"low"},{"name":"1862 Apollo (1932 HA)","a":1.471,"e":0.5599,"i":6.35,"om":35.54,"w":286.05,"q":0.647,"ad":2.29,"per_y":1.78,"data_arc":34421,"condition_code":0,"n_obs_used":3473,"H":16.08,"diameter_km":1.7,"mass_kg":4900000000000,"impact_energy_mt":103,"hazard_level":"extreme"},{"name":"3122 Florence (1981 ET3)","a":1.769,"e":0.4232,"i":22.14,"om":336.04,"w":27.88,"q":1.02,"ad":2.52,"per_y":2.35,"data_arc":16876,"condition_code":0,"n_obs_used":9972,"H":14.08,"diameter_km":4.9,"mass_kg":125000000000000,"impact_energy_mt":2625,"hazard_level":"very_high"},{"name":"65803 Didymos (1996 GT)","a":1.643,"e":0.3832,"i":3.41,"om":72.98,"w":319.59,"q":1.013,"ad":2.27,"per_y":2.11,"data_arc":722,"condition_code":0,"n_obs_used":1647,"H":18.11,"diameter_km":0.78,"mass_kg":530000000000,"impact_energy_mt":11.1,"hazard_level":"very_high"},{"name":"99942 Apophis (2004 MN4)","a":0.922,"e":0.191,"i":3.33,"om":204.4,"w":126.4,"q":0.746,"ad":1.099,"per_y":0.886,"data_arc":6000,"condition_code":0,"n_obs_used":1000,"H":19.7,"diameter_km":0.34,"mass_kg":61000000000,"impact_energy_mt":1.28,"hazard_level":"extreme"},{"name":"2022 AP7","a":1.067,"e":0.415,"i":31.1,"om":204.3,"w":46.7,"q":0.624,"ad":1.51,"per_y":1.1,"data_arc":365,"condition_code":7,"n_obs_used":50,"H":17.8,"diameter_km":1.1,"mass_kg":1400000000000,"impact_energy_mt":29.4,"hazard_level":"extreme"},{"name":"2023 DW","a":2.05,"e":0.38,"i":3.1,"om":142.3,"w":85.2,"q":1.27,"ad":2.83,"per_y":2.93,"data_arc":200,"condition_code":6,"n_obs_used":85,"H":18.2,"diameter_km":0.67,"mass_kg":310000000000,"impact_energy_mt":6.5,"hazard_level":"high"},{"name":"Bennu (101955)","a":1.126,"e":0.204,"i":6.03,"om":2.06,"w":66.22,"q":0.897,"ad":1.356,"per_y":1.2,"data_arc":15000,"condition_code":0,"n_obs_used":2000,"H":20.9,"diameter_km":0.49,"mass_kg":73000000000,"impact_energy_mt":1.53,"hazard_level":"moderate"}]');const oD=function(t){let{onRunSimulation:e,onLocationChange:n,searchQuery:r,setSearchQuery:a,searchResults:o,searchLoading:s}=t;const[l,c]=(0,i.useState)(250),[u,h]=(0,i.useState)(19.3),[d,p]=(0,i.useState)(45),[f,m]=(0,i.useState)("Ocean (Pacific)"),g=(0,i.useMemo)(()=>{const t=l/1e3;return aD.reduce((e,n)=>{const i=Math.abs(e.diameter_km-t);return Math.abs(n.diameter_km-t)<i?n:e})},[l]);return(0,i.useEffect)(()=>{n&&f&&n(f)},[n,f]),(0,zt.jsxs)("div",{className:"simulation-parameters",children:[(0,zt.jsxs)("div",{className:"parameters-header",children:[(0,zt.jsx)("div",{className:"header-icon",children:"\u2699\ufe0f"}),(0,zt.jsx)("h3",{children:"Simulation Parameters"})]}),(0,zt.jsxs)("div",{className:"parameter-group",children:[(0,zt.jsxs)("div",{className:"parameter-label",children:[(0,zt.jsx)("span",{children:"Asteroid Diameter"}),(0,zt.jsxs)("span",{className:"parameter-value",children:[l," m"]})]}),(0,zt.jsxs)("div",{className:"slider-container",children:[(0,zt.jsx)("button",{className:"slider-btn",onClick:()=>c(Math.max(10,l-10)),children:"\u2212"}),(0,zt.jsx)("input",{type:"range",min:"10",max:"2000",step:"10",value:l,onChange:t=>c(parseInt(t.target.value)),className:"parameter-slider"}),(0,zt.jsx)("button",{className:"slider-btn",onClick:()=>c(Math.min(2e3,l+10)),children:"+"})]})]}),(0,zt.jsxs)("div",{className:"parameter-group",children:[(0,zt.jsxs)("div",{className:"parameter-label",children:[(0,zt.jsx)("span",{children:"Velocity"}),(0,zt.jsxs)("span",{className:"parameter-value",children:[u," km/s"]})]}),(0,zt.jsxs)("div",{className:"slider-container",children:[(0,zt.jsx)("button",{className:"slider-btn",onClick:()=>h(Math.max(5,u-.1)),children:"\u2212"}),(0,zt.jsx)("input",{type:"range",min:"5",max:"50",step:"0.1",value:u,onChange:t=>h(parseFloat(t.target.value)),className:"parameter-slider"}),(0,zt.jsx)("button",{className:"slider-btn",onClick:()=>h(Math.min(50,u+.1)),children:"+"})]})]}),(0,zt.jsxs)("div",{className:"parameter-group",children:[(0,zt.jsxs)("div",{className:"parameter-label",children:[(0,zt.jsx)("span",{children:"Entry Angle"}),(0,zt.jsxs)("span",{className:"parameter-value",children:[d,"\xb0"]})]}),(0,zt.jsxs)("div",{className:"slider-container",children:[(0,zt.jsx)("button",{className:"slider-btn",onClick:()=>p(Math.max(0,d-5)),children:"\u2212"}),(0,zt.jsx)("input",{type:"range",min:"0",max:"360",step:"5",value:d,onChange:t=>p(parseInt(t.target.value)),className:"parameter-slider"}),(0,zt.jsx)("button",{className:"slider-btn",onClick:()=>p(Math.min(360,d+5)),children:"+"})]})]}),(0,zt.jsxs)("div",{className:"parameter-group",children:[(0,zt.jsx)("div",{className:"parameter-label",children:(0,zt.jsx)("span",{children:"Impact Location"})}),(0,zt.jsx)("select",{value:f,onChange:t=>{m(t.target.value),null===n||void 0===n||n(t.target.value)},className:"location-select",children:Object.keys(VE).map(t=>(0,zt.jsx)("option",{value:t,children:t},t))})]}),(0,zt.jsxs)("div",{className:"parameter-group",children:[(0,zt.jsx)("div",{className:"parameter-label",children:(0,zt.jsx)("span",{children:"Search Custom Location"})}),(0,zt.jsxs)("div",{className:"search-container",children:[(0,zt.jsx)("input",{type:"text",value:r,onChange:t=>a(t.target.value),placeholder:"Search for a city or address...",className:"location-search-input"}),s&&(0,zt.jsx)("div",{className:"search-loading",children:"Searching..."}),o.length>0&&(0,zt.jsx)("div",{className:"search-results",children:o.map((t,e)=>(0,zt.jsx)("div",{className:"search-result-item",onClick:()=>{const e=Dt(Dt({},t),{},{centroid:{lat:parseFloat(t.lat),lon:parseFloat(t.lon)}});console.log("Selected search location:",e),null===n||void 0===n||n(e),a("")},children:t.display_name},e))})]})]}),g&&(0,zt.jsxs)("div",{className:"asteroid-info",children:[(0,zt.jsxs)("div",{className:"asteroid-name",children:["Auto-selected: ",g.name]}),(0,zt.jsxs)("div",{className:"asteroid-details",children:[(0,zt.jsxs)("span",{children:["Diameter: ",g.diameter_km," km"]}),(0,zt.jsxs)("span",{children:["Risk: ",g.hazard_level]})]})]}),(0,zt.jsxs)("div",{className:"simulation-actions",children:[(0,zt.jsxs)("button",{className:"run-simulation-btn",onClick:()=>{null===e||void 0===e||e({diameter:l,velocity:u,entryAngle:d,impactLocation:f,selectedAsteroid:g})},children:[(0,zt.jsx)("span",{className:"btn-icon",children:"\u25b6"}),"Run Simulation"]}),(0,zt.jsx)("button",{className:"reset-btn",children:(0,zt.jsx)("span",{className:"btn-icon",children:"\u21bb"})})]})]})};function sD(t,e){return sD=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},sD(t,e)}function lD(){lD=function(t,e){return new n(t,void 0,e)};var t=RegExp.prototype,e=new WeakMap;function n(t,i,r){var a=RegExp(t,i);return e.set(a,r||e.get(t)),sD(a,n.prototype)}function i(t,n){var i=e.get(n);return Object.keys(i).reduce(function(e,n){var r=i[n];if("number"==typeof r)e[n]=t[r];else{for(var a=0;void 0===t[r[a]]&&a+1<r.length;)a++;e[n]=t[r[a]]}return e},Object.create(null))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sD(t,e)}(n,RegExp),n.prototype.exec=function(e){var n=t.exec.call(this,e);if(n){n.groups=i(n,this);var r=n.indices;r&&(r.groups=i(r,this))}return n},n.prototype[Symbol.replace]=function(n,r){if("string"==typeof r){var a=e.get(this);return t[Symbol.replace].call(this,n,r.replace(/\$<([^>]+)(>|$)/g,function(t,e,n){if(""===n)return t;var i=a[e];return Array.isArray(i)?"$"+i.join("$"):"number"==typeof i?"$"+i:""}))}if("function"==typeof r){var o=this;return t[Symbol.replace].call(this,n,function(){var t=arguments;return"object"!=It(t[t.length-1])&&(t=[].slice.call(t)).push(i(t,o)),r.apply(this,t)})}return t[Symbol.replace].call(this,n,r)},lD.apply(this,arguments)}var cD=n(136);Map,Symbol.iterator,Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");const uD=new class{constructor(){this._apiKey="",this._fetch="undefined"!==typeof self?fetch.bind(self):"undefined"!==typeof global&&global.fetch?global.fetch:null,this.tileCacheSize=200}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}},hD=Dt(Dt({},{AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}}),{ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}});function dD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hD;for(const n of Object.values(e))if(n.code===t)return n;return null}function pD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hD;for(const n of Object.values(e))if(n.flag===t)return n;return null}function fD(t){return null!==t&&"object"===typeof t&&"code"in t&&"flag"in t&&"name"in t&&"latin"in t&&"isMode"in t&&"geocoding"in t&&("string"===typeof t.code||null===t.code)&&"string"===typeof t.flag&&"string"===typeof t.name&&"boolean"===typeof t.latin&&"boolean"===typeof t.isMode&&"boolean"===typeof t.geocoding}function mD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hD;return fD(t)?pD(t.flag,e):"string"!==typeof t?null:function(t){return t in(arguments.length>1&&void 0!==arguments[1]?arguments[1]:hD)?t[t]:null}(t,e)||dD(t,e)||pD(t,e)||null}async function gD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===uD.fetch)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(""===new URL(t).searchParams.get("key").trim())throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return uD.fetch(t,e)}const yD={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(yD);class vD extends Error{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super("Call to enpoint ".concat(t.url," failed with the status code ").concat(t.status,". ").concat(e)),this.res=t}}const _D={403:"Key is missing, invalid or restricted"};const xD={info:async function(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=new URL("geolocation/ip.json",yD.maptilerApiURL);n.searchParams.set("key",null!==(t=e.apiKey)&&void 0!==t?t:uD.apiKey),"elevation"in e&&n.searchParams.set("elevation",e.elevation?"true":"false");const i=n.toString(),r=await gD(i);if(!r.ok)throw new vD(r,r.status in _D?_D[r.status]:"");return await r.json()}};function bD(t){let e;const n=t.trim();let i;return i=n.startsWith("http://")||n.startsWith("https://")?n:null!==(e=/^maptiler:\/\/(.*)/.exec(n))?"https://api.maptiler.com/maps/".concat(e[1],"/style.json"):"https://api.maptiler.com/maps/".concat(n,"/style.json"),i}class wD{constructor(t,e,n,i,r,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.name=t,this.variantType=e,this.id=n,this.referenceStyle=i,this.description=r,this.imageURL=a,this.deprecated=o}getName(){return this.name}getFullName(){return"".concat(this.referenceStyle.getName()," ").concat(this.name)}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){const e=this.referenceStyle.getVariant(t);return this.warnIfDeprecated(e),e}getVariants(){return this.referenceStyle.getVariants().filter(t=>t!==this).map(t=>(this.warnIfDeprecated(t),t))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return bD(this.getId())}warnIfDeprecated(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if(!t.deprecated)return t;const e=t.getFullName();return console.warn('Style "'.concat(e,'" is deprecated and will be removed in a future version.')),t}}class SD{constructor(t,e){this.name=t,this.id=e,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const MD=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function TD(t){return new Proxy(t,{get(e,n,i){if(e.hasVariant(n))return e.getVariant(n);if(n.toString().toUpperCase()===n)return t.getDefaultVariant();return Reflect.get(e,n,i)}})}const ED=function(){const t={};for(let e=0;e<MD.length;e+=1){const n=MD[e],i=TD(new SD(n.name,n.referenceStyleID));for(let t=0;t<n.variants.length;t+=1){const e=n.variants[t],r=new wD(e.name,e.variantType,e.id,i,e.description,e.imageURL,e.deprecated);i.addVariant(r)}t[n.referenceStyleID]=i}return t}();const AD=6371008.8;Math.PI;var CD=n(981);const PD={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let ID;const RD=new Uint8Array(16);const kD=[];for(let n=0;n<256;++n)kD.push((n+256).toString(16).slice(1));function LD(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(kD[t[e+0]]+kD[t[e+1]]+kD[t[e+2]]+kD[t[e+3]]+"-"+kD[t[e+4]]+kD[t[e+5]]+"-"+kD[t[e+6]]+kD[t[e+7]]+"-"+kD[t[e+8]]+kD[t[e+9]]+"-"+kD[t[e+10]]+kD[t[e+11]]+kD[t[e+12]]+kD[t[e+13]]+kD[t[e+14]]+kD[t[e+15]]).toLowerCase()}const DD=function(t,e,n){var i,r,a,o;if(PD.randomUUID&&!e&&!t)return PD.randomUUID();const s=null!==(i=null!==(r=(t=t||{}).random)&&void 0!==r?r:null===(a=(o=t).rng)||void 0===a?void 0:a.call(o))&&void 0!==i?i:function(){if(!ID){if("undefined"===typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ID=crypto.getRandomValues.bind(crypto)}return ID(RD)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){if((n=n||0)<0||n+16>e.length)throw new RangeError("UUID byte range ".concat(n,":").concat(n+15," is out of buffer bounds"));for(let t=0;t<16;++t)e[n+t]=s[t];return e}return LD(s)},zD="function"===typeof Buffer,ND=("function"===typeof TextDecoder&&new TextDecoder,"function"===typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),OD=(t=>{let e={};return t.forEach((t,n)=>e[t]=n),e})(ND),FD=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,BD=String.fromCharCode.bind(String),UD=("function"===typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),t=>t.replace(/=/g,"").replace(/[+\/]/g,t=>"+"==t?"-":"_")),jD=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),VD=t=>{let e,n,i,r,a="";const o=t.length%3;for(let s=0;s<t.length;){if((n=t.charCodeAt(s++))>255||(i=t.charCodeAt(s++))>255||(r=t.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=n<<16|i<<8|r,a+=ND[e>>18&63]+ND[e>>12&63]+ND[e>>6&63]+ND[63&e]}return o?a.slice(0,o-3)+"===".substring(o):a},HD="function"===typeof btoa?t=>btoa(t):zD?t=>Buffer.from(t,"binary").toString("base64"):VD,GD=zD?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let n=0,i=t.length;n<i;n+=4096)e.push(BD.apply(null,t.subarray(n,n+4096)));return HD(e.join(""))},WD=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?UD(GD(t)):GD(t)},qD=t=>{if(t=t.replace(/\s+/g,""),!FD.test(t))throw new TypeError("malformed base64.");let e,n,i;t+="==".slice(2-(3&t.length));let r=[];for(let a=0;a<t.length;)e=OD[t.charAt(a++)]<<18|OD[t.charAt(a++)]<<12|(n=OD[t.charAt(a++)])<<6|(i=OD[t.charAt(a++)]),64===n?r.push(BD(e>>16&255)):64===i?r.push(BD(e>>16&255,e>>8&255)):r.push(BD(e>>16&255,e>>8&255,255&e));return r.join("")},ZD=WD;var XD=Object.defineProperty,YD=t=>{throw TypeError(t)},KD=(t,e,n)=>((t,e,n)=>e in t?XD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n),JD=(t,e,n)=>e.has(t)||YD("Cannot "+n),$D=(t,e,n)=>(JD(t,e,"read from private field"),n?n.call(t):e.get(t)),QD=(t,e,n)=>e.has(t)?YD("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),tz=(t,e,n,i)=>(JD(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),ez=(t,e,n)=>(JD(t,e,"access private method"),n);const nz=Dt({VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1}},hD);function iz(){var t;if(typeof navigator>"u"){return dD(Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0])||nz.ENGLISH}return null!==(t=Array.from(new Set(navigator.languages.map(t=>t.split("-")[0]))).map(t=>dD(t)).filter(t=>t)[0])&&void 0!==t?t:nz.LOCAL}const rz={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:nz.STYLE,secondaryLanguage:nz.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(rz);const az=DD();const oz=new class extends CD{constructor(){super(...arguments),KD(this,"primaryLanguage",rz.primaryLanguage),KD(this,"secondaryLanguage"),KD(this,"session",!0),KD(this,"caching",!0),KD(this,"telemetry",!0),KD(this,"_unit","metric"),KD(this,"_apiKey","")}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,uD.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){uD.fetch=t}get fetch(){return uD.fetch}},sz="localcache_source",lz="localcache",cz=typeof caches<"u",{addProtocol:uz}=cD;function hz(t,e){if(cz&&oz.caching&&oz.session&&t.host===rz.maptilerApiHost){if("Source"===e&&t.href.includes("tiles.json"))return t.href.replace("https://","".concat(sz,"://"));if("Tile"===e||"Glyphs"===e)return t.href.replace("https://","".concat(lz,"://"))}return t.href}let dz;async function pz(){return dz||(dz=await caches.open("maptiler_sdk")),dz}let fz=0;function mz(){uz(sz,async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace("".concat(sz,"://"),"https://");const n=t;n.signal=e.signal;const i=await fetch(t.url,n),r=await i.json();return r.tiles&&r.tiles.length>0&&(r.tiles[0]+="&last-modified=".concat(i.headers.get("Last-Modified"))),{data:r,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires")}}),uz(lz,async(t,e)=>{if(!t.url)throw new Error("");t.url=t.url.replace("".concat(lz,"://"),"https://");const n=new URL(t.url),i=new URL(n);i.searchParams.delete("mtsid"),i.searchParams.delete("key");const r=i.toString(),a=new URL(n);a.searchParams.delete("last-modified");const o=a.toString(),s=async t=>({data:await t.arrayBuffer(),cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires")}),l=await pz(),c=await l.match(r);if(c)return s(c);const u=t;u.signal=e.signal;const h=await fetch(o,u);return h.status>=200&&h.status<300&&(l.put(r,h.clone()).catch(()=>{}),++fz>100&&(async function(){const t=await pz(),e=await t.keys(),n=e.slice(0,Math.max(e.length-1e3,0));for(const i of n)t.delete(i)}(),fz=0)),s(h)})}function gz(t,e){let n=null;try{n=new URL(t)}catch(i){return{url:t}}return n.host===rz.maptilerApiHost&&(n.searchParams.has("key")||n.searchParams.append("key",oz.apiKey),oz.session&&n.searchParams.append("mtsid",az)),{url:hz(n,e)}}function yz(t){return(e,n)=>{if(null!=t){var i;const r=t(e,n),a=gz(null!==(i=null==r?void 0:r.url)&&void 0!==i?i:"",n);return Dt(Dt({},r),a)}return gz(e,n)}}function vz(){return Math.random().toString(36).substring(2)}function _z(t){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t)}function xz(t){const e=document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed.";if(!e)return;let n=null;if("string"==typeof t?n=document.getElementById(t):t instanceof HTMLElement&&(n=t),!n)throw new Error("The Map container must be provided.");const i=document.createElement("div");throw i.innerHTML=e,i.classList.add("webgl-warning-div"),n.appendChild(i),new Error(e)}function bz(t,e){return!(!Array.isArray(t)||2!==t.length||"get"!==t[0]||"string"!=typeof t[1]||e&&!t[1].startsWith("name:")||!e&&"name"!==t[1])}function wz(t,e,n){const i=structuredClone(t),r=t=>{if("string"!=typeof t)for(let i=0;i<t.length;i+=1)bz(t[i],n)?t[i]=structuredClone(e):r(t[i])};return bz(i,n)?e:(r(i),i)}function Sz(t,e){const n=e?/\{name:\S+\}/:/\{name\}/;return{contains:n.test(t),exactMatch:new RegExp("^".concat(n.source,"$")).test(t)}}function Mz(t,e,n){const i=n?/\{name:\S+\}/:/\{name\}/,r=t.split(i);return["concat",...r.flatMap((t,n)=>n===r.length-1?[t]:[t,e])]}function Tz(t){var e;const n=lD(/\{name(?::(\S+))?\}/g,{language:1}),i=[];for(;;){var r;const a=n.exec(t);if(!a)break;const o=null!==(r=null==(e=a.groups)?void 0:e.language)&&void 0!==r?r:null;i.push(o)}return i}function Ez(t){return Array.isArray(t)&&2===t.length&&"get"===t[0]&&"string"==typeof t[1]?"name"===t[1].trim()?{isLanguage:!0,localization:null}:t[1].trim().startsWith("name:")?{isLanguage:!0,localization:t[1].trim().split(":").pop()}:null:null}function Az(t){const e=[],n=structuredClone(t),i=t=>{if("string"!=typeof t)for(let n=0;n<t.length;n+=1){const r=Ez(t[n]);r?e.push(r.localization):i(t[n])}};return i([n]),e}cD.Marker;cD.Popup;cD.Style;cD.CanvasSource;cD.GeoJSONSource;cD.ImageSource;cD.RasterTileSource;cD.RasterDEMTileSource;cD.VectorTileSource;cD.VideoSource;class Cz extends cD.NavigationControl{onAdd(t){return super.onAdd(t)}}class Pz extends cD.GeolocateControl{onAdd(t){return super.onAdd(t)}}cD.AttributionControl;class Iz extends cD.LogoControl{onAdd(t){return super.onAdd(t)}}class Rz extends cD.ScaleControl{onAdd(t){return super.onAdd(t)}}class kz extends cD.FullscreenControl{onAdd(t){return super.onAdd(t)}}cD.TerrainControl;cD.BoxZoomHandler;cD.ScrollZoomHandler;cD.CooperativeGesturesHandler;cD.KeyboardHandler;cD.TwoFingersTouchPitchHandler;cD.MapWheelEvent;cD.MapTouchEvent;cD.MapMouseEvent;class Lz extends Iz{constructor(){var t,e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(n),KD(this,"logoURL",""),KD(this,"linkURL",""),this.logoURL=null!==(t=n.logoURL)&&void 0!==t?t:rz.maptilerLogoURL,this.linkURL=null!==(e=n.linkURL)&&void 0!==e?e:rz.maptilerURL}onAdd(t){var e;this._map=t,this._compact=null!==(e=this.options.compact)&&void 0!==e&&e,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const n=window.document.createElement("a");return n.style.backgroundRepeat="no-repeat",n.style.cursor="pointer",n.style.display="block",n.style.height="23px",n.style.margin="0 0 -4px -4px",n.style.overflow="hidden",n.style.width="88px",n.style.backgroundImage="url(".concat(this.logoURL,")"),n.style.backgroundSize="100px 30px",n.style.width="100px",n.style.height="30px",n.target="_blank",n.rel="noopener",n.href=this.linkURL,n.setAttribute("aria-label","MapTiler logo"),n.setAttribute("rel","noopener"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var Dz={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class zz{constructor(t,e,n,i){this.message=(t?"".concat(t,": "):"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)}}function Nz(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(const r of n)for(const e in r)t[e]=r[e];return t}class Oz extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Fz{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(t){return new Fz(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error("".concat(t," not found in scope."))}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Bz={kind:"null"},Uz={kind:"number"},jz={kind:"string"},Vz={kind:"boolean"},Hz={kind:"color"},Gz={kind:"projectionDefinition"},Wz={kind:"object"},qz={kind:"value"},Zz={kind:"collator"},Xz={kind:"formatted"},Yz={kind:"padding"},Kz={kind:"colorArray"},Jz={kind:"numberArray"},$z={kind:"resolvedImage"},Qz={kind:"variableAnchorOffsetCollection"};function tN(t,e){return{kind:"array",itemType:t,N:e}}function eN(t){if("array"===t.kind){const e=eN(t.itemType);return"number"==typeof t.N?"array<".concat(e,", ").concat(t.N,">"):"value"===t.itemType.kind?"array":"array<".concat(e,">")}return t.kind}const nN=[Bz,Uz,jz,Vz,Hz,Gz,Xz,Wz,tN(qz),Yz,Jz,Kz,$z,Qz];function iN(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!iN(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of nN)if(!iN(t,e))return null}return"Expected ".concat(eN(t)," but found ").concat(eN(e)," instead.")}function rN(t,e){return e.some(e=>e.kind===t.kind)}function aN(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function oN(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const sN=.96422,lN=.82521,cN=4/29,uN=6/29,hN=3*uN*uN,dN=uN*uN*uN,pN=Math.PI/180,fN=180/Math.PI;function mN(t){return(t%=360)<0&&(t+=360),t}function gN(t){let e,n,[i,r,a,o]=t;i=yN(i),r=yN(r),a=yN(a);const s=vN((.2225045*i+.7168786*r+.0606169*a)/1);i===r&&r===a?e=n=s:(e=vN((.4360747*i+.3850649*r+.1430804*a)/sN),n=vN((.0139322*i+.0971045*r+.7141733*a)/lN));const l=116*s-16;return[l<0?0:l,500*(e-s),200*(s-n),o]}function yN(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function vN(t){return t>dN?Math.pow(t,1/3):t/hN+cN}function _N(t){let[e,n,i,r]=t,a=(e+16)/116,o=isNaN(n)?a:a+n/500,s=isNaN(i)?a:a-i/200;return a=1*bN(a),o=sN*bN(o),s=lN*bN(s),[xN(3.1338561*o-1.6168667*a-.4906146*s),xN(-.9787684*o+1.9161415*a+.033454*s),xN(.0719453*o-.2289914*a+1.4052427*s),r]}function xN(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function bN(t){return t>uN?t*t*t:hN*(t-cN)}const wN=Object.hasOwn||function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function SN(t,e){return wN(t,e)?t[e]:void 0}function MN(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=SN(PN,t);if(e){const[t,n,i]=e;return[t/255,n/255,i/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let n=1;return[TN(t.slice(n,n+=e)),TN(t.slice(n,n+=e)),TN(t.slice(n,n+=e)),TN(t.slice(n,n+e)||"ff")]}if(t.startsWith("rgb")){const e=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=t.match(e);if(n){const[t,e,i,r,a,o,s,l,c,u,h,d]=n,p=[r||" ",s||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const t=[i,o,c].join(""),n="%%%"===t?100:""===t?255:0;if(n){const t=[AN(+e/n,0,1),AN(+a/n,0,1),AN(+l/n,0,1),h?EN(+h,d):1];if(CN(t))return t}}return}}const n=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[t,e,i,r,a,o,s,l,c]=n,u=[i||" ",a||" ",s].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,AN(+r,0,100),AN(+o,0,100),l?EN(+l,c):1];if(CN(t))return function(t){let[e,n,i,r]=t;function a(t){const r=(t+e/30)%12,a=n*Math.min(i,1-i);return i-a*Math.max(-1,Math.min(r-3,9-r,1))}return e=mN(e),n/=100,i/=100,[a(0),a(8),a(4),r]}(t)}}}function TN(t){return parseInt(t.padEnd(2,t),16)/255}function EN(t,e){return AN(e?t/100:t,0,1)}function AN(t,e,n){return Math.min(Math.max(e,t),n)}function CN(t){return!t.some(Number.isNaN)}const PN={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function IN(t,e,n){return t+n*(e-t)}function RN(t,e,n){return t.map((t,i)=>IN(t,e[i],n))}class kN{constructor(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.r=t,this.g=e,this.b=n,this.a=i,r||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[t,e,n,i]))}static parse(t){if(t instanceof kN)return t;if("string"!=typeof t)return;const e=MN(t);return e?new kN(...e,!1):void 0}get rgb(){const{r:t,g:e,b:n,a:i}=this,r=i||1/0;return this.overwriteGetter("rgb",[t/r,e/r,n/r,i])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,n,i,r]=gN(t),a=Math.sqrt(n*n+i*i);return[Math.round(1e4*a)?mN(Math.atan2(i,n)*fN):NaN,a,e,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",gN(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,n,i]=this.rgb;return"rgba(".concat([t,e,n].map(t=>Math.round(255*t)).join(","),",").concat(i,")")}static interpolate(t,e,n){switch(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb"){case"rgb":{const[i,r,a,o]=RN(t.rgb,e.rgb,n);return new kN(i,r,a,o,!1)}case"hcl":{const[i,r,a,o]=t.hcl,[s,l,c,u]=e.hcl;let h,d;if(isNaN(i)||isNaN(s))isNaN(i)?isNaN(s)?h=NaN:(h=s,(1===a||0===a)&&(d=l)):(h=i,(1===c||0===c)&&(d=r));else{let t=s-i;s>i&&t>180?t-=360:s<i&&i-s>180&&(t+=360),h=i+n*t}const[p,f,m,g]=function(t){let[e,n,i,r]=t;return e=isNaN(e)?0:e*pN,_N([i,Math.cos(e)*n,Math.sin(e)*n,r])}([h,null!==d&&void 0!==d?d:IN(r,l,n),IN(a,c,n),IN(o,u,n)]);return new kN(p,f,m,g,!1)}case"lab":{const[i,r,a,o]=_N(RN(t.lab,e.lab,n));return new kN(i,r,a,o,!1)}}}}kN.black=new kN(0,0,0,1),kN.white=new kN(1,1,1,1),kN.transparent=new kN(0,0,0,0),kN.red=new kN(1,0,0,1);class LN{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const DN=["bottom","center","top"];class zN{constructor(t,e,n,i,r,a){this.text=t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r,this.verticalAlign=a}}class NN{constructor(t){this.sections=t}static fromString(t){return new NN([new zN(t,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof NN?t:NN.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}}class ON{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ON)return t;if("number"==typeof t)return new ON([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ON(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new ON(RN(t.values,e.values,n))}}class FN{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof FN)return t;if("number"==typeof t)return new FN([t]);if(Array.isArray(t)){for(const e of t)if("number"!=typeof e)return;return new FN(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){return new FN(RN(t.values,e.values,n))}}class BN{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof BN)return t;if("string"==typeof t){const e=kN.parse(t);return e?new BN([e]):void 0}if(!Array.isArray(t))return;const e=[];for(const n of t){if("string"!=typeof n)return;const t=kN.parse(n);if(!t)return;e.push(t)}return new BN(e)}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"rgb";const r=[];if(t.values.length!=e.values.length)throw new Error("colorArray: Arrays have mismatched length (".concat(t.values.length," vs. ").concat(e.values.length,"), cannot interpolate."));for(let a=0;a<t.values.length;a++)r.push(kN.interpolate(t.values[a],e.values[a],n,i));return new BN(r)}}class UN extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const jN=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class VN{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof VN)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2===0){for(let e=0;e<t.length;e+=2){const n=t[e],i=t[e+1];if("string"!=typeof n||!jN.has(n)||!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new VN(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,n){const i=t.values,r=e.values;if(i.length!==r.length)throw new UN("Cannot interpolate values of different length. from: ".concat(t.toString(),", to: ").concat(e.toString()));const a=[];for(let o=0;o<i.length;o+=2){if(i[o]!==r[o])throw new UN("Cannot interpolate values containing mismatched anchors. from[".concat(o,"]: ").concat(i[o],", to[").concat(o,"]: ").concat(r[o]));a.push(i[o]);const[t,e]=i[o+1],[s,l]=r[o+1];a.push([IN(t,s,n),IN(e,l,n)])}return new VN(a)}}class HN{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new HN({name:t,available:!1}):null}}class GN{constructor(t,e,n){this.from=t,this.to=e,this.transition=n}static interpolate(t,e,n){return new GN(t,e,n)}static parse(t){return t instanceof GN?t:Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]?new GN(t[0],t[1],t[2]):"object"==typeof t&&"string"==typeof t.from&&"string"==typeof t.to&&"number"==typeof t.transition?new GN(t.from,t.to,t.transition):"string"==typeof t?new GN(t,t,1):void 0}}function WN(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?typeof i>"u"||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value [".concat([t,e,n,i].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function qN(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof GN||t instanceof kN||t instanceof LN||t instanceof NN||t instanceof ON||t instanceof FN||t instanceof BN||t instanceof VN||t instanceof HN)return!0;if(Array.isArray(t)){for(const e of t)if(!qN(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!qN(t[e]))return!1;return!0}return!1}function ZN(t){if(null===t)return Bz;if("string"==typeof t)return jz;if("boolean"==typeof t)return Vz;if("number"==typeof t)return Uz;if(t instanceof kN)return Hz;if(t instanceof GN)return Gz;if(t instanceof LN)return Zz;if(t instanceof NN)return Xz;if(t instanceof ON)return Yz;if(t instanceof FN)return Jz;if(t instanceof BN)return Kz;if(t instanceof VN)return Qz;if(t instanceof HN)return $z;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=ZN(i);if(n){if(n===t)continue;n=qz;break}n=t}return tN(n||qz,e)}return Wz}function XN(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof kN||t instanceof GN||t instanceof NN||t instanceof ON||t instanceof FN||t instanceof BN||t instanceof VN||t instanceof HN?t.toString():JSON.stringify(t)}class YN{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!qN(t[1]))return e.error("invalid value");const n=t[1];let i=ZN(n);const r=e.expectedType;return"array"===i.kind&&0===i.N&&r&&"array"===r.kind&&("number"!=typeof r.N||0===r.N)&&(i=r),new YN(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const KN={string:jz,number:Uz,boolean:Vz,object:Wz};class JN{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,a;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in KN)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=KN[n],i++}else r=qz;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],i++}n=tN(r,a)}else{if(!KN[r])throw new Error("Types doesn't contain name = ".concat(r));n=KN[r]}const a=[];for(;i<t.length;i++){const n=e.parse(t[i],i,qz);if(!n)return null;a.push(n)}return new JN(n,a)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!iN(this.type,ZN(n)))return n;if(e===this.args.length-1)throw new UN("Expected value to be of type ".concat(eN(this.type),", but found ").concat(eN(ZN(n))," instead."))}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const $N={"to-boolean":Vz,"to-color":Hz,"to-number":Uz,"to-string":jz};class QN{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(!$N[n])throw new Error("Can't parse ".concat(n," as it is not part of the known types"));if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=$N[n],r=[];for(let a=1;a<t.length;a++){const n=e.parse(t[a],a,qz);if(!n)return null;r.push(n)}return new QN(i,r)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof kN)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?"Invalid rgba value ".concat(JSON.stringify(e),": expected an array containing either three or four numeric values."):WN(e[0],e[1],e[2],e[3]),!n))return new kN(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new UN(n||"Could not parse color from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"padding":{let e;for(const n of this.args){e=n.evaluate(t);const i=ON.parse(e);if(i)return i}throw new UN("Could not parse padding from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"numberArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=FN.parse(e);if(i)return i}throw new UN("Could not parse numberArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"colorArray":{let e;for(const n of this.args){e=n.evaluate(t);const i=BN.parse(e);if(i)return i}throw new UN("Could not parse colorArray from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"variableAnchorOffsetCollection":{let e;for(const n of this.args){e=n.evaluate(t);const i=VN.parse(e);if(i)return i}throw new UN("Could not parse variableAnchorOffsetCollection from value '".concat("string"==typeof e?e:JSON.stringify(e),"'"))}case"number":{let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new UN("Could not convert ".concat(JSON.stringify(e)," to number."))}case"formatted":return NN.fromString(XN(this.args[0].evaluate(t)));case"resolvedImage":return HN.fromString(XN(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return XN(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const tO=["Unknown","Point","LineString","Polygon"];class eO{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?tO[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache.get(t);return e||(e=kN.parse(t),this._parseColorCache.set(t,e)),e}}class nO{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Fz,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];this.registry=t,this.path=n,this.key=n.map(t=>"[".concat(t,"]")).join(""),this.scope=r,this.errors=a,this.expectedType=i,this._isConstant=e}parse(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)}_parse(t,e){function n(t,e,n){return"assert"===n?new JN(e,[t]):"coerce"===n?new QN(e,[t]):t}if((null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t)&&(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found ".concat(typeof r,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;const a=this.registry[r];if(a){let r=a.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind){if("projectionDefinition"===t.kind&&["string","array"].includes(i.kind)||["color","formatted","resolvedImage"].includes(t.kind)&&["value","string"].includes(i.kind)||["padding","numberArray"].includes(t.kind)&&["value","number","array"].includes(i.kind)||"colorArray"===t.kind&&["value","string","array"].includes(i.kind)||"variableAnchorOffsetCollection"===t.kind&&["value","array"].includes(i.kind))r=n(r,t,e.typeAnnotation||"coerce");else if(this.checkSubtype(t,i))return null}else r=n(r,t,e.typeAnnotation||"assert")}if(!(r instanceof YN)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const t=new eO;try{r=new YN(r.type,r.evaluate(t))}catch(i){return this.error(i.message),null}}return r}return this.error('Unknown expression "'.concat(r,'". If you wanted a literal array, use ["literal", [...]].'),0)}return typeof t>"u"?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found ".concat(typeof t," instead."))}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new nO(this.registry,this._isConstant,i,e||null,r,this.errors)}error(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const r="".concat(this.key).concat(n.map(t=>"[".concat(t,"]")).join(""));this.errors.push(new Oz(r,t))}checkSubtype(t,e){const n=iN(t,e);return n&&this.error(n),n}}class iO{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error("Expected string, but found ".concat(typeof i," instead."),r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const a=e.parse(t[r+1],r+1);if(!a)return null;n.push([i,a])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new iO(n,i):null}outputDefined(){return this.result.outputDefined()}}class rO{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new rO(n,e.scope.get(n)):e.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class aO{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,Uz),i=e.parse(t[2],2,tN(e.expectedType||qz));if(!n||!i)return null;const r=i.type;return new aO(r.itemType,n,i)}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new UN("Array index out of bounds: ".concat(e," < 0."));if(e>=n.length)throw new UN("Array index out of bounds: ".concat(e," > ").concat(n.length-1,"."));if(e!==Math.floor(e))throw new UN("Array index must be an integer, but found ".concat(e," instead."));return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class oO{constructor(t,e){this.type=Vz,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,qz),i=e.parse(t[2],2,qz);return n&&i?rN(n.type,[Vz,jz,Uz,Bz,qz])?new oO(n,i):e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(eN(n.type)," instead")):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!aN(e,["boolean","string","number","null"]))throw new UN("Expected first argument to be of type boolean, string, number or null, but found ".concat(eN(ZN(e))," instead."));if(!aN(n,["string","array"]))throw new UN("Expected second argument to be of type array or string, but found ".concat(eN(ZN(n))," instead."));return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class sO{constructor(t,e,n){this.type=Uz,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,qz),i=e.parse(t[2],2,qz);if(!n||!i)return null;if(!rN(n.type,[Vz,jz,Uz,Bz,qz]))return e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(eN(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,Uz);return r?new sO(n,i,r):null}return new sO(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!aN(e,["boolean","string","number","null"]))throw new UN("Expected first argument to be of type boolean, string, number or null, but found ".concat(eN(ZN(e))," instead."));let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(t)),aN(n,["string"])){const t=n.indexOf(e,i);return-1===t?-1:[...n.slice(0,t)].length}if(aN(n,["array"]))return n.indexOf(e,i);throw new UN("Expected second argument to be of type array or string, but found ".concat(eN(ZN(n))," instead."))}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class lO{constructor(t,e,n,i,r,a){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a}static parse(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!==1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},a=[];for(let l=2;l<t.length-1;l+=2){let o=t[l];const s=t[l+1];Array.isArray(o)||(o=[o]);const c=e.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,ZN(t)))return null}else n=ZN(t);if(typeof r[String(t)]<"u")return c.error("Branch labels must be unique.");r[String(t)]=a.length}const u=e.parse(s,l,i);if(!u)return null;i=i||u.type,a.push(u)}const o=e.parse(t[1],1,qz);if(!o)return null;const s=e.parse(t[t.length-1],t.length-1,i);return!s||"value"!==o.type.kind&&e.concat(1).checkSubtype(n,o.type)?null:new lO(n,i,o,r,a,s)}evaluate(t){const e=this.input.evaluate(t);return(ZN(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class cO{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!==0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let a=1;a<t.length-1;a+=2){const r=e.parse(t[a],a,Vz);if(!r)return null;const o=e.parse(t[a+1],a+1,n);if(!o)return null;i.push([r,o]),n=n||o.type}const r=e.parse(t[t.length-1],t.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new cO(n,i,r)}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(t=>{let[e,n]=t;return n.outputDefined()})&&this.otherwise.outputDefined()}}class uO{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1,qz),i=e.parse(t[2],2,Uz);if(!n||!i)return null;if(!rN(n.type,[tN(qz),jz,qz]))return e.error("Expected first argument to be of type array or string, but found ".concat(eN(n.type)," instead"));if(4===t.length){const r=e.parse(t[3],3,Uz);return r?new uO(n.type,n,i,r):null}return new uO(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);let i;if(this.endIndex&&(i=this.endIndex.evaluate(t)),aN(e,["string"]))return[...e].slice(n,i).join("");if(aN(e,["array"]))return e.slice(n,i);throw new UN("Expected first argument to be of type array or string, but found ".concat(eN(ZN(e))," instead."))}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function hO(t,e){const n=t.length-1;let i,r,a=0,o=n,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),i=t[s],r=t[s+1],i<=e){if(s===n||e<r)return s;a=s+1}else{if(!(i>e))throw new UN("Input is not a number.");o=s-1}return 0}class dO{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,Uz);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let a=1;a<t.length;a+=2){const n=1===a?-1/0:t[a],o=t[a+1],s=a,l=a+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(i.length&&i[i.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(o,l,r);if(!c)return null;r=r||c.type,i.push([n,c])}return new dO(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);return n[hO(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function pO(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fO,mO;var gO=function(){if(mO)return fO;function t(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}return mO=1,fO=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=r/a}var o=0,s=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?o=n:s=n,n=.5*(s-o)+o;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},fO}(),yO=pO(gO);class vO{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of r)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(t,e,n,i){let r=0;if("exponential"===t.name)r=_O(e,t.base,n,i);else if("linear"===t.name)r=_O(e,1,n,i);else if("cubic-bezier"===t.name){const a=t.controlPoints;r=new yO(a[0],a[1],a[2],a[3]).solve(_O(e,1,n,i))}return r}static parse(t,e){let[n,i,r,...a]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type ".concat(String(i[0])),1,0);{const t=i.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Uz),!r)return null;const o=[];let s=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||e.expectedType==Kz?e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType):s=Hz;for(let l=0;l<a.length;l+=2){const t=a[l],n=a[l+1],i=l+3,r=l+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=e.parse(n,r,s);if(!c)return null;s=s||c.type,o.push([t,c])}return oN(s,Uz)||oN(s,Gz)||oN(s,Hz)||oN(s,Yz)||oN(s,Jz)||oN(s,Kz)||oN(s,Qz)||oN(s,tN(Uz))?new vO(s,n,i,r,o):e.error("Type ".concat(eN(s)," is not interpolatable."))}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const a=hO(e,i),o=e[a],s=e[a+1],l=vO.interpolationFactor(this.interpolation,i,o,s),c=n[a].evaluate(t),u=n[a+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return IN(c,u,l);case"color":return kN.interpolate(c,u,l);case"padding":return ON.interpolate(c,u,l);case"colorArray":return BN.interpolate(c,u,l);case"numberArray":return FN.interpolate(c,u,l);case"variableAnchorOffsetCollection":return VN.interpolate(c,u,l);case"array":return RN(c,u,l);case"projectionDefinition":return GN.interpolate(c,u,l)}case"interpolate-hcl":switch(this.type.kind){case"color":return kN.interpolate(c,u,l,"hcl");case"colorArray":return BN.interpolate(c,u,l,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return kN.interpolate(c,u,l,"lab");case"colorArray":return BN.interpolate(c,u,l,"lab")}}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function _O(t,e,n,i){const r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}kN.interpolate,ON.interpolate,FN.interpolate,BN.interpolate,VN.interpolate;class xO{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const a of t.slice(1)){const t=e.parse(a,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}if(!n)throw new Error("No output type");return i&&r.some(t=>iN(i,t.type))?new xO(qz,r):new xO(n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(t),n&&n instanceof HN&&!n.available&&(e||(e=n.name),n=null,i===this.args.length&&(n=e)),null!==n)break;return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function bO(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function wO(t,e,n,i){return 0===i.compare(e,n)}function SO(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=Vz,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let a=e.parse(t[1],1,qz);if(!a)return null;if(!bO(n,a.type))return e.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(eN(a.type),"'."));let o=e.parse(t[2],2,qz);if(!o)return null;if(!bO(n,o.type))return e.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(eN(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '".concat(eN(a.type),"' and '").concat(eN(o.type),"'."));i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new JN(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new JN(a.type,[o])));let s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(s=e.parse(t[3],3,Zz),!s)return null}return new r(a,o,s)}evaluate(r){const a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=ZN(a),n=ZN(o);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new UN('Expected arguments for "'.concat(t,'" to be (string, string) or (number, number), but found (').concat(e.kind,", ").concat(n.kind,") instead."))}if(this.collator&&!i&&this.hasUntypedArgument){const t=ZN(a),n=ZN(o);if("string"!==t.kind||"string"!==n.kind)return e(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):e(r,a,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const MO=SO("==",function(t,e,n){return e===n},wO),TO=SO("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!wO(0,e,n,i)}),EO=SO("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),AO=SO(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),CO=SO("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),PO=SO(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class IO{constructor(t,e,n){this.type=Zz,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Vz);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Vz);if(!r)return null;let a=null;return n.locale&&(a=e.parse(n.locale,1,jz),!a)?null:new IO(i,r,a)}evaluate(t){return new LN(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class RO{constructor(t,e,n,i,r){this.type=jz,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Uz);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,jz),!r))return null;let a=null;if(i.currency&&(a=e.parse(i.currency,1,jz),!a))return null;let o=null;if(i["min-fraction-digits"]&&(o=e.parse(i["min-fraction-digits"],1,Uz),!o))return null;let s=null;return i["max-fraction-digits"]&&(s=e.parse(i["max-fraction-digits"],1,Uz),!s)?null:new RO(n,r,a,o,s)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class kO{constructor(t){this.type=Xz,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let a=1;a<=t.length-1;++a){const n=t[a];if(r&&"object"==typeof n&&!Array.isArray(n)){r=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,Uz),!t))return null;let a=null;if(n["text-font"]&&(a=e.parse(n["text-font"],1,tN(jz)),!a))return null;let o=null;if(n["text-color"]&&(o=e.parse(n["text-color"],1,Hz),!o))return null;let s=null;if(n["vertical-align"]){if("string"==typeof n["vertical-align"]&&!DN.includes(n["vertical-align"]))return e.error("'vertical-align' must be one of: 'bottom', 'center', 'top' but found '".concat(n["vertical-align"],"' instead."));if(s=e.parse(n["vertical-align"],1,jz),!s)return null}const l=i[i.length-1];l.scale=t,l.font=a,l.textColor=o,l.verticalAlign=s}else{const n=e.parse(t[a],1,qz);if(!n)return null;const o=n.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:n,scale:null,font:null,textColor:null,verticalAlign:null})}}return new kO(i)}evaluate(t){return new NN(this.sections.map(e=>{const n=e.content.evaluate(t);return ZN(n)===$z?new zN("",n,null,null,null,e.verticalAlign?e.verticalAlign.evaluate(t):null):new zN(XN(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null,e.verticalAlign?e.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor),e.verticalAlign&&t(e.verticalAlign)}outputDefined(){return!1}}class LO{constructor(t){this.type=$z,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,jz);return n?new LO(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=HN.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}}class DO{constructor(t){this.type=Uz,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found ".concat(eN(n.type)," instead.")):new DO(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return[...e].length;if(Array.isArray(e))return e.length;throw new UN("Expected value to be of type string or array, but found ".concat(eN(ZN(e))," instead."))}eachChild(t){t(this.input)}outputDefined(){return!1}}const zO=8192;function NO(t,e){const n=function(t){return(180+t)/360}(t[0]),i=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}(t[1]),r=Math.pow(2,e.z);return[Math.round(n*r*zO),Math.round(i*r*zO)]}function OO(t,e){const n=Math.pow(2,e.z),i=(t[0]/zO+e.x)/n,r=(t[1]/zO+e.y)/n;return[FO(i),BO(r)]}function FO(t){return 360*t-180}function BO(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function UO(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function jO(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function VO(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function HO(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],a=t[0]-n[0],o=t[1]-n[1];return i*o-a*r===0&&i*a<=0&&r*o<=0}function GO(t,e,n,i){const r=[e[0]-t[0],e[1]-t[1]];return 0!==function(t,e){return t[0]*e[1]-t[1]*e[0]}([i[0]-n[0],i[1]-n[1]],r)&&!(!KO(t,e,n,i)||!KO(n,i,t,e))}function WO(t,e,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(GO(t,e,i[n],i[n+1]))return!0;return!1}function qO(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;for(const r of e)for(let e=0;e<r.length-1;e++){if(HO(t,r[e],r[e+1]))return n;VO(t,r[e],r[e+1])&&(i=!i)}return i}function ZO(t,e){for(const n of e)if(qO(t,n))return!0;return!1}function XO(t,e){for(const n of t)if(!qO(n,e))return!1;for(let n=0;n<t.length-1;++n)if(WO(t[n],t[n+1],e))return!1;return!0}function YO(t,e){for(const n of e)if(XO(t,n))return!0;return!1}function KO(t,e,n,i){const r=t[0]-n[0],a=t[1]-n[1],o=e[0]-n[0],s=e[1]-n[1],l=i[0]-n[0],c=i[1]-n[1],u=r*c-l*a,h=o*c-l*s;return u>0&&h<0||u<0&&h>0}function JO(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=[];for(let i=0;i<t[r].length;i++){const o=NO(t[r][i],n);UO(e,o),a.push(o)}i.push(a)}return i}function $O(t,e,n){const i=[];for(let r=0;r<t.length;r++){const a=JO(t[r],e,n);i.push(a)}return i}function QO(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}UO(e,t)}function tF(t,e,n,i){const r=Math.pow(2,i.z)*zO,a=[i.x*zO,i.y*zO],o=[];for(const s of t)for(const t of s){const i=[t.x+a[0],t.y+a[1]];QO(i,e,n,r),o.push(i)}return o}function eF(t,e,n,i){const r=Math.pow(2,i.z)*zO,a=[i.x*zO,i.y*zO],o=[];for(const s of t){const t=[];for(const n of s){const i=[n.x+a[0],n.y+a[1]];UO(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=r/2){!function(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}(e);for(const t of o)for(const i of t)QO(i,e,n,r)}return o}class nF{constructor(t,e){this.type=Vz,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(qN(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const n of e.features){const{type:e,coordinates:i}=n.geometry;"Polygon"===e&&t.push(i),"MultiPolygon"===e&&t.push(...i)}if(t.length){return new nF(e,{type:"MultiPolygon",coordinates:t})}}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new nF(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new nF(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=JO(e.coordinates,i,r),o=tF(t.geometry(),n,i,r);if(!jO(n,i))return!1;for(const t of o)if(!qO(t,a))return!1}if("MultiPolygon"===e.type){const a=$O(e.coordinates,i,r),o=tF(t.geometry(),n,i,r);if(!jO(n,i))return!1;for(const t of o)if(!ZO(t,a))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const a=JO(e.coordinates,i,r),o=eF(t.geometry(),n,i,r);if(!jO(n,i))return!1;for(const t of o)if(!XO(t,a))return!1}if("MultiPolygon"===e.type){const a=$O(e.coordinates,i,r),o=eF(t.geometry(),n,i,r);if(!jO(n,i))return!1;for(const t of o)if(!YO(t,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class iF{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t,e)=>t<e?-1:t>e?1:0;if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1);const a=i+1;if(a<this.length&&n(e[a],e[i])<0&&(i=a),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}}function rF(t){let e=0;for(let n,i,r=0,a=t.length,o=a-1;r<a;o=r++)n=t[r],i=t[o],e+=(i.x-n.x)*(n.y+i.y);return e}const aF=1/298.257223563,oF=aF*(2-aF),sF=Math.PI/180;class lF{constructor(t){const e=6378.137*sF*1e3,n=Math.cos(t*sF),i=1/(1-oF*(1-n*n)),r=Math.sqrt(i);this.kx=e*r*n,this.ky=e*r*i*(1-oF)}distance(t,e){const n=this.wrap(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(t,e){let n,i,r,a,o=1/0;for(let s=0;s<t.length-1;s++){let l=t[s][0],c=t[s][1],u=this.wrap(t[s+1][0]-l)*this.kx,h=(t[s+1][1]-c)*this.ky,d=0;(0!==u||0!==h)&&(d=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=t[s+1][0],c=t[s+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const p=u*u+h*h;p<o&&(o=p,n=l,i=c,r=s,a=d)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,a))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function cF(t,e){return e[0]-t[0]}function uF(t){return t[1]-t[0]+1}function hF(t,e){return t[1]>=t[0]&&t[1]<e}function dF(t,e){if(t[0]>t[1])return[null,null];const n=uF(t);if(e){if(2===n)return[t,null];const e=Math.floor(n/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===n)return[t,null];const i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}function pF(t,e){if(!hF(e,t.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let i=e[0];i<=e[1];++i)UO(n,t[i]);return n}function fF(t){const e=[1/0,1/0,-1/0,-1/0];for(const n of t)for(const t of n)UO(e,t);return e}function mF(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function gF(t,e,n){if(!mF(t)||!mF(e))return NaN;let i=0,r=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),n.distance([0,0],[i,r])}function yF(t,e,n){const i=n.pointOnLine(e,t);return n.distance(t,i.point)}function vF(t,e,n,i,r){const a=Math.min(yF(t,[n,i],r),yF(e,[n,i],r)),o=Math.min(yF(n,[t,e],r),yF(i,[t,e],r));return Math.min(a,o)}function _F(t,e,n,i,r){if(!hF(e,t.length)||!hF(i,n.length))return 1/0;let a=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(let t=i[0];t<i[1];++t){const i=n[t],o=n[t+1];if(GO(e,s,i,o))return 0;a=Math.min(a,vF(e,s,i,o,r))}}return a}function xF(t,e,n,i,r){if(!hF(e,t.length)||!hF(i,n.length))return NaN;let a=1/0;for(let o=e[0];o<=e[1];++o)for(let e=i[0];e<=i[1];++e)if(a=Math.min(a,r.distance(t[o],n[e])),0===a)return a;return a}function bF(t,e,n){if(qO(t,e,!0))return 0;let i=1/0;for(const r of e){const e=r[0],a=r[r.length-1];if(e!==a&&(i=Math.min(i,yF(t,[a,e],n)),0===i))return i;const o=n.pointOnLine(r,t);if(i=Math.min(i,n.distance(t,o.point)),0===i)return i}return i}function wF(t,e,n,i){if(!hF(e,t.length))return NaN;for(let a=e[0];a<=e[1];++a)if(qO(t[a],n,!0))return 0;let r=1/0;for(let a=e[0];a<e[1];++a){const e=t[a],o=t[a+1];for(const t of n)for(let n=0,a=t.length,s=a-1;n<a;s=n++){const a=t[s],l=t[n];if(GO(e,o,a,l))return 0;r=Math.min(r,vF(e,o,a,l,i))}}return r}function SF(t,e){for(const n of t)for(const t of n)if(qO(t,e,!0))return!0;return!1}function MF(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const r=fF(t),a=fF(e);if(i!==1/0&&gF(r,a,n)>=i)return i;if(jO(r,a)){if(SF(t,e))return 0}else if(SF(e,t))return 0;let o=1/0;for(const s of t)for(let t=0,i=s.length,r=i-1;t<i;r=t++){const i=s[r],a=s[t];for(const t of e)for(let e=0,r=t.length,s=r-1;e<r;s=e++){const r=t[s],l=t[e];if(GO(i,a,r,l))return 0;o=Math.min(o,vF(i,a,r,l,n))}}return o}function TF(t,e,n,i,r,a){if(!a)return;const o=gF(pF(i,a),r,n);o<e&&t.push([o,a,[0,0]])}function EF(t,e,n,i,r,a,o){if(!a||!o)return;const s=gF(pF(i,a),pF(r,o),n);s<e&&t.push([s,a,o])}function AF(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=Math.min(i.distance(t[0],n[0][0]),r);if(0===a)return a;const o=new iF([[0,[0,t.length-1],[0,0]]],cF),s=fF(n);for(;o.length>0;){const r=o.pop();if(r[0]>=a)continue;const l=r[1],c=e?50:100;if(uF(l)<=c){if(!hF(l,t.length))return NaN;if(e){const e=wF(t,l,n,i);if(isNaN(e)||0===e)return e;a=Math.min(a,e)}else for(let e=l[0];e<=l[1];++e){const r=bF(t[e],n,i);if(a=Math.min(a,r),0===a)return 0}}else{const n=dF(l,e);TF(o,a,i,t,s,n[0]),TF(o,a,i,t,s,n[1])}}return a}function CF(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(a,r.distance(t[0],n[0]));if(0===o)return o;const s=new iF([[0,[0,t.length-1],[0,n.length-1]]],cF);for(;s.length>0;){const a=s.pop();if(a[0]>=o)continue;const l=a[1],c=a[2],u=e?50:100,h=i?50:100;if(uF(l)<=u&&uF(c)<=h){if(!hF(l,t.length)&&hF(c,n.length))return NaN;let a;if(e&&i)a=_F(t,l,n,c,r),o=Math.min(o,a);else if(e&&!i){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(a=yF(n[t],e,r),o=Math.min(o,a),0===o)return o}else if(!e&&i){const e=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(a=yF(t[n],e,r),o=Math.min(o,a),0===o)return o}else a=xF(t,l,n,c,r),o=Math.min(o,a)}else{const a=dF(l,e),u=dF(c,i);EF(s,o,r,t,n,a[0],u[0]),EF(s,o,r,t,n,a[0],u[1]),EF(s,o,r,t,n,a[1],u[0]),EF(s,o,r,t,n,a[1],u[1])}}return o}function PF(t,e){const n=t.geometry();if(0===n.length||0===n[0].length)return NaN;const i=function(t){if(t.length<=1)return[t];const e=[];let n,i;for(const r of t){const t=rF(r);0!==t&&(r.area=Math.abs(t),void 0===i&&(i=t<0),i===t<0?(n&&e.push(n),n=[r]):n.push(r))}return n&&e.push(n),e}(n).map(e=>e.map(e=>e.map(e=>OO([e.x,e.y],t.canonical)))),r=new lF(i[0][0][0][1]);let a=1/0;for(const o of e)for(const t of i){switch(o.type){case"Point":a=Math.min(a,AF([o.coordinates],!1,t,r,a));break;case"LineString":a=Math.min(a,AF(o.coordinates,!0,t,r,a));break;case"Polygon":a=Math.min(a,MF(t,o.coordinates,r,a))}if(0===a)return a}return a}function IF(t){return"MultiPolygon"===t.type?t.coordinates.map(t=>({type:"Polygon",coordinates:t})):"MultiLineString"===t.type?t.coordinates.map(t=>({type:"LineString",coordinates:t})):"MultiPoint"===t.type?t.coordinates.map(t=>({type:"Point",coordinates:t})):[t]}class RF{constructor(t,e){this.type=Uz,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error("'distance' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(qN(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new RF(e,e.features.map(t=>IF(t.geometry)).flat());if("Feature"===e.type)return new RF(e,IF(e.geometry));if("type"in e&&"coordinates"in e)return new RF(e,IF(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>OO([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new lF(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,CF(i,!1,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,CF(i,!1,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,AF(i,!1,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=t.geometry(),i=n.flat().map(e=>OO([e.x,e.y],t.canonical));if(0===n.length)return NaN;const r=new lF(i[0][1]);let a=1/0;for(const o of e){switch(o.type){case"Point":a=Math.min(a,CF(i,!0,[o.coordinates],!1,r,a));break;case"LineString":a=Math.min(a,CF(i,!0,o.coordinates,!0,r,a));break;case"Polygon":a=Math.min(a,AF(i,!0,o.coordinates,r,a))}if(0===a)return a}return a}(t,this.geometries);if("Polygon"===t.geometryType())return PF(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class kF{constructor(t){this.type=qz,this.key=t}static parse(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found ".concat(t.length-1," instead."));const n=t[1];return null==n?e.error("Global state property must be defined."):"string"!=typeof n?e.error("Global state property must be string, but found ".concat(typeof t[1]," instead.")):new kF(n)}evaluate(t){var e;const n=null===(e=t.globals)||void 0===e?void 0:e.globalState;return n&&0!==Object.keys(n).length?SN(n,this.key):null}eachChild(){}outputDefined(){return!1}}const LF={"==":MO,"!=":TO,">":AO,"<":EO,">=":PO,"<=":CO,array:JN,at:aO,boolean:JN,case:cO,coalesce:xO,collator:IO,format:kO,image:LO,in:oO,"index-of":sO,interpolate:vO,"interpolate-hcl":vO,"interpolate-lab":vO,length:DO,let:iO,literal:YN,match:lO,number:JN,"number-format":RO,object:JN,slice:uO,step:dO,string:JN,"to-boolean":QN,"to-color":QN,"to-number":QN,"to-string":QN,var:rO,within:nF,distance:RF,"global-state":kF};class DF{constructor(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const n=t[0],i=DF.definitions[n];if(!i)return e.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);const r=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(e=>{let[n]=e;return!Array.isArray(n)||n.length===t.length-1});let s=null;for(const[l,c]of o){s=new nO(e.registry,BF,e.path,null,e.scope);const i=[];let a=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(l)?l[e-1]:l.type,o=s.parse(n,1+i.length,r);if(!o){a=!0;break}i.push(o)}if(!a){if(Array.isArray(l)&&l.length!==i.length){s.error("Expected ".concat(l.length," arguments, but found ").concat(i.length," instead."));continue}for(let t=0;t<i.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=i[t];s.concat(t+1).checkSubtype(e,n.type)}if(0===s.errors.length)return new DF(n,r,c,i)}}if(1===o.length)e.errors.push(...s.errors);else{const n=(o.length?o:a).map(t=>{let[e]=t;return n=e,Array.isArray(n)?"(".concat(n.map(eN).join(", "),")"):"(".concat(eN(n.type),"...)");var n}).join(" | "),i=[];for(let r=1;r<t.length;r++){const n=e.parse(t[r],1+i.length);if(!n)return null;i.push(eN(n.type))}e.error("Expected arguments of type ".concat(n,", but found (").concat(i.join(", "),") instead."))}return null}static register(t,e){DF.definitions=e;for(const n in e)t[n]=DF}}function zF(t,e){let[n,i,r,a]=e;n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=a?a.evaluate(t):1,s=WN(n,i,r,o);if(s)throw new UN(s);return new kN(n/255,i/255,r/255,o,!1)}function NF(t,e){return t in e}function OF(t,e){const n=e[t];return typeof n>"u"?null:n}function FF(t){return{type:t}}function BF(t){if(t instanceof rO)return BF(t.boundExpression);if(t instanceof DF&&"error"===t.name)return!1;if(t instanceof IO)return!1;if(t instanceof nF)return!1;if(t instanceof RF)return!1;if(t instanceof kF)return!1;const e=t instanceof QN||t instanceof JN;let n=!0;return t.eachChild(t=>{n=e?n&&BF(t):n&&t instanceof YN}),!!n&&(UF(t)&&VF(t,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]))}function UF(t){if(t instanceof DF){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof nF||t instanceof RF)return!1;let e=!0;return t.eachChild(t=>{e&&!UF(t)&&(e=!1)}),e}function jF(t){if(t instanceof DF&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!jF(t)&&(e=!1)}),e}function VF(t,e){if(t instanceof DF&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!VF(t,e)&&(n=!1)}),n}function HF(t){return{result:"success",value:t}}function GF(t){return{result:"error",value:t}}function WF(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function qF(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function ZF(t){return!!t.expression&&t.expression.interpolated}function XF(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function YF(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)&&ZN(t)===Wz}DF.register(LF,{error:[{kind:"error"},[jz],(t,e)=>{let[n]=e;throw new UN(n.evaluate(t))}],typeof:[jz,[qz],(t,e)=>{let[n]=e;return eN(ZN(n.evaluate(t)))}],"to-rgba":[tN(Uz,4),[Hz],(t,e)=>{let[n]=e;const[i,r,a,o]=n.evaluate(t).rgb;return[255*i,255*r,255*a,o]}],rgb:[Hz,[Uz,Uz,Uz],zF],rgba:[Hz,[Uz,Uz,Uz,Uz],zF],has:{type:Vz,overloads:[[[jz],(t,e)=>{let[n]=e;return NF(n.evaluate(t),t.properties())}],[[jz,Wz],(t,e)=>{let[n,i]=e;return NF(n.evaluate(t),i.evaluate(t))}]]},get:{type:qz,overloads:[[[jz],(t,e)=>{let[n]=e;return OF(n.evaluate(t),t.properties())}],[[jz,Wz],(t,e)=>{let[n,i]=e;return OF(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[qz,[jz],(t,e)=>{let[n]=e;return OF(n.evaluate(t),t.featureState||{})}],properties:[Wz,[],t=>t.properties()],"geometry-type":[jz,[],t=>t.geometryType()],id:[qz,[],t=>t.id()],zoom:[Uz,[],t=>t.globals.zoom],"heatmap-density":[Uz,[],t=>t.globals.heatmapDensity||0],elevation:[Uz,[],t=>t.globals.elevation||0],"line-progress":[Uz,[],t=>t.globals.lineProgress||0],accumulated:[qz,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Uz,FF(Uz),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[Uz,FF(Uz),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:Uz,overloads:[[[Uz,Uz],(t,e)=>{let[n,i]=e;return n.evaluate(t)-i.evaluate(t)}],[[Uz],(t,e)=>{let[n]=e;return-n.evaluate(t)}]]},"/":[Uz,[Uz,Uz],(t,e)=>{let[n,i]=e;return n.evaluate(t)/i.evaluate(t)}],"%":[Uz,[Uz,Uz],(t,e)=>{let[n,i]=e;return n.evaluate(t)%i.evaluate(t)}],ln2:[Uz,[],()=>Math.LN2],pi:[Uz,[],()=>Math.PI],e:[Uz,[],()=>Math.E],"^":[Uz,[Uz,Uz],(t,e)=>{let[n,i]=e;return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.sqrt(n.evaluate(t))}],log10:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN10}],ln:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))}],log2:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.log(n.evaluate(t))/Math.LN2}],sin:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.sin(n.evaluate(t))}],cos:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.cos(n.evaluate(t))}],tan:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.tan(n.evaluate(t))}],asin:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.asin(n.evaluate(t))}],acos:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.acos(n.evaluate(t))}],atan:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.atan(n.evaluate(t))}],min:[Uz,FF(Uz),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Uz,FF(Uz),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.abs(n.evaluate(t))}],round:[Uz,[Uz],(t,e)=>{let[n]=e;const i=n.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.floor(n.evaluate(t))}],ceil:[Uz,[Uz],(t,e)=>{let[n]=e;return Math.ceil(n.evaluate(t))}],"filter-==":[Vz,[jz,qz],(t,e)=>{let[n,i]=e;return t.properties()[n.value]===i.value}],"filter-id-==":[Vz,[qz],(t,e)=>{let[n]=e;return t.id()===n.value}],"filter-type-==":[Vz,[jz],(t,e)=>{let[n]=e;return t.geometryType()===n.value}],"filter-<":[Vz,[jz,qz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Vz,[qz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Vz,[jz,qz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Vz,[qz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Vz,[jz,qz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Vz,[qz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Vz,[jz,qz],(t,e)=>{let[n,i]=e;const r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Vz,[qz],(t,e)=>{let[n]=e;const i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Vz,[qz],(t,e)=>{let[n]=e;return n.value in t.properties()}],"filter-has-id":[Vz,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Vz,[tN(jz)],(t,e)=>{let[n]=e;return n.value.indexOf(t.geometryType())>=0}],"filter-id-in":[Vz,[tN(qz)],(t,e)=>{let[n]=e;return n.value.indexOf(t.id())>=0}],"filter-in-small":[Vz,[jz,tN(qz)],(t,e)=>{let[n,i]=e;return i.value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Vz,[jz,tN(qz)],(t,e)=>{let[n,i]=e;return function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Vz,overloads:[[[Vz,Vz],(t,e)=>{let[n,i]=e;return n.evaluate(t)&&i.evaluate(t)}],[FF(Vz),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Vz,overloads:[[[Vz,Vz],(t,e)=>{let[n,i]=e;return n.evaluate(t)||i.evaluate(t)}],[FF(Vz),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Vz,[Vz],(t,e)=>{let[n]=e;return!n.evaluate(t)}],"is-supported-script":[Vz,[jz],(t,e)=>{let[n]=e;const i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[jz,[jz],(t,e)=>{let[n]=e;return n.evaluate(t).toUpperCase()}],downcase:[jz,[jz],(t,e)=>{let[n]=e;return n.evaluate(t).toLowerCase()}],concat:[jz,FF(qz),(t,e)=>e.map(e=>XN(e.evaluate(t))).join("")],"resolved-locale":[jz,[Zz],(t,e)=>{let[n]=e;return n.evaluate(t).resolvedLocale()}]});class KF{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new eO,this._defaultValue=e?function(t){if("color"===t.type&&YF(t.default))return new kN(0,0,0,0);switch(t.type){case"color":return kN.parse(t.default)||null;case"padding":return ON.parse(t.default)||null;case"numberArray":return FN.parse(t.default)||null;case"colorArray":return BN.parse(t.default)||null;case"variableAnchorOffsetCollection":return VN.parse(t.default)||null;case"projectionDefinition":return GN.parse(t.default)||null;default:return void 0===t.default?null:t.default}}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,i,r,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!==t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new UN("Expected value to be one of ".concat(Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", "),", but found ").concat(JSON.stringify(t)," instead."));return t}catch(o){return this._warningHistory[o.message]||(this._warningHistory[o.message]=!0,typeof console<"u"&&console.warn(o.message)),this._defaultValue}}}function JF(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in LF}function $F(t,e){const n=new nO(LF,BF,[],e?function(t){const e={color:Hz,string:jz,number:Uz,enum:jz,boolean:Vz,formatted:Xz,padding:Yz,numberArray:Jz,colorArray:Kz,projectionDefinition:Gz,resolvedImage:$z,variableAnchorOffsetCollection:Qz};return"array"===t.type?tN(e[t.value]||qz,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?HF(new KF(i,e)):GF(n.errors)}class QF{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!jF(e.expression),this.globalStateRefs=iB(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}}class tB{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!jF(e.expression),this.globalStateRefs=iB(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,i,r,a)}evaluate(t,e,n,i,r,a){return this._styleExpression.evaluate(t,e,n,i,r,a)}interpolationFactor(t,e,n){return this.interpolationType?vO.interpolationFactor(this.interpolationType,t,e,n):0}}function eB(t,e){const n=$F(t,e);if("error"===n.result)return n;const i=n.value.expression,r=UF(i);if(!r&&!WF(e))return GF([new Oz("","data expressions not supported")]);const a=VF(i,["zoom"]);if(!a&&!qF(e))return GF([new Oz("","zoom expressions not supported")]);const o=nB(i);if(!o&&!a)return GF([new Oz("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Oz)return GF([o]);if(o instanceof vO&&!ZF(e))return GF([new Oz("",'"interpolate" expressions cannot be used with this property')]);if(!o)return HF(new QF(r?"constant":"source",n.value));const s=o instanceof vO?o.interpolation:void 0;return HF(new tB(r?"camera":"composite",n.value,o.labels,s))}function nB(t){let e=null;if(t instanceof iO)e=nB(t.result);else if(t instanceof xO){for(const n of t.args)if(e=nB(n),e)break}else(t instanceof dO||t instanceof vO)&&t.input instanceof DF&&"zoom"===t.input.name&&(e=t);return e instanceof Oz||t.eachChild(t=>{const n=nB(t);n instanceof Oz?e=n:!e&&n?e=new Oz("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Oz("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function iB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return t instanceof kF&&e.add(t.key),t.eachChild(t=>{iB(t,e)}),e}function rB(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!rB(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function aB(t){const e=t.key,n=t.value;return n?[new zz(e,n,"constants have been deprecated as of v8")]:[]}function oB(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function sB(t){if(Array.isArray(t))return t.map(sB);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=sB(t[n]);return e}return oB(t)}function lB(t){const e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=t.validateSpec;let l=[];const c=XF(n);if("object"!==c)return[new zz(e,n,"object expected, ".concat(c," found"))];for(const u in n){const t=u.split(".")[0],c=SN(i,t)||i["*"];let h;if(SN(r,t))h=r[t];else if(SN(i,t))h=s;else if(r["*"])h=r["*"];else{if(!i["*"]){l.push(new zz(e,n[u],'unknown property "'.concat(u,'"')));continue}h=s}l=l.concat(h({key:(e&&"".concat(e,"."))+u,value:n[u],valueSpec:c,style:a,styleSpec:o,object:n,objectKey:u,validateSpec:s},n))}for(const u in i)r[u]||i[u].required&&void 0===i[u].default&&void 0===n[u]&&l.push(new zz(e,n,'missing required property "'.concat(u,'"')));return l}function cB(t){const e=t.value,n=t.valueSpec,i=t.validateSpec,r=t.style,a=t.styleSpec,o=t.key,s=t.arrayElementValidator||i;if("array"!==XF(e))return[new zz(o,e,"array expected, ".concat(XF(e)," found"))];if(n.length&&e.length!==n.length)return[new zz(o,e,"array length ".concat(n.length," expected, length ").concat(e.length," found"))];if(n["min-length"]&&e.length<n["min-length"])return[new zz(o,e,"array length at least ".concat(n["min-length"]," expected, length ").concat(e.length," found"))];let l={type:n.value,values:n.values};a.$version<7&&(l.function=n.function),"object"===XF(n.value)&&(l=n.value);let c=[];for(let u=0;u<e.length;u++)c=c.concat(s({array:e,arrayIndex:u,value:e[u],valueSpec:l,validateSpec:t.validateSpec,style:r,styleSpec:a,key:"".concat(o,"[").concat(u,"]")}));return c}function uB(t){const e=t.key,n=t.value,i=t.valueSpec;let r=XF(n);return"number"===r&&n!==n&&(r="NaN"),"number"!==r?[new zz(e,n,"number expected, ".concat(r," found"))]:"minimum"in i&&n<i.minimum?[new zz(e,n,"".concat(n," is less than the minimum value ").concat(i.minimum))]:"maximum"in i&&n>i.maximum?[new zz(e,n,"".concat(n," is greater than the maximum value ").concat(i.maximum))]:[]}function hB(t){const e=t.valueSpec,n=oB(t.value.type);let i,r,a,o={};const s="categorical"!==n&&void 0===t.value.property,l=!s,c="array"===XF(t.value.stops)&&"array"===XF(t.value.stops[0])&&"object"===XF(t.value.stops[0][0]),u=lB({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new zz(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const i=t.value;return e=e.concat(cB({key:t.key,value:i,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===XF(i)&&0===i.length&&e.push(new zz(t.key,i,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&s&&u.push(new zz(t.key,t.value,'missing required property "property"')),"identity"!==n&&!t.value.stops&&u.push(new zz(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!ZF(t.valueSpec)&&u.push(new zz(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!WF(t.valueSpec)?u.push(new zz(t.key,t.value,"property functions not supported")):s&&!qF(t.valueSpec)&&u.push(new zz(t.key,t.value,"zoom functions not supported"))),("categorical"===n||c)&&void 0===t.value.property&&u.push(new zz(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const i=t.value,s=t.key;if("array"!==XF(i))return[new zz(s,i,"array expected, ".concat(XF(i)," found"))];if(2!==i.length)return[new zz(s,i,"array length 2 expected, length ".concat(i.length," found"))];if(c){if("object"!==XF(i[0]))return[new zz(s,i,"object expected, ".concat(XF(i[0])," found"))];if(void 0===i[0].zoom)return[new zz(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new zz(s,i,"object stop key must have value")];if(a&&a>oB(i[0].zoom))return[new zz(s,i[0].zoom,"stop zoom values must appear in ascending order")];oB(i[0].zoom)!==a&&(a=oB(i[0].zoom),r=void 0,o={}),n=n.concat(lB({key:"".concat(s,"[0]"),value:i[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:uB,value:d}}))}else n=n.concat(d({key:"".concat(s,"[0]"),value:i[0],validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},i));return JF(sB(i[1]))?n.concat([new zz("".concat(s,"[1]"),i[1],"expressions are not allowed in function stops.")]):n.concat(t.validateSpec({key:"".concat(s,"[1]"),value:i[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function d(t,a){const s=XF(t.value),l=oB(t.value),c=null!==t.value?t.value:a;if(i){if(s!==i)return[new zz(t.key,c,"".concat(s," stop domain type must match previous stop domain type ").concat(i))]}else i=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new zz(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==n){let i="number expected, ".concat(s," found");return WF(e)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new zz(t.key,c,i)]}return"categorical"!==n||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===s&&void 0!==r&&l<r?[new zz(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in o?[new zz(t.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new zz(t.key,c,"integer expected, found ".concat(l))]}}function dB(t){const e=("property"===t.expressionContext?eB:$F)(sB(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new zz("".concat(t.key).concat(e.key),t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new zz(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!jF(n))return[new zz(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!jF(n))return[new zz(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!VF(n,["zoom","feature-state"]))return[new zz(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!UF(n))return[new zz(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pB(t){const e=t.key,n=t.value,i=XF(n);return"string"!==i?[new zz(e,n,"color expected, ".concat(i," found"))]:kN.parse(String(n))?[]:[new zz(e,n,'color expected, "'.concat(n,'" found'))]}function fB(t){const e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(oB(n))&&r.push(new zz(e,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(oB(n))&&r.push(new zz(e,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),r}function mB(t){return rB(sB(t.value))?dB(Nz({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gB(t)}function gB(t){const e=t.value,n=t.key;if("array"!==XF(e))return[new zz(n,e,"array expected, ".concat(XF(e)," found"))];const i=t.styleSpec;let r,a=[];if(e.length<1)return[new zz(n,e,"filter array must have at least 1 element")];switch(a=a.concat(fB({key:"".concat(n,"[0]"),value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),oB(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===oB(e[1])&&a.push(new zz(n,e,'"$type" cannot be use with operator "'.concat(e[0],'"')));case"==":case"!=":3!==e.length&&a.push(new zz(n,e,'filter array for operator "'.concat(e[0],'" must have 3 elements')));case"in":case"!in":e.length>=2&&(r=XF(e[1]),"string"!==r&&a.push(new zz("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found"))));for(let o=2;o<e.length;o++)r=XF(e[o]),"$type"===oB(e[1])?a=a.concat(fB({key:"".concat(n,"[").concat(o,"]"),value:e[o],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&a.push(new zz("".concat(n,"[").concat(o,"]"),e[o],"string, number, or boolean expected, ".concat(r," found")));break;case"any":case"all":case"none":for(let i=1;i<e.length;i++)a=a.concat(gB({key:"".concat(n,"[").concat(i,"]"),value:e[i],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=XF(e[1]),2!==e.length?a.push(new zz(n,e,'filter array for "'.concat(e[0],'" operator must have 2 elements'))):"string"!==r&&a.push(new zz("".concat(n,"[1]"),e[1],"string expected, ".concat(r," found")))}return a}function yB(t,e){const n=t.key,i=t.validateSpec,r=t.style,a=t.styleSpec,o=t.value,s=t.objectKey,l=a["".concat(e,"_").concat(t.layerType)];if(!l)return[];const c=s.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return i({key:n,value:o,valueSpec:a.transition,style:r,styleSpec:a});const u=t.valueSpec||l[s];if(!u)return[new zz(n,o,'unknown property "'.concat(s,'"'))];let h;if("string"===XF(o)&&WF(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(o)))return[new zz(n,o,'"'.concat(s,'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": ').concat(JSON.stringify(h[1])," }`."))];const d=[];return"symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&d.push(new zz(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&YF(sB(o))&&"identity"===oB(o.type)&&d.push(new zz(n,o,'"text-font" does not support identity functions'))),d.concat(i({key:t.key,value:o,valueSpec:u,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:s}))}function vB(t){return yB(t,"paint")}function _B(t){return yB(t,"layout")}function xB(t){let e=[];const n=t.value,i=t.key,r=t.style,a=t.styleSpec;if("object"!==XF(n))return[new zz(i,n,"object expected, ".concat(XF(n)," found"))];!n.type&&!n.ref&&e.push(new zz(i,n,'either "type" or "ref" is required'));let o=oB(n.type);const s=oB(n.ref);if(n.id){const a=oB(n.id);for(let o=0;o<t.arrayIndex;o++){const t=r.layers[o];oB(t.id)===a&&e.push(new zz(i,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new zz(i,n[t],'"'.concat(t,'" is prohibited for ref layers')))}),r.layers.forEach(e=>{oB(e.id)===s&&(t=e)}),t?t.ref?e.push(new zz(i,n.ref,"ref cannot reference another ref layer")):o=oB(t.type):e.push(new zz(i,n.ref,'ref layer "'.concat(s,'" not found')))}else if("background"!==o)if(n.source){const t=r.sources&&r.sources[n.source],a=t&&oB(t.type);t?"vector"===a&&"raster"===o?e.push(new zz(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster-dem"!==a&&"hillshade"===o||"raster-dem"!==a&&"color-relief"===o?e.push(new zz(i,n.source,'layer "'.concat(n.id,'" requires a raster-dem source'))):"raster"===a&&"raster"!==o?e.push(new zz(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==o&&"color-relief"!==o?e.push(new zz(i,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"===o&&n.paint&&n.paint["line-gradient"]&&("geojson"!==a||!t.lineMetrics)&&e.push(new zz(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):e.push(new zz(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):e.push(new zz(i,n.source,'source "'.concat(n.source,'" not found')))}else e.push(new zz(i,n,'missing required property "source"'));return e=e.concat(lB({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:"".concat(i,".type"),value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:n,objectKey:"type"}),filter:mB,layout:t=>lB({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>_B(Nz({layerType:o},t))}}),paint:t=>lB({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>vB(Nz({layerType:o},t))}})}})),e}function bB(t){const e=t.value,n=t.key,i=XF(e);return"string"!==i?[new zz(n,e,"string expected, ".concat(i," found"))]:[]}const wB={promoteId:function(t){let{key:e,value:n}=t;if("string"===XF(n))return bB({key:e,value:n});{const t=[];for(const i in n)t.push(...bB({key:"".concat(e,".").concat(i),value:n[i]}));return t}}};function SB(t){const e=t.value,n=t.key,i=t.styleSpec,r=t.style,a=t.validateSpec;if(!e.type)return[new zz(n,e,'"type" is required')];const o=oB(e.type);let s;switch(o){case"vector":case"raster":return s=lB({key:n,value:e,valueSpec:i["source_".concat(o.replace("-","_"))],style:t.style,styleSpec:i,objectElementValidators:wB,validateSpec:a}),s;case"raster-dem":return s=function(t){var e;const n=null!==(e=t.sourceName)&&void 0!==e?e:"",i=t.value,r=t.styleSpec,a=r.source_raster_dem,o=t.style;let s=[];const l=XF(i);if(void 0===i)return s;if("object"!==l)return s.push(new zz("source_raster_dem",i,"object expected, ".concat(l," found"))),s;const c="custom"===oB(i.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?'"'.concat(t.value.encoding,'"'):"Default";for(const d in i)!c&&u.includes(d)?s.push(new zz(d,i[d],'In "'.concat(n,'": "').concat(d,'" is only valid when "encoding" is set to "custom". ').concat(h," encoding found"))):a[d]?s=s.concat(t.validateSpec({key:d,value:i[d],valueSpec:a[d],validateSpec:t.validateSpec,style:o,styleSpec:r})):s.push(new zz(d,i[d],'unknown property "'.concat(d,'"')));return s}({sourceName:n,value:e,style:t.style,styleSpec:i,validateSpec:a}),s;case"geojson":if(s=lB({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,validateSpec:a,objectElementValidators:wB}),e.cluster)for(const t in e.clusterProperties){const[i,r]=e.clusterProperties[t],a="string"==typeof i?[i,["accumulated"],["get",t]]:i;s.push(...dB({key:"".concat(n,".").concat(t,".map"),value:r,expressionContext:"cluster-map"})),s.push(...dB({key:"".concat(n,".").concat(t,".reduce"),value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return lB({key:n,value:e,valueSpec:i.source_video,style:r,validateSpec:a,styleSpec:i});case"image":return lB({key:n,value:e,valueSpec:i.source_image,style:r,validateSpec:a,styleSpec:i});case"canvas":return[new zz(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fB({key:"".concat(n,".type"),value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function MB(t){const e=t.value,n=t.styleSpec,i=n.light,r=t.style;let a=[];const o=XF(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new zz("light",e,"object expected, ".concat(o," found"))]),a;for(const s in e){const o=s.match(/^(.*)-transition$/);a=o&&i[o[1]]&&i[o[1]].transition?a.concat(t.validateSpec({key:s,value:e[s],valueSpec:n.transition,validateSpec:t.validateSpec,style:r,styleSpec:n})):i[s]?a.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n})):a.concat([new zz(s,e[s],'unknown property "'.concat(s,'"'))])}return a}function TB(t){const e=t.value,n=t.styleSpec,i=n.sky,r=t.style,a=XF(e);if(void 0===e)return[];if("object"!==a)return[new zz("sky",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=i[s]?o.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):o.concat([new zz(s,e[s],'unknown property "'.concat(s,'"'))]);return o}function EB(t){const e=t.value,n=t.styleSpec,i=n.terrain,r=t.style;let a=[];const o=XF(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new zz("terrain",e,"object expected, ".concat(o," found"))]),a;for(const s in e)a=i[s]?a.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],validateSpec:t.validateSpec,style:r,styleSpec:n})):a.concat([new zz(s,e[s],'unknown property "'.concat(s,'"'))]);return a}function AB(t){let e=[];const n=t.value,i=t.key;if(Array.isArray(n)){const r=[],a=[];for(const o in n){n[o].id&&r.includes(n[o].id)&&e.push(new zz(i,n,"all the sprites' ids must be unique, but ".concat(n[o].id," is duplicated"))),r.push(n[o].id),n[o].url&&a.includes(n[o].url)&&e.push(new zz(i,n,"all the sprites' URLs must be unique, but ".concat(n[o].url," is duplicated"))),a.push(n[o].url);const s={id:{type:"string",required:!0},url:{type:"string",required:!0}};e=e.concat(lB({key:"".concat(i,"[").concat(o,"]"),value:n[o],valueSpec:s,validateSpec:t.validateSpec}))}return e}return bB({key:i,value:n})}function CB(t){return function(t){return!!t&&t.constructor===Object}(t.value)?[]:[new zz(t.key,t.value,"object expected, ".concat(XF(t.value)," found"))]}const PB={"*":()=>[],array:cB,boolean:function(t){const e=t.value,n=t.key,i=XF(e);return"boolean"!==i?[new zz(n,e,"boolean expected, ".concat(i," found"))]:[]},number:uB,color:pB,constants:aB,enum:fB,filter:mB,function:hB,layer:xB,object:lB,source:SB,light:MB,sky:TB,terrain:EB,projection:function(t){const e=t.value,n=t.styleSpec,i=n.projection,r=t.style,a=XF(e);if(void 0===e)return[];if("object"!==a)return[new zz("projection",e,"object expected, ".concat(a," found"))];let o=[];for(const s in e)o=i[s]?o.concat(t.validateSpec({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):o.concat([new zz(s,e[s],'unknown property "'.concat(s,'"'))]);return o},projectionDefinition:function(t){const e=t.key;let n=t.value;n=n instanceof String?n.valueOf():n;const i=XF(n);return"array"!==i||function(t){return Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]}(n)||function(t){return!!["interpolate","step","literal"].includes(t[0])}(n)?["array","string"].includes(i)?[]:[new zz(e,n,'projection expected, invalid type "'.concat(i,'" found'))]:[new zz(e,n,"projection expected, invalid array ".concat(JSON.stringify(n)," found"))]},string:bB,formatted:function(t){return 0===bB(t).length?[]:dB(t)},resolvedImage:function(t){return 0===bB(t).length?[]:dB(t)},padding:function(t){const e=t.key,n=t.value;if("array"===XF(n)){if(n.length<1||n.length>4)return[new zz(e,n,"padding requires 1 to 4 values; ".concat(n.length," values found"))];const i={type:"number"};let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return uB({key:e,value:n,valueSpec:{}})},numberArray:function(t){const e=t.key,n=t.value;if("array"===XF(n)){const i={type:"number"};if(n.length<1)return[new zz(e,n,"array length at least 1 expected, length 0 found")];let r=[];for(let a=0;a<n.length;a++)r=r.concat(t.validateSpec({key:"".concat(e,"[").concat(a,"]"),value:n[a],validateSpec:t.validateSpec,valueSpec:i}));return r}return uB({key:e,value:n,valueSpec:{}})},colorArray:function(t){const e=t.key,n=t.value;if("array"===XF(n)){if(n.length<1)return[new zz(e,n,"array length at least 1 expected, length 0 found")];let t=[];for(let i=0;i<n.length;i++)t=t.concat(pB({key:"".concat(e,"[").concat(i,"]"),value:n[i]}));return t}return pB({key:e,value:n})},variableAnchorOffsetCollection:function(t){const e=t.key,n=t.value,i=XF(n),r=t.styleSpec;if("array"!==i||n.length<1||n.length%2!==0)return[new zz(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let a=[];for(let o=0;o<n.length;o+=2)a=a.concat(fB({key:"".concat(e,"[").concat(o,"]"),value:n[o],valueSpec:r.layout_symbol["text-anchor"]})),a=a.concat(cB({key:"".concat(e,"[").concat(o+1,"]"),value:n[o+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:r}));return a},sprite:AB,state:CB};function IB(t){const e=t.value,n=t.valueSpec,i=t.styleSpec;return t.validateSpec=IB,n.expression&&YF(oB(e))?hB(t):n.expression&&JF(sB(e))?dB(t):n.type&&PB[n.type]?PB[n.type](t):lB(Nz({},t,{valueSpec:n.type?i[n.type]:n}))}function RB(t){const e=t.value,n=t.key,i=bB(t);return i.length||(-1===e.indexOf("{fontstack}")&&i.push(new zz(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new zz(n,e,'"glyphs" url must include a "{range}" token'))),i}function kB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dz,n=[];return n=n.concat(IB({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:IB,objectElementValidators:{glyphs:RB,"*":()=>[]}})),t.constants&&(n=n.concat(aB({key:"constants",value:t.constants}))),DB(n)}function LB(t){return function(e){return t(Dt(Dt({},e),{},{validateSpec:IB}))}}function DB(t){return[].concat(t).sort((t,e)=>t.line-e.line)}function zB(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return DB(t.apply(this,n))}}function NB(t){if(!t)return{style:ED[MD[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if("string"==typeof t){const e=function(t){try{const e=JSON.parse(t),n=kB(e);return{isValidJSON:!0,isValidStyle:0===n.length,styleObject:0===n.length?e:null}}catch(e){return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}(t);return e.isValidStyle?{style:e.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:e.isValidJSON?{style:ED[MD[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:t.startsWith("http")?{style:t,requiresUrlMonitoring:!0,isFallback:!1}:t.toLowerCase().includes(".json")?{style:OB(t),requiresUrlMonitoring:!0,isFallback:!1}:{style:bD(t),requiresUrlMonitoring:!0,isFallback:!1}}return t instanceof wD?{style:t.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:t instanceof SD?{style:t.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:0===kB(t).length?{style:t,requiresUrlMonitoring:!1,isFallback:!1}:{style:ED[MD[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function OB(t){try{return new URL(t).href}catch(e){}return new URL(t,location.origin).href}function FB(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i}function BB(t){t.parentNode&&t.parentNode.removeChild(t)}kB.source=zB(LB(SB)),kB.sprite=zB(LB(AB)),kB.glyphs=zB(LB(RB)),kB.light=zB(LB(MB)),kB.sky=zB(LB(TB)),kB.terrain=zB(LB(EB)),kB.state=zB(LB(CB)),kB.layer=zB(LB(xB)),kB.filter=zB(LB(mB)),kB.paintProperty=zB(LB(vB)),kB.layoutProperty=zB(LB(_B));class UB{constructor(){KD(this,"_map"),KD(this,"_container"),KD(this,"_terrainButton"),function(t,e){for(const n of t)"function"==typeof e[n]&&(e[n]=e[n].bind(e))}(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(t){return this._map=t,this._container=FB("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=FB("button","maplibregl-ctrl-terrain",this._container),FB("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){BB(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){jB(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function jB(t){t.hasTerrain()?t.disableTerrain():t.enableTerrain()}class VB extends Cz{constructor(){var t,e,n;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({showCompass:null===(t=i.showCompass)||void 0===t||t,showZoom:null===(e=i.showZoom)||void 0===e||e,visualizePitch:null===(n=i.visualizePitch)||void 0===n||n}),KD(this,"_rotateCompassArrow",()=>{const t=this._map.getBearing(),e=this._map.getPitch(),n=this.options.visualizePitch?"scale(".concat(Math.min(1.5,1/Math.cos(e*(Math.PI/180))**.5),") rotateX(").concat(Math.min(70,e),"deg) rotateZ(").concat(-t,"deg)"):"rotate(".concat(-t,"deg)");this._compassIcon.style.transform=n}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",t=>{0===this._map.getPitch()?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}))}_createButton(t,e){const n=super._createButton(t,e);return n.clickFunction=e,n}}const HB=cD.Marker,GB=cD.LngLat,WB=cD.LngLatBounds;class qB extends Pz{constructor(){super(...arguments),KD(this,"lastUpdatedCenter",new GB(0,0)),KD(this,"_updateCamera",t=>{var e,n;const i=new GB(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,a=Dt(Dt({bearing:this._map.getBearing()},this.options.fitBoundsOptions),{},{linear:!0}),o=this._map.getZoom();o>(null!==(e=null==(n=this.options.fitBoundsOptions)?void 0:n.maxZoom)&&void 0!==e?e:30)&&(a.zoom=o),this._map.fitBounds(WB.fromLngLat(i,r),a,{geolocateSource:!0});let s=!1;const l=()=>{s=!0};this._map.once("click",l),this._map.once("dblclick",l),this._map.once("dragstart",l),this._map.once("mousedown",l),this._map.once("touchstart",l),this._map.once("wheel",l),this._map.once("moveend",()=>{this._map.off("click",l),this._map.off("dblclick",l),this._map.off("dragstart",l),this._map.off("mousedown",l),this._map.off("touchstart",l),this._map.off("wheel",l),!s&&(this.lastUpdatedCenter=this._map.getCenter())})}),KD(this,"_finishSetupUI",t=>{if(this._map){if(!1===t){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=FB("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new HB({element:this._dotElement}),this._circleElement=FB("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new HB({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const e=t.originalEvent&&"resize"===t.originalEvent.type,n=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&"ACTIVE_LOCK"===this._watchState&&!e&&n>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),KD(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if("BACKGROUND"!==this._watchState&&"ACTIVE_LOCK"!==this._watchState)return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],e=this._map.project(t),n=this._map.unproject([e.x,e.y]),i=this._map.unproject([e.x+20,e.y]),r=n.distanceTo(i)/20,a=Math.ceil(2*this._accuracy/r);this._circleElement.style.width="".concat(a,"px"),this._circleElement.style.height="".concat(a,"px")}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":break;default:throw new Error("Unexpected watchState ".concat(this._watchState))}}}var ZB,XB,YB,KB,JB;class $B{constructor(t,e,n){if(QD(this,ZB),QD(this,XB),QD(this,YB),QD(this,KB),QD(this,JB),"string"==typeof t){const e=document.querySelector(t);if(!e)throw new Error('No element has been found with selector "'.concat(t,'" when creating an external control.'));tz(this,XB,e)}else tz(this,XB,t);e&&tz(this,YB,t=>{e($D(this,ZB),$D(this,XB),t)}),n&&tz(this,KB,t=>{n($D(this,ZB),$D(this,XB),t)}),tz(this,JB,$D(this,XB).parentElement)}onAdd(t){return tz(this,ZB,t),$D(this,YB)&&$D(this,XB).addEventListener("click",$D(this,YB)),$D(this,KB)&&$D(this,ZB).on("render",$D(this,KB)),BB($D(this,XB)),$D(this,XB)}onRemove(){$D(this,YB)&&$D(this,XB).removeEventListener("click",$D(this,YB)),$D(this,KB)&&$D(this,ZB).off("render",$D(this,KB)),$D(this,JB)?$D(this,JB).appendChild($D(this,XB)):BB($D(this,XB))}}ZB=new WeakMap,XB=new WeakMap,YB=new WeakMap,KB=new WeakMap,JB=new WeakMap;class QB{constructor(){KD(this,"map"),KD(this,"container"),KD(this,"projectionButton")}onAdd(t){return this.map=t,this.container=FB("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=FB("button","maplibregl-ctrl-projection",this.container),FB("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),t.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){BB(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){tU(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function tU(t){void 0===t.getProjection()&&t.setProjection({type:"mercator"}),t.isGlobeProjection()?t.enableMercatorProjection():t.enableGlobeProjection()}const eU={"zoom-in":t=>t.zoomIn(),"zoom-out":t=>t.zoomOut(),"toggle-projection":tU,"toggle-terrain":jB,"reset-view":t=>{0===t.getPitch()?t.easeTo({pitch:Math.min(t.getMaxPitch(),80)}):t.resetNorthPitch()},"reset-bearing":t=>{t.rotateTo(0)},"reset-pitch":t=>{t.setPitch(0)},"reset-roll":t=>{t.setRoll(0)}};var nU,iU,rU,aU,oU,sU,lU,cU,uU,hU,dU,pU;class fU extends $B{constructor(t,e){if(e&&!(e in eU))throw new Error('data-maptiler-control value "'.concat(e,'" is invalid.'));super(t,e&&eU[e]),QD(this,nU),QD(this,iU,new Map)}onAdd(t){return tz(this,nU,t),super.onAdd(t)}onRemove(){for(const[t,e]of $D(this,iU)){const n=t.deref();n&&n.removeEventListener("click",e)}$D(this,iU).clear(),super.onRemove()}configureGroupItem(t,e){if(!e)return;if(!(e in eU))throw new Error('data-maptiler-control value "'.concat(e,'" is invalid.'));const n=n=>{eU[e]($D(this,nU),t,n)};t.addEventListener("click",n),$D(this,iU).set(new WeakRef(t),n)}}nU=new WeakMap,iU=new WeakMap,KD(fU,"controlCallbacks",eU);class mU{constructor(t,e){var n;QD(this,uU),QD(this,rU),KD(this,"map"),QD(this,aU),QD(this,oU),QD(this,sU),QD(this,lU,!1),QD(this,cU),void 0!==t.style&&tz(this,lU,!0),tz(this,rU,Dt(Dt(Dt({zoomAdjust:-4,position:"top-right"},e),{},{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1},t),{},{containerStyle:Dt({border:"1px solid #000",width:"400px",height:"300px"},null!==(n=t.containerStyle)&&void 0!==n?n:{})})),void 0!==t.lockZoom&&($D(this,rU).minZoom=t.lockZoom,$D(this,rU).maxZoom=t.lockZoom)}setStyle(t,e){$D(this,lU)||this.map.setStyle(t,e),ez(this,uU,dU).call(this)}addLayer(t,e){return $D(this,lU)||this.map.addLayer(t,e),ez(this,uU,dU).call(this),this.map}moveLayer(t,e){return $D(this,lU)||this.map.moveLayer(t,e),ez(this,uU,dU).call(this),this.map}removeLayer(t){return $D(this,lU)||this.map.removeLayer(t),ez(this,uU,dU).call(this),this}setLayerZoomRange(t,e,n){return $D(this,lU)||this.map.setLayerZoomRange(t,e,n),ez(this,uU,dU).call(this),this}setFilter(t,e,n){return $D(this,lU)||this.map.setFilter(t,e,n),ez(this,uU,dU).call(this),this}setPaintProperty(t,e,n,i){return $D(this,lU)||this.map.setPaintProperty(t,e,n,i),ez(this,uU,dU).call(this),this}setLayoutProperty(t,e,n,i){return $D(this,lU)||this.map.setLayoutProperty(t,e,n,i),ez(this,uU,dU).call(this),this}setGlyphs(t,e){return $D(this,lU)||this.map.setGlyphs(t,e),ez(this,uU,dU).call(this),this}onAdd(t){tz(this,aU,t),tz(this,oU,FB("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[e,n]of Object.entries($D(this,rU).containerStyle))$D(this,oU).style.setProperty(e,n);return $D(this,rU).container=$D(this,oU),$D(this,rU).zoom=t.getZoom()+$D(this,rU).zoomAdjust,this.map=new mj($D(this,rU)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{ez(this,uU,hU).call(this,$D(this,rU).parentRect),tz(this,cU,ez(this,uU,pU).call(this))}),$D(this,oU)}onRemove(){var t;null==(t=$D(this,cU))||t.call(this),BB($D(this,oU))}}rU=new WeakMap,aU=new WeakMap,oU=new WeakMap,sU=new WeakMap,lU=new WeakMap,cU=new WeakMap,uU=new WeakSet,hU=function(t){void 0===t||void 0===t.linePaint&&void 0===t.fillPaint||(tz(this,sU,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:$D(this,sU)}),(void 0!==t.lineLayout||void 0!==t.linePaint)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:Dt({},t.lineLayout),paint:Dt({"line-color":"#FFF","line-width":1,"line-opacity":.85},t.linePaint)}),void 0!==t.fillPaint&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:Dt({"fill-color":"#08F","fill-opacity":.135},t.fillPaint)}),ez(this,uU,dU).call(this))},dU=function(){if(void 0===$D(this,sU))return;const{devicePixelRatio:t}=window,e=$D(this,aU).getCanvas(),n=e.width/t,i=e.height/t,r=$D(this,aU).unproject.bind($D(this,aU)),a=r([0,0]),o=r([n,0]),s=r([0,i]),l=r([n,i]);$D(this,sU).geometry.coordinates=[[s.toArray(),l.toArray(),o.toArray(),a.toArray(),s.toArray()]];const c=this.map.getSource("parentRect");void 0!==c&&c.setData($D(this,sU))},pU=function(){const{pitchAdjust:t}=$D(this,rU),e=()=>{a("parent")},n=()=>{a("minimap")},i=()=>{$D(this,aU).on("move",e),this.map.on("move",n)},r=()=>{$D(this,aU).off("move",e),this.map.off("move",n)},a=e=>{r();const n="parent"===e?$D(this,aU):this.map,a="parent"===e?this.map:$D(this,aU),o=n.getCenter(),s=n.getZoom()+$D(this,rU).zoomAdjust*("parent"===e?1:-1),l=n.getBearing(),c=n.getPitch();a.jumpTo({center:o,zoom:s,bearing:l,pitch:t?c:0}),ez(this,uU,dU).call(this),i()};return i(),()=>{r()}};class gU{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;KD(this,"map"),KD(this,"registeredModules",new Set),KD(this,"viewerType"),this.map=t,this.viewerType="Map",setTimeout(async()=>{if(!oz.telemetry)return;const t=this.preparePayload();try{(await fetch(t,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(e){console.warn("The metrics could not be sent to MapTiler Cloud",e)}},Math.max(1e3,e))}registerModule(t,e){this.registeredModules.add("".concat(t,":").concat(e))}registerViewerType(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Map";this.viewerType=t}preparePayload(){const t=new URL(rz.telemetryURL);return t.searchParams.append("sdk","3.8.0"),t.searchParams.append("key",oz.apiKey),t.searchParams.append("mtsid",az),t.searchParams.append("session",oz.session?"1":"0"),t.searchParams.append("caching",oz.caching?"1":"0"),t.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),t.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),t.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),t.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&t.searchParams.append("modules",Array.from(this.registeredModules).join("|")),t.href}}var yU=typeof Float32Array<"u"?Float32Array:Array;function vU(){var t=new yU(16);return yU!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _U(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+c*i,t[5]=o*r+u*i,t[6]=s*r+h*i,t[7]=l*r+d*i,t[8]=c*r-a*i,t[9]=u*r-o*i,t[10]=h*r-s*i,t[11]=d*r-l*i,t}function xU(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+c*i,t[1]=o*r+u*i,t[2]=s*r+h*i,t[3]=l*r+d*i,t[4]=c*r-a*i,t[5]=u*r-o*i,t[6]=h*r-s*i,t[7]=d*r-l*i,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var bU,wU,SU,MU,TU,EU,AU,CU,PU=function(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(a=1/(i-r),t[10]=(r+i)*a,t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t};function IU(){var t=new yU(3);return yU!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function RU(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function kU(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2];return t[0]=r*l-a*s,t[1]=a*o-i*l,t[2]=i*s-r*o,t}function LU(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function DU(){if(MU)return SU;MU=1;const t=(wU||(wU=1,bU={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),bU),e={};for(const r of Object.keys(t))e[t[r]]=r;const n={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};SU=n;for(const r of Object.keys(n)){if(!("channels"in n[r]))throw new Error("missing channels property: "+r);if(!("labels"in n[r]))throw new Error("missing channel labels property: "+r);if(n[r].labels.length!==n[r].channels)throw new Error("channel and label counts mismatch: "+r);const{channels:t,labels:e}=n[r];delete n[r].channels,delete n[r].labels,Object.defineProperty(n[r],"channels",{value:t}),Object.defineProperty(n[r],"labels",{value:e})}function i(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2}return n.rgb.hsl=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=a-r;let s,l;a===r?s=0:e===a?s=(n-i)/o:n===a?s=2+(i-e)/o:i===a&&(s=4+(e-n)/o),s=Math.min(60*s,360),s<0&&(s+=360);const c=(r+a)/2;return l=a===r?0:c<=.5?o/(a+r):o/(2-a-r),[s,100*l,100*c]},n.rgb.hsv=function(t){let e,n,i,r,a;const o=t[0]/255,s=t[1]/255,l=t[2]/255,c=Math.max(o,s,l),u=c-Math.min(o,s,l),h=function(t){return(c-t)/6/u+.5};return 0===u?(r=0,a=0):(a=u/c,e=h(o),n=h(s),i=h(l),o===c?r=i-n:s===c?r=1/3+e-i:l===c&&(r=2/3+n-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*a,100*c]},n.rgb.hwb=function(t){const e=t[0],i=t[1];let r=t[2];const a=n.rgb.hsl(t)[0],o=1/255*Math.min(e,Math.min(i,r));return r=1-1/255*Math.max(e,Math.max(i,r)),[a,100*o,100*r]},n.rgb.cmyk=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.min(1-e,1-n,1-i);return[100*((1-e-r)/(1-r)||0),100*((1-n-r)/(1-r)||0),100*((1-i-r)/(1-r)||0),100*r]},n.rgb.keyword=function(n){const r=e[n];if(r)return r;let a,o=1/0;for(const e of Object.keys(t)){const r=i(n,t[e]);r<o&&(o=r,a=e)}return a},n.keyword.rgb=function(e){return t[e]},n.rgb.xyz=function(t){let e=t[0]/255,n=t[1]/255,i=t[2]/255;e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,i=i>.04045?((i+.055)/1.055)**2.4:i/12.92;return[100*(.4124*e+.3576*n+.1805*i),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},n.rgb.lab=function(t){const e=n.rgb.xyz(t);let i=e[0],r=e[1],a=e[2];i/=95.047,r/=100,a/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;return[116*r-16,500*(i-r),200*(r-a)]},n.hsl.rgb=function(t){const e=t[0]/360,n=t[1]/100,i=t[2]/100;let r,a,o;if(0===n)return o=255*i,[o,o,o];r=i<.5?i*(1+n):i+n-i*n;const s=2*i-r,l=[0,0,0];for(let c=0;c<3;c++)a=e+1/3*-(c-1),a<0&&a++,a>1&&a--,o=6*a<1?s+6*(r-s)*a:2*a<1?r:3*a<2?s+(r-s)*(2/3-a)*6:s,l[c]=255*o;return l},n.hsl.hsv=function(t){const e=t[0];let n=t[1]/100,i=t[2]/100,r=n;const a=Math.max(i,.01);i*=2,n*=i<=1?i:2-i,r*=a<=1?a:2-a;return[e,100*(0===i?2*r/(a+r):2*n/(i+n)),100*((i+n)/2)]},n.hsv.rgb=function(t){const e=t[0]/60,n=t[1]/100;let i=t[2]/100;const r=Math.floor(e)%6,a=e-Math.floor(e),o=255*i*(1-n),s=255*i*(1-n*a),l=255*i*(1-n*(1-a));switch(i*=255,r){case 0:return[i,l,o];case 1:return[s,i,o];case 2:return[o,i,l];case 3:return[o,s,i];case 4:return[l,o,i];case 5:return[i,o,s]}},n.hsv.hsl=function(t){const e=t[0],n=t[1]/100,i=t[2]/100,r=Math.max(i,.01);let a,o;o=(2-n)*i;const s=(2-n)*r;return a=n*r,a/=s<=1?s:2-s,a=a||0,o/=2,[e,100*a,100*o]},n.hwb.rgb=function(t){const e=t[0]/360;let n=t[1]/100,i=t[2]/100;const r=n+i;let a;r>1&&(n/=r,i/=r);const o=Math.floor(6*e),s=1-i;a=6*e-o,1&o&&(a=1-a);const l=n+a*(s-n);let c,u,h;switch(o){default:case 6:case 0:c=s,u=l,h=n;break;case 1:c=l,u=s,h=n;break;case 2:c=n,u=s,h=l;break;case 3:c=n,u=l,h=s;break;case 4:c=l,u=n,h=s;break;case 5:c=s,u=n,h=l}return[255*c,255*u,255*h]},n.cmyk.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100,r=t[3]/100;return[255*(1-Math.min(1,e*(1-r)+r)),255*(1-Math.min(1,n*(1-r)+r)),255*(1-Math.min(1,i*(1-r)+r))]},n.xyz.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100;let r,a,o;return r=3.2406*e+-1.5372*n+-.4986*i,a=-.9689*e+1.8758*n+.0415*i,o=.0557*e+-.204*n+1.057*i,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,r=Math.min(Math.max(0,r),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[255*r,255*a,255*o]},n.xyz.lab=function(t){let e=t[0],n=t[1],i=t[2];e/=95.047,n/=100,i/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*n-16,500*(e-n),200*(n-i)]},n.lab.xyz=function(t){let e,n,i;n=(t[0]+16)/116,e=t[1]/500+n,i=n-t[2]/200;const r=n**3,a=e**3,o=i**3;return n=r>.008856?r:(n-16/116)/7.787,e=a>.008856?a:(e-16/116)/7.787,i=o>.008856?o:(i-16/116)/7.787,e*=95.047,n*=100,i*=108.883,[e,n,i]},n.lab.lch=function(t){const e=t[0],n=t[1],i=t[2];let r;r=360*Math.atan2(i,n)/2/Math.PI,r<0&&(r+=360);return[e,Math.sqrt(n*n+i*i),r]},n.lch.lab=function(t){const e=t[0],n=t[1],i=t[2]/360*2*Math.PI;return[e,n*Math.cos(i),n*Math.sin(i)]},n.rgb.ansi16=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[i,r,a]=t;let o=null===e?n.rgb.hsv(t)[2]:e;if(o=Math.round(o/50),0===o)return 30;let s=30+(Math.round(a/255)<<2|Math.round(r/255)<<1|Math.round(i/255));return 2===o&&(s+=60),s},n.hsv.ansi16=function(t){return n.rgb.ansi16(n.hsv.rgb(t),t[2])},n.rgb.ansi256=function(t){const e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},n.ansi16.rgb=function(t){let e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},n.ansi256.rgb=function(t){if(t>=232){const e=10*(t-232)+8;return[e,e,e]}let e;t-=16;return[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},n.rgb.hex=function(t){const e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},n.hex.rgb=function(t){const e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];let n=e[0];3===e[0].length&&(n=n.split("").map(t=>t+t).join(""));const i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},n.rgb.hcg=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.max(Math.max(e,n),i),a=Math.min(Math.min(e,n),i),o=r-a;let s,l;return s=o<1?a/(1-o):0,l=o<=0?0:r===e?(n-i)/o%6:r===n?2+(i-e)/o:4+(e-n)/o,l/=6,l%=1,[360*l,100*o,100*s]},n.hsl.hcg=function(t){const e=t[1]/100,n=t[2]/100,i=n<.5?2*e*n:2*e*(1-n);let r=0;return i<1&&(r=(n-.5*i)/(1-i)),[t[0],100*i,100*r]},n.hsv.hcg=function(t){const e=t[1]/100,n=t[2]/100,i=e*n;let r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],100*i,100*r]},n.hcg.rgb=function(t){const e=t[0]/360,n=t[1]/100,i=t[2]/100;if(0===n)return[255*i,255*i,255*i];const r=[0,0,0],a=e%1*6,o=a%1,s=1-o;let l=0;switch(Math.floor(a)){case 0:r[0]=1,r[1]=o,r[2]=0;break;case 1:r[0]=s,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=o;break;case 3:r[0]=0,r[1]=s,r[2]=1;break;case 4:r[0]=o,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=s}return l=(1-n)*i,[255*(n*r[0]+l),255*(n*r[1]+l),255*(n*r[2]+l)]},n.hcg.hsv=function(t){const e=t[1]/100,n=e+t[2]/100*(1-e);let i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},n.hcg.hsl=function(t){const e=t[1]/100,n=t[2]/100*(1-e)+.5*e;let i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},n.hcg.hwb=function(t){const e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},n.hwb.hcg=function(t){const e=t[1]/100,n=1-t[2]/100,i=n-e;let r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],100*i,100*r]},n.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},n.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},n.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},n.gray.hsl=function(t){return[0,0,t[0]]},n.gray.hsv=n.gray.hsl,n.gray.hwb=function(t){return[0,100,t[0]]},n.gray.cmyk=function(t){return[0,0,0,t[0]]},n.gray.lab=function(t){return[t[0],0,0]},n.gray.hex=function(t){const e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},n.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]},SU}function zU(){if(EU)return TU;EU=1;const t=DU();function e(e){const n=function(){const e={},n=Object.keys(t);for(let t=n.length,i=0;i<t;i++)e[n[i]]={distance:-1,parent:null};return e}(),i=[e];for(n[e].distance=0;i.length;){const e=i.pop(),r=Object.keys(t[e]);for(let t=r.length,a=0;a<t;a++){const t=r[a],o=n[t];-1===o.distance&&(o.distance=n[e].distance+1,o.parent=e,i.unshift(t))}}return n}function n(t,e){return function(n){return e(t(n))}}function i(e,i){const r=[i[e].parent,e];let a=t[i[e].parent][e],o=i[e].parent;for(;i[o].parent;)r.unshift(i[o].parent),a=n(t[i[o].parent][o],a),o=i[o].parent;return a.conversion=r,a}return TU=function(t){const n=e(t),r={},a=Object.keys(n);for(let e=a.length,o=0;o<e;o++){const t=a[o];null!==n[t].parent&&(r[t]=i(t,n))}return r},TU}!function(){var t=IU()}();var NU=function(){if(CU)return AU;CU=1;const t=DU(),e=zU(),n={};return Object.keys(t).forEach(i=>{n[i]={},Object.defineProperty(n[i],"channels",{value:t[i].channels}),Object.defineProperty(n[i],"labels",{value:t[i].labels});const r=e(i);Object.keys(r).forEach(t=>{const e=r[t];n[i][t]=function(t){const e=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=n[0];if(null==r)return r;r.length>1&&(n=r);const a=t(n);if("object"==typeof a)for(let t=a.length,o=0;o<t;o++)a[o]=Math.round(a[o]);return a};return"conversion"in t&&(e.conversion=t.conversion),e}(e),n[i][t].raw=function(t){const e=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=n[0];return null==r?r:(r.length>1&&(n=r),t(n))};return"conversion"in t&&(e.conversion=t.conversion),e}(e)})}),AU=n}();const OU=LU(NU);function FU(t){let{gl:e,type:n,source:i}=t;const r=e.createShader(n);if(null===r)throw new Error("Cannot create shader");if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw console.error("Shader compilation error:",e.getShaderInfoLog(r)),e.deleteShader(r),new Error("Cannot compile shader");return r}function BU(t){let{gl:e,vertexShaderSource:n,fragmentShaderSource:i,attributesKeys:r,uniformsKeys:a,vertices:o,indices:s}=t;const l=function(t){let{gl:e,vertexShaderSource:n,fragmentShaderSource:i}=t;const r=FU({gl:e,type:e.VERTEX_SHADER,source:n}),a=FU({gl:e,type:e.FRAGMENT_SHADER,source:i}),o=e.createProgram();if(e.attachShader(o,r),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw console.error("Error: ",e.getProgramInfoLog(o)),new Error("Cannot link shader program");return o}({gl:e,vertexShaderSource:n,fragmentShaderSource:i}),c=r.reduce((t,n)=>(t[n]=e.getAttribLocation(l,"a_".concat(n)),t),{}),u=a.reduce((t,n)=>(t[n]=function(t,e,n){const i=t.getUniformLocation(e,n);if(null===i)throw new Error("Cannot get uniform location for ".concat(n));return i}(e,l,"u_".concat(n)),t),{}),h=e.createBuffer();let d,p;return e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o),e.STATIC_DRAW),void 0!==s&&(d=e.createBuffer(),p=s.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),e.STATIC_DRAW)),{shaderProgram:l,programInfo:{attributesLocations:c,uniformsLocations:u},positionBuffer:h,indexBuffer:d,indexBufferLength:p}}function UU(t){if(!t)return[1,1,1,0];if("transparent"===t)return[1,1,1,0];try{var e;const n=function(t){return jU=null!==jU&&void 0!==jU?jU:document.createElement("canvas").getContext("2d"),jU?(jU.fillStyle=t,jU.fillStyle):"#000000"}(t),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(n);if(null!=i&&i.length){const t=!!i[4];return[...OU.hex.rgb(n).map(t=>t/255),t?parseInt(i[4],16)/255:1]}const r=null!==(e=n.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi))&&void 0!==e?e:["0","0","0"];if(n.includes("rgb")){const t=n.includes("rgba"),e=[...r.map(t=>parseFloat(t)).map((t,e)=>e<3?t/255:t)];return t||e.push(1),e}}catch(n){}return console.warn(["[parseColorStringToVec4]: Color ".concat(t," is either not a valid color or its type is not supported, defaulting to black")]),[0,0,0,1]}let jU;const VU=.5,HU=.5,GU=.5,WU=[...[-.5,-.5,GU,VU,-.5,GU,VU,HU,GU,-.5,HU,GU],...[-.5,-.5,-.5,-.5,HU,-.5,VU,HU,-.5,VU,-.5,-.5],...[-.5,HU,-.5,-.5,HU,GU,VU,HU,GU,VU,HU,-.5],...[-.5,-.5,-.5,VU,-.5,-.5,VU,-.5,GU,-.5,-.5,GU],...[VU,-.5,-.5,VU,HU,-.5,VU,HU,GU,VU,-.5,GU],...[-.5,-.5,-.5,-.5,-.5,GU,-.5,HU,GU,-.5,HU,-.5]],qU=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],ZU="precision mediump float;\n\nvarying vec3 vTextureCoord;\n\n%USE_TEXTURE_MACRO_MARKER%\n\n# ifdef USE_TEXTURE\nuniform samplerCube u_cubeSampler;\nuniform float u_fadeOpacity;\n# endif\n\nuniform vec4 u_bgColor;\n\nvoid main(void) {\n  #ifdef USE_TEXTURE\n  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);\n\n    gl_FragColor = mix(\n      u_bgColor,\n      texColor,\n      min(texColor.a, u_fadeOpacity)\n    );\n\n    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);\n\n  #else\n  gl_FragColor = u_bgColor;\n  #endif\n}\n";const XU={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var YU=(t=>(t.POSITIVE_X="pX",t.NEGATIVE_X="nX",t.POSITIVE_Y="pY",t.NEGATIVE_Y="nY",t.POSITIVE_Z="pZ",t.NEGATIVE_Z="nZ",t))(YU||{});let KU,JU,$U;function QU(t,e){if(e===YU.POSITIVE_X)return t.TEXTURE_CUBE_MAP_POSITIVE_X;if(e===YU.NEGATIVE_X)return t.TEXTURE_CUBE_MAP_NEGATIVE_X;if(e===YU.POSITIVE_Y)return t.TEXTURE_CUBE_MAP_POSITIVE_Y;if(e===YU.NEGATIVE_Y)return t.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(e===YU.POSITIVE_Z)return t.TEXTURE_CUBE_MAP_POSITIVE_Z;if(e===YU.NEGATIVE_Z)return t.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error("[CubemapLayer][loadCubemapTexture]: Invalid key ".concat(e))}function tj(t,e,n){return t+(e-t)*n}const ej="https://api.maptiler.com/resources/space",nj=["vertexPosition"],ij=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],rj="%USE_TEXTURE_MACRO_MARKER%",aj=XU.stars;class oj{constructor(t){var e,n;KD(this,"id","Cubemap Layer"),KD(this,"type","custom"),KD(this,"renderingMode","3d"),KD(this,"map"),KD(this,"faces"),KD(this,"useCubemapTexture",!0),KD(this,"currentFadeOpacity",0),KD(this,"cubeMapNeedsUpdate",!1),KD(this,"bgColor"),KD(this,"previousBgColor",[0,0,0,0]),KD(this,"targetBgColor",[0,0,0,0]),KD(this,"transitionDelta",0),KD(this,"gl"),KD(this,"cubemap"),KD(this,"texture"),KD(this,"currentFacesDefinitionKey",""),KD(this,"options"),KD(this,"animationActive",!0),KD(this,"imageIsAnimating",!1),KD(this,"imageFadeInDelta",0);const i=function(t,e){var n,i;if(!sj(t))return{color:"transparent"};if(!0===t)return e;const r=Dt({},t);if(t.faces||t.path)return delete r.preset,r;const a=t.preset;if(void 0!==a&&!(a in XU))throw new Error('[CubemapLayer]: Invalid preset "'.concat(a,'". Available presets: ').concat(Object.keys(XU).join(", ")));return Dt(Dt({},r),{},{color:null!==(n=null!==(i=r.color)&&void 0!==i?i:XU[a].color)&&void 0!==n?n:"hsl(233,100%,92%)"})}(t,aj);this.options=i,this.currentFacesDefinitionKey=JSON.stringify(null!==(e=null!==(n=i.faces)&&void 0!==n?n:i.preset)&&void 0!==e?e:i.path),this.bgColor=[0,0,0,0],this.targetBgColor=UU(i.color),this.faces=lj(i),this.useCubemapTexture=null!==this.faces}updateCubemap(){let{facesNeedUpdate:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{facesNeedUpdate:!0};this.useCubemapTexture=null!==this.faces;const e=ij.filter(t=>"cubeSampler"!==t&&"fadeOpacity"!==t||this.useCubemapTexture);this.cubemap=BU({gl:this.gl,vertexShaderSource:"attribute vec3 a_vertexPosition;\nvarying vec3 vTextureCoord;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\n  \nvoid main(void) {\n  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);\n  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);\n}\n",fragmentShaderSource:this.useCubemapTexture?ZU.replace(rj,"#define USE_TEXTURE"):ZU.replace(rj,""),attributesKeys:nj,uniformsKeys:e,vertices:WU,indices:qU}),this.cubeMapNeedsUpdate=t,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(t,e){this.map=t,this.gl=e,this.updateCubemap()}onRemove(t,e){this.cubemap&&(e.deleteProgram(this.cubemap.shaderProgram),e.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(t,e){if(!0===this.cubeMapNeedsUpdate&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;!function(t){let{gl:e,faces:n,onReady:i,forceRefresh:r}=t;KU&&!r&&$U===JSON.stringify(n)&&i(KU,JU),$U=JSON.stringify(n);const a=null!==KU&&void 0!==KU?KU:e.createTexture();if(e.bindTexture(e.TEXTURE_CUBE_MAP,a),!n)return void console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");const o=Object.keys(n).length;if(6!==o)return void console.warn("[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ".concat(o));const s=Object.entries(n).map(t=>{let[e,n]=t;return new Promise((t,i)=>{const r=e;if(void 0===n)return void i(new Error("[CubemapLayer][loadCubemapTexture]: Face ".concat(e," is undefined")));const a=new Image;a.crossOrigin="anonymous";const o=()=>{t({image:a,key:r})};a.src=n,a.complete&&a.naturalWidth>0?o():a.onload=o,a.onerror=()=>{i(new Error("[CubemapLayer][loadCubemapTexture]: Error loading image ".concat(n)))}})});Promise.all(s).then(t=>{for(let i=0;i<t.length;i++){var n;const r=e.RGBA,o=e.RGBA,s=e.UNSIGNED_BYTE,{image:l,key:c}=null!==(n=t[i])&&void 0!==n?n:{};if(!l||!c){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const u=QU(e,c);e.bindTexture(e.TEXTURE_CUBE_MAP,a),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(u,0,r,o,s,l)}e.bindTexture(e.TEXTURE_CUBE_MAP,a),e.generateMipmap(e.TEXTURE_CUBE_MAP),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);const r=t.map(t=>t.image);i(a,r),JU=r,KU=a}).catch(t=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",t)})}({gl:t,faces:e,onReady:t=>{this.texture=t,this.animateIn()}})}}prerender(t,e){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const t=()=>{this.transitionDelta<1&&(requestAnimationFrame(t),this.bgColor=function(t,e,n){return[tj(t[0],e[0],n),tj(t[1],e[1],n),tj(t[2],e[2],n),tj(t[3],e[3],n)]}(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(t)}async animateIn(){if(!this.imageIsAnimating)return this.animationActive?new Promise(t=>{this.imageIsAnimating=!0;const e=()=>{this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=tj(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1?requestAnimationFrame(e):(this.imageIsAnimating=!1,this.imageFadeInDelta=0,t())};requestAnimationFrame(e)}):(this.currentFadeOpacity=1,this.imageFadeInDelta=1,void this.map.triggerRepaint())}async animateOut(){if(!this.imageIsAnimating&&this.animationActive)return new Promise(t=>{const e=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=tj(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1)return this.imageIsAnimating=!1,this.imageFadeInDelta=0,void t();requestAnimationFrame(e)};requestAnimationFrame(e)})}setAnimationActive(t){this.animationActive=t}render(t,e){if(!this.map.isGlobeProjection())return;if(void 0===this.map)throw new Error("[CubemapLayer]: Map is undefined");if(void 0===this.cubemap)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.DST_ALPHA),t.useProgram(this.cubemap.shaderProgram),t.bindBuffer(t.ARRAY_BUFFER,this.cubemap.positionBuffer),t.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const n=t.canvas,i=n.clientWidth/n.clientHeight,r=this.map.transform,a=r.fov*(Math.PI/180),o=vU();PU(o,a,i,.1,1e4),xU(o,o,r.rollInRadians),_U(o,o,-r.pitchInRadians),xU(o,o,r.bearingInRadians);const s=r.center.lat*Math.PI/180,l=r.center.lng*Math.PI/180;_U(o,o,s),function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],c=e[8],u=e[9],h=e[10],d=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-c*i,t[1]=o*r-u*i,t[2]=s*r-h*i,t[3]=l*r-d*i,t[8]=a*i+c*r,t[9]=o*i+u*r,t[10]=s*i+h*r,t[11]=l*i+d*r}(o,o,-l),t.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,o);const c=vU();if(t.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,c),t.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),t.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture),t.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),void 0===this.cubemap.indexBuffer)throw new Error("Index buffer is undefined");if(void 0===this.cubemap.indexBufferLength)throw new Error("Index buffer length is undefined");t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),t.drawElements(t.TRIANGLES,this.cubemap.indexBufferLength,t.UNSIGNED_SHORT,0)}setBgColor(t){this.targetBgColor=t,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(t){var e,n;if(await this.animateOut(),!t.faces&&!t.preset&&!t.path)return this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",void await this.animateIn();this.faces=lj(t),this.currentFacesDefinitionKey=JSON.stringify(null!==(e=null!==(n=t.faces)&&void 0!==n?n:t.preset)&&void 0!==e?e:t.path)}async setCubemap(t){var e,n;const i="boolean"==typeof t?aj:t;this.options=i;const r=JSON.stringify(null!==(e=null!==(n=i.faces)&&void 0!==n?n:i.preset)&&void 0!==e?e:i.path),a=this.currentFacesDefinitionKey!==r;a&&(await this.setCubemapFaces(i),this.cubeMapNeedsUpdate=!0);const o=UU(i.color);if(i.color&&this.targetBgColor.toString()!==o.toString())this.setBgColor(o);else if(!i.color&&i.preset&&i.preset in XU){const t=XU[i.preset];this.setBgColor(UU(t.color))}this.updateCubemap({facesNeedUpdate:a})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function sj(t){return!!t&&("boolean"==typeof t||!(!t.path&&!t.preset&&!t.faces&&!t.color||t.preset&&!(t.preset in XU)||t.faces&&(!t.faces.pX||!t.faces.nX||!t.faces.pY||!t.faces.nY||!t.faces.pZ||!t.faces.nZ)))}function lj(t){if(t.faces)return t.faces;if(t.preset)return{pX:"".concat(ej,"/").concat(t.preset,"/px.webp"),nX:"".concat(ej,"/").concat(t.preset,"/nx.webp"),pY:"".concat(ej,"/").concat(t.preset,"/py.webp"),nY:"".concat(ej,"/").concat(t.preset,"/ny.webp"),pZ:"".concat(ej,"/").concat(t.preset,"/pz.webp"),nZ:"".concat(ej,"/").concat(t.preset,"/nz.webp")};if(t.path){var e;const n=t.path.baseUrl,i=null!==(e=t.path.format)&&void 0!==e?e:"png";return{pX:"".concat(n,"/px.").concat(i),nX:"".concat(n,"/nx.").concat(i),pY:"".concat(n,"/py.").concat(i),nY:"".concat(n,"/ny.").concat(i),pZ:"".concat(n,"/pz.").concat(i),nZ:"".concat(n,"/nz.").concat(i)}}return null}const cj=["position"],uj=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],hj=[-2,-2,0,2,-2,0,-2,2,0,2,2,0],dj={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]};class pj{constructor(t){KD(this,"id","Halo Layer"),KD(this,"type","custom"),KD(this,"renderingMode","3d"),KD(this,"gradient"),KD(this,"scale",0),KD(this,"animationDelta",0),KD(this,"map"),KD(this,"plane"),KD(this,"animationActive",!0),this.gradient="boolean"!=typeof t?Dt(Dt({},dj),t):dj}onAdd(t,e){this.map=t,this.plane=BU({gl:e,vertexShaderSource:"attribute vec3 a_position;\n\nuniform mat4 u_matrix;\nuniform mat4 u_rotationMatrix;\n\nuniform float u_scale;\n\nvarying vec2 v_pos;\nvarying float v_scale;\n\nvoid main() {\n  v_scale = u_scale;\n  v_pos = a_position.xy * u_scale;\n  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);\n}\n",fragmentShaderSource:"precision mediump float;\nvarying vec2 v_pos;\n      \nuniform int u_stopsNumber;\nuniform float u_stops[100];\nuniform vec4 u_colors[100];\nuniform float u_maxDistance;\n\nvarying float v_scale;\n\nconst float EPSILON = 0.000001;\n\nvec2 center = vec2(0.0, 0.0);\nvoid main() {\n  float rawDistance = distance(center, v_pos);\n  float distanceFromGlobeEdge = rawDistance - 1.0;\n\n    vec4 color = u_colors[0];\n\n  // if we're further than the max distance, we should not render anything.\n  // This is to always render a circle, otherwise we end up rendering\n  // to the corners of the plane.\n  if (distance(center, v_pos) > u_maxDistance * v_scale) {\n    discard;\n  }\n\n  for (int i = 1; i < 100; i++) {\n    // if we're past the last stop\n    // we should fill to the end with the last stop color\n    if (i >= u_stopsNumber) {\n      color = u_colors[i - 1];\n      break;\n    }\n\n    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);\n    float lastStopValue = u_stops[i - 1];\n    float thisStopValue = u_stops[i];\n\n    // this is to avoid blending errors when the stops are the same\n    // eg when you would want a sharp edge between two stops.\n    // `numbersAreEqual` will be 1.0 if the numbers are equal, 0.0 if they are not.\n    // We then subtract EPSILON from the last stop making the stop value _almost_ equal\n    // to the next stop but not enough to cause blending issues.\n    // It's more efficient to do this than an if / else statement.\n    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));\n    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;\n\n    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);\n\n    if (distanceFromGlobeEdge <= scaledStopPosition) {\n      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);\n      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);\n      break;\n    }\n  }\n  \n  // gl_FragColor = color;\n  gl_FragColor = vec4(color.rgb * color.a, color.a);\n}\n",attributesKeys:cj,uniformsKeys:uj,vertices:hj}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){return this.animationActive?new Promise(t=>{this.animationDelta=0;const e=()=>{if(this.animationDelta<1)return this.scale=tj(0,this.gradient.scale,this.animationDelta),this.animationDelta+=.06,this.map.triggerRepaint(),void requestAnimationFrame(e);t()};requestAnimationFrame(e)}):(this.scale=this.gradient.scale,this.animationDelta=1,void this.map.triggerRepaint())}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(t=>{const e=()=>{if(this.animationDelta<1)return this.scale=tj(this.gradient.scale,0,this.animationDelta),this.animationDelta+=.06,this.map.triggerRepaint(),void requestAnimationFrame(e);t()};e()})}onRemove(t,e){void 0!==this.plane&&(e.deleteProgram(this.plane.shaderProgram),e.deleteBuffer(this.plane.positionBuffer))}prerender(t,e){}render(t,e){if(void 0===this.map)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(void 0===this.plane)throw new Error("[RadialGradientLayer]: Plane is undefined");t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.useProgram(this.plane.shaderProgram),t.bindBuffer(t.ARRAY_BUFFER,this.plane.positionBuffer);const n=this.plane.programInfo.attributesLocations.position;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,3,t.FLOAT,!1,0,0);const i=vU(),r=this.scale;!function(t,e,n){var i=n[0],r=n[1],a=n[2];t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(i,i,[r,r,r]);const a=vU();!function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];t[0]=_*i+x*s+b*h+w*m,t[1]=_*r+x*l+b*d+w*g,t[2]=_*a+x*c+b*p+w*y,t[3]=_*o+x*u+b*f+w*v,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*i+x*s+b*h+w*m,t[5]=_*r+x*l+b*d+w*g,t[6]=_*a+x*c+b*p+w*y,t[7]=_*o+x*u+b*f+w*v,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*i+x*s+b*h+w*m,t[9]=_*r+x*l+b*d+w*g,t[10]=_*a+x*c+b*p+w*y,t[11]=_*o+x*u+b*f+w*v,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*i+x*s+b*h+w*m,t[13]=_*r+x*l+b*d+w*g,t[14]=_*a+x*c+b*p+w*y,t[15]=_*o+x*u+b*f+w*v}(a,e.defaultProjectionData.mainMatrix,i);const o=this.plane.programInfo.uniformsLocations.matrix;t.uniformMatrix4fv(o,!1,a);const s=vU(),l=this.map.transform.cameraPosition,c=RU(IU(),l),u=function(t,e,n){var i=new yU(3);return i[0]=t,i[1]=e,i[2]=n,i}(0,1,0),h=IU();kU(h,u,c),RU(h,h);const d=IU();kU(d,c,h),RU(d,d),function(t,e,n,i,r,a,o,s,l,c,u,h,d,p,f,m,g){t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=d,t[12]=p,t[13]=f,t[14]=m,t[15]=g}(s,h[0],h[1],h[2],0,d[0],d[1],d[2],0,c[0],c[1],c[2],0,0,0,0,1);const p=this.plane.programInfo.uniformsLocations.rotationMatrix;t.uniformMatrix4fv(p,!1,s);const f=this.gradient.stops.length,m=[],g=[];for(let y=0;y<=f;y++)if(y<f){m[y]=this.gradient.stops[y][0];const t=UU(this.gradient.stops[y][1]);g.push(...t)}t.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,f),t.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(m)),t.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(g)),t.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,2),t.uniform1f(this.plane.programInfo.uniformsLocations.scale,r),t.drawArrays(t.TRIANGLE_STRIP,0,4)}async setGradient(t){var e,n,i;if(!1!==t)return await this.animateOut(),"boolean"==typeof(i=t)||"number"==typeof i.scale&&i.stops&&0!==i.stops.length&&!i.stops.some(t=>"number"!=typeof t[0]||"string"!=typeof t[1])?(!0===t?(this.gradient.scale=dj.scale,this.gradient.stops=dj.stops):(this.gradient.scale=null!==(e=t.scale)&&void 0!==e?e:dj.scale,this.gradient.stops=null!==(n=t.stops)&&void 0!==n?n:dj.stops),void await this.animateIn()):(this.gradient.scale=dj.scale,void(this.gradient.stops=[[0,"transparent"],[1,"transparent"]]));await this.animateOut()}setAnimationActive(t){this.animationActive=t}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}const fj="COUNTRY";let mj=class t extends cD.Map{constructor(t){var e,n;xz(t.container),t.apiKey&&(oz.apiKey=t.apiKey);const{style:i,requiresUrlMonitoring:r,isFallback:a}=NB(t.style);a&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),oz.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const o=location.hash;let s={compact:!1};t.customAttribution?s.customAttribution=t.customAttribution:t.attributionControl&&"object"==typeof t.attributionControl&&(s=Dt(Dt({},s),t.attributionControl));const l=Dt(Dt({},t),{},{style:i,maplibreLogo:!1,transformRequest:yz(t.transformRequest),attributionControl:!0!==t.forceNoAttributionControl&&s});delete l.style,super(l),KD(this,"telemetry"),KD(this,"space"),KD(this,"halo"),KD(this,"options"),KD(this,"isTerrainEnabled",!1),KD(this,"terrainExaggeration",1),KD(this,"primaryLanguage"),KD(this,"terrainGrowing",!1),KD(this,"terrainFlattening",!1),KD(this,"minimap"),KD(this,"forceLanguageUpdate"),KD(this,"languageAlwaysBeenStyle"),KD(this,"isReady",!1),KD(this,"terrainAnimationDuration",1e3),KD(this,"monitoredStyleUrls"),KD(this,"styleInProcess",!1),KD(this,"curentProjection"),KD(this,"originalLabelStyle",new window.Map),KD(this,"isStyleLocalized",!1),KD(this,"languageIsUpdated",!1),KD(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=t,this.setStyle(i),r&&this.monitorStyleUrl(i);const c=()=>{let t="The distant style could not be loaded.";this.getStyle()?t+="Leaving the style as is.":(this.setStyle(ED.STREETS),t+='Loading default MapTiler Cloud style "'.concat(ED.STREETS.getDefaultVariant().getId(),'" as a fallback.')),console.warn(t)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",t=>{if(t.error instanceof cD.AJAXError){const e=t.error.url,n=new URL(e);n.search="";const i=n.href;return void(this.monitoredStyleUrls&&this.monitoredStyleUrls.has(i)&&(this.monitoredStyleUrls.delete(i),c()))}this.styleInProcess&&c()}),oz.caching&&!cz&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),oz.caching&&cz&&mz(),typeof t.language>"u")this.primaryLanguage=oz.primaryLanguage;else{const e=mD(t.language,nz);this.primaryLanguage=null!==e&&void 0!==e?e:oz.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===nz.STYLE||this.primaryLanguage===nz.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===nz.STYLE,this.terrainExaggeration=null!==(e=t.terrainExaggeration)&&void 0!==e?e:this.terrainExaggeration,this.curentProjection=t.projection,this.on("styledata",()=>{"mercator"===this.curentProjection?this.setProjection({type:"mercator"}):"globe"===this.curentProjection&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!t.geolocate||t.center||t.hash&&o)return;try{if(t.geolocate===fj)return void await this.fitToIpBounds()}catch(n){console.warn(n.message)}let e;try{await this.centerOnIpPoint(t.zoom),e=this.getCameraHash()}catch(n){console.warn(n.message)}"granted"===(await navigator.permissions.query({name:"geolocation"})).state&&navigator.geolocation.getCurrentPosition(n=>{e===this.getCameraHash()&&(this.terrain?this.easeTo({center:[n.coords.longitude,n.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[n.coords.longitude,n.coords.latitude],zoom:t.zoom||12,duration:2e3})}))},null,{maximumAge:864e5,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{null===this.getTerrain()&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let e={logo:null};try{const t=Object.keys(this.style.sourceCaches).map(t=>this.getSource(t)).filter(t=>t&&"url"in t&&"string"==typeof t.url&&t.url.includes("tiles.json")),n=new URL(t[0].url);n.searchParams.has("key")||n.searchParams.append("key",oz.apiKey),e=await(await fetch(n.href)).json()}catch(n){}if(t.customControls){const e="[data-maptiler-control-group]",n="[data-maptiler-control]",i=t=>{let e=t.dataset.maptilerControl;return("true"===e||""===e)&&(e=void 0),e},r=t=>t.dataset.maptilerPosition;let a=[...this._container.ownerDocument.querySelectorAll(e)],o=[...this._container.ownerDocument.querySelectorAll(n)].filter(t=>null===t.closest(e));if("string"==typeof t.customControls){const e=t.customControls;a=a.filter(t=>t.matches(e)||null!==t.closest(e)),o=o.filter(t=>t.matches(e)||null!==t.closest(e))}for(const t of a){const e=new fU(t);this.addControl(e,r(t));for(const r of t.querySelectorAll(n))e.configureGroupItem(r,i(r))}for(const t of o)this.addControl(new fU(t,i(t)),r(t));const s=()=>{const{lng:t,lat:e}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(t)),this._container.style.setProperty("--maptiler-center-lat",String(e)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};s(),this.on("render",s)}if(!0!==t.forceNoAttributionControl)if("logo"in e&&e.logo){const n=e.logo;this.addControl(new Lz({logoURL:n}),t.logoPosition)}else t.maptilerLogo&&this.addControl(new Lz,t.logoPosition);if(t.scaleControl){const e=!0===t.scaleControl||void 0===t.scaleControl?"bottom-right":t.scaleControl,n=new Rz({unit:oz.unit});this.addControl(n,e),oz.on("unit",t=>{n.setUnit(t)})}if(!1!==t.navigationControl){const e=!0===t.navigationControl||void 0===t.navigationControl?"top-right":t.navigationControl;this.addControl(new VB,e)}if(!1!==t.geolocateControl){const e=!0===t.geolocateControl||void 0===t.geolocateControl?"top-right":t.geolocateControl;this.addControl(new qB({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),e)}if(t.terrainControl){const e=!0===t.terrainControl||void 0===t.terrainControl?"top-right":t.terrainControl;this.addControl(new UB,e)}if(t.projectionControl){const e=!0===t.projectionControl||void 0===t.projectionControl?"top-right":t.projectionControl;this.addControl(new QB,e)}if(t.fullscreenControl){const e=!0===t.fullscreenControl||void 0===t.fullscreenControl?"top-right":t.fullscreenControl;this.addControl(new kz({}),e)}this.isReady=!0,this.fire("ready",{target:this})});let u,h=!1,d=!1;this.once("ready",()=>{h=!0,d&&this.fire("loadWithTerrain",u)}),this.once("style.load",()=>{const{minimap:e}=t;if("object"==typeof e){var n;const{zoom:i,center:r,style:a,language:o,apiKey:s,maptilerLogo:l,canvasContextAttributes:c,refreshExpiredTiles:u,maxBounds:h,scrollZoom:d,minZoom:p,maxZoom:f,boxZoom:m,locale:g,fadeDuration:y,crossSourceCollisions:v,clickTolerance:_,bounds:x,fitBoundsOptions:b,pixelRatio:w,validateStyle:S}=t;this.minimap=new mU(e,{zoom:i,center:r,style:a,language:o,apiKey:s,container:"null",maptilerLogo:l,canvasContextAttributes:c,refreshExpiredTiles:u,maxBounds:h,scrollZoom:d,minZoom:p,maxZoom:f,boxZoom:m,locale:g,fadeDuration:y,crossSourceCollisions:v,clickTolerance:_,bounds:x,fitBoundsOptions:b,pixelRatio:w,validateStyle:S}),this.addControl(this.minimap,null!==(n=e.position)&&void 0!==n?n:"bottom-left")}else!0===e?(this.minimap=new mU({},t),this.addControl(this.minimap,"bottom-left")):void 0!==e&&!1!==e&&(this.minimap=new mU({},t),this.addControl(this.minimap,e))});const p=t=>{t.terrain&&(d=!0,u={type:"loadWithTerrain",target:this,terrain:t.terrain},this.off("terrain",p),h&&this.fire("loadWithTerrain",u))};this.on("terrain",p),t.terrain&&this.enableTerrain(null!==(n=t.terrainExaggeration)&&void 0!==n?n:this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",t=>{!0!==this._removed?(console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",t)):console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.")});const e=this.getLayersOrder()[0];t.space&&this.initSpace({options:t,before:e}),t.halo&&this.initHalo({options:t,before:e})}),this.telemetry=new gU(this)}getSpace(){return this.space}setSpace(t){if(!1!==t){if(this.isGlobeProjection()){if(this.space)return this.space.setCubemap(t),void(this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]));this.space=new oj(t),this.once("load",()=>{const t=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,t)})}}else this.space=void 0}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(t){this.halo?this.halo.setAnimationActive(t):this.once("load",()=>{var e;null==(e=this.halo)||e.setAnimationActive(t)})}setSpaceAnimationActive(t){this.space?this.space.setAnimationActive(t):this.once("load",()=>{var e;null==(e=this.space)||e.setAnimationActive(t)})}setSpaceFromStyle(t){let{style:e}=t;var n,i,r;if(this.options.space)return void this.setSpace(this.options.space);const a=null==(i=null==(n=e.metadata)?void 0:n.maptiler)?void 0:i.space;if(a)if(sj(a)){if(JSON.stringify(null==(r=this.space)?void 0:r.getConfig())!==JSON.stringify(a))(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const t=this.getLayersOrder()[0];this.addLayer(this.space,t)}this.space.setCubemap(a)}})();else if(this.space&&!this.getLayer(this.space.id)){const t=this.getLayersOrder()[0];this.addLayer(this.space,t)}}else this.setSpace({color:"transparent"});else this.setSpace({color:"transparent"})}setHaloFromStyle(t){let{style:e}=t;var n,i,r;const a=null==(n=e.metadata)?void 0:n.maptiler;if(JSON.stringify(null==(i=this.halo)?void 0:i.getConfig())!==JSON.stringify(null==a?void 0:a.halo))null!=a&&a.halo||this.options.halo?(()=>{var t;if(this.halo){var e;if(!this.getLayer(this.halo.id)){var n;const e=this.getLayersOrder().indexOf(null!==(n=null==(t=this.space)?void 0:t.id)&&void 0!==n?n:"")+1,i=this.getLayersOrder()[e];this.addLayer(this.halo,i)}const i=null!==(e=null==a?void 0:a.halo)&&void 0!==e?e:this.options.halo;i&&this.halo.setGradient(i)}})():this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});else if(this.halo&&!this.getLayer(this.halo.id)){var o;const t=this.getLayersOrder().indexOf(null!==(o=null==(r=this.space)?void 0:r.id)&&void 0!==o?o:"")+1,e=this.getLayersOrder()[t];this.addLayer(this.halo,e)}}initSpace(t){let{options:e=this.options,before:n,spec:i}=t;if(this.space)return void(this.getLayer(this.space.id)||this.addLayer(this.space,n));if(!1===e.space)return;const r=i;if(e.space)return this.space=new oj(e.space),void this.addLayer(this.space,n);r&&(this.space=new oj(r),this.addLayer(this.space,n))}initHalo(t){let{options:e=this.options,before:n,spec:i}=t;if(this.halo&&this.getLayer(this.halo.id)||!1===e.halo)return;const r=i;if(e.halo)return this.halo=new pj(e.halo),void this.addLayer(this.halo,n);r&&(this.halo=new pj(r),this.addLayer(this.halo,n))}getHalo(){return this.halo}setHalo(t){if(this.isGlobeProjection()){if(this.halo)return void this.halo.setGradient(t);this.halo=new pj(t),this.once("load",()=>{var t,e;const n=this.getLayersOrder(),i=n[0],r=n.indexOf(null!==(t=null==(e=this.space)?void 0:e.id)&&void 0!==t?t:"")+2,a=n[r];this.halo&&this.addLayer(this.halo,this.space?a:i)})}}recreate(){const e={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new t(Dt({},this.options))),this.once("load",()=>{this.jumpTo(e)})}setTerrainAnimationDuration(t){this.terrainAnimationDuration=Math.max(t,0)}async onLoadAsync(){return new Promise(t=>{this.loaded()?t(this):this.once("load",()=>{t(this)})})}async onReadyAsync(){return new Promise(t=>{this.isReady?t(this):this.once("ready",()=>{t(this)})})}async onLoadWithTerrainAsync(){return new Promise(t=>{this.isReady&&this.terrain?t(this):this.once("loadWithTerrain",()=>{t(this)})})}monitorStyleUrl(t){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const e=new URL(t);e.search="",this.monitoredStyleUrls.add(e.href)}setStyle(t,e){var n,i,r,a,o;this.originalLabelStyle.clear(),null==(n=this.minimap)||n.setStyle(t),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const s=NB(t);if(s.requiresUrlMonitoring&&this.monitorStyleUrl(s.style),s.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const l=this.getStyle(),c=s.style;try{super.setStyle(s.style,e),this.styleInProcess=!0}catch(h){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",h)}const u=t=>{var e,n,i,r,a;const o=null!==(e=null==t?void 0:t.target.getStyle())&&void 0!==e?e:s.style,l=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:o}):this.initSpace({before:l,spec:null==(i=null==(n=o.metadata)?void 0:n.maptiler)?void 0:i.space}),this.halo?this.setHaloFromStyle({style:o}):this.initHalo({before:l,spec:null==(a=null==(r=o.metadata)?void 0:r.maptiler)?void 0:a.halo})};if("string"==typeof s.style||s.requiresUrlMonitoring)return this.on("styledata",u),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",u),this.once("styledata",u),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if((null==(i=null==l?void 0:l.terrain)?void 0:i.source)!==(null==(r=null==c?void 0:c.terrain)?void 0:r.source)||(null==(a=null==l?void 0:l.terrain)?void 0:a.exaggeration)!==(null==(o=null==c?void 0:c.terrain)?void 0:o.exaggeration))return this.once("terrain",()=>{const t=s.style;t.projection&&"mercator"!==t.projection.type?(this.setSpaceFromStyle({style:s.style}),this.setHaloFromStyle({style:s.style})):console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...")}),this;try{u()}catch(d){}return this}addLayer(t,e){var n;return null==(n=this.minimap)||n.addLayer(t,e),super.addLayer(t,e)}moveLayer(t,e){var n;return null==(n=this.minimap)||n.moveLayer(t,e),super.moveLayer(t,e)}removeLayer(t){var e;return null==(e=this.minimap)||e.removeLayer(t),super.removeLayer(t)}setLayerZoomRange(t,e,n){var i;return null==(i=this.minimap)||i.setLayerZoomRange(t,e,n),super.setLayerZoomRange(t,e,n)}setFilter(t,e,n){var i;return null==(i=this.minimap)||i.setFilter(t,e,n),super.setFilter(t,e,n)}setPaintProperty(t,e,n,i){var r;return null==(r=this.minimap)||r.setPaintProperty(t,e,n,i),super.setPaintProperty(t,e,n,i)}setLayoutProperty(t,e,n,i){var r;return null==(r=this.minimap)||r.setLayoutProperty(t,e,n,i),super.setLayoutProperty(t,e,n,i)}setGlyphs(t,e){var n;return null==(n=this.minimap)||n.setGlyphs(t,e),super.setGlyphs(t,e)}getStyleLanguage(){return this.style&&this.style.stylesheet&&this.style.stylesheet.metadata&&"object"==typeof this.style.stylesheet.metadata&&"maptiler:language"in this.style.stylesheet.metadata&&"string"==typeof this.style.stylesheet.metadata["maptiler:language"]?pD(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(t){var e;null==(e=this.minimap)||e.map.setLanguage(t),this.onStyleReady(()=>{this.setPrimaryLanguage(t)})}setPrimaryLanguage(t){const e=this.getStyleLanguage(),n=mD(t,nz);if(!n)return void console.warn('The language "'.concat(n,'" is not supported.'));if((n.flag!==nz.STYLE.flag||!e||e.flag!==nz.AUTO.flag&&e.flag!==nz.VISITOR.flag)&&(n.flag!==nz.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===n&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===nz.STYLE_LOCK.flag)return void console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");this.primaryLanguage=n;let i=n;if(n.flag===nz.STYLE.flag){if(!e)return void console.warn("The style has no default languages or has an invalid one.");i=e}let r=nz.LOCAL.flag,a=["get",r];i.flag===nz.VISITOR.flag?(r=iz().flag,a=["case",["all",["has",r],["has",nz.LOCAL.flag]],["case",["==",["get",r],["get",nz.LOCAL.flag]],["get",nz.LOCAL.flag],["format",["get",r],{"font-scale":.8},"\n",["get",nz.LOCAL.flag],{"font-scale":1.1}]],["get",nz.LOCAL.flag]]):i.flag===nz.VISITOR_ENGLISH.flag?(r=nz.ENGLISH.flag,a=["case",["all",["has",r],["has",nz.LOCAL.flag]],["case",["==",["get",r],["get",nz.LOCAL.flag]],["get",nz.LOCAL.flag],["format",["get",r],{"font-scale":.8},"\n",["get",nz.LOCAL.flag],{"font-scale":1.1}]],["get",nz.LOCAL.flag]]):i.flag===nz.AUTO.flag?(r=iz().flag,a=["coalesce",["get",r],["get",nz.LOCAL.flag]]):i===nz.LOCAL?(r=nz.LOCAL.flag,a=["get",r]):(r=i.flag,a=["coalesce",["get",r],["get",nz.LOCAL.flag]]);const{layers:o}=this.getStyle(),s=0===this.originalLabelStyle.size;if(s){const t=function(t,e){const n=[];for(const a of t){if("symbol"!==a.type)continue;const t=a,{id:i,layout:r}=t;if(!r||!("text-field"in r))continue;const o=e.getLayoutProperty(i,"text-field");if(o)if("string"==typeof o){const t=Tz(o);n.push(t)}else{const t=Az(o);n.push(t)}}const i=n.flat(),r={unlocalized:0,localized:{}};for(const a of i)null===a?r.unlocalized+=1:(a in r.localized||(r.localized[a]=0),r.localized[a]+=1);return r}(o,this);this.isStyleLocalized=Object.keys(t.localized).length>0}for(const l of o){if("symbol"!==l.type)continue;const t=l,e=this.getSource(t.source);if(!e||!("url"in e)||"string"!=typeof e.url||new URL(e.url).host!==rz.maptilerApiHost)continue;const{id:n,layout:i}=t;if(!i||!("text-field"in i))continue;let r;if(s?(r=this.getLayoutProperty(n,"text-field"),this.originalLabelStyle.set(n,r)):r=this.originalLabelStyle.get(n),"string"==typeof r){const{contains:t,exactMatch:e}=Sz(r,this.isStyleLocalized);if(!t)continue;if(e)this.setLayoutProperty(n,"text-field",a);else{const t=Mz(r,a,this.isStyleLocalized);this.setLayoutProperty(n,"text-field",t)}}else{const t=wz(r,a,this.isStyleLocalized);this.setLayoutProperty(n,"text-field",t)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t){if(!this.terrain)return;const e=performance.now(),n=this.terrain.exaggeration,i=t-n,r=()=>{if(!this.terrain||this.terrainFlattening)return;const a=(performance.now()-e)/this.terrainAnimationDuration;if(a<.99){const t=n+(1-(1-a)**4)*i;this.terrain.exaggeration=t,requestAnimationFrame(r)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(r)}enableTerrain(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.terrainExaggeration;if(t<0)return void console.warn("Terrain exaggeration cannot be negative.");const e=n=>{!this.terrain||"data"!==n.type||"source"!==n.dataType||!("source"in n)||"maptiler-terrain"!==n.sourceId||"raster-dem"!==n.source.type||n.isSourceLoaded&&(this.off("data",e),this.growTerrain(t))},n=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",e),this.addSource(rz.terrainSourceId,{type:"raster-dem",url:rz.terrainSourceURL}),this.setTerrain({source:rz.terrainSourceId,exaggeration:0})};if(this.getTerrain())return this.isTerrainEnabled=!0,void this.growTerrain(t);if(this.loaded()||this.isTerrainEnabled)n();else{const t=()=>{this.getTerrain()&&this.getSource(rz.terrainSourceId)||n()};this.once("load",()=>{t()}),this.once("moveend",()=>{t()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=performance.now(),e=this.terrain.exaggeration,n=()=>{if(!this.terrain||this.terrainGrowing)return;const i=(performance.now()-t)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,i<.99){const t=e*(1-i)**4;this.terrain.exaggeration=t,requestAnimationFrame(n)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(rz.terrainSourceId)&&this.removeSource(rz.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(n)}setTerrainExaggeration(t){!(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",()=>{t()})}async fitToIpBounds(){const t=await xD.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(t){var e,n;const i=await xD.info();this.jumpTo({center:[null!==(e=i.longitude)&&void 0!==e?e:0,null!==(n=i.latitude)&&void 0!==n?n:0],zoom:t||11})}getCameraHash(){const t=new Float32Array(5),e=this.getCenter();return t[0]=e.lng,t[1]=e.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),ZD(new Uint8Array(t.buffer))}getSdkConfig(){return oz}getMaptilerSessionId(){return az}setTransformRequest(t){return super.setTransformRequest(yz(t)),this}isGlobeProjection(){const t=this.getProjection();return!!t&&"globe"===t.type}enableGlobeProjection(){!0!==this.isGlobeProjection()&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){!1!==this.isGlobeProjection()&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};const gj=["idle","render","load","remove","idle"],yj=["error"],vj=["resize"],_j=["webglcontextlost","webglcontextrestored"],xj=["moveend","movestart","move","zoomend","zoomstart","zoom","rotatestart","rotateend","rotate","dragstart","dragend","drag","boxzoomcancel","boxzoomend","boxzoomstart"],bj=["click","dblclick","mousedown","mouseup","mousemove","mouseout","mouseover","contextmenu","touchstart","touchend","touchmove","touchcancel"],wj=["cooperativegestureprevented"],Sj=["data","dataloading","sourcedata","sourcedataloading","dataabort","sourcedataabort"];Error;cD.Evented;function Mj(t){if(typeof DOMParser<"u"){const e=(new DOMParser).parseFromString(t,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function Tj(t,e){if(!t.hasChildNodes())return!1;for(const n of Array.from(t.childNodes)){const t=n.nodeName;if("string"==typeof t&&t.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function Ej(t){if(typeof XMLSerializer<"u")return(new XMLSerializer).serializeToString(t);throw new Error("No XML serializer found")}function Aj(t){const e="string"==typeof t?Mj(t):t;if(!Tj(e,"gpx"))throw new Error("The XML document is not valid GPX");const n=jj(e,"trk"),i=jj(e,"rte"),r=jj(e,"wpt"),a={type:"FeatureCollection",features:[]};for(const o of Array.from(n)){const t=zj(o);t&&a.features.push(t)}for(const o of Array.from(i)){const t=Nj(o);t&&a.features.push(t)}for(const o of Array.from(r))a.features.push(Oj(o));return a}function Cj(t,e){let n=t;if("string"==typeof n&&Mj(n),!Tj(n,"kml"))throw new Error("The XML document is not valid KML");const i={type:"FeatureCollection",features:[]},r={},a={},o={},s=jj(n,"Placemark"),l=jj(n,"Style"),c=jj(n,"StyleMap");for(const h of Array.from(l)){const t=Uj(void 0!==e?e(h):Ej(h)).toString(16);r["#".concat(Vj(h,"id"))]=t,a[t]=h}for(const h of Array.from(c)){r["#".concat(Vj(h,"id"))]=Uj(void 0!==e?e(h):Ej(h)).toString(16);const t=jj(h,"Pair"),n={};for(const e of Array.from(t)){var u;n[null!==qj(Gj(e,"key"))&&void 0!==u?u:""]=qj(Gj(e,"styleUrl"))}o["#".concat(Vj(h,"id"))]=n}for(const h of Array.from(s))i.features=i.features.concat(Lj(h,r,a,o));return i}function Pj(t){if(null===t)return["#000000",1];let e="",n=1,i=t;return i.startsWith("#")&&i.substring(1),(6===i.length||3===i.length)&&i,8===i.length&&(Number.parseInt(i.substring(0,2),16)/255,"#".concat(i.substring(6,8)).concat(i.substring(4,6)).concat(i.substring(2,4))),[null!==e&&void 0!==e?e:"#000000",null!==n&&void 0!==n?n:1]}function Ij(t){return Wj(t.split(" "))}function Rj(t){let e=jj(t,"coord");const n=[],i=[];0===e.length&&jj(t,"gx:coord");for(const o of Array.from(e)){var r;n.push(Ij(null!==qj(o)&&void 0!==r?r:""))}const a=jj(t,"when");for(const o of Array.from(a))i.push(qj(o));return{coords:n,times:i}}function kj(t){const e=["Polygon","LineString","Point","Track","gx:Track"];let n,i,r,a,o;const s=[],l=[];if(null!==Gj(t,"MultiGeometry"))return kj(Gj(t,"MultiGeometry"));if(null!==Gj(t,"MultiTrack"))return kj(Gj(t,"MultiTrack"));if(null!==Gj(t,"gx:MultiTrack"))return kj(Gj(t,"gx:MultiTrack"));for(0;r<e.length;r++)if(jj(t,e[r]),i)for(0;a<i.length;a++){var c,u;if(i[a],"Point"===e[r])s.push({type:"Point",coordinates:Xj(null!==qj(Gj(n,"coordinates"))&&void 0!==c?c:"")});else if("LineString"===e[r])s.push({type:"LineString",coordinates:Yj(null!==qj(Gj(n,"coordinates"))&&void 0!==u?u:"")});else if("Polygon"===e[r]){const t=jj(n,"LinearRing"),e=[];for(0;o<t.length;o++){var h;e.push(Yj(null!==qj(Gj(t[o],"coordinates"))&&void 0!==h?h:""))}s.push({type:"Polygon",coordinates:e})}else if("Track"===e[r]||"gx:Track"===e[r]){const t=Rj(n);s.push({type:"LineString",coordinates:t.coords}),t.times.length&&l.push(t.times)}}return{geoms:s,coordTimes:l}}function Lj(t,e,n,i){var r,a,o;const s=kj(t),l={},c=qj(Gj(t,"name")),u=qj(Gj(t,"address")),h=qj(Gj(t,"description")),d=Gj(t,"TimeSpan"),p=Gj(t,"TimeStamp"),f=Gj(t,"ExtendedData"),m=Gj(t,"visibility");let g,y=qj(Gj(t,"styleUrl")),v=Gj(t,"LineStyle"),_=Gj(t,"PolyStyle");if(!s.geoms.length)return[];if(c&&(l.name=c),u&&(l.address=u),y){var x,b;y.startsWith("#")||"#".concat(y),l.styleUrl=y,e[y]&&(l.styleHash=e[y]),i[y]&&(l.styleMapHash=i[y],l.styleHash=e[null!==i[y].normal&&void 0!==x?x:""]);const t=n[null!==l.styleHash&&void 0!==b?b:""];if(t){v||Gj(t,"LineStyle"),_||Gj(t,"PolyStyle");const e=Gj(t,"IconStyle");if(e){const t=Gj(e,"Icon");if(t){const e=qj(Gj(t,"href"));e&&(l.icon=e)}}}}if(h&&(l.description=h),d){const t=qj(Gj(d,"begin")),e=qj(Gj(d,"end"));t&&e&&(l.timespan={begin:t,end:e})}if(null!==p&&(l.timestamp=null!==qj(Gj(p,"when"))&&void 0!==r?r:(new Date).toISOString()),null!==v){var w;const t=Pj(qj(Gj(v,"color"))),e=t[0],n=t[1],i=Number.parseFloat(null!==qj(Gj(v,"width"))&&void 0!==w?w:"");e&&(l.stroke=e),Number.isNaN(n)||(l["stroke-opacity"]=n),Number.isNaN(i)||(l["stroke-width"]=i)}if(_){const t=Pj(qj(Gj(_,"color"))),e=t[0],n=t[1],i=qj(Gj(_,"fill")),r=qj(Gj(_,"outline"));e&&(l.fill=e),Number.isNaN(n)||(l["fill-opacity"]=n),i&&(l["fill-opacity"]="1"===i?l["fill-opacity"]||1:0),r&&(l["stroke-opacity"]="1"===r?l["stroke-opacity"]||1:0)}if(f){const t=jj(f,"Data"),e=jj(f,"SimpleData");for(0;g<t.length;g++){var S,M;l[null!==t[g].getAttribute("name")&&void 0!==S?S:""]=null!==qj(Gj(t[g],"value"))&&void 0!==M?M:""}for(0;g<e.length;g++){var T,E;l[null!==e[g].getAttribute("name")&&void 0!==T?T:""]=null!==qj(e[g])&&void 0!==E?E:""}}null!==m&&(l.visibility=null!==qj(m)&&void 0!==a?a:""),0!==s.coordTimes.length&&(l.coordTimes=1===s.coordTimes.length?s.coordTimes[0]:s.coordTimes);const A={type:"Feature",geometry:1===s.geoms.length?s.geoms[0]:{type:"GeometryCollection",geometries:s.geoms},properties:l};return Vj(t,"id")&&(A.id=null!==Vj(t,"id")&&void 0!==o?o:void 0),[A]}function Dj(t,e){const n=jj(t,e),i=[],r=[];let a=[];const o=n.length;if(!(o<2)){for(let t=0;t<o;t++){const e=Kj(n[t]);i.push(e.coordinates),e.time&&r.push(e.time),(e.heartRate||a.length)&&(0===a.length&&new Array(t).fill(null),a.push(e.heartRate))}return{line:i,times:r,heartRates:a}}}function zj(t){const e=jj(t,"trkseg"),n=[],i=[],r=[];let a;for(let s=0;s<e.length;s++)if(Dj(e[s],"trkpt"),void 0!==a&&(a.line&&n.push(a.line),a.times&&a.times.length&&i.push(a.times),r.length||a.heartRates&&a.heartRates.length)){if(!r.length)for(let t=0;t<s;t++)r.push(new Array(n[t].length).fill(null));a.heartRates&&a.heartRates.length?r.push(a.heartRates):r.push(new Array(a.line.length).fill(null))}if(0===n.length)return;const o=Dt(Dt({},Bj(t)),Fj(Gj(t,"extensions")));return 0!==i.length&&(o.coordTimes=1===n.length?i[0]:i),0!==r.length&&(o.heartRates=1===n.length?r[0]:r),1===n.length?{type:"Feature",properties:o,geometry:{type:"LineString",coordinates:n[0]}}:{type:"Feature",properties:o,geometry:{type:"MultiLineString",coordinates:n}}}function Nj(t){const e=Dj(t,"rtept");return void 0===e?void 0:{type:"Feature",properties:Dt(Dt({},Bj(t)),Fj(Gj(t,"extensions"))),geometry:{type:"LineString",coordinates:e.line}}}function Oj(t){return{type:"Feature",properties:Dt(Dt({},Bj(t)),Zj(t,["sym"])),geometry:{type:"Point",coordinates:Kj(t).coordinates}}}function Fj(t){const e={};if(t){const r=Gj(t,"line");if(r){var n,i;const t=qj(Gj(r,"color")),a=Number.parseFloat(null!==qj(Gj(r,"opacity"))&&void 0!==n?n:"0"),o=Number.parseFloat(null!==qj(Gj(r,"width"))&&void 0!==i?i:"0");t&&(e.stroke=t),Number.isNaN(a)||(e["stroke-opacity"]=a),Number.isNaN(o)||(e["stroke-width"]=96*o/25.4)}}return e}function Bj(t){const e=Zj(t,["name","cmt","desc","type","time","keywords"]),n=jj(t,"link");if(0!==n.length){e.links=[];for(const t of Array.from(n)){const n=Dt({href:Vj(t,"href")},Zj(t,["text","type"]));e.links.push(n)}}return e}function Uj(t){let e=0;if(!t||!t.length)return e;for(let n=0;n<t.length;n++)(e<<5)-e+t.charCodeAt(n)|0;return e}function jj(t,e){return t.getElementsByTagName(e)}function Vj(t,e){return t.getAttribute(e)}function Hj(t,e){var n;return Number.parseFloat(null!==Vj(t,e)&&void 0!==n?n:"0")}function Gj(t,e){const n=jj(t,e);return n.length?n[0]:null}function Wj(t){return t.map(Number.parseFloat).map(t=>Number.isNaN(t)?null:t)}function qj(t){return t&&function(t){t.normalize&&t.normalize()}(t),t&&t.textContent}function Zj(t,e){const n={};let i,r;for(0;r<e.length;r++){var a;Gj(t,e[r]),i&&(n[e[r]]=null!==qj(i)&&void 0!==a?a:"")}return n}function Xj(t){return Wj(t.replace(/\s*/g,"").split(","))}function Yj(t){const e=t.replace(/^\s*|\s*$/g,"").split(/\s+/),n=[];for(const i of e)n.push(Xj(i));return n}function Kj(t){var e,n;const i=[Hj(t,"lon"),Hj(t,"lat")],r=Gj(t,"ele"),a=Gj(t,"gpxtpx:hr")||Gj(t,"hr"),o=Gj(t,"time");let s;return r&&(Number.parseFloat(null!==qj(r)&&void 0!==e?e:"0"),Number.isNaN(s)||i.push(s)),{coordinates:i,time:o?qj(o):null,heartRate:null!==a?Number.parseFloat(null!==qj(a)&&void 0!==n?n:"0"):null}}const Jj=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function $j(){return Jj[~~(Math.random()*Jj.length)][~~(4*Math.random())]}function Qj(){return"maptiler_source_".concat(vz())}function tV(){return"maptiler_layer_".concat(vz())}function eV(t,e){if(e<=t[0].zoom)return t[0].value;if(e>=t[t.length-1].zoom)return t[t.length-1].value;for(let n=0;n<t.length-1;n+=1)if(e>=t[n].zoom&&e<t[n+1].zoom){const i=t[n+1].zoom-t[n].zoom,r=(e-t[n].zoom)/i;return r*t[n+1].value+(1-r)*t[n].value}return 0}function nV(t){return["interpolate",["linear"],["zoom"],...t.flatMap(t=>[t.zoom,t.value])]}function iV(t){return["interpolate",["linear"],["zoom"],...t.flatMap(t=>[t.zoom,t.value])]}function rV(t,e){if("number"==typeof e&&"number"==typeof t)return 2*e+t;if("number"==typeof e&&Array.isArray(t))return["interpolate",["linear"],["zoom"],...t.flatMap(t=>[t.zoom,2*e+t.value])];if("number"==typeof t&&Array.isArray(e))return["interpolate",["linear"],["zoom"],...e.flatMap(e=>[e.zoom,2*e.value+t])];if(Array.isArray(t)&&Array.isArray(e)){return["interpolate",["linear"],["zoom"],...Array.from(new Set([...t.map(t=>t.zoom),...e.map(t=>t.zoom)])).sort((t,e)=>t<e?-1:1).flatMap(n=>[n,2*eV(e,n)+eV(t,n)])]}return 0}function aV(t,e){return["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,t.value])]}function oV(t){const e=t.trimStart(),n="".concat(e).concat(" ".repeat(t.length-e.length)),i=Array.from(n);if(!i.every(t=>" "===t||"_"===t))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!i.some(t=>"_"===t)||!i.some(t=>" "===t))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const r=[1];for(let a=1;a<i.length;a+=1){i[a-1]===i[a]?r[r.length-1]+=1:r.push(1)}return r}function sV(t,e){return["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,t.color])]}function lV(t,e){return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.025*t.pointRadius])],2,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.05*t.pointRadius])],4,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.1*t.pointRadius])],8,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,.25*t.pointRadius])],16,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,t.pointRadius])]]:["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.value,t.pointRadius])]}function cV(t,e){return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.025*t.value])],2,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.05*t.value])],4,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.1*t.value])],8,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,.25*t.value])],16,["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,t.value])]]:["interpolate",["linear"],["get",e],...t.flatMap(t=>[t.propertyValue,t.value])]}function uV(t,e){return t.every(e=>e.color[3]===t[0].color[3])?t[0].color[3]?t[0].color[3]/255:1:["interpolate",["linear"],["get",e],...t.getRawColorStops().flatMap(t=>{const e=t.value,n=t.color;return[e,4===n.length?n[3]/255:1]})]}function hV(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},(n,i)=>{const r=i/e;return[r,t.getColorHex(r)]}).flat()]}function dV(t){const e=t.toString(16);return 1===e.length?"0".concat(e):e}class pV extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),KD(this,"min",0),KD(this,"max",1),"min"in t&&(this.min=t.min),"max"in t&&(this.max=t.max),"stops"in t&&this.setStops(t.stops,{clone:!1})}static fromArrayDefinition(t){return new pV({stops:t.map(t=>({value:t[0],color:t[1]}))})}setStops(t){const e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{clone:!0}).clone?this.clone():this;e.length=0;let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r+=1)n=Math.min(n,t[r].value),i=Math.max(i,t[r].value),e.push({value:t[r].value,color:t[r].color.slice()});return e.sort((t,e)=>t.value<e.value?-1:1),this.min=n,this.max=i,e}scale(t,e){const n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0}).clone,i=this[0].value,r=this.at(-1).value-i,a=e-t,o=[];for(let s=0;s<this.length;s+=1){const e=(this[s].value-i)/r*a+t;n?o.push({value:e,color:this[s].color.slice()}):this[s].value=e}return n?new pV({stops:o}):this}at(t){return t<0?this[this.length+t]:this[t]}clone(){return new pV({stops:this.getRawColorStops()})}getRawColorStops(){const t=[];for(let e=0;e<this.length;e+=1)t.push({value:this[e].value,color:this[e].color});return t}reverse(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clone:!0}).clone?this.clone():this;for(let e=0;e<~~(t.length/2);e+=1){const n=t[e].color;t[e].color=t.at(-(e+1)).color,t.at(-(e+1)).color=n}return t}getBounds(){return{min:this.min,max:this.max}}getColor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{smooth:!0};if(t<=this[0].value)return this[0].color;if(t>=this.at(-1).value)return this.at(-1).color;for(let n=0;n<this.length-1;n+=1){if(t>this[n+1].value)continue;const i=this[n].color;if(!e.smooth)return i.slice();const r=this[n].value,a=this[n+1].value,o=this[n+1].color,s=(a-t)/(a-r);return i.map((t,e)=>Math.round(t*s+o[e]*(1-s)))}return[0,0,0]}getColorHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{smooth:!0,withAlpha:!1};return n=this.getColor(t,e),"#".concat(dV(n[0])).concat(dV(n[1])).concat(dV(n[2])).concat(4===n.length?dV(n[3]):"");var n}getColorRelative(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{smooth:!0};const n=this.getBounds();return this.getColor(n.min+t*(n.max-n.min),e)}getCanvasStrip(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{horizontal:!0,size:512,smooth:!0};const e=document.createElement("canvas");e.width=t.horizontal?t.size:1,e.height=t.horizontal?1:t.size;const n=e.getContext("2d");if(!n)throw new Error("Canvs context is missing");const i=n.getImageData(0,0,e.width,e.height),r=i.data,a=t.size,o=this[0].value,s=(this.at(-1).value-o)/a;for(let l=0;l<a;l+=1){const e=this.getColor(o+l*s,{smooth:t.smooth});r[4*l]=e[0],r[4*l+1]=e[1],r[4*l+2]=e[2],r[4*l+3]=e.length>3?e[3]:255}return n.putImageData(i,0,0),e}resample(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;const n=this.getBounds(),i=this.scale(0,1),r=1/(e-1);let a;if("ease-in-square"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=n**2;return{value:n,color:i.getColor(a)}});else if("ease-out-square"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=1-(1-n)**2;return{value:n,color:i.getColor(a)}});else if("ease-out-sqrt"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=n**.5;return{value:n,color:i.getColor(a)}});else if("ease-in-sqrt"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=1-(1-n)**.5;return{value:n,color:i.getColor(a)}});else if("ease-out-exp"===t)a=Array.from({length:e},(t,e)=>{const n=e*r,a=1-2**(-10*n);return{value:n,color:i.getColor(a)}});else{if("ease-in-exp"!==t)throw new Error("Invalid ressampling method.");a=Array.from({length:e},(t,e)=>{const n=e*r,a=2**(10*n-10);return{value:n,color:i.getColor(a)}})}return new pV({stops:a}).scale(n.min,n.max)}transparentStart(){const t=this.getRawColorStops();t.unshift({value:t[0].value,color:t[0].color.slice()}),t[1].value+=.001;for(const e of t)3===e.color.length&&e.color.push(255);return t[0].color[3]=0,new pV({stops:t})}hasTransparentStart(){return 4===this[0].color.length&&0===this[0].color[3]}}const fV={NULL:new pV({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new pV({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new pV({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new pV({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new pV({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new pV({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new pV({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new pV({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new pV({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new pV({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new pV({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new pV({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new pV({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new pV({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new pV({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new pV({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new pV({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new pV({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new pV({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new pV({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new pV({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new pV({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new pV({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new pV({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new pV({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new pV({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new pV({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new pV({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new pV({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new pV({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new pV({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new pV({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new pV({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new pV({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new pV({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new pV({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new pV({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new pV({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new pV({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new pV({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new pV({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new pV({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new pV({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new pV({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new pV({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new pV({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new pV({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new pV({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new pV({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};Symbol.toStringTag;!function(){if(typeof window>"u")return;const t=cD.getRTLTextPluginStatus();if("unavailable"===t||"requested"===t)try{cD.setRTLTextPlugin(rz.rtlPluginURL,!0)}catch(e){}}();cD.Map,cD.Marker,cD.Popup,cD.Style,cD.CanvasSource,cD.GeoJSONSource,cD.ImageSource,cD.RasterTileSource,cD.RasterDEMTileSource,cD.VectorTileSource,cD.VideoSource,cD.NavigationControl,cD.GeolocateControl,cD.AttributionControl,cD.LogoControl,cD.ScaleControl,cD.FullscreenControl,cD.TerrainControl,cD.BoxZoomHandler,cD.ScrollZoomHandler,cD.CooperativeGesturesHandler,cD.KeyboardHandler,cD.TwoFingersTouchPitchHandler,cD.MapWheelEvent,cD.MapTouchEvent,cD.MapMouseEvent,cD.config,cD.getVersion;const{setRTLTextPlugin:mV,getRTLTextPluginStatus:gV,LngLat:yV,LngLatBounds:vV,MercatorCoordinate:_V,Evented:xV,AJAXError:bV,prewarm:wV,clearPrewarmedResources:SV,Hash:MV,Point:TV,EdgeInsets:EV,DragRotateHandler:AV,DragPanHandler:CV,TwoFingersTouchZoomRotateHandler:PV,DoubleClickZoomHandler:IV,TwoFingersTouchZoomHandler:RV,TwoFingersTouchRotateHandler:kV,getWorkerCount:LV,setWorkerCount:DV,getMaxParallelImageRequests:zV,setMaxParallelImageRequests:NV,getWorkerUrl:OV,setWorkerUrl:FV,addSourceType:BV,importScriptInWorkers:UV,addProtocol:jV,removeProtocol:VV}=cD;function HV(t){let{selectedLocation:e,selectedAsteroid:n,simulationTrigger:r,simulationParams:a}=t;const o=200,s=(0,i.useRef)(null),l=(0,i.useRef)(null),c=(0,i.useRef)(e);(0,i.useEffect)(()=>{const t=()=>{const e=s.current;if(!e)return void console.error("Map container not found");if(0===e.offsetWidth||0===e.offsetHeight)return console.warn("Map container has no dimensions, retrying..."),void setTimeout(t,100);const n=[90.368603,23.807133];let i;oz.apiKey="4xlqmw5O239jIs3v38vu";try{i=new mj({container:e,style:ED.BASIC,center:n,zoom:1.8,minZoom:.5,maxZoom:18,projection:"globe",bearing:0,pitch:0}),l.current=i;const t={width:o,height:o,data:new Uint8Array(16e4),onAdd:function(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.context=t.getContext("2d")},render:function(){const t=performance.now()%1e3/1e3,e=70*t+30,n=this.context;return n.clearRect(0,0,this.width,this.height),n.beginPath(),n.arc(this.width/2,this.height/2,e,0,2*Math.PI),n.fillStyle="rgba(255, 200, 200,"+(1-t)+")",n.fill(),n.beginPath(),n.arc(this.width/2,this.height/2,30,0,2*Math.PI),n.fillStyle="rgba(255, 100, 100, 1)",n.strokeStyle="white",n.lineWidth=2+4*(1-t),n.fill(),n.stroke(),this.data=n.getImageData(0,0,this.width,this.height).data,i.triggerRepaint(),!0}};i.on("load",()=>{i.addImage("pulsing-dot",t,{pixelRatio:2}),i.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:n}}]}}),i.addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"pulsing-dot"}}),i.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,90],"sky-atmosphere-sun-intensity":15}})})}catch(dE){return void console.error("Error initializing map:",dE)}return()=>{i&&i.remove()}},e=setTimeout(t,100);return()=>{clearTimeout(e),l.current&&(l.current.remove(),l.current=null)}},[]);const u=t=>{if(console.log("Getting coordinates for location:",t),"object"===typeof t&&t.centroid){const e=[t.centroid.lon,t.centroid.lat];return console.log("Using search result coordinates:",e,"from centroid:",t.centroid),e}if("string"===typeof t&&VE[t]){const e=VE[t];if(e.centroid){const t=[e.centroid.lon,e.centroid.lat];return console.log("Using dropdown location coordinates:",t),t}}const e=[90.368603,23.807133];return console.log("Using default coordinates:",e),e};return(0,i.useEffect)(()=>{if(!l.current||!e)return;c.current=e;const t=u(e);l.current.flyTo({center:t,zoom:6,duration:1500,essential:!0}),l.current.getSource("points")&&l.current.getSource("points").setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}]})},[e]),(0,i.useEffect)(()=>{if(!l.current||!n||!r)return;const t=c.current;if(!t)return;const e=u(t);console.log("Simulation: currentLocation from ref =",t),console.log("Simulation: targetCoords =",e),console.log("Simulation: map center =",l.current.getCenter());let i=null,o=null;let h;return setTimeout(()=>{h=(()=>{s.current.querySelectorAll(".meteor-container, .impact-explosion").forEach(t=>t.remove());const t=l.current.project(e);console.log("Meteor: targetCoords for projection =",e),console.log("Meteor: targetPixel screen coordinates =",t);const n=document.createElement("div");n.className="meteor-container",s.current.appendChild(n),o=document.createElement("div"),o.className="meteor meteor-falling";const r=(null===a||void 0===a?void 0:a.diameter)||250,c=Math.max(8,Math.min(40,r/25));o.style.width="".concat(c,"px"),o.style.height="".concat(c,"px");const u=(null===a||void 0===a?void 0:a.entryAngle)||45,h=u*Math.PI/180,d=t.x-500*Math.cos(h),p=t.y-500*Math.sin(h);o.style.left="".concat(d,"px"),o.style.top="".concat(p,"px"),n.appendChild(o);let f=null;const m=(null===a||void 0===a?void 0:a.velocity)||19.3,g=Math.max(1e3,2e3-50*(m-19.3)),y=t=>{f||(f=t);const n=Math.min((t-f)/g,1),r=l.current.project(e),a=d+(r.x-d)*n,c=p+(r.y-p)*n,h=40*Math.sin(n*Math.PI),m=u*Math.PI/180,v=a+h*Math.sin(m),_=c-h*Math.cos(m);o.style.left="".concat(v,"px"),o.style.top="".concat(_,"px");const x=Math.atan2(r.y-p,r.x-d)*(180/Math.PI);if(o.style.transform="rotate(".concat(x+45,"deg)"),n<1)requestAnimationFrame(y);else{o.className="meteor meteor-impact",i=document.createElement("div"),i.className="impact-explosion",i.style.left="".concat(r.x,"px"),i.style.top="".concat(r.y,"px"),i.style.position="absolute",i.style.pointerEvents="none",i.style.zIndex="20";for(let t=0;t<8;t++){const e=document.createElement("div");e.className="impact-debris",e.style.left="50%",e.style.top="50%",e.style.transform="rotate(".concat(45*t,"deg)"),i.appendChild(e)}s.current.appendChild(i)}};requestAnimationFrame(y);const v=()=>{if(i){const t=l.current.project(e);i.style.left="".concat(t.x,"px"),i.style.top="".concat(t.y,"px")}};return l.current.on("move",v),l.current.on("rotate",v),()=>{l.current.off("move",v),l.current.off("rotate",v)}})()},500),()=>{h&&h()}},[n,r,a]),(0,zt.jsx)("div",{ref:s,className:"real-map-container",style:{width:"50vw",height:"80vh",alignItems:"flex-start"}})}const GV=function(){const[t,e]=(0,i.useState)(null),[n,r]=(0,i.useState)(null),[a,o]=(0,i.useState)(""),[s,l]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[h,d]=(0,i.useState)(0),[p,f]=(0,i.useState)({diameter:250,velocity:19.3,entryAngle:45,impactLocation:"Ocean (Pacific)",selectedAsteroid:null}),m=(0,i.useCallback)(async t=>{if(t.trim()){u(!0);try{const e=await fetch("https://nominatim.openstreetmap.org/search?q=".concat(encodeURIComponent(t),"&format=json&limit=5")),n=await e.json();l(n)}catch(dE){l([])}u(!1)}else l([])},[]);i.useEffect(()=>{const t=setTimeout(()=>{m(a)},300);return()=>clearTimeout(t)},[a,m]);const g=(0,i.useMemo)(()=>{const e=VE[t]||t;if(!e)return null;const n=e.population||("ocean"===e.type?5e4:1e5),i=e.density||("ocean"===e.type?100:500),r=p.diameter/1e3,a=p.velocity,o=p.entryAngle*Math.PI/180,s=r/2,l=1e3*a,c=.5*(26e11*(4/3*Math.PI*Math.pow(s,3)))*Math.pow(l,2)*(Math.sin(o)||.1)/4184e12,u=.5*Math.pow(c/.001,1/3),h=Math.PI*Math.pow(u,2),d=Math.min(n,h*i),f=.15*d,m=Math.round(.25*d),g=Math.round(.47*d),y=Math.round(.28*d),v=m+g+y;return{blastRadius:u.toFixed(1),affectedPopulation:Math.round(d).toLocaleString(),casualties:Math.round(f).toLocaleString(),energy:c.toFixed(0),asteroidDiameter:r.toFixed(2),simulationParams:{diameter:p.diameter,velocity:p.velocity,entryAngle:p.entryAngle},populationBreakdown:{directImpact:m,secondary:g,longTerm:y,totalAffected:v}}},[t,p]),y=(0,i.useCallback)(t=>{var n;console.log("Running simulation with parameters:",t),f(t),r(null===(n=t.selectedAsteroid)||void 0===n?void 0:n.name),e(t.impactLocation),d(t=>t+1)},[]),v=(0,i.useCallback)(t=>{console.log("Dashboard: Setting selected location to:",t),e(t)},[]);return(0,zt.jsxs)("div",{className:"dashboard",children:[(0,zt.jsxs)("div",{className:"dashboard-container",children:[(0,zt.jsx)("aside",{className:"dashboard-sidebar",children:(0,zt.jsx)(oD,{onRunSimulation:y,onLocationChange:v,searchQuery:a,setSearchQuery:o,searchLoading:c,searchResults:s})}),(0,zt.jsxs)("main",{className:"dashboard-main",children:[(0,zt.jsxs)("div",{className:"visualization-panel",children:[(0,zt.jsxs)("div",{className:"panel-header",children:[(0,zt.jsx)("h3",{children:"Selected Impact Zone"}),(0,zt.jsx)("span",{className:"impact-zone-label",children:(t=>{if(!t)return"No Location Selected";if("string"===typeof t)return t;if(t.display_name){const e=t.display_name.split(",");return e.length>=2?"".concat(e[0].trim(),", ").concat(e[1].trim()):e[0].trim()}return t.name?t.name:"Unknown Location"})(t)})]}),(0,zt.jsx)("div",{className:"earth-container",children:(0,zt.jsx)(i.Suspense,{fallback:(0,zt.jsx)("div",{className:"loading-spinner"}),children:(0,zt.jsx)(HV,{selectedLocation:t,selectedAsteroid:n,simulationTrigger:h,simulationParams:p,zoom:.5,center:{lat:0,lng:0}})})})]}),(0,zt.jsx)("div",{className:"results-section",children:(0,zt.jsxs)("div",{className:"results-grid",children:[(0,zt.jsx)(HE,{impactData:g}),(0,zt.jsx)(iD,{impactData:g}),(0,zt.jsx)(rD,{impactData:g,simulationParams:p,selectedLocation:t})]})})]})]}),(0,zt.jsxs)("footer",{className:"story-footer",children:[(0,zt.jsxs)("div",{className:"footer-container",children:[(0,zt.jsxs)("div",{className:"footer-logo",children:[(0,zt.jsx)("div",{className:"logo-icon",children:(0,zt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,zt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,zt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,zt.jsxs)("div",{className:"footer-nav",children:[(0,zt.jsx)("h4",{children:"Navigation"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/",children:"Home"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/story",children:"Story Mode"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/dashboard",children:"Simulation Dashboard"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/results",children:"Impact Results"})})]})]}),(0,zt.jsxs)("div",{className:"footer-sources",children:[(0,zt.jsx)("h4",{children:"Data Sources"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,zt.jsxs)("div",{className:"footer-bottom",children:[(0,zt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,zt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})]})};bk.register(mL,_L,Fk,Nk,Jk,dL,Yk);const WV=function(){return(0,zt.jsxs)("div",{className:"impact-analysis",children:[(0,zt.jsxs)("div",{className:"analysis-header",children:[(0,zt.jsx)("div",{className:"header-icon",children:"\ud83d\udcc8"}),(0,zt.jsx)("h3",{children:"Impact Analysis"}),(0,zt.jsxs)("select",{className:"analysis-filter",defaultValue:"Energy Distribution",children:[(0,zt.jsx)("option",{children:"Energy Distribution"}),(0,zt.jsx)("option",{children:"Seismic Effects"}),(0,zt.jsx)("option",{children:"Atmospheric Impact"})]})]}),(0,zt.jsx)("div",{className:"chart-container",children:(0,zt.jsx)(eD,{data:{labels:["0 sec","10 sec","30 sec","60 sec","2 min","5 min","10 min"],datasets:[{label:"Energy Distribution",data:[0,15,45,75,85,92,95],borderColor:"#00d4ff",backgroundColor:"rgba(0, 212, 255, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:"#00d4ff",pointBorderColor:"#ffffff",pointBorderWidth:2},{label:"Population Effects",data:[0,25,55,70,80,85,90],borderColor:"#ff6b35",backgroundColor:"rgba(255, 107, 53, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:"#ff6b35",pointBorderColor:"#ffffff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#ffffff",padding:20,usePointStyle:!0,font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.1)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",font:{size:11}}},y:{grid:{color:"rgba(255, 255, 255, 0.1)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",font:{size:11},callback:function(t){return t+"%"}}}}}})})]})};bk.register(Ak,dL,Yk);const qV=function(){return(0,zt.jsxs)("div",{className:"impact-distribution",children:[(0,zt.jsxs)("div",{className:"distribution-header",children:[(0,zt.jsx)("div",{className:"header-icon",children:"\ud83d\udcca"}),(0,zt.jsx)("h3",{children:"Impact Distribution"}),(0,zt.jsxs)("select",{className:"distribution-filter",defaultValue:"Population",children:[(0,zt.jsx)("option",{children:"Population"}),(0,zt.jsx)("option",{children:"Economic"}),(0,zt.jsx)("option",{children:"Environmental"})]})]}),(0,zt.jsxs)("div",{className:"distribution-content",children:[(0,zt.jsx)("div",{className:"chart-container",children:(0,zt.jsx)(nD,{data:{labels:["Direct Impact (23%)","Tsunami (29%)","Seismic Effects (26%)","Other Effects (22%)"],datasets:[{data:[23,29,26,22],backgroundColor:["#ff6b35","#00d4ff","#8b5cf6","#22c55e"],borderColor:["#ff6b35","#00d4ff","#8b5cf6","#22c55e"],borderWidth:2,cutout:"65%"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,callbacks:{label:function(t){return"".concat(t.label,": ").concat(t.parsed,"%")}}}}}})}),(0,zt.jsxs)("div",{className:"distribution-legend",children:[(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--orange"}),(0,zt.jsxs)("div",{className:"legend-info",children:[(0,zt.jsx)("span",{className:"legend-label",children:"Direct Impact (23%)"}),(0,zt.jsx)("span",{className:"legend-description",children:"Immediate blast effects"})]})]}),(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--blue"}),(0,zt.jsxs)("div",{className:"legend-info",children:[(0,zt.jsx)("span",{className:"legend-label",children:"Tsunami (29%)"}),(0,zt.jsx)("span",{className:"legend-description",children:"Coastal wave damage"})]})]}),(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--purple"}),(0,zt.jsxs)("div",{className:"legend-info",children:[(0,zt.jsx)("span",{className:"legend-label",children:"Seismic Effects (26%)"}),(0,zt.jsx)("span",{className:"legend-description",children:"Earthquake-like damage"})]})]}),(0,zt.jsxs)("div",{className:"legend-item",children:[(0,zt.jsx)("div",{className:"legend-color legend-color--green"}),(0,zt.jsxs)("div",{className:"legend-info",children:[(0,zt.jsx)("span",{className:"legend-label",children:"Other Effects (22%)"}),(0,zt.jsx)("span",{className:"legend-description",children:"Secondary impacts"})]})]})]})]})]})};const ZV=function(){return(0,zt.jsxs)("div",{className:"energy-metrics",children:[(0,zt.jsx)("div",{className:"metric-header",children:(0,zt.jsx)("span",{className:"metric-label",children:"Energy Released"})}),(0,zt.jsxs)("div",{className:"metric-value",children:[(0,zt.jsx)("span",{className:"value-number",children:"12.1"}),(0,zt.jsx)("span",{className:"value-unit",children:"Mt"})]}),(0,zt.jsxs)("div",{className:"metric-progress",children:[(0,zt.jsx)("div",{className:"progress-bar",children:(0,zt.jsx)("div",{className:"progress-fill progress-fill--blue",style:{width:"75%"}})}),(0,zt.jsx)("span",{className:"progress-label",children:"TNT Equivalent"})]})]})};const XV=function(){return(0,zt.jsxs)("div",{className:"population-metrics",children:[(0,zt.jsx)("div",{className:"metric-header",children:(0,zt.jsx)("span",{className:"metric-label",children:"Population Affected"})}),(0,zt.jsxs)("div",{className:"metric-value",children:[(0,zt.jsx)("span",{className:"value-number",children:"320"}),(0,zt.jsx)("span",{className:"value-unit",children:"K"})]}),(0,zt.jsxs)("div",{className:"metric-progress",children:[(0,zt.jsx)("div",{className:"progress-bar",children:(0,zt.jsx)("div",{className:"progress-fill progress-fill--orange",style:{width:"60%"}})}),(0,zt.jsx)("span",{className:"progress-label",children:"Direct Impact Zone"})]})]})};const YV=function(){return(0,zt.jsxs)("div",{className:"tsunami-metrics",children:[(0,zt.jsx)("div",{className:"metric-header",children:(0,zt.jsx)("span",{className:"metric-label",children:"Tsunami Height"})}),(0,zt.jsxs)("div",{className:"metric-value",children:[(0,zt.jsx)("span",{className:"value-number",children:"86.3"}),(0,zt.jsx)("span",{className:"value-unit",children:"m"})]}),(0,zt.jsxs)("div",{className:"metric-progress",children:[(0,zt.jsx)("div",{className:"progress-bar",children:(0,zt.jsx)("div",{className:"progress-fill progress-fill--blue",style:{width:"90%"}})}),(0,zt.jsx)("span",{className:"progress-label",children:"Maximum Wave Height"})]})]})};const KV=function(){return(0,zt.jsxs)("div",{className:"blast-radius-metrics",children:[(0,zt.jsx)("div",{className:"metric-header",children:(0,zt.jsx)("span",{className:"metric-label",children:"Blast Radius"})}),(0,zt.jsxs)("div",{className:"metric-value",children:[(0,zt.jsx)("span",{className:"value-number",children:"243.2"}),(0,zt.jsx)("span",{className:"value-unit",children:"km"})]}),(0,zt.jsxs)("div",{className:"metric-progress",children:[(0,zt.jsx)("div",{className:"progress-bar",children:(0,zt.jsx)("div",{className:"progress-fill progress-fill--purple",style:{width:"80%"}})}),(0,zt.jsx)("span",{className:"progress-label",children:"Damage Zone"})]})]})},JV=new kd,$V=new Qh;class QV extends Z_{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new xf([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new xf([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(t){const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const n=new Bx(e,6,1);return this.setAttribute("instanceStart",new hm(n,3,0)),this.setAttribute("instanceEnd",new hm(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new Bx(e,2*n,1);return this.setAttribute("instanceColorStart",new hm(i,n,0)),this.setAttribute("instanceColorEnd",new hm(i,n,n)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new Iv(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new kd);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),JV.setFromBufferAttribute(e),this.boundingBox.union(JV))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Kd),null===this.boundingBox&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let r=0,a=t.count;r<a;r++)$V.fromBufferAttribute(t,r),i=Math.max(i,n.distanceToSquared($V)),$V.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared($V));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(t){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(t)}}const tH=(()=>parseInt(tl.replace(/\D+/g,"")))();class eH extends Zf{constructor(t){super({type:"LineMaterial",uniforms:qf.clone(qf.merge([Gb.common,Gb.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Jh(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:"\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\t\tuniform float linewidth;\n\t\t\t\tuniform vec2 resolution;\n\n\t\t\t\tattribute vec3 instanceStart;\n\t\t\t\tattribute vec3 instanceEnd;\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t\tattribute vec4 instanceColorStart;\n\t\t\t\t\t\tattribute vec4 instanceColorEnd;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t\tattribute vec3 instanceColorStart;\n\t\t\t\t\t\tattribute vec3 instanceColorEnd;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashScale;\n\t\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#endif\n\n\t\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t\t// conservative estimate of the near plane\n\t\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\t\tvLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t\t// camera space\n\t\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvUv = uv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// clip space\n\t\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t\t// ndc space\n\t\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t\t// direction\n\t\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\t\tdir.x *= aspect;\n\t\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\t\tvec3 offset;\n\t\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t\t// set the world position\n\t\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t\t// project the worldpos\n\t\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t\t// sign flip\n\t\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t\t// endcaps\n\t\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t\t// select end\n\t\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t\t// back to clip space\n\t\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tgl_Position = clip;\n\n\t\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t\t#include <fog_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tuniform vec3 diffuse;\n\t\t\t\tuniform float opacity;\n\t\t\t\tuniform float linewidth;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tuniform float dashOffset;\n\t\t\t\t\tuniform float dashSize;\n\t\t\t\t\tuniform float gapSize;\n\n\t\t\t\t#endif\n\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tvarying vec4 worldPos;\n\t\t\t\t\tvarying vec3 worldStart;\n\t\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_fragment>\n\t\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\tvarying vec4 vLineColor;\n\t\t\t\t\t#else\n\t\t\t\t\t\tvarying vec3 vLineColor;\n\t\t\t\t\t#endif\n\t\t\t\t#endif\n\n\t\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\t\tfloat mua;\n\t\t\t\t\tfloat mub;\n\n\t\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\t\tmua = numer / denom;\n\t\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\t\t\t\t\t#ifdef USE_COLOR\n\t\t\t\t\t\t#ifdef USE_LINE_COLOR_ALPHA\n\t\t\t\t\t\t\tdiffuseColor *= vLineColor;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tdiffuseColor.rgb *= vLineColor;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t\t\tgl_FragColor = diffuseColor;\n\n\t\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t\t#include <".concat(tH>=154?"colorspace_fragment":"encodings_fragment",">\n\t\t\t\t\t#include <fog_fragment>\n\t\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t\t}\n\t\t\t"),clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(t)}}const nH=tH>=125?"uv1":"uv2",iH=new Td,rH=new Qh,aH=new Qh,oH=new Td,sH=new Td,lH=new Td,cH=new Qh,uH=new ap,hH=new ab,dH=new Qh,pH=new kd,fH=new Kd,mH=new Td;let gH,yH;function vH(t,e,n){return mH.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),mH.multiplyScalar(1/mH.w),mH.x=yH/n.width,mH.y=yH/n.height,mH.applyMatrix4(t.projectionMatrixInverse),mH.multiplyScalar(1/mH.w),Math.abs(Math.max(mH.x,mH.y))}class _H extends Uf{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new QV,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eH({color:16777215*Math.random()})),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,n=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let a=0,o=0,s=e.count;a<s;a++,o+=2)rH.fromBufferAttribute(e,a),aH.fromBufferAttribute(n,a),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+rH.distanceTo(aH);const r=new Bx(i,2,1);return t.setAttribute("instanceDistanceStart",new hm(r,1,0)),t.setAttribute("instanceDistanceEnd",new hm(r,1,1)),this}raycast(t,e){const n=this.material.worldUnits,i=t.camera;null!==i||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=void 0!==t.params.Line2&&t.params.Line2.threshold||0;gH=t.ray;const a=this.matrixWorld,o=this.geometry,s=this.material;let l,c;if(yH=s.linewidth+r,null===o.boundingSphere&&o.computeBoundingSphere(),fH.copy(o.boundingSphere).applyMatrix4(a),n)l=.5*yH;else{l=vH(i,Math.max(i.near,fH.distanceToPoint(gH.origin)),s.resolution)}if(fH.radius+=l,!1!==gH.intersectsSphere(fH)){if(null===o.boundingBox&&o.computeBoundingBox(),pH.copy(o.boundingBox).applyMatrix4(a),n)c=.5*yH;else{c=vH(i,Math.max(i.near,pH.distanceToPoint(gH.origin)),s.resolution)}pH.expandByScalar(c),!1!==gH.intersectsBox(pH)&&(n?function(t,e){const n=t.matrixWorld,i=t.geometry,r=i.attributes.instanceStart,a=i.attributes.instanceEnd;for(let o=0,s=Math.min(i.instanceCount,r.count);o<s;o++){hH.start.fromBufferAttribute(r,o),hH.end.fromBufferAttribute(a,o),hH.applyMatrix4(n);const i=new Qh,s=new Qh;gH.distanceSqToSegment(hH.start,hH.end,s,i),s.distanceTo(i)<.5*yH&&e.push({point:s,pointOnLine:i,distance:gH.origin.distanceTo(s),object:t,face:null,faceIndex:o,uv:null,[nH]:null})}}(this,e):function(t,e,n){const i=e.projectionMatrix,r=t.material.resolution,a=t.matrixWorld,o=t.geometry,s=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,s.count),u=-e.near;gH.at(1,lH),lH.w=1,lH.applyMatrix4(e.matrixWorldInverse),lH.applyMatrix4(i),lH.multiplyScalar(1/lH.w),lH.x*=r.x/2,lH.y*=r.y/2,lH.z=0,cH.copy(lH),uH.multiplyMatrices(e.matrixWorldInverse,a);for(let h=0,d=c;h<d;h++){if(oH.fromBufferAttribute(s,h),sH.fromBufferAttribute(l,h),oH.w=1,sH.w=1,oH.applyMatrix4(uH),sH.applyMatrix4(uH),oH.z>u&&sH.z>u)continue;if(oH.z>u){const t=oH.z-sH.z,e=(oH.z-u)/t;oH.lerp(sH,e)}else if(sH.z>u){const t=sH.z-oH.z,e=(sH.z-u)/t;sH.lerp(oH,e)}oH.applyMatrix4(i),sH.applyMatrix4(i),oH.multiplyScalar(1/oH.w),sH.multiplyScalar(1/sH.w),oH.x*=r.x/2,oH.y*=r.y/2,sH.x*=r.x/2,sH.y*=r.y/2,hH.start.copy(oH),hH.start.z=0,hH.end.copy(sH),hH.end.z=0;const e=hH.closestPointToPointParameter(cH,!0);hH.at(e,dH);const o=Kh.lerp(oH.z,sH.z,e),c=o>=-1&&o<=1,d=cH.distanceTo(dH)<.5*yH;if(c&&d){hH.start.fromBufferAttribute(s,h),hH.end.fromBufferAttribute(l,h),hH.start.applyMatrix4(a),hH.end.applyMatrix4(a);const e=new Qh,i=new Qh;gH.distanceSqToSegment(hH.start,hH.end,i,e),n.push({point:i,pointOnLine:e,distance:gH.origin.distanceTo(i),object:t,face:null,faceIndex:h,uv:null,[nH]:null})}}}(this,i,e))}}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(iH),this.material.uniforms.resolution.value.set(iH.z,iH.w))}}class xH extends QV{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,n=new Float32Array(2*e);for(let i=0;i<e;i+=3)n[2*i]=t[i],n[2*i+1]=t[i+1],n[2*i+2]=t[i+2],n[2*i+3]=t[i+3],n[2*i+4]=t[i+4],n[2*i+5]=t[i+5];return super.setPositions(n),this}setColors(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;const n=t.length-e,i=new Float32Array(2*n);if(3===e)for(let r=0;r<n;r+=e)i[2*r]=t[r],i[2*r+1]=t[r+1],i[2*r+2]=t[r+2],i[2*r+3]=t[r+3],i[2*r+4]=t[r+4],i[2*r+5]=t[r+5];else for(let r=0;r<n;r+=e)i[2*r]=t[r],i[2*r+1]=t[r+1],i[2*r+2]=t[r+2],i[2*r+3]=t[r+3],i[2*r+4]=t[r+4],i[2*r+5]=t[r+5],i[2*r+6]=t[r+6],i[2*r+7]=t[r+7];return super.setColors(i,e),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}}class bH extends _H{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xH,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eH({color:16777215*Math.random()})),this.isLine2=!0,this.type="Line2"}}const wH=["points","color","vertexColors","linewidth","lineWidth","segments","dashed"],SH=i.forwardRef(function(t,e){let{points:n,color:r=16777215,vertexColors:a,linewidth:o,lineWidth:s,segments:l,dashed:c}=t,u=Qe(t,wH);var h,d;const p=RT(t=>t.size),f=i.useMemo(()=>l?new _H:new bH,[l]),[m]=i.useState(()=>new eH),g=4===(null==a||null==(h=a[0])?void 0:h.length)?4:3,y=i.useMemo(()=>{const t=l?new QV:new xH,e=n.map(t=>{const e=Array.isArray(t);return t instanceof Qh||t instanceof Td?[t.x,t.y,t.z]:t instanceof Jh?[t.x,t.y,0]:e&&3===t.length?[t[0],t[1],t[2]]:e&&2===t.length?[t[0],t[1],0]:t});if(t.setPositions(e.flat()),a){r=16777215;const e=a.map(t=>t instanceof Jp?t.toArray():t);t.setColors(e.flat(),g)}return t},[n,l,a,g]);return i.useLayoutEffect(()=>{f.computeLineDistances()},[n,f]),i.useLayoutEffect(()=>{c?m.defines.USE_DASH="":delete m.defines.USE_DASH,m.needsUpdate=!0},[c,m]),i.useEffect(()=>()=>{y.dispose(),m.dispose()},[y]),i.createElement("primitive",xE({object:f,ref:e},u),i.createElement("primitive",{object:y,attach:"geometry"}),i.createElement("primitive",xE({object:m,attach:"material",color:r,vertexColors:Boolean(a),resolution:[p.width,p.height],linewidth:null!==(d=null!==o&&void 0!==o?o:s)&&void 0!==d?d:1,dashed:c,transparent:4===g},u)))});var MH=Object.defineProperty,TH=(t,e,n)=>(((t,e,n)=>{e in t?MH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!==typeof e?e+"":e,n),n);class EH{constructor(){TH(this,"_listeners")}addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}var AH=Object.defineProperty,CH=(t,e,n)=>(((t,e,n)=>{e in t?AH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!==typeof e?e+"":e,n),n);const PH=new rp,IH=new rg,RH=Math.cos(Math.PI/180*70),kH=(t,e)=>(t%e+e)%e;class LH extends EH{constructor(t,e){super(),CH(this,"object"),CH(this,"domElement"),CH(this,"enabled",!0),CH(this,"target",new Qh),CH(this,"minDistance",0),CH(this,"maxDistance",1/0),CH(this,"minZoom",0),CH(this,"maxZoom",1/0),CH(this,"minPolarAngle",0),CH(this,"maxPolarAngle",Math.PI),CH(this,"minAzimuthAngle",-1/0),CH(this,"maxAzimuthAngle",1/0),CH(this,"enableDamping",!1),CH(this,"dampingFactor",.05),CH(this,"enableZoom",!0),CH(this,"zoomSpeed",1),CH(this,"enableRotate",!0),CH(this,"rotateSpeed",1),CH(this,"enablePan",!0),CH(this,"panSpeed",1),CH(this,"screenSpacePanning",!0),CH(this,"keyPanSpeed",7),CH(this,"zoomToCursor",!1),CH(this,"autoRotate",!1),CH(this,"autoRotateSpeed",2),CH(this,"reverseOrbit",!1),CH(this,"reverseHorizontalOrbit",!1),CH(this,"reverseVerticalOrbit",!1),CH(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),CH(this,"mouseButtons",{LEFT:el.ROTATE,MIDDLE:el.DOLLY,RIGHT:el.PAN}),CH(this,"touches",{ONE:nl.ROTATE,TWO:nl.DOLLY_PAN}),CH(this,"target0"),CH(this,"position0"),CH(this,"zoom0"),CH(this,"_domElementKeyEvents",null),CH(this,"getPolarAngle"),CH(this,"getAzimuthalAngle"),CH(this,"setPolarAngle"),CH(this,"setAzimuthalAngle"),CH(this,"getDistance"),CH(this,"getZoomScale"),CH(this,"listenToKeyEvents"),CH(this,"stopListenToKeyEvents"),CH(this,"saveState"),CH(this,"reset"),CH(this,"update"),CH(this,"connect"),CH(this,"dispose"),CH(this,"dollyIn"),CH(this,"dollyOut"),CH(this,"getScale"),CH(this,"setScale"),this.object=t,this.domElement=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=t=>{let e=kH(t,2*Math.PI),i=c.phi;i<0&&(i+=2*Math.PI),e<0&&(e+=2*Math.PI);let r=Math.abs(e-i);2*Math.PI-r<r&&(e<i?e+=2*Math.PI:i+=2*Math.PI),u.phi=e-i,n.update()},this.setAzimuthalAngle=t=>{let e=kH(t,2*Math.PI),i=c.theta;i<0&&(i+=2*Math.PI),e<0&&(e+=2*Math.PI);let r=Math.abs(e-i);2*Math.PI-r<r&&(e<i?e+=2*Math.PI:i+=2*Math.PI),u.theta=e-i,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=t=>{t.addEventListener("keydown",K),this._domElementKeyEvents=t},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",K),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),s=o.NONE},this.update=(()=>{const e=new Qh,r=new Qh(0,1,0),a=(new $h).setFromUnitVectors(t.up,r),p=a.clone().invert(),f=new Qh,m=new $h,g=2*Math.PI;return function(){const y=n.object.position;a.setFromUnitVectors(t.up,r),p.copy(a).invert(),e.copy(y).sub(n.target),e.applyQuaternion(a),c.setFromVector3(e),n.autoRotate&&s===o.NONE&&C(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let v=n.minAzimuthAngle,_=n.maxAzimuthAngle;isFinite(v)&&isFinite(_)&&(v<-Math.PI?v+=g:v>Math.PI&&(v-=g),_<-Math.PI?_+=g:_>Math.PI&&(_-=g),c.theta=v<=_?Math.max(v,Math.min(_,c.theta)):c.theta>(v+_)/2?Math.max(v,c.theta):Math.min(_,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.zoomToCursor&&M||n.object.isOrthographicCamera?c.radius=O(c.radius):c.radius=O(c.radius*h),e.setFromSpherical(c),e.applyQuaternion(p),y.copy(n.target).add(e),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),d.set(0,0,0));let x=!1;if(n.zoomToCursor&&M){let i=null;if(n.object instanceof $f&&n.object.isPerspectiveCamera){const t=e.length();i=O(t*h);const r=t-i;n.object.position.addScaledVector(w,r),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const t=new Qh(S.x,S.y,0);t.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix(),x=!0;const r=new Qh(S.x,S.y,0);r.unproject(n.object),n.object.position.sub(r).add(t),n.object.updateMatrixWorld(),i=e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(PH.origin.copy(n.object.position),PH.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(PH.direction))<RH?t.lookAt(n.target):(IH.setFromNormalAndCoplanarPoint(n.object.up,n.target),PH.intersectPlane(IH,n.target))))}else n.object instanceof F_&&n.object.isOrthographicCamera&&(x=1!==h,x&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/h)),n.object.updateProjectionMatrix()));return h=1,M=!1,!!(x||f.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(i),f.copy(n.object.position),m.copy(n.object.quaternion),x=!1,!0)}})(),this.connect=t=>{n.domElement=t,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",J),n.domElement.addEventListener("pointerdown",q),n.domElement.addEventListener("pointercancel",X),n.domElement.addEventListener("wheel",Y)},this.dispose=()=>{var t,e,i,r,a,o;n.domElement&&(n.domElement.style.touchAction="auto"),null==(t=n.domElement)||t.removeEventListener("contextmenu",J),null==(e=n.domElement)||e.removeEventListener("pointerdown",q),null==(i=n.domElement)||i.removeEventListener("pointercancel",X),null==(r=n.domElement)||r.removeEventListener("wheel",Y),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointermove",Z),null==(o=n.domElement)||o.ownerDocument.removeEventListener("pointerup",X),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",K)};const n=this,i={type:"change"},r={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const l=1e-6,c=new Zx,u=new Zx;let h=1;const d=new Qh,p=new Jh,f=new Jh,m=new Jh,g=new Jh,y=new Jh,v=new Jh,_=new Jh,x=new Jh,b=new Jh,w=new Qh,S=new Jh;let M=!1;const T=[],E={};function A(){return Math.pow(.95,n.zoomSpeed)}function C(t){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=t:u.theta-=t}function P(t){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=t:u.phi-=t}const I=(()=>{const t=new Qh;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),d.add(t)}})(),R=(()=>{const t=new Qh;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),d.add(t)}})(),k=(()=>{const t=new Qh;return function(e,i){const r=n.domElement;if(r&&n.object instanceof $f&&n.object.isPerspectiveCamera){const a=n.object.position;t.copy(a).sub(n.target);let o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),I(2*e*o/r.clientHeight,n.object.matrix),R(2*i*o/r.clientHeight,n.object.matrix)}else r&&n.object instanceof F_&&n.object.isOrthographicCamera?(I(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),R(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function L(t){n.object instanceof $f&&n.object.isPerspectiveCamera||n.object instanceof F_&&n.object.isOrthographicCamera?h=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D(t){L(h/t)}function z(t){L(h*t)}function N(t){if(!n.zoomToCursor||!n.domElement)return;M=!0;const e=n.domElement.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top,a=e.width,o=e.height;S.x=i/a*2-1,S.y=-r/o*2+1,w.set(S.x,S.y,1).unproject(n.object).sub(n.object.position).normalize()}function O(t){return Math.max(n.minDistance,Math.min(n.maxDistance,t))}function F(t){p.set(t.clientX,t.clientY)}function B(t){g.set(t.clientX,t.clientY)}function U(){if(1==T.length)p.set(T[0].pageX,T[0].pageY);else{const t=.5*(T[0].pageX+T[1].pageX),e=.5*(T[0].pageY+T[1].pageY);p.set(t,e)}}function j(){if(1==T.length)g.set(T[0].pageX,T[0].pageY);else{const t=.5*(T[0].pageX+T[1].pageX),e=.5*(T[0].pageY+T[1].pageY);g.set(t,e)}}function V(){const t=T[0].pageX-T[1].pageX,e=T[0].pageY-T[1].pageY,n=Math.sqrt(t*t+e*e);_.set(0,n)}function H(t){if(1==T.length)f.set(t.pageX,t.pageY);else{const e=Q(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);f.set(n,i)}m.subVectors(f,p).multiplyScalar(n.rotateSpeed);const e=n.domElement;e&&(C(2*Math.PI*m.x/e.clientHeight),P(2*Math.PI*m.y/e.clientHeight)),p.copy(f)}function G(t){if(1==T.length)y.set(t.pageX,t.pageY);else{const e=Q(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);y.set(n,i)}v.subVectors(y,g).multiplyScalar(n.panSpeed),k(v.x,v.y),g.copy(y)}function W(t){const e=Q(t),i=t.pageX-e.x,r=t.pageY-e.y,a=Math.sqrt(i*i+r*r);x.set(0,a),b.set(0,Math.pow(x.y/_.y,n.zoomSpeed)),D(b.y),_.copy(x)}function q(t){var e,i;!1!==n.enabled&&(0===T.length&&(null==(e=n.domElement)||e.ownerDocument.addEventListener("pointermove",Z),null==(i=n.domElement)||i.ownerDocument.addEventListener("pointerup",X)),function(t){T.push(t)}(t),"touch"===t.pointerType?function(t){switch($(t),T.length){case 1:switch(n.touches.ONE){case nl.ROTATE:if(!1===n.enableRotate)return;U(),s=o.TOUCH_ROTATE;break;case nl.PAN:if(!1===n.enablePan)return;j(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(n.touches.TWO){case nl.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&j(),s=o.TOUCH_DOLLY_PAN;break;case nl.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&U(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(r)}(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case el.DOLLY:if(!1===n.enableZoom)return;!function(t){N(t),_.set(t.clientX,t.clientY)}(t),s=o.DOLLY;break;case el.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;B(t),s=o.PAN}else{if(!1===n.enableRotate)return;F(t),s=o.ROTATE}break;case el.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;F(t),s=o.ROTATE}else{if(!1===n.enablePan)return;B(t),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(r)}(t))}function Z(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch($(t),s){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;H(t),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;G(t),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&W(t),n.enablePan&&G(t)}(t),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&W(t),n.enableRotate&&H(t)}(t),n.update();break;default:s=o.NONE}}(t):function(t){if(!1===n.enabled)return;switch(s){case o.ROTATE:if(!1===n.enableRotate)return;!function(t){f.set(t.clientX,t.clientY),m.subVectors(f,p).multiplyScalar(n.rotateSpeed);const e=n.domElement;e&&(C(2*Math.PI*m.x/e.clientHeight),P(2*Math.PI*m.y/e.clientHeight)),p.copy(f),n.update()}(t);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(t){x.set(t.clientX,t.clientY),b.subVectors(x,_),b.y>0?D(A()):b.y<0&&z(A()),_.copy(x),n.update()}(t);break;case o.PAN:if(!1===n.enablePan)return;!function(t){y.set(t.clientX,t.clientY),v.subVectors(y,g).multiplyScalar(n.panSpeed),k(v.x,v.y),g.copy(y),n.update()}(t)}}(t))}function X(t){var e,i,r;!function(t){delete E[t.pointerId];for(let e=0;e<T.length;e++)if(T[e].pointerId==t.pointerId)return void T.splice(e,1)}(t),0===T.length&&(null==(e=n.domElement)||e.releasePointerCapture(t.pointerId),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointermove",Z),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointerup",X)),n.dispatchEvent(a),s=o.NONE}function Y(t){!1===n.enabled||!1===n.enableZoom||s!==o.NONE&&s!==o.ROTATE||(t.preventDefault(),n.dispatchEvent(r),function(t){N(t),t.deltaY<0?z(A()):t.deltaY>0&&D(A()),n.update()}(t),n.dispatchEvent(a))}function K(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:k(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:k(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:k(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:k(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function J(t){!1!==n.enabled&&t.preventDefault()}function $(t){let e=E[t.pointerId];void 0===e&&(e=new Jh,E[t.pointerId]=e),e.set(t.pageX,t.pageY)}function Q(t){const e=t.pointerId===T[0].pointerId?T[1]:T[0];return E[e.pointerId]}this.dollyIn=function(){z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A()),n.update()},this.dollyOut=function(){D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A()),n.update()},this.getScale=()=>h,this.setScale=t=>{L(t),n.update()},this.getZoomScale=()=>A(),void 0!==e&&this.connect(e),this.update()}}const DH=["makeDefault","camera","regress","domElement","enableDamping","keyEvents","onChange","onStart","onEnd"],zH=i.forwardRef((t,e)=>{let{makeDefault:n,camera:r,regress:a,domElement:o,enableDamping:s=!0,keyEvents:l=!1,onChange:c,onStart:u,onEnd:h}=t,d=Qe(t,DH);const p=RT(t=>t.invalidate),f=RT(t=>t.camera),m=RT(t=>t.gl),g=RT(t=>t.events),y=RT(t=>t.setEvents),v=RT(t=>t.set),_=RT(t=>t.get),x=RT(t=>t.performance),b=r||f,w=o||g.connected||m.domElement,S=i.useMemo(()=>new LH(b),[b]);return kT(()=>{S.enabled&&S.update()},-1),i.useEffect(()=>(l&&S.connect(!0===l?w:l),S.connect(w),()=>{S.dispose()}),[l,w,a,S,p]),i.useEffect(()=>{const t=t=>{p(),a&&x.regress(),c&&c(t)},e=t=>{u&&u(t)},n=t=>{h&&h(t)};return S.addEventListener("change",t),S.addEventListener("start",e),S.addEventListener("end",n),()=>{S.removeEventListener("start",e),S.removeEventListener("end",n),S.removeEventListener("change",t)}},[c,u,h,S,p,y]),i.useEffect(()=>{if(n){const t=_().controls;return v({controls:S}),()=>v({controls:t})}},[n,S]),i.createElement("primitive",xE({ref:e,object:S,enableDamping:s},d))});function NH(){const t=(0,i.useRef)(),e=(0,i.useRef)(),n=(0,i.useRef)(),r=(0,i.useMemo)(()=>{const t=document.createElement("canvas");t.width=2048,t.height=1024;const e=t.getContext("2d"),n=e.createRadialGradient(1024,512,0,1024,512,1024);return n.addColorStop(0,"#1e40af"),n.addColorStop(.5,"#1e3a8a"),n.addColorStop(1,"#0f172a"),e.fillStyle=n,e.fillRect(0,0,2048,1024),e.fillStyle="#16a34a",e.beginPath(),e.ellipse(1100,600,150,200,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(1050,300,80,60,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(1400,400,200,150,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(400,350,180,120,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(500,650,80,150,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(1600,750,100,60,0,0,2*Math.PI),e.fill(),e.fillStyle="#ca8a04",e.beginPath(),e.ellipse(1e3,450,100,60,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(1200,700,80,40,0,0,2*Math.PI),e.fill(),new ry(t)},[]),a=(0,i.useMemo)(()=>{const t=document.createElement("canvas");t.width=1024,t.height=512;const e=t.getContext("2d");e.clearRect(0,0,1024,512),e.fillStyle="rgba(255, 255, 255, 0.6)";for(let n=0;n<20;n++){const t=1024*Math.random(),n=512*Math.random(),i=50*Math.random()+20;e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fill()}return new ry(t)},[]);return kT(i=>{t.current&&(t.current.rotation.y+=.003),n.current&&(n.current.rotation.y+=.002),e.current&&(e.current.rotation.y+=.001)}),(0,zt.jsxs)("group",{children:[(0,zt.jsx)(SE,{ref:t,args:[2,64,64],children:(0,zt.jsx)("meshPhongMaterial",{map:r,shininess:1,specular:"#004080",bumpScale:.1})}),(0,zt.jsx)(SE,{ref:n,args:[2.02,32,32],children:(0,zt.jsx)("meshLambertMaterial",{map:a,transparent:!0,opacity:.6,depthWrite:!1})}),(0,zt.jsx)(SE,{ref:e,args:[2.1,32,32],children:(0,zt.jsx)("meshBasicMaterial",{color:"#87ceeb",transparent:!0,opacity:.15,side:dl,depthWrite:!1})})]})}function OH(){const t=(0,i.useRef)(),[e,n]=(0,i.useState)(0);return kT(i=>{if(n(i.clock.elapsedTime),t.current){const n=6,i=.5;t.current.position.x=Math.cos(e*i)*n,t.current.position.z=Math.sin(e*i)*n,t.current.position.y=2*Math.sin(e*i*.5),t.current.rotation.x+=.01,t.current.rotation.y+=.02}}),(0,zt.jsxs)("mesh",{ref:t,children:[(0,zt.jsx)("dodecahedronGeometry",{args:[.3,0]}),(0,zt.jsx)("meshStandardMaterial",{color:"#ff4400ff",roughness:.8,metalness:.2})]})}function FH(){const t=[];for(let e=0;e<=100;e++){const n=e/100,i=n*Math.PI*4,r=6-2*n,a=Math.cos(i)*r,o=Math.sin(i)*r,s=2*Math.sin(.5*i);t.push(new Qh(a,s,o))}return(0,zt.jsx)(SH,{points:t,color:"#00d4ff",lineWidth:2,dashed:!0,dashSize:.1,gapSize:.05})}function BH(){const t=(0,i.useRef)(),e=(0,i.useMemo)(()=>{const t=[];for(let e=0;e<2e3;e++){const e=100+100*Math.random(),n=Math.random()*Math.PI*2,i=Math.random()*Math.PI,r=e*Math.sin(i)*Math.cos(n),a=e*Math.sin(i)*Math.sin(n),o=e*Math.cos(i);t.push(r,a,o)}return new Float32Array(t)},[]);return kT(e=>{t.current&&(t.current.rotation.y+=2e-4)}),(0,zt.jsxs)("points",{ref:t,children:[(0,zt.jsx)("bufferGeometry",{children:(0,zt.jsx)("bufferAttribute",{attachObject:["attributes","position"],count:e.length/3,array:e,itemSize:3})}),(0,zt.jsx)("pointsMaterial",{size:.5,sizeAttenuation:!0,color:"#ffffff",transparent:!0,opacity:.8})]})}const UH=function(){return(0,zt.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative"},children:[(0,zt.jsxs)(_E,{camera:{position:[8,4,8],fov:50},style:{background:"transparent"},gl:{antialias:!0,alpha:!0},children:[(0,zt.jsx)("ambientLight",{intensity:.15,color:"#404080"}),(0,zt.jsx)("directionalLight",{position:[10,0,5],intensity:1.2,color:"#ffffff",castShadow:!0}),(0,zt.jsx)("pointLight",{position:[-10,-10,-10],intensity:.3,color:"#4040ff"}),(0,zt.jsxs)("mesh",{children:[(0,zt.jsx)("sphereGeometry",{args:[200,32,32]}),(0,zt.jsx)("meshBasicMaterial",{color:"#000005",side:dl,transparent:!0,opacity:1})]}),(0,zt.jsx)(BH,{}),(0,zt.jsx)(NH,{}),(0,zt.jsx)(OH,{}),(0,zt.jsx)(FH,{}),(0,zt.jsx)(zH,{enablePan:!1,enableZoom:!0,enableRotate:!0,autoRotate:!0,autoRotateSpeed:.3,maxDistance:15,minDistance:5,maxPolarAngle:.8*Math.PI,minPolarAngle:.2*Math.PI})]}),(0,zt.jsx)("div",{style:{position:"absolute",bottom:"20px",right:"20px",background:"rgba(255, 107, 53, 0.15)",border:"1px solid rgba(255, 107, 53, 0.4)",padding:"0.5rem 1rem",borderRadius:"12px",backdropFilter:"blur(10px)",color:"#ff6b35",fontSize:"0.85rem",fontWeight:"600",textShadow:"0 0 10px rgba(255, 107, 53, 0.5)"},children:(0,zt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,zt.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#ff6b35",boxShadow:"0 0 10px #ff6b35",animation:"pulse 2s infinite"}}),"IMPACT ZONE: Pacific Ocean"]})}),(0,zt.jsx)("style",{children:"\n          @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.5; }\n          }\n        "})]})};const jH=function(){return(0,zt.jsxs)("div",{className:"results",children:[(0,zt.jsx)("section",{className:"results-header",children:(0,zt.jsx)("div",{className:"container",children:(0,zt.jsxs)("div",{className:"header-content",children:[(0,zt.jsxs)("div",{className:"header-text",children:[(0,zt.jsx)("h1",{className:"results-title",children:"Impact Results"}),(0,zt.jsx)("p",{className:"results-subtitle",children:"Detailed impact simulation results for a 250m object at 19.3 km/s"}),(0,zt.jsxs)("div",{className:"impact-location",children:[(0,zt.jsx)("span",{className:"location-label",children:"Impact Location:"}),(0,zt.jsx)("span",{className:"location-value",children:"Asteroid Ocean at FL 69,047 W"})]}),(0,zt.jsxs)("div",{className:"action-buttons",children:[(0,zt.jsx)("button",{className:"btn btn--primary",children:"\ud83d\udce5 New Simulation"}),(0,zt.jsx)("button",{className:"btn btn--secondary",children:"\ud83d\udcca Download Report"})]})]}),(0,zt.jsx)("div",{className:"header-visual",children:(0,zt.jsx)(i.Suspense,{fallback:(0,zt.jsx)("div",{className:"loading-spinner"}),children:(0,zt.jsx)(UH,{})})})]})})}),(0,zt.jsx)("section",{className:"metrics-section",children:(0,zt.jsx)("div",{className:"container",children:(0,zt.jsxs)("div",{className:"metrics-grid",children:[(0,zt.jsx)(ZV,{}),(0,zt.jsx)(KV,{}),(0,zt.jsx)(XV,{}),(0,zt.jsx)(YV,{})]})})}),(0,zt.jsx)("section",{className:"analysis-section",children:(0,zt.jsx)("div",{className:"container",children:(0,zt.jsxs)("div",{className:"analysis-grid",children:[(0,zt.jsx)(WV,{}),(0,zt.jsx)(qV,{})]})})}),(0,zt.jsx)("section",{className:"new-simulation",children:(0,zt.jsx)("div",{className:"container",children:(0,zt.jsxs)("div",{className:"simulation-prompt",children:[(0,zt.jsx)("h2",{children:"Ready to Run Another Simulation?"}),(0,zt.jsx)("p",{children:"Customize asteroid parameters, impact location and more to see different scenarios and outcomes."}),(0,zt.jsx)("button",{className:"btn btn--primary btn--large",children:"New Simulation \u2192"})]})})}),(0,zt.jsx)("footer",{className:"results-footer",children:(0,zt.jsxs)("div",{className:"container",children:[(0,zt.jsxs)("div",{className:"footer-content",children:[(0,zt.jsxs)("div",{className:"footer-logo",children:[(0,zt.jsx)("div",{className:"logo-icon",children:(0,zt.jsx)("span",{className:"logo-text",children:"IE"})}),(0,zt.jsx)("span",{className:"logo-title",children:"Impact Explorer 2025"}),(0,zt.jsx)("p",{className:"footer-description",children:"Simulating asteroid impacts on Earth using real NASA data for research and education."})]}),(0,zt.jsxs)("div",{className:"footer-nav",children:[(0,zt.jsx)("h4",{children:"Navigation"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/",children:"Home"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/story",children:"Story Mode"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/dashboard",children:"Simulation Dashboard"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"/results",children:"Impact Results"})})]})]}),(0,zt.jsxs)("div",{className:"footer-sources",children:[(0,zt.jsx)("h4",{children:"Data Sources"}),(0,zt.jsxs)("ul",{children:[(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://cneos.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"NASA CNEOS"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://ssd.jpl.nasa.gov/",target:"_blank",rel:"noopener noreferrer",children:"JPL Small-Body Database"})}),(0,zt.jsx)("li",{children:(0,zt.jsx)("a",{href:"https://neo.ssa.esa.int/",target:"_blank",rel:"noopener noreferrer",children:"NASA NEO Program"})})]})]})]}),(0,zt.jsxs)("div",{className:"footer-bottom",children:[(0,zt.jsx)("p",{children:"\xa9 2025 Impact Explorer 2025. All rights reserved."}),(0,zt.jsx)("p",{children:"Powered by NASA data. This is a simulation tool for educational purposes."})]})]})})]})};const VH=function(){return(0,i.useEffect)(()=>{document.documentElement.classList.add("dark-mode"),document.documentElement.classList.remove("light-mode")},[]),(0,zt.jsx)(Bt,{children:(0,zt.jsx)(Mt,{future:{v7_relativeSplatPath:!0,v7_fetcherPersist:!0,v7_normalizeFormMethod:!0},children:(0,zt.jsxs)("div",{className:"App",children:[(0,zt.jsx)(jt,{}),(0,zt.jsxs)(vt,{children:[(0,zt.jsx)(gt,{path:"/",element:(0,zt.jsx)(UE,{})}),(0,zt.jsx)(gt,{path:"/story",element:(0,zt.jsx)(jE,{})}),(0,zt.jsx)(gt,{path:"/dashboard",element:(0,zt.jsx)(GV,{})}),(0,zt.jsx)(gt,{path:"/results",element:(0,zt.jsx)(jH,{})})]})]})})})};a.createRoot(document.getElementById("root")).render((0,zt.jsx)(i.StrictMode,{children:(0,zt.jsx)(VH,{})}))})()})();